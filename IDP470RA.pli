* PROCESS ATTRIBUTES,XREF,AGGREGATE;                                    00001   
        /* DATA SET IDP470RA   AT LEVEL 255 AS OF 16/03/10    */        00002   
 /*------------------------------------------------------------------*/ 00003   
 /* 13/05/2014 - A. MICHOT                                           */ 00004   
 /* ''''''''''''''''''''''                                           */ 00005   
 /* MIGRATION BMP                                                    */ 00006   
 /*                                                                  */ 00007   
 /*------------------------------------------------------------------*/ 00008   
 /*!!!!!!!!!!!!!!!!!!!!!!!!!! JANVIER 2011 !!!!!!!!!!!!!!!!!!!!!!*/     00009   
 /*!!!!    OKOKOK     A M O D E 31 / R M O D E ANY           !!!!*/     00010   
 /*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/     00011   
 /****************************************************************/     00012   
 /* YBD 10/02/2015 TBNUDIV PASSE A 5000 POSTES                   */     00013   
 /* PCA 20150630 MISE A ZERO TAUX TVA EXPORT                     */     00014   
 /* PCA 20150825 CONTROLE CARACTERES SPECIAUX REFLI              */     00015   
 /* EDI-154 20210224 MISE A ZERO TAUX TVA EXPORT: FICHIER FICSTOD*/     00016   
 /*         N'A PAS �T� MIS EN PRODUCTION, JIRA �CART�           */     00017   
 /* IDIL-142 20211108 CORRECTION SUIT INC026531081               */     00018   
 /* EDI-351 18/09/2024 CORRECTION INIT WPOFIS POUR TBCOTAX       */     00019   
 /* IDIL-281 08/07/2025 CORRECTION FORMAT IMPRESION FACTURES     */     00020   
 /****************************************************************/     00021   
 /* ID470RA:        PROCEDURE(PCLI) OPTIONS(MAIN) REORDER;       */     00022   
1   ID470RA:        PROCEDURE(IO_PTR_PCB,PCLI) OPTIONS(MAIN) REORDER;   00023   
                    DEFAULT RANGE(*) STATIC ;                           00024   
0      DCL FEDITI   FILE RECORD OUTPUT; /*   JOURNAL DE FACTURATION   */00025   
                                        /*   BORDEREAUX COMPTANT      */00026   
                                        /*   FICHIER DES ANOMALIES    */00027   
                                        /*   FICH. TRAVAIL FACT. MULTI*/00028   
       DCL FRESUL   FILE RECORD OUTPUT; /*   RESULTATS DE FACTURATION */00029   
       DCL FMICRO   FILE RECORD OUTPUT; /*   FICHIER DES F BORDEREAU  */00030   
       DCL FIPAGE   FILE RECORD OUTPUT; /*   FICHIER INDEX PAGE-FACTUR*/00031   
       DCL FHISTO   FILE RECORD OUTPUT; /*   FICHIER HISTORIQUE ACCORD*/00032   
       DCL CANADA4P FILE RECORD OUTPUT; /*   FICHIER CANADA PROFORMA  */00033   
       DCL EXPOHARR FILE RECORD OUTPUT; /*   FICHIER EXPORT INFOCENTRE*/00034   
                                                                        00035   
                     /* YDU/YHM DEBUT AJOUT LE 22 10 02  PCF */         00036   
       DCL IDDPCFEN FILE RECORD OUTPUT; /* ENTETE FACTURE PCF         */00037   
       DCL IDDPCFLI FILE RECORD OUTPUT; /* LIGNES FACTURE PCF         */00038   
       DCL IDDPCFIN FILE RECORD OUTPUT; /* INDEX BX LIVRAISON PCF     */00039   
                     /* YDU/YHM FIN   AJOUT LE 22 10 02 PCF */          00040   
                                                                        00041   
                     /* 3 DEBUT AJOUT LE 15 01 97  */                   00042   
       DCL IDPIEDF5 FILE RECORD OUTPUT; /* ANALYSE PIED DE FACTURE    */00043   
                                        /* COMPLEMENT REF.DE COMMANDE */00044   
       DCL IDREFCO1 FILE RECORD DIRECT KEYED INPUT ENV(VSAM) ;          00045   
                    /*   FIN   AJOUT LE 15 01 97  */                    00046   
       DCL FICDEMA  FILE RECORD OUTPUT; /*   FICHIER FACT. DEMAT.12-04*/00047   
       DCL FICLCOM  FILE RECORD OUTPUT; /*   FICHIER LOG.  DEMAT.12-04*/00048   
                                                                        00049   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                00050   
  /* FICHIERS DE STOCKAGE DES FACTURES D�MAT�RIALIS�ES ET PAPIER */     00051   
       DCL FICSTOD  FILE RECORD OUTPUT; /*   FICHIER STOCK FACT DEMAT */00052   
       DCL FICSTOP  FILE RECORD OUTPUT; /*   FICHIER STOCK FACT PAPIER*/00053   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                00054   
                                                                        00055   
0      DCL FFAC3A   FILE RECORD INPUT;  /*   FICHIER A FACTURER       */00056   
                                                                        00057   
                                        /*   AJOUT LE 03 10 06 YFB    */00058   
       DCL FIRENT   FILE RECORD DIRECT KEYED INPUT ENV(VSAM) ;          00059   
                                        /*   DEBUT AJOUT LE 03 11 92  */00060   
       DCL FEXCLI   FILE RECORD DIRECT KEYED INPUT ENV(VSAM) ;          00061   
                                        /*   FICHIER AUXILIAIRE CLIENT*/00062   
                                        /*   EXPORT                   */00063   
                                        /*   FIN AJOUT                */00064   
0                                       /*   TABLES DU SYSTEME TABLE  */00065   
                                        /*             TBLIFAC  1045  */00066   
                                        /*             TBOPSPE  1215  */00067   
                                        /*             TBNUEDI  1305  */00068   
                                        /*             TBNUDIV  1310  */00069   
                                        /*             TBEDICO  1315  */00070   
                                        /*             TBCOTAX  1330  */00071   
                                        /*             TBECFAC  1365  */00072   
                                        /*             TBVENET  1370  */00073   
                                        /*             TBACRDL  1415  */00074   
                                        /*             TBFASUC  1416  */00075   
                                        /*             TBECHEA  1425  */00076   
                                        /*             TBMOREG  1430  */00077   
                                        /*             TBCADOR  1440  */00078   
                                        /*             TBDEPAY  1455  */00079   
                                        /*             TBZONTI  1640  */00080   
                                        /*             TBTRANS  1875  */00081   
                                        /*   MTAB      MERNUCLI       */00082   
                                        /*   SPOOL1    FACTURES CDL   */00083   
                                        /*   SPOOL2    FACTURES GIH   */00084   
                                        /*   SPOOL3    FACTURES CRDL  */00085   
                                        /*   SPOOL4    + CLIFA NUCLI  */00086   
                                        /*   SPOOL7    EXPORT AUTOMAT.*/00087   
                                        /*   SPOOL8    EXP CLIFA NUCLI*/00088   
1                                                                       00089   
  /* **++INCLUDE DCLDLI */                                              00090   
 /*    INCLUDE++ BMPPLI                                               */00091   
        /* DATA SET BMPPLI     AT LEVEL 009 AS OF 21/04/05    */                
         DCL   PLITDLI ENTRY ;                                          00001**6
  /*-----------------------------------------------------------------*/ 00002**6
  /*    DECLARATIONS  DL/1 - BMP       DATE    : AVRIL 2005          */ 00003**6
  /*                                                                 */ 00004**6
  /*    MIGRATION DES PROGRAMMES BATCH DLI EN BATCH BMP (DBCTL)      */ 00005**6
  /*    AJOUT DE LA FONCTIONNALITE IO-PCB RESERVE A DBCTL            */ 00006**6
  /*    MOT CLE DE RECHERCHE DES MODIFICATIONS : IMS-BMP             */ 00007**6
  /*-----------------------------------------------------------------*/ 00008**6
  /*                       DESCRIPTION PCB                           */ 00009**6
  DCL   PSBNAME CHAR(8) ;                      /* NOM DU PSB         */ 00010**6
                                                                        00011**6
  /* IMS-BMP                                                         */ 00012**7
  /* LE POINTER : IO_PTR_PCB DOIT ETRE LE PREMIER PARAMETRE DU       */ 00013**8
  /* PROGRAMME PL1.                                                  */ 00014**7
                                                                        00015**7
  DCL IO_PTR_PCB             POINTER;                                   00016**7
  DCL 1 IO_PCB               BASED (IO_PTR_PCB),                        00017**6
        2   FILLER           CHAR(10),                                  00018**6
        2   IO_PCB_STAT      CHAR(2);                                   00019**9
                                                                        00020**7
  /* FIN IMS-BMP                                                     */ 00021**7
                                                                        00022**6
  DCL   1   PCB_PROTOTYPE                   ,                           00023**6
         2   ID                             ,                           00024**6
           3  NAME       CHAR(8)            ,  /* NOM DE LA BASE     */ 00025**6
           3  SEGLVL     CHAR(2)            ,  /* NIVEAU DU SEGMENT  */ 00026**6
           3  SC         CHAR(2)            ,  /* STATUS-CODE        */ 00027**6
           3  PROCOPT    CHAR(4)            ,  /* OPTIONS TRAITEMENT */ 00028**6
           3  RDLI       FIXED   BIN(31,0)  ,                           00029**6
           3  SEGNM      CHAR(8)            ,  /* NOM SEGMENT-TYPE   */ 00030**6
           3  LFBK       FIXED   BIN(31,0)  ,  /* LG CLE CONCATENEE  */ 00031**6
           3  NBSEN      FIXED   BIN(31,0)  ;  /* NBRE SEG.SENSITIFS */ 00032**6
          /* CETTE DESCRIPTION NE CONTIENT PAS LA CLE */                00033**6
          /* CONCATENEE (LG VARIABLE , STRUCTURE)     */                00034**6
                                                                        00035**6
  /*                       DESCRIPTION SSA                           */ 00036**6
                                                                        00037**6
  DCL   1   SSA_PROTOTYPE                   ,                           00038**6
          2   ID                            ,                           00039**6
           3  NAME       CHAR(8)            ,  /* ZONE SEGMENT-TYPE  */ 00040**6
           3  QUAL       CHAR(1) INIT ('(') ,                           00041**6
           3  KNAME      CHAR(8)            ,  /*  CLE NOM DE CHAMP  */ 00042**6
           3  OPER       CHAR(2)            ;  /* ZONE OPERATEUR     */ 00043**6
          /* CETTE DESCRIPTION NE CONTIENT PAS LA VALEUR DE */          00044**6
          /* COMPARAISON NI LA PARENTHESE DROITE DU SSA     */          00045**6
                                                                        00046**6
- /*                        CODES FONCTION                           */ 00047**6
                                                                        00048**6
  DCL   GU     CHAR(4)   INIT   ('GU  ') STATIC ;                       00049**6
  DCL   GN     CHAR(4)   INIT   ('GN  ') STATIC ;                       00050**6
  DCL   GHU    CHAR(4)   INIT   ('GHU ') STATIC ;                       00051**6
  DCL   GHN    CHAR(4)   INIT   ('GHN ') STATIC ;                       00052**6
  DCL   GNP    CHAR(4)   INIT   ('GNP ') STATIC ;                       00053**6
  DCL   GHNP   CHAR(4)   INIT   ('GHNP') STATIC ;                       00054**6
  DCL   ISRT   CHAR(4)   INIT   ('ISRT') STATIC ;                       00055**6
  DCL   DLET   CHAR(4)   INIT   ('DLET') STATIC ;                       00056**6
  DCL   REPL   CHAR(4)   INIT   ('REPL') STATIC ;                       00057**6
  DCL   PCB    CHAR(4)   INIT   ('PCB ') STATIC ;                       00058**6
  DCL   TERM   CHAR(4)   INIT   ('TERM') STATIC ;                       00059**6
                                                                        00060**6
  /*            COMPTEURS DES PARAMETRES DU CALL                     */ 00061**6
                                                                        00062**6
  DCL   N01    FIXED   BIN(31,0)   INIT   (1)   STATIC ;                00063**6
  DCL   N02    FIXED   BIN(31,0)   INIT   (2)   STATIC ;                00064**6
  DCL   N03    FIXED   BIN(31,0)   INIT   (3)   STATIC ;                00065**6
  DCL   N04    FIXED   BIN(31,0)   INIT   (4)   STATIC ;                00066**6
  DCL   N05    FIXED   BIN(31,0)   INIT   (5)   STATIC ;                00067**6
  DCL   N06    FIXED   BIN(31,0)   INIT   (6)   STATIC ;                00068**6
  DCL   N07    FIXED   BIN(31,0)   INIT   (7)   STATIC ;                00069**6
  DCL   N08    FIXED   BIN(31,0)   INIT   (8)   STATIC ;                00070**6
  DCL   N09    FIXED   BIN(31,0)   INIT   (9)   STATIC ;                00071**6
  DCL   N10    FIXED   BIN(31,0)   INIT   (10)  STATIC ;                00072**6
 /*    END INCLUDE++                                                  */        
1                                                                       00092   
                                        /*   INCLUDE IDDCLIP          */00093   
                                        /*   INCLUDE GEDCLIPG         */00094   
 /*    INCLUDE++ IDDCLIP                                              */00095   
0/* PL1CMS VER 01 * MOD. IDDCLIP * LIB INC * LE 02/07/81 A 15:46:34 */  00000000
        /* DATA SET IDDCLIPR   AT LEVEL 008 AS OF 13/04/88    */                
0  /*************************/                                          00001   
   /* D A T A  B A S E      */  /* NOUVELLE VERSION POUR  G E C I     */00002   
   /*   C L I E N T         */                                          00003   
   /*************************/                                          00004   
                                            /* VERSION DU 17/10/80 */   00005   
   /*************************/                                          00006   
   /* SEGMENT CLIENT        */                                          00007   
   /*************************/                                          00008   
                                        /* LONGUEUR DU DBD = 780 */     00009   
0DCL 01 WTCLI BASED(PWTCLI),                                            00010   
0             /*  GENERAL    */                                         00011   
   20 NUCLI   CHAR(6),   /* NUMERO CLIENT (AVEC MODULUS)              */00012   
                         /*$ NOMOD,ECR01,INDSE,INTER                  */00013   
   20 CECLI   CHAR(1),   /* CODE ETAT CLIENT                          */00014   
                         /* 0 = CLIENT EXISTANT   1 = CLIENT SUPPRIME */00015   
                         /* 9 = CLIENT EN COURS D'INSTALLATION        */00016   
                         /*$ NOMOD,ECR01                              */00017   
   20 MAJPO   FIXED DEC(3),/* COMPTEUR DE MISE A JOUR PONCTUELLE      */00018   
   20 MAJGE   FIXED DEC(3),/* COMPTEUR DE MISE A JOUR GENERALISEE     */00019   
   20 TYCOM   CHAR(01),  /* TYPE DE COMPTE                            */00020   
                         /* 9 = CLIENT DE LIVRAISON                   */00021   
                         /* 8 = CLIENT NORMAL                         */00022   
                         /* 6 = REGROUPEMENT FACTURATION              */00023   
                         /* 4 = REGROUPEMENT COMPTABLE                */00024   
                         /* 2 = REGROUPEMENT STATISTIQUE              */00025   
                         /*$ ECR01,INTER                              */00026   
   20 AUTIN   CHAR(01),  /* EXISTENCE SEGMENT AUTORISE INTERDIT       */00027   
                         /* 0 = NON - 1 = OUI                         */00028   
                         /*$ ECR01,NOMOD                              */00029   
   20 BASEC   CHAR(1) ,  /* EXISTENCE BARETTE SECOND. DE TARIFICATION */00030   
                         /* 0 = NON - 1 = OUI                         */00031   
                         /*$ ECR01,NOMOD,INTER                        */00032   
   20 COLOF   CHAR(1) ,  /* EXISTENCE COLLECTION OFFICE               */00033   
                         /* 0 = NON - 1 = OUI                         */00034   
                         /*$ ECR01,NOMOD                              */00035   
   20 GRPOF   CHAR(1) ,  /* EXISTENCE GROUPE PRODUIT OFFICE           */00036   
                         /* 0 = NON - 1 = OUI                         */00037   
                         /*$ ECR01,NOMOD                              */00038   
   20 RASOC   CHAR(26),  /* RAISON SOCIALE */ /*$ ECR01,INDSE */        00039   
   20 NOCLI   CHAR(15),  /* NOM DU CLIENT                             */00040   
                         /* OU SUITE RAISON SOCIALE POUR ETRANGER     */00041   
                         /*$ ECR01,INDSE                              */00042   
   20 ADCLI   CHAR(26),  /* ADRESSE DU CLIENT                         */00043   
                         /*$ ECR01,INDSE                              */00044   
   20 LORES   CHAR(15),  /* LOCALISATION RESIDENCE                    */00045   
                         /* OU SUITE ADRESSE POUR ETRANGER            */00046   
                         /*$ ECR01,INDSE                              */00047   
   20 CPCLI   CHAR(05),  /* CODE POSTAL                               */00048   
                         /*$ ECR01,INDSE                              */00049   
   20 LOBDI   CHAR(26),  /* LOCALITE BUREAU DISTRIBUTEUR              */00050   
                         /* OU VILLE ETRANGER                         */00051   
                         /*$ ECR01,INDSE                              */00052   
   20 PAYCL   CHAR(26),  /* PAYS                  */ /*$ ECR01,INDSE  */00053   
   20 CLILI   CHAR(06),  /* CLIENT LIVRAISON (ROUTAGE COMPLEMENTAIRE) */00054   
                         /*$ ECR01,INTER                              */00055   
   20 CLIFA   CHAR(06),  /* COMPTE REGROUPEMENT FACTURATION           */00056   
                         /*$ ECR01,INTER                              */00057   
   20 CLICO   CHAR(06),  /* COMPTE REGROUPEMENT COMPTABLE             */00058   
                         /*$ ECR01,INTER                              */00059   
   20 CLIST   CHAR(06),  /* COMPTE DE REGROUPEMENT STATISTIQUES       */00060   
                         /*$ ECR01,INTER                              */00061   
   20 OUFER   CHAR(01),  /* CODE OUVERT FERME                         */00062   
         /***        NOUVELLES VALEURS / JANVIER 1984           ***/    00063**5
         /*-----------------------------!-----!-------------------*/    00064**4
         /*                             ! MEV !    DIL            */    00065**5
         /*-----------------------------!-----!-------------------*/    00066**4
         /* 0=OUVERT                    ! OUI ! TOUTES NATOP      */    00067**3
         /*-----------------------------!-----!-------------------*/    00068**4
         /* 1= OUV. OFF/CDL  TOUT/CRDL  ! OUI ! SAUF NATOP 01,04  */    00069**4
         /*                             !     ! 02+MAGTI=001 ,5X  */    00070**4
         /*-----------------------------!-----!-------------------*/    00071**4
         /* 2= OUVERT CRDL - FERME CDL  ! NON !SAUF NATOP 01,04,05*/    00072**4
         /*                             !     ! 02+MAGTI=001 ,5X  */    00073**4
         /*-----------------------------!-----!-------------------*/    00074**4
         /* 3= LITIGE COMPTABLE         ! NON !SAUF NATOP 01,04,05*/    00075**4
         /* 4=CESSATION D'ACTIVITE      ! NON ! 02+MAGTI=001 ,6X  */    00076**5
         /*    FERMETURE PROVISOIRE     !     !                   */    00077**4
         /*                             !     !                   */    00078**4
         /*-----------------------------!-----!-------------------*/    00079**4
         /* 5= CLIENT COMPTANT          ! NON ! QUE NATOP 2X      */    00080**4
         /*-----------------------------!-----!-------------------*/    00081**4
         /* 6= COMPTE FINANCIER         ! NON ! QUE NATOP 12,14   */    00082**4
         /*-----------------------------!-----!-------------------*/    00083**4
         /* 7= FERME                    ! NON !   AUCUNES         */    00084**4
         /* 8= FERME CONTENTIEUX        ! NON !    NATOP          */    00085**4
         /* 9= EN VOIE DE SUPPRESSION   ! NON !  ACCEPTEES        */    00086**4
         /*-----------------------------!-----!-------------------*/    00087**4
                                                           /*$ ECR01 */ 00088   
   20 DEPCO   CHAR(02),  /* DEPARTEMENT COMPTABLE                     */00089   
                         /*$ ECR01,NCRIV,INTER                        */00090   
   20 TRACO   CHAR(01),  /* TRAITEMENT COMPTABLE                      */00091   
                         /* 0=C.A. , 2=CESSION , 3=TRANSFERT CDL      */00092   
                         /* 4 = FACTURATION EDITEUR                   */00093   
                         /*$ ECR01,NCRIV,INTER                        */00094   
   20 MAGES   CHAR(03),  /* MAGASIN GESTION                           */00095   
                         /*$ ECR01,INTER                              */00096   
   20 NCRDL   CHAR(03),  /* RATTACHEMENT CRDL POUR LOGISTIQUE         */00097   
                         /*$ ECR01                                    */00098   
0             /*  OFFICE     */                                         00099   
   20 CLOFN   CHAR(01),  /* OFFICE SUR NOUVEAUTE                      */00100   
                         /* 0 = NON , 1 = OUI                         */00101   
                         /*$ ECR02                                    */00102   
   20 CLOFR   CHAR(01),  /* OFFICE SUR REIMPRESSION                   */00103   
                         /* 0 = NON , 1 = OUI                         */00104   
                         /*$ ECR02                                    */00105   
   20 RECOF   CHAR(01),  /* RESPECT COLLECTION                        */00106   
                         /* 0 = NON , 1 = OUI                         */00107   
                         /*$ ECR02                                    */00108   
   20 NOURG   CHAR(01),   /* NOTE  URGENT                             */00109   
                         /* 0 = NON , 1 = OUI                         */00110   
                         /*$ ECR02                                    */00111   
   20 ENVOI   CHAR(01),  /* ENVOI                                     */00112   
                         /* 0=RECOIT TOUT,1=NE RECOIT RIEN ET ABANDON */00113   
                         /* DES NOTES,2=RECOIT LES NOTES ET ABANDON   */00114   
                         /* COMPLET OFFICE                            */00115   
                         /* 3=RECOIT OFFICE POUR COLLECTIONS X,Y,Z    */00116   
                         /*$ ECR02                                    */00117   
   20 DEREP   CHAR(06),  /* DATE DEBUT REPORT DES ENVOIS   AA/MM/JJ   */00118   
                         /*$ ECR02,INTER                              */00119   
   20 FIREP   CHAR(06),  /* DATE FIN   REPORT DES ENVOIS   AA/MM/JJ   */00120   
                         /*$ ECR02,INTER                              */00121   
   20 DOMOF   CHAR(01),  /* DOMAINE OFFICE                            */00122   
                         /*$ ECR02                                    */00123   
   20 CACLI   CHAR(02),  /* CATEGORIE DE CLIENT                       */00124   
                         /* OU  TYPE DE POSTE BB    */                  00125   
                         /*$ ECR02,NCRIV                              */00126   
   20 HORIZ   CHAR(01),  /* CRITERE VENTILATION HORIZONTALE SUR ETAT  */00127   
                         /*$ ECR02                                    */00128   
   20 RESER   CHAR(01),  /* RESPECT SERVICE                           */00129   
                         /* 0 = NON , 1 = OUI                         */00130   
                         /*$ ECR02                                    */00131   
   20 CRI01   CHAR(02),  /* CRITERE OFFICE 1                          */00132   
                         /*$ ECR02,NCRIV                              */00133   
   20 CRI02   CHAR(02),  /* CRITERE OFFICE 2                          */00134   
                         /*$ ECR02,NCRIV                              */00135   
   20 CRI03   CHAR(02),  /* CRITERE OFFICE 3                          */00136   
                         /*$ ECR02,NCRIV                              */00137   
   20 CRI04   CHAR(02),  /* CRITERE OFFICE 4                          */00138   
                         /*$ ECR02,NCRIV                              */00139   
   20 CRI05   CHAR(01),  /* CRITERE OFFICE 5                          */00140   
                         /*$ ECR02,NCRIV                              */00141   
   20 CRI06   CHAR(01),  /* CRITERE OFFICE 6                          */00142   
                         /*$ ECR02,NCRIV                              */00143   
   20 CRI07   CHAR(01),  /* CRITERE OFFICE 7                          */00144   
                         /*$ ECR02,NCRIV                              */00145   
   20 CRI08   CHAR(01),  /* CRITERE OFFICE 8                          */00146   
                         /*$ ECR02,NCRIV                              */00147   
   20 CRI09   CHAR(03),  /* CRITERE OFFICE 9     */                     00148   
                         /*$ ECR02                                    */00149   
   20 CRI10   CHAR(03),  /* CRITERE OFFICE 10    */                     00150   
                         /*$ ECR02                                    */00151   
   20 FRAET   CHAR(01),  /* CRITERE SELECTION  (FRANCE-ETRANGER)      */00152   
                         /* 1 = FRANCE   - 2 = ETRANGER               */00153   
                         /*$ ECR01,INDSE                              */00154   
   20 REMAR   CHAR(02),  /* REGION (FRAET=1) - MARCHE(FRAET=2)        */00155   
                         /*$ ECR01,NCRIV                              */00156   
   20 DEPAY   CHAR(03),  /* DEPARTEMENT (FRAET=1) - PAYS (FRAET=2)    */00157   
                         /*$ ECR01                                    */00158   
   20 MODOF   CHAR(01),  /* MODIFICATION SEGMENT COLLECTION OFFICE    */00159   
                         /*$ ECR02                                    */00160   
   20 NOTEC   CHAR(01),  /* DESIR  DU CLIENT SUR NOTATION             */00161   
                         /* 0 = AUCUNE NOTATION                       */00162   
                         /* 1 = NOTATION TOTALE                       */00163   
                         /* 2 = NOTATION SUR NOUVEAUTE                */00164   
                         /* 3 = NOTATION PARTIELLE                    */00165   
                         /*$ ECR01                                    */00166   
   20 CLIRE   CHAR(01),  /* DESIR  DU CLIENT SUR REMPLACEMENT         */00167   
                         /* 0 = AUCUN REMPLACEMENT                    */00168   
                         /* 1 = TOUT REMPLACEMENT ACCEPTE             */00169   
                         /* 3 = REMPLACEMENT PARTIEL                  */00170   
                         /*$ ECR01                                    */00171   
   20 NONO(9) CHAR(01),  /* NOTATION SUR NOUVEAUTE                    */00172   
                         /*  0 = NON , 1 = OUI                        */00173   
                         /*$ ECR01                                    */00174   
   20 RENO(9) CHAR(01),  /* REMPLACEMENT SUR NOUVEAUTE                */00175   
                         /*  0 = NON , 1 = OUI                        */00176   
                         /*$ ECR01                                    */00177   
   20 NORI(9) CHAR(01),  /* NOTATION SUR REIMPRESSION                 */00178   
                         /*  0 = NON , 1 = OUI                        */00179   
                         /*$ ECR01                                    */00180   
   20 RERI(9) CHAR(01),  /* REMPLACEMENT SUR REIMPRESSION             */00181   
                         /*  0 = NON , 1 = OUI                        */00182   
                         /*$ ECR01                                    */00183   
0             /*  TIRAGE     */                                         00184   
   20 CADIS   CHAR(01),  /* CANAL DISTRIBUTION                        */00185   
                         /* 1 = POSTES BB                             */00186   
                         /* 2,3,4,5 = AUTRES  (CDL CHAINES CRDL GIH)  */00187   
                         /*$ ECR02,NCRIV,INTER                        */00188   
   20 CAPOS   CHAR(01),  /* CATEGORIE POSTE BB-COFEC                  */00189   
                         /* BLANC,A,B,C                               */00190   
                         /*$ ECR02,NCRIV,INTER                        */00191   
   20 REGRO   CHAR(01),  /* REGROUPEMENT COMMANDES                    */00192   
                         /*-------------------------------------------*/00193   
                         /*   !    COMMANDES      !         NOTES     */00194   
                         /*-------------------------------------------*/00195   
                         /* 0 !     TOUS   REGROUPEMENTS  POSSIBLES   */00196   
                         /*-------------------------------------------*/00197   
                         /* 1 ! REGROUPABLE A PART! REGROUPABLE A PART*/00198   
                         /* 2 ! NON REGROUPABLE   ! REGROUPABLE A PART*/00199   
                         /* 3 ! NON REGROUPABLE   ! NON REGROUPABLE   */00200   
                         /*-------------------------------------------*/00201   
                         /*$ ECR02                                    */00202   
   20 PRIOR   CHAR(01),  /* PRIORITE RASSORT                          */00203   
                         /* 0 = SANS PRIORITE                         */00204   
                         /* U = PRIORITE RELATIVE (URGENT)            */00205   
                         /* T = PRIORITE ABSOLUE (TRES URGENT)        */00206   
                         /*$ ECR02                                    */00207   
   20 DIFOF   CHAR(01),  /* DIFFUSION OFFICE                          */00208   
                         /*-------------------------------------------*/00209   
                         /* 0 = AUTRES CLIENTS       !                */00210   
                         /* 1 = CLIENTS CRDL         !    B T L       */00211   
                         /* 2 = CLIENTS BB COFEC     !                */00212   
                         /* 3 = CLIENTS CHAINES      !   COLISES      */00213   
                         /* 4 = CLIENTS GIH          !                */00214   
                         /* 5,6 = (NON ATTRIBUEES)   !                */00215   
                         /*-------------------------------------------*/00216   
                         /* 7 = CRDL                 !    B T L       */00217   
                         /* 8,9 = (NON ATTRIBUEES)   !  PALETTISES    */00218   
                         /*-------------------------------------------*/00219   
                         /*$ ECR02                                    */00220   
   20 PRIOF   CHAR(01),  /* PRIORITE TRAITEMENT ET ENVOI OFFICE       */00221   
                   /*  NON UTILISISE NOUVEAU SYSTEME - SAUVEGARDE PRI */00222   
                         /*$ ECR02                                    */00223   
   20 ZONTI   CHAR(01),  /* ZONE DE TIRAGE                            */00224   
                         /* BLANC = AFFECTATION AUTOMATIQUE           */00225   
                         /* 1 = DETAIL - 3 = GROS                     */00226   
                         /*$ ECR02                                    */00227   
   20 CONDI   CHAR(01),  /* TYPE DE CONDITIONNEMENT                   */00228   
                         /* 0 = COLIS SUR GROS - 1 = PALETTE SUR GROS */00229   
                         /*$ ECR02                                    */00230   
   20 PREPA   CHAR(01),  /* CODE TRI PREPARATION                      */00231   
                         /*$ ECR02                                    */00232   
   20 FABRI   CHAR(01),  /* CONSIGNE POUR FABRICATION SPECIALE        */00233   
                         /*$ ECR02                                    */00234   
   20 CODIN   CHAR(01),  /* CODE INDEXATION                           */00235   
                         /*$ ECR02                                    */00236   
   20 SPENV   CHAR(02),  /* SPECIFICATION D ENVOI                     */00237   
                         /*$ ECR02                                    */00238   
   20 TRARA   CHAR(03),  /* MODE TRANSPORT MAUREPAS RASSORT           */00239   
                         /*$ ECR02                                    */00240   
   20 TRAOF   CHAR(03),  /* MODE TRANSPORT MAUREPAS OFFICE            */00241   
                         /*$ ECR02                                    */00242   
   20 TRACR   CHAR(03),  /* MODE TRANSPORT A PARTIR CRDL              */00243   
                         /*$ ECR02                                    */00244   
   20 TRASE   CHAR(02),  /* TRANSPORT SECONDAIRE                      */00245   
                         /*$ ECR02                                    */00246   
   20 ROUTA   CHAR(18),  /* LIBELLE ROUTAGE                           */00247   
                         /*$ ECR02                                    */00248   
0             /*  FACTURATION  -  COMPTABILITE  */                      00249   
   20 POFIS   CHAR(01),  /* POSITION FISCALE                          */00250   
                         /*$ ECR01,INTER                              */00251   
   20 REGFA   CHAR(01)  ,/* REGIME FACTURATION                        */00252   
                         /* 1 = FRANCE , 2 = ETRANGER                 */00253   
                         /*$ ECR01,INTER                              */00254   
   20 TYFAC   CHAR(01),  /* TYPE EDITION FACTURE                      */00255   
             /* 0 = TYPE FRANCE                                       */00256   
             /* 5 = TYPE ETRANGER - SANS PRIX UNITAIRE NET            */00257   
             /* 6 = TYPE ETRANGER - SEULEMENT PRIX NET REMISE DEDUITE */00258   
             /* 7 = TYPE ETRANGER - PRIX UNITAIRE NET                 */00259   
             /*$ ECR01,INTER                                          */00260   
   20 ECHEA   CHAR(02),  /* ECHEANCE RASSORT                          */00261   
                         /*$ ECR01,INTER                              */00262   
   20 ECHOF   CHAR(02),  /* ECHEANCE OFFICE                           */00263   
                         /*$ ECR01,INTER                              */00264   
   20 SUMAR   CHAR(01),  /* SUMMARISATION                             */00265   
                         /* 0 = NON                                   */00266   
                         /* 1 = SUMMARISATION (NON COLIS STANDARD)    */00267   
                         /* 2 = TOUTE SUMMARISATION                   */00268   
                         /*$ ECR01,INTER                              */00269   
   20 PEFAC   CHAR(01),  /* PERIODICITE DE FACTURATION                */00270   
                         /* 0 = IMMEDIATE FERMEE                      */00271   
                         /* 1 = DECADAIRE                             */00272   
                         /* 2 = MENSUELLE                             */00273   
                         /* 3 = A LA DEMANDE                          */00274   
                         /* 9 = IMMEDIATE OUVERTE                     */00275   
                         /*$ ECR01,INTER                              */00276   
   20 NBFAC FIXED DEC(1),/* NOMBRE DE FACTURES (ORIGINAUX)            */00277   
                         /*$ ECR01                                    */00278   
   20 NBCOL FIXED DEC(1),/* NB EXEMPLAIRE BORDEREAUX DE COLISAGE      */00279   
                         /*$ ECR01                                    */00280   
   20 CADOR   CHAR(01),  /* CATEGORIE DOSSIER RECU                    */00281   
                         /*$ ECR01                                    */00282   
   20 GEF17   CHAR(02),  /**************************/                   00283   
   20 GEF18   CHAR(01),  /**************************/                   00284   
   20 GEF19   CHAR(01),  /**************************/                   00285   
   20 ALED(9) CHAR(01),  /* APPARTENANCE LISTE EDITEUR                */00286   
                         /* 0 = CDL DIFFUSEUR  - 1 = CDL DISTRIBUTEUR */00287   
                         /*$ ECR01,NCRIV                              */00288   
   20 CAREM   CHAR(03),  /* CATEGORIE REMISE MAUREPAS                 */00289   
                         /*$ ECR03                                    */00290   
   20 REBUT   CHAR(01),  /* REGIME DE BUTOIR                          */00291   
                         /* 1 = BUTOIR PARIS   2 = BUTOIR PROVINCE    */00292   
                         /*$ ECR03                                    */00293   
   20 TAB(80)    ,                                                      00294   
    30 BAP    CHAR(03),  /* BARETTE PRINCIPALE DE TARIFICATION        */00295   
                         /*$ ECR03,CLASS=BAP                          */00296   
    30 SUR    CHAR(01),  /* DROIT AUX SURREMISES IMMEDIATES           */00297   
                         /*  0 = NON , 1 = OUI A TOUTES SURREMISES    */00298   
                         /* 2 = OUI AUX SURREMISES COMPENSEES SEULES  */00299   
                         /*$ ECR03,CLASS=SUR                          */00300   
                         /****************************/                 00301   
   20 DAOUV CHAR(06),    /* DATE DE PREMIERE OUVERTURE DE COMPTE      */00302   
   20 DAFER CHAR(06),    /* DATE DE DERNIERE FERMETURE DE COMPTE      */00303   
   20 GEF12 CHAR(03),                                                   00304**6
   20 GEF13 CHAR(06),                                                   00305**6
   20 EXGCO CHAR(01),    /* EXISTENCE DU SEGMENT GESTION COMPTABILITE */00306   
                         /*   0 = NON  -  1 = OUI                     */00307   
   20 NUSUC CHAR(06),    /* NUMERO SUCCESSEUR                         */00308   
   20 FILAT CHAR(19),    /* FILLER ATTENTE                            */00309   
0             /*  STATISTIQUE */                                        00310   
   20 TYCLI   CHAR(01),  /* TYPE DE CLIENTELE                         */00311   
                         /* SOUS DIVISION CLIENTELE A L'INTERIEUR DU  */00312   
                         /* DEPARTEMENT COMPTABLE                     */00313   
                         /*$ ECR01,NCRIV                              */00314   
   20 SYPRO   CHAR(2),   /* SYSTEME DE PROSPECTION                    */00315   
                         /*$ ECR01,NCRIV                              */00316   
   20 FACTA   CHAR(01),  /* FAMILLE CLIENT TARIFAIRE                  */00317**7
   20 REF01   CHAR(01),  /* REF. 01                                   */00318**6
   20 REF02   CHAR(01),  /* REF. 02                                   */00319**6
   20 REF03   CHAR(01),  /* REF. 03                                   */00320**6
   20 NOMCO   CHAR(05),  /* NOMENCLATURE COMPTE                       */00321   
                         /* NUMERO DE COMPTE GIH OU SECTEUR BB        */00322   
                         /*$ ECR01                                    */00323   
   20 CATCO   CHAR(01),  /* CATEGORIE COMPTE                          */00324   
                         /* TYPE GIH  OU  SOCIETE BB GARE             */00325   
                         /*$ ECR01                                    */00326   
   20 NATCO   CHAR(02),  /* NATURE DE COMPTE                          */00327   
                         /* NATURE DE COMPTE GIH OU RESEAU BB         */00328   
                         /*$ ECR01                                    */00329   
   20 DEVIS   CHAR(01),  /* DEVISE GIH                                */00330   
                         /*$ ECR01                                    */00331   
   20 ARRON   CHAR(02),  /* ARRONDISSEMENT                            */00332   
                         /*$ ECR01,NCRIV                              */00333   
0             /* GESTION FICHIER */                                     00334   
   20 GEF01   CHAR(01) ,  /*               */ /*$ ECR02,NCRIV,CLASS=* */00335   
   20 GEF02   CHAR(01) ,  /*               */ /*$ ECR02,NCRIV,CLASS=* */00336   
   20 GEF03   CHAR(01) ,  /*               */ /*$ ECR02,NCRIV,CLASS=* */00337   
   20 REPDU   CHAR(01) ,  /*REPONSE DUPLIQUEE                         */00338**8
   20 GEF05   CHAR(01) ,  /*               */ /*$ ECR02,NCRIV,CLASS=* */00339   
   20 GEF06   CHAR(01) ,  /*               */ /*$ ECR02,CLASS=*       */00340   
   20 GEF07   CHAR(01) ,  /*               */ /*$ ECR02,CLASS=*       */00341   
   20 GEF08   CHAR(01) ,  /*               */ /*$ ECR02,CLASS=*       */00342   
   20 GEF09   CHAR(01) ,  /*               */ /*$ ECR02,CLASS=*       */00343   
   20 GEF10   CHAR(01) ,  /*               */ /*$ ECR02,CLASS=*       */00344   
   20 GEF11   CHAR(02) ,  /*               */ /*$ ECR02,NCRIV,CLASS=* */00345   
   20 SPEOF   CHAR(02) ,  /*               */ /*$ ECR02,NCRIV,CLASS=* */00346   
   20 AFFIL   CHAR(02) ,  /*               */ /*$ ECR02,NCRIV,CLASS=* */00347   
   20 GEF14   CHAR(02) ,  /*               */ /*$ ECR02,CLASS=*       */00348   
   20 GEF15   CHAR(02) ,  /*               */ /*$ ECR02,CLASS=*       */00349   
   20 GEF16   CHAR(03) ,  /*               */ /*$ ECR02,CLASS=*       */00350   
   20 MAJCO   CHAR(1) ,    /* MAJORATION COMMISSION NON GEREE         */00351   
   20 CRSEC   CHAR(3) ,    /* C.R.D.L.  SECONDAIRE                    */00352   
   20 PORCR   CHAR(2) ,    /* PORT. CRDL                              */00353**6
   20 GEF20   CHAR(1) ,                                                 00354**7
   20 CNUDI   CHAR(8) ,    /* CODE NATIONAL UNIFIE DISTRIBUTEUR       */00355   
   20 BASTA   CHAR(2) ,    /* BARETTE D'AGREGATION STATISTIQUE        */00356   
   20 BASTB   CHAR(2) ,    /* BARETTE D'AGREGATION STATISTIQUE (A.S.) */00357   
   20 DAMBA   CHAR(4) ,    /* DATE DE MODIF. DE LA BARETTE STATISTIQUE*/00358   
   20 FILER   CHAR(04) ,                                                00359   
   20 F_WTCLI CHAR(0);                                                  00360   
-/* DESCRIPTION SSA */                                                  00361   
0DCL 01 SSCLI  STATIC,/* S.S.A. CHAMP NUCLI ET CECLI (POUR GHU ET GU)*/ 00362   
   02 NAME    CHAR(8) INIT('CLI'),                                      00363   
   02 QUAL    CHAR(1) INIT('('),                                        00364   
   02 KNAM    CHAR(8) INIT('NUCLI'),                                    00365   
   02 OPER    CHAR(2) INIT(' ='),                                       00366   
   02 VAL     CHAR(6) INIT(' '),                                        00367   
   02 ET      CHAR(1) INIT('&'),                                        00368   
   02 KNAM2   CHAR(8) INIT('CECLI   '),                                 00369   
   02 OPER2   CHAR(2) INIT(' ='),                                       00370   
   02 VAL2    CHAR(1) INIT('0'),                                        00371   
   02 END     CHAR(1) INIT(')');                                        00372   
0DCL 01 SSCLI2 STATIC,    /* S.S.A. CHAMP CECLI (POUR GHN OU GN) */     00373   
   02 NAME    CHAR(8) INIT('CLI'),                                      00374   
   02 QUAL    CHAR(1) INIT('('),                                        00375   
   02 KNAM    CHAR(8) INIT('CECLI'),                                    00376   
   02 OPER    CHAR(2) INIT(' ='),                                       00377   
   02 VAL     CHAR(1) INIT('0'),                                        00378   
   02 END     CHAR(1) INIT(')');                                        00379   
        /* DATA SET IDDCLIPP   AT LEVEL 001 AS OF 18/02/84    */                
-/* SEGMENT GROUPE PRODUIT AUTORISE INTERDIT */                         00001   
 /********************************************/                         00002   
                                   /* LONGUEUR DU DBD = 150 */          00003   
0DCL 01 WTPAI BASED(PWTPAI) ,                                           00004   
   20 INA(50) CHAR(03)  , /* GROUPE PRODUIT AUTORISE INTERDIT       */  00005   
       /*$ ECR02,INTER */ /* '999' TOUT AUTORISE OU TOUT INTERDIT   */  00006   
   20 F_WTPAI CHAR(0) ;                                                 00007   
-/* DESCRIPTION SSA */                                                  00008   
0DCL 01 SSPAI STATIC,    /* SEGMENT GROUPE PRODUIT AUTORISE INTERDIT */ 00009   
   02 NAME    CHAR(8) INIT('PAI'),                                      00010   
   02 QUAL    CHAR(1) INIT(' '),                                        00011   
   02 KNAM    CHAR(8) INIT('     '),                                    00012   
   02 OPER    CHAR(2) INIT(' ='),                                       00013   
   02 VAL     CHAR(6) INIT(' '),                                        00014   
   02 END     CHAR(1) INIT(')');                                        00015   
        /* DATA SET IDDCLIPT   AT LEVEL 001 AS OF 18/02/84    */                
-/* SEGMENT BARETTE SECONDAIRE DE TARIFICATION */                       00001   
 /**********************************************/                       00002   
                                   /* LONGUEUR DU DBD = 240 */          00003   
0DCL 01 WTBAS BASED(PWTBAS),                                            00004   
   20 BAS(80) CHAR(3),   /* BARETTE SECONDAIRE DE TARIFICATION        */00005   
                                     /*$ CLASS=BAS,ECR03  */            00006   
   20 F_WTBAS CHAR(0);                                                  00007   
-/* DESCRIPTION SSA */                                                  00008   
0DCL 01 SSBAS STATIC,     /* SEGMENT BARETTE SECONDAIRE TARIFICATION */ 00009   
   02 NAME    CHAR(8) INIT('BAS'),                                      00010   
   02 QUAL    CHAR(1) INIT(' '),                                        00011   
   02 KNAM    CHAR(8) INIT('     '),                                    00012   
   02 OPER    CHAR(2) INIT(' ='),                                       00013   
   02 VAL     CHAR(6) INIT(' '),                                        00014   
   02 END     CHAR(1) INIT(')');                                        00015   
        /* DATA SET IDDCLIPC   AT LEVEL 001 AS OF 18/02/84    */                
-/* SEGMENT COLLECTION OFFICE */                                        00001   
 /*****************************/                                        00002   
      /* SEGMENT DE LONGUEUR VARIABLE -  LONGUEUR DU DBD = 3000 */      00003   
0DCL 01 WTCOF BASED(PWTCOF),                                            00004   
   20 COMPT   FIXED BIN(15) , /*�COMPTEUR LONGUEUR ENREGISTREMENT     */00005   
   20 CO(500)     ,                                                     00006   
     30 NUCOF   CHAR(3),   /* NUMERO COLLECTION OFFICE */ /*$ ECR05   */00007   
     30 SEROF FIXED DEC(5),/* SERVICE DE BASE OFFICE */ /*$ ECR05     */00008   
   20 F_WTCOF CHAR(0);                                                  00009   
-/* DESCRIPTION SSA */                                                  00010   
0DCL 01 SSCOF STATIC,                   /* SEGMENT COLLECTION OFFICE */ 00011   
   02 NAME    CHAR(8) INIT('COF'),                                      00012   
   02 QUAL    CHAR(1) INIT(' '),                                        00013   
   02 KNAM    CHAR(8) INIT('     '),                                    00014   
   02 OPER    CHAR(2) INIT(' ='),                                       00015   
   02 VAL     CHAR(3) INIT(' '),                                        00016   
   02 END     CHAR(1) INIT(')');                                        00017   
        /* DATA SET IDDCLIPG   AT LEVEL 001 AS OF 18/02/84    */                
-/* SEGMENT GROUPE PRODUIT OFFICE */                                    00001   
 /*********************************/                                    00002   
      /* SEGMENT DE LONGUEUR VARIABLE -  LONGUEUR DU DBD = 200 */       00003   
0DCL 01 WTGRP BASED(PWTGRP),                                            00004   
   20 COMPT   FIXED BIN(15) , /*�COMPTEUR LONGUEUR ENREGISTREMENT     */00005   
   20 COM(20)     ,                                                     00006   
    30 CAPRO   CHAR(2),   /* NO GROUPE PRODUCTION */ /*$ ECR04,NOMOD  */00007   
    30 CRIP1   CHAR(2),   /* CRITERE  GROUPE DE PRODUIT */ /*$ ECR04  */00008   
    30 CRIP2   CHAR(2),   /*                            */ /*$ ECR04  */00009   
    30 CRIP3   CHAR(2),   /*                            */ /*$ ECR04  */00010   
    30 CRIP4   CHAR(1),   /*                            */ /*$ ECR04  */00011   
    30 CRIP5   CHAR(1),   /*                            */ /*$ ECR04  */00012   
   20 F_WTGRP CHAR(0);                                                  00013   
-/* DESCRIPTION SSA */                                                  00014   
0DCL 01 SSGRP STATIC,                   /* SEGMENT CATEGORIE PRODUIT */ 00015   
   02 NAME    CHAR(8) INIT('GRP'),                                      00016   
   02 QUAL    CHAR(1) INIT(' '),                                        00017   
   02 KNAM    CHAR(8) INIT('     '),                                    00018   
   02 OPER    CHAR(2) INIT(' ='),                                       00019   
   02 VAL     CHAR(3) INIT(' '),                                        00020   
   02 END     CHAR(1) INIT(')');                                        00021   
 /*    END INCLUDE++                                                  */        
 /*    INCLUDE++ GEDCLIPG                                             */00096   
        /* DATA SET GEDCLIPG   AT LEVEL 002 AS OF 02/10/84    */                
 /*---------------------------*/                                        00001   
 /* SEGMENT   -  G C O  -     */      /* LONGUEUR DONNEE = 200        */00002   
 /* GESTION ET COMPTABILITE   */      /*        -> TOTAL = 200 (FIXE) */00003   
 /*---------------------------*/                                        00004   
 DCL 01  WTGCO        BASED (PWTGCO),                                   00005   
 10      CECOM        CHAR(03),     /* CENTRE COMPTABLE TENUE COMPTE  */00006   
 10      NACOM        CHAR(02),     /* NATURE COMPTABLE DU CLIENT     */00007   
 10      SICOM        CHAR(01),     /* SITUATION COMPTABLE DU CLIENT  */00008   
 10      NCONT        CHAR(08),     /* NO DE CONTREMARQUE CLIENT      */00009   
 10      SIREN        CHAR(09),     /* NO SIREN                       */00010   
 10      TELEX        CHAR(20),     /* NO DE TELEX                    */00011   
 10      PHONE        CHAR(12),     /* NO DE TELEPHONE                */00012   
 10      TYECH        CHAR(01),     /* TYPE DE CALCUL DE L'ECHEANCE   */00013   
 10      MTDMA        DEC FIXED(7), /* MT DECOUVERT MAXIMUM AUTORISE  */00014   
 10      LETAU        CHAR(01),     /* LETTRAGE AUTOMATIQUE AUTORISE  */00015   
 10      RELAU        CHAR(01),     /* ENVOI RELANCES AUTORISE        */00016   
 10      APPAU        CHAR(01),     /* ENVOI APPEL ECHEANCE  AUTORISE */00017   
 10      FOUAU        CHAR(01),     /* ENVOI RELEVE FOURNIT. AUTORISE */00018   
 10      REVAU        CHAR(01),     /* ENVOI RELEVE COMPTE   AUTORISE */00019   
 10      TYREL        CHAR(01),     /* TYPE RELEVE COMPTE (DETA/SIMP) */00020**2
 10      AUTO(4)      CHAR(01),     /* AUTRES ACTIONS AUTORISEES      */00021**2
 10      DALAP        CHAR(06),     /* DATE LIMITE ENVOI APP. ECH(AMJ)*/00022   
 10      DURAP        CHAR(01),     /* DUREE ENVOI APP. ECH (EN MOIS) */00023   
 10      EDEFF        CHAR(02),     /* NBJ AVANT ECH EMISSION LCCA    */00024   
 10      DELCO        CHAR(01),     /* NB MOIS ECR POSEC=5 CONSERVEE  */00025   
 10      TYFOU        CHAR(01),     /* TYPE DE RELEVE FOURNITURES     */00026   
 10      CORE1        CHAR(02),     /* CODE RELANCE 1 RETARD PAIEMENT */00027   
 10      CORE2        CHAR(02),     /* CODE RELANCE 2 RETARD PAIEMENT */00028   
 10      COREI        CHAR(02),     /* CODE RELANCE IMPAYE            */00029   
 10      NBFOU        DEC FIXED(01),/* NB RELEVE FOURNITURES A EDITER */00030   
 10      CUCAE        DEC FIXED(13),/* CUMUL C.A T.C EXERCICE EN COURS*/00031   
 10      CUCAA        DEC FIXED(13),/* CUMUL C.A T.C EXERCICE ANTERI. */00032   
 10      COCTX        CHAR(02),     /* CODE CONTENTIEUX               */00033   
 10      COBAN        CHAR(05),     /* CODE BANQUE                    */00034   
 10      COGUI        CHAR(05),     /* CODE GUICHET                   */00035   
 10      COCOM        CHAR(11),     /* CODE COMPTE                    */00036   
 10      CLERI        CHAR(02),     /* CLEF R.I.B                     */00037   
 10      LIBAN        CHAR(24),     /* LIBELLE DE LA BANQUE           */00038   
 10      COAPP        CHAR(02),     /* CODE APPEL D'ECHEANCE          */00039   
 10      NBREL        DEC FIXED(01),/* NB RELEVE DE COMPTE A EDITER   */00040   
 10      MOREG        CHAR(02),     /* MODE DE REGLEMENT USUEL        */00041   
 10      DETET        CHAR(01),     /* DETAIL ETAT                    */00042   
 10      CODAR        CHAR(05),     /* CODE SOCIETE AR                */00042   
 10      CRREP        CHAR(04),     /* RESPONSABLE CREDIT A.R         */00042   
 10      DAREO        CHAR(06),     /* DATE DE REOUVERTURE            */00042   
 10      F_WTGCO      CHAR(28);                                         00043   
0DCL 01  SSGCO,                              /* S.S.A SEGMENT GCO     */00044   
 02      NAME    CHAR(8) INIT('GCO'),                                   00045   
 02      QUAL    CHAR(1) INIT(' '),                                     00046   
 02      KNAM    CHAR(8) INIT('     '),                                 00047   
 02      OPER    CHAR(2) INIT(' ='),                                    00048   
 02      VAL     CHAR(3) INIT(' '),                                     00049   
 02      END     CHAR(1) INIT(')');                                     00050   
 /*    END INCLUDE++                                                  */        
1                                                                       00097   
       DCL 1 PCBCLI           BASED(PCLI),                              00098   
             2 ID             LIKE PCB_PROTOTYPE.ID,                    00099   
             2 KEY            CHAR (6);                                 00100   
0      DCL   WTCLIA           CHAR (3000);                              00101   
       DCL   WTCLIB           CHAR (3000);                              00102   
       DCL   WTCLIC           CHAR (3000);                              00103   
       DCL   WTGCOA           CHAR (500);                               00104   
       DCL   WTGCOB           LIKE WTGCO;                               00105   
       DCL   WTCLI1           LIKE WTCLI BASED(PWTCLIA);                00106   
       DCL   WTCLI2           LIKE WTCLI BASED(PWTCLIB);                00107   
       DCL   WTCLI3           LIKE WTCLI BASED(PWTCLIC);                00108   
0      DCL   PART             PTR;                                      00109   
       DCL   PCLI             PTR;                                      00110   
       DCL   (PWTCLIA,PWTCLIB,PWTCLIC,PWTGCO)  PTR;                     00111   
0            PWTCLIA          = ADDR(WTCLIA);                           00112   
             PWTCLIB          = ADDR(WTCLIB);                           00113   
             PWTCLIC          = ADDR(WTCLIC);                           00114   
             PWTGCO           = ADDR(WTGCOA);                           00115   
1                                       /*******************************00116   
                                        *                              *00117   
                                        *    FICHIERS EN ENTREE        *00118   
                                        *                              *00119   
                                        *******************************/00120   
0                                       /*   CARTES PARAMETRE         */00121   
                                        /******************************/00122   
                                        /*   INCLUDE IDDODAT OFFICE   */00123   
       DCL 1 XDATE            CHAR (128);                               00124   
 /*    INCLUDE++ IDDODAT                                              */00125   
-/* SELECTION CLIENT-TITRE CARTE DATE              */                   00000000
 /* GEN=TP.LU SUR DAT1A.ECRIT SUR FAUTO.D=26/10/80 */                   00000010
 /*------------------------------------------------*/                   00000020
0DCL 01 WTDAT BASED (PWTDAT),                                           00000030
  20 COENR,            /* CODE ENREGISTREMENT = OF                    */00000040
   30 COEN1 CHAR(1),   /* O=VALIDE,8=ERR.SIMULATION ET FACTURATION    */00000050
   30 COEN2 CHAR(1),   /* 9=ERREUR POUR FACTURATION                   */00000060
  20 TYRUN CHAR(1),    /* TYPE DE RUN N=NORMAL,S=SPECIAL              */00000070
  20 NORUN CHAR(3),    /* NUMERO DE RUN                               */00000080
  20 DATOF,            /* DATE TRAITEMENT OFFICE                      */00000090
   30 ANNEE CHAR(2),                                                    00000100
   30 MOIS  CHAR(2),                                                    00000110
   30 JOUR  CHAR(2),                                                    00000120
  20 ASART ,           /* NUM VERSION AS DBA                          */00000130
    30 DEGAR CHAR(3),  /* DERNIERE GESTION ARTICLE                    */00000140
    30 DERAS CHAR(3),  /* DERNIERE VERSION RASSORT                    */00000150
  20 ASCLI CHAR(3),    /* NUM VERSION AS DBC                          */00000160
  20 ASTAB CHAR(3),    /* NUM VERSION AS TAB                          */00000170
  20 ASFLI CHAR(3),    /* NUM VERSION AS FLI                          */00000180
  20 DAFAF CHAR(6),    /* DATE FRANCE                                 */00000190
  20 FRAFR CHAR(1),    /* CODE FRANCO FRANCE                          */00000200
  20 PEFRA CHAR(1),    /* PERIODE DE FACTURATION FRANCE               */00000210
  20 LOFRA CHAR(3),    /* LOT FRANCE                                  */00000220
  20 DAFAE CHAR(6),    /* DATE ETRANGER                               */00000230
  20 FRANE CHAR(1),    /* CODE FRANCO ETRANGER                        */00000240
  20 PEFET CHAR(1),    /* PERIODE FACTURATION ETRANGER                */00000250
  20 LOETR CHAR(3),    /* LOT ETRANGER                                */00000260
  20 DLIPO CHAR(6),    /* DATE LIMITE SEJOUR EN PORTEFEUILLE          */00000270
  20 MIFRA CHAR(3),    /* MINIMUM ENVOI FRANCE HORS BB                */00000280
  20 MINBB CHAR(3),    /* MINIMUM ENVOI BB                            */00000290
  20 MINET CHAR(3),    /* MINIMUM ENVOI GIH                           */00000300
  20 COMAX CHAR(2),    /* NOMBRE DE COLIS MAXI PAR LOREC POUR BTS     */00000310
  20 LIMAX CHAR(3),    /* NOMBRE DE LIGNES MAXI PAR LOREC POUR BTS    */00000320
  20 SIMAX CHAR(1),    /* NOMBRE LIMITE DE COLIS POUR 1 BTS           */00000330
  20 POMAX CHAR(3),    /* POIDS MAXI D UN BTS                         */00000340
  20 QMINT CHAR(4),    /* NOMBRE MAXI DE TITRE POUR 1 PALETTE ISOLEE  */00000350
  20 QUMAX CHAR(4),    /* QTE MAXI POUR 1 PALETTE EN VOLUME           */00000360
  20 CODAT CHAR(1),    /* CODE ERREUR C=CORRECT.E=ERRONE. M=MANQUE    */00000370
  20 TRAS1 CHAR(3),    /* MODE TRANSPORT SPECIAL DIFOF 1              */00000380
  20 TRAS2 CHAR(3),    /* MODE TRANSPORT SPECIAL DIFOF 2              */00000390
  20 TRAS3 CHAR(3),    /* MODE TRANSPORT SPECIAL DIFOF 3              */00000400
  20 TRAS4 CHAR(3),    /* MODE TRANSPORT SPECIAL DIFOF 4              */00000410
  20 TRAS5 CHAR(3),    /* MODE TRANSPORT SPECIAL DIFOF 5              */00000420
  20 TRAS6 CHAR(3),    /* MODE TRANSPORT SPECIAL DIFOF 6              */00000430
  20 POISP CHAR(3),    /* POIDS SPECIAL HARLEQUIN                     */00000440
  20 DLIPE CHAR(6),    /* DATE LIMITE PORTEFEUILLE GIH                */00000450
  20 DLIPB CHAR(6),    /* DATE LIMITE PORTEFEUILLE BB                 */00000460
  20 SEMEV CHAR(3),    /* SEMAINE DE MISE EN VENTE                    */00000470
  20 QMIN8 CHAR(4),    /* NBRE MAXI LIGNES PALETTE ISOLEE DIFOF=8     */00000480
  20 QUMA8 CHAR(4),    /* QTE  MAXI SUR UNE PALETTE POUR  DIFOF=8     */00000490
  20 QMIN9 CHAR(4),    /* NBRE MAXI LIGNES PALETTE ISOLEE DIFOF=9     */00000500
  20 QUMA9 CHAR(4),    /* QTE  MAXI SUR UNE PALETTE POUR  DIFOF=9     */00000510
  20 DALOG CHAR(4),    /* DATE D EXECUTION LOGISTIQUE                 */00000520
  20 OFSTA CHAR(1),    /* CODE OFFICE STANDARD 0=NON,1=OUI            */00000521
  20 TRAS0 CHAR(3),    /* MODE TRANSPORT SPECIAL DIFOF 0              */00000522
  20 TRAS7 CHAR(3),    /* MODE TRANSPORT SPECIAL DIFOF 7              */00000523
  20 TRAS8 CHAR(3),    /* MODE TRANSPORT SPECIAL DIFOF 8              */00000524
  20 TRAS9 CHAR(3),    /* MODE TRANSPORT SPECIAL DIFOF 9              */00000525
  20 QOLMA CHAR(4),    /* QTE POUR AIGUILLAGE COLMA 2 CONDI PALETTE   */00000525
  20 FIN   CHAR(0);                                                     00000530
 /*    END INCLUDE++                                                  */        
                                        /*   RASSORT                  */00126   
                                        /*   INCLUDE IDDRDATP RASSORT */00127   
       DCL 1 WRDAT            BASED(PWTDAT),                            00128   
 /*    INCLUDE++ IDDRDATP                                             */00129   
        /* DATA SET IDDRDATP   AT LEVEL 011 AS OF 12/08/04    */                
        /* DATA SET IDDRDATP   AT LEVEL 009 AS OF 12/05/89    */        00001**1
 /*       ENREG DATE RASSORT                 16/03/79   */              00002**1
 /*******************************************************/              00003**1
 /*D 01 WTDAT */                                                        00004**1
   10 ZDAT,                                                             00005**1
       20 COENR CHAR (2),/* CODE ENREGISTREMENT =RA */                  00006**1
       20 TYRUN CHAR (1),/* TYPE DE RUN N=NORMAL,S=SPECIAL */           00007**1
       20 NORUN CHAR (3),/* NUMERO DE RUN */                            00008**1
       20 DATRA ,        /* DATE RASSORT */                             00009**1
         30 AA  CHAR (2),/* ANNEE */                                    00010**1
         30 MM  CHAR (2),/* MOIS */                                     00011**1
         30 JJ  CHAR (2),/* JOUR */                                     00012**1
       20 ASART ,       /* NUM VERSION AS DBA */                        00013**1
         30 DEGAR CHAR (3),/* DERNIERE GESTION ARTICLE */               00014**1
         30 DERAS CHAR (3),/* DERNIERE VERSION RASSORT */               00015**1
       20 ASCLI CHAR (3),/* NUM VERSION AS DBC */                       00016**1
       20 ASTAB CHAR (3),/* NUM VERSION AS TAB */                       00017**1
       20 ASPOR CHAR (3),/* NUM VERSION AS POR */                       00018**1
       20 DAFAC CHAR (6),/* DATE FACTURATION */                         00019**1
       20 DATCO CHAR (6),/* DATE DE SAISIE DES COMMANDES */             00020**1
       20 COFAD CHAR (1),/* CODE FACTURATION DIFFERE */                 00021**1
       20 LIDEC CHAR (15),/* LIBELLE DECADE */                          00022**1
       20 DADEC CHAR (6),/* DATE DECADE */                              00023**1
       20 LIMOI CHAR (15),/* LIBELLE MOIS */                            00024**1
       20 DAMOI CHAR (6),/* DATE DU MOIS */                             00025**1
       20 SEQEX CHAR (2),/* SEQUENCE D EXTRACTION */                    00026**1
       20 SEQTI CHAR (1),/* SEQUENCE TIRAGE */                          00027**1
       20 DEMAX FIXED DEC(9),/* QTE MAX DE LIGNE DETAIL A TIRER */      00028*10
       20 LOMAX CHAR (5),/* QTE MAX D UN LOT DE TIRAGE */               00029**1
       20 COMAX CHAR (2),/* NBRE DE COLIS DS UN LOREC POUR BTS */       00030**1
       20 LIMAX CHAR (3),/* NBRE MAX DE LIGNES DS UN LOREC POUR BTS */  00031**1
       20 SIMAX CHAR (1),/* NBRE LIMITE DE COL DS UN BTS */             00032**1
       20 POMAX CHAR (3),/* POIDS MAX D UN BTS */                       00033**1
       20 QMINT CHAR (4),/* QTE MIN D UN TITRE PROVOQUANT */            00034**1
                         /*             UNE PALETTE ISOLEE */           00035**1
       20 QUMAX CHAR (4),/* QTE MAX D UNE PALETTE EN VOLUME */          00036**1
       20 COHIS CHAR (1),/* CODE INTERROGATION HISTORIQUE */            00037**1
       20 LIFRE CHAR(20),/* LIBELLE FREQUENCE HISTORIQUE */             00038**1
       20 ANTIR CHAR(1), /* NB JOURS D ANTICIPATION DE TIRAGE */        00039**1
       20 INTBB CHAR(1), /* CODE INTERROGATION HISTORIQUE BB  */        00040**1
       20 DEFAD CHAR(1), /* DELAI MAXI DE FACTURATION DEMANDE */        00041**1
       20 DALOG CHAR(4), /* DATE D EXECUTION LOGISTIQUE       */        00042**1
       20 GRMAX FIXED DEC(9), /* QTE MAX DE LIGNE GROS A TIRER     */   00043*10
       20 QMIRE CHAR (4),/* POIDS MIN D'1 TITRE POUR UNE   */           00044**1
                         /*           PALETTE ISOLEE  (KG) */           00045**1
       20 QMARE CHAR (4),/* POIDS MAX D'UNE PALETTE         */          00046**1
       20 SIMAG CHAR (2),/* NB MAX DE COLIS A TIRER SIMULT. S/GROS   */ 00047**1
       20 SIMAD CHAR (2),/* NB MAX DE COLIS A TIRER SIMULT. S/DETAIL */ 00048**1
       20 SIMIG CHAR (2),/* NB MIN DE COLIS A TIRER SIMULT. S/GROS   */ 00049**1
       20 SIMID CHAR (2),/* NB MIN DE COLIS A TIRER SIMULT. S/DETAIL */ 00050**1
       20 SEPAL CHAR (3),/* SEUIL DE PALETISATION                    */ 00051**1
       20 SUMAX FIXED DEC(9),/* QTE MAX DE LIGNE SUCCES A TIRER      */ 00052*10
       20 DAINV CHAR (6),/* DATE INVENTAIRE                          */ 00053**1
       20 SELEC CHAR (1),/* TYPE DE SELECTION POUR INVENTAIRE PARTIEL*/ 00054**1
       20 DAREP CHAR (6),/* DATE REPORT MISE EN TIRAGE ART.INVENT.   */ 00055**1
       20 RMIDI CHAR (1),/* SELECTION POUR RUN RASSORT DU MIDI (M)   */ 00056**3
       20 SEQOF CHAR (2),/* SEQTI POUR TIRAGE SUR CHAINE OFFICE      */ 00057**5
 /*F*/                   /* TOTAL LONG. = 185                        */ 00058**1
 /*    END INCLUDE++                                                  */        
               2 FILLER       CHAR (0);                                 00130   
1                                       /*   FICHIER A FACTURER       */00131   
1                                       /*   MODIF 07/99 +8 � IDDIFA2P*/00132   
                                        /*   FFAC3A PASSE DE 483 � 491*/00133   
                                        /******************************/00134   
                                        /*   INCLUDE IDDIFA2P         */00135   
       DCL 1 WTFACRED         BASED(PENRWFAC),                          00136   
 /*    INCLUDE++ IDDIFA2P                                             */00137   
        /* DATA SET IDDIFA2P   AT LEVEL 004 AS OF 10/03/92    */                
0/* ARGUMENT TRI FICHIER A FACTURER /FAC1A/...             D=12/12/91 */00001**2
 /* AJOUT FRAET,DEPAY FACT.AUTO/MANUEL 07/99                          */00001**2
 /* AJOUT LIBELLE DIVISION (LIDIV)     07/01                          */00001**2
 /* AJOUT NUMERO BORDEREAU (NUBOR)     12/02                          */00001**2
 /*-------------------------------------------------------------------*/00002   
 10  ID ,                                /*   LONGUEUR X(190)         */00003**2
  20 EDIPA CHAR(1) ,     /* EDITION PAPIER  1=FRANCE  2=GIH  9=NO EDIT*/00004   
  20 AUTOM CHAR(1) ,     /* A=FACTURE AUTOMATIQUE     M=MANUELLE      */00005**2
  20 FRAET CHAR(1) ,     /* CRITER SELECTION FRANCE-ETRANGER FACT AUTO*/        
  20 DEPAY CHAR(3) ,     /* DEPARTEMENT OU PAYS FACT AUTO             */        
  20 CLIFA CHAR(6) ,     /* NUMERO DE CLIFA  POUR FACTURE AUTO        */00006**4
  20 NCLI2 CHAR(6) ,     /* NUMERO DE CLIENT POUR FACTURE AUTO        */00007**3
  20 MACOM CHAR(3) ,     /* MAGASIN COMMERCIAL                        */00008   
  20 FACSP CHAR(1) ,     /* FACTURATION SPECIALE                      */00009   
  20 CADOR CHAR(1) ,     /* CATEGORIE DE DOSSIER RECU                 */00010   
  20 GNAT1 CHAR(2) ,     /* REGROUPEMENT DE GNATO                     */00011   
  20 PEFAC CHAR(1) ,     /* PERIODICITE DE FACTURATION                */00012   
  20 TRANS CHAR(3) ,     /* MODE DE TRANSPORT                         */00013   
  20 FRAE2 CHAR(1) ,     /* CRITER SELECTION FRANCE-ETRANGER FACT MANU*/        
  20 DEPA2 CHAR(3) ,     /* DEPARTEMENT OU PAYS FACT MANUEL           */        
  20 NUCLI CHAR(6) ,     /* NUMERO DE CLIENT                          */00014**2
  20 RGNAT CHAR(2) ,     /* REGROUPEMENT DE GNATO  --- DISPONIBLE --- */00015**3
  20 TRACO CHAR(1) ,     /* TRAITEMENT  COMPTABLE                     */00016   
  20 DEPCO CHAR(2) ,     /* DEPARTEMENT COMPTABLE                     */00017   
  20 POFIS CHAR(1) ,     /* POSITION FISCALE                          */00018   
  20 TYCLI CHAR(1) ,     /* TYPE DE CLIENTELE                         */00019   
  20 GNATO CHAR(2) ,     /* GROUPE DE NATOP                           */00020   
  20 INFAC DEC FIXED(5), /* INDICATIF DE LA FACTURE                   */00021   
  20 ECFAC CHAR(1) ,     /* ECLATEMENT DE LA FACTURE                  */00022   
  20 NBFAC CHAR(1) ,     /* NOMBRE DE FACTURES                        */00023   
  20 TRIFA CHAR(1) ,     /* SEQUENCE DE TRI,FACTURE A LA DEMANDE      */00024   
                         /* 1=PREFACTURATION OU ANNULATION            */00025   
                         /* 2=POSTFACTURATION 3=AVOIR OU REFACTURATION*/00026   
                         /* 4=LIGNE DE CLOTURE                        */00027   
  20 DAMIS CHAR(6) ,     /* DATE DE MISE A JOUR DU STOCK  AAMMJJ      */00028   
  20 NORUN CHAR(3) ,     /* NUMERO DE RUN DU TIRAGE                   */00029   
  20 LOREC DEC FIXED(5), /* LOT DE REGROUPEMENT DE COMMANDES          */00030   
  20 RESAI ,             /* REFERENCE DE SAISIE                       */00031   
   30 ANNEE CHAR(2),     /* ANNEE                                     */00032   
   30 RUN   CHAR(3),     /* NUMERO DE RUN                             */00033   
   30 ORIGI CHAR(2),     /* ORIGINE                                   */00034   
   30 NUMRO DEC FIXED(5),/* NUMERO D ORDRE                            */00035   
  20 LIEDI CHAR(15),     /* LIBELLE  EDITEUR                          */00036   
  20 NUEDI CHAR(3) ,     /* NUMERO D'EDITEUR                          */00036   
  20 LIDIV CHAR(15),     /* LIBELLE  DIVISION                         */00036   
  20 NUDIV CHAR(2) ,     /* NUMERO DIVISION / EDITEUR                 */00037   
  20 LIBTI CHAR(45),     /* LIBELLE  ARTICLE                          */00036   
  20 GPSUX CHAR(3) ,     /* NUMERO DE GROUPE DE SURREMISE             */00038   
  20 NUCOL CHAR(2) ,     /* NUMERO DE COLLECTION                      */00039   
  20 LISUM CHAR(1) ,     /* LIGNES A SUMMARIZER                       */00040   
  20 COTAX CHAR(1) ,     /* CODE TAXE TVA                             */00041   
  20 PRIFA DEC FIXED(7,2),/* PRIX DE FACTURATION                      */00042   
  20 RAPLI DEC FIXED(5,2),/* REMISE APPLIQUEE                         */00043   
  20 REMBA DEC FIXED(5,2),/* REMISE DE BASE                           */00044   
  20 TYSUR CHAR(1) ,     /* TYPE DE SURREMISE                         */00045   
  20 NUART CHAR(7) ,     /* NUMERO ARTICLE                            */00046   
  20 RUNTR CHAR(3) ,     /* NO DE RUN DE CREATION DES COENR = NORUN   */00047   
  20 NUBOR DEC FIXED(3,0),/* NUMERO DE BORDEREAU                      */00043   
  20 CTRLI DEC FIXED(7), /* COMPTEUR DE LIGNES                        */00048   
 /*    END INCLUDE++                                                  */        
             2 FILLER         CHAR (0);                                 00138   
       DCL   ENRWFAC          CHAR (602) EXT;                           00139   
                                        /*   INCLUDE IDDZCOMP         */00140   
                                        /*   INCLUDE IDDZFACP         */00141   
                                        /*   INCLUDE IDDCREFP         */00142   
                                        /*   INCLUDE IDDCRESP         */00143   
                                        /*   INCLUDE IDDZVALP         */00144   
       DCL 1 WTFAC            BASED(PENRWFAC),                          00145   
             10 ID ,                   /*    ARGUMENT DE TRI          */00146   
               20 ZONTRI      CHAR (190),                               00147   
 10 GS ,                 /* ZONES DE GESTION 07/99 105-->173          */00148   
                         /* ZONES DE GESTION 07/01 173-->188            00149   
                         /* ZONES DE GESTION 12/02 188-->190            00150   
                         /*********************************************/00151   
 /*    INCLUDE++ IDDZCOMP                                             */00152   
        /* DATA SET IDDZCOMP   AT LEVEL 001 AS OF 18/02/84    */                
0/* ZONE COMMUNE TIR1A,TIR1B,FLF,REM,FAC,RES              AU 01/03/79 */00001   
 /*-------------------------------------------------------------------*/00002   
 /*D 01 WTCOM */                                                        00003   
 20 CO,                                                                 00004   
  30 COENR CHAR(3) ,     /* CODE ENREGISTREMENT FACTURATION           */00005   
  30 NATOP CHAR(2) ,     /* NATURE OPERATION                          */00006   
  30 NUCLI CHAR(6) ,     /* NUMERO CLIENT                             */00007   
  30 REPRE CHAR(3) ,     /* CODE REPRESENTANT                         */00008   
  30 MOTRA CHAR(3) ,     /* MODE DE TRANSPORT                         */00009   
  30 RECOM ,             /* REFERENCE COMMANDE                        */00010   
   40 RECO1 CHAR(17),    /* REFERENCE COMMANDE EFFECTIVE              */00011   
   40 MONTC CHAR(08),    /* MONTANT COMPTANT POUR NATOP 21-22         */00012   
                         /* NUCLI NATOP 50-54-70-74(6 DERNIERS CARACT)*/00013   
  30 OPSPE CHAR(1) ,     /* OPERATION SPECIALE                        */00014   
  30 FRANC CHAR(1) ,     /* FRANCO DE PORT                            */00015   
  30 REDAC CHAR(1) ,     /* NUMERO DE REDACTEUR                       */00016   
  30 MAGTI CHAR(3) ,     /* MAGASIN DE TIRAGE                         */00017   
  30 NBFAC CHAR(1) ,     /* NOMBRE DE FACTURES                        */00018   
  30 PEFAC CHAR(1) ,     /* PERIODICITE DE FACTURATION                */00019   
  30 TYVAR CHAR(1) ,     /* TYPE DE VALORISATION RETOUR (0,1)         */00020   
  30 NATRE CHAR(2) ,     /* NATURE RETOUR EDITEUR                     */00021   
  30 RESAI ,             /* REFERENCE SAISIE                          */00022   
   40 ANNEE CHAR(2),     /* ANNEE                                     */00023   
   40 RUN   CHAR(3),     /* NO DE RUN                                 */00024   
   40 ORIGI CHAR(2),     /* ORIGINE                                   */00025   
   40 NUMRO FIXED DEC(5),/* NUMERO D ORDRE                            */00026   
  30 NUSEQ FIXED DEC(5) ,/* NUMERO DE SEQUENCE                        */00027   
  30 NUART CHAR(7) ,     /* NUMERO ARTICLE                            */00028   
  30 QUANT FIXED DEC(5), /* QUANTITE                                  */00029   
  30 REFLI CHAR(10),     /* REFERENCE LIGNE                           */00030   
  30 CATLI CHAR(1) ,     /* CATEGORIE LIGNE - BLANC,0,1,2,3           */00031   
  30 MACOM CHAR(3) ,     /* MAGASIN COMMERCIAL                        */00032   
  30 NORUN CHAR(3),      /* NUMERO DE RUN                             */00033   
  30 LOREC FIXED DEC(5), /* LOT DE REGROUPEMENT COMMANDES             */00034   
  30 CTRLI FIXED DEC(7), /* COMPTEUR DE LIGNES / RUN                  */00035   
  30 NARSE CHAR(7) ,     /* NO ARTICLE SECONDAIRE (COMPOSANT COLIS)   */00036   
  30 DAMIS ,             /* DATE DE MISE A JOUR STOCK                 */00037   
   40 DAMAA CHAR(2),     /* ANNEE                                     */00038   
   40 DAMMM CHAR(2),     /* MOIS                                      */00039   
   40 DAMJJ CHAR(2),     /* JOUR                                      */00040   
  30 DCOFA ,             /* DATE DE CONDITIONS DE FACTURATION ------- */00041   
   40 DCOAA CHAR(2),     /* ANNEE                                     */00042   
   40 DCOMM CHAR(2),     /* MOIS                                      */00043   
   40 DCOJJ CHAR(2),     /* JOUR                                      */00044   
  30 ZONTI CHAR(1),      /* ZONE DE TIRAGE                            */00045   
  30 PREPA CHAR(1),      /* CODE PREPARATION  ----------------------- */00046   
  30 SPENV CHAR(2),      /* SPECIFICATIONS D ENVOI ------------------ */00047   
  30 STRET CHAR(1),      /* ----------------------------------------- */00048   
  30 DIFOF CHAR(1),      /* DIFFUSION OFFICE ------------------------ */00049   
  30 FRAET CHAR(1),      /* CODE FRANCE = 1 , ETRANGER = 2 ---------- */00050   
  30 DEPAY CHAR(3),      /* CODE DEPARTEMENT PAYS-------------------- */00051   
  30 FIN CHAR(0),                                                       00052   
 /*F*/                                                                  00053   
 /*    END INCLUDE++                                                  */        
 /*    INCLUDE++ IDDZFACP                                             */00153   
        /* DATA SET IDDZFACP   AT LEVEL 003 AS OF 23/01/86    */                
0/* ZONE COMMUNE TIR1A,TIR1B,FLF,REM,FAC,RES              AU 01/03/79 */00001   
 /*-------------------------------------------------------------------*/00002   
 /*D 01 WTZFA */                                                        00003   
 20 FA,                                                                 00004   
  30 ECHEA CHAR(2),      /* CODE ECHEANCE                             */00005   
  30 IMPEC CHAR(1),      /* ECHEANCE IMPOSEE                          */00006   
  30 RETAU CHAR(1),      /* RETOUR AUTORISE ( 0 = NON,1 = OUI )       */00007   
  30 SUFAI CHAR(1),      /* SURREMISE FAITE (0,1)                     */00008   
  30 ORIMP CHAR(1),      /* ORIGINE D IMPOSITION 1=COMPENSE,2=NCOMP.  */00009   
  30 TYSUR CHAR(1),      /* TYPE DE SURREMISE (0,1,2,3,9)             */00010   
  30 SRIMP FIXED DEC(5,2), /* SURREMISE IMPOSEE                       */00011   
  30 PRIFA FIXED DEC(7,2), /* PRIX DE FACTURATION                     */00012   
  30 PRIBA FIXED DEC(7,2), /* PRIX DE BASE (COMPTABILITE MATIERE)     */00013   
  30 NIMPR CHAR(1),      /* NATURE D IMPOSITION (BLANC,1,2,3,4,5)     */00014   
  30 PRIBB FIXED DEC(7,2), /* PRIX BB GARE                            */00015   
  30 GPREM CHAR(2),      /* GROUPE PRODUIT REMISE                     */00016   
  30 CLAXX CHAR(3),      /* CLAUSE SURREMISE                          */00017   
  30 GPSUX CHAR(3),      /* GROUPE PRODUIT SURREMISE                  */00018   
  30 TYREF CHAR(1),      /* TYPE DE REFERENCE                         */00019   
  30 RACBA FIXED DEC(5,2), /* REMISE ACHAT DE BASE (COMPTA MATIERES)  */00020   
  30 RACRE FIXED DEC(5,2), /* REMISE ACHAT EDITEUR                    */00021   
  30 ORDIA CHAR(1),      /* ORIGINE DIFFERENCE ACHAT ((0,1,2,3)       */00022   
  30 TAUDI FIXED DEC(5,2), /* TAUX DE DISTRIBUTION                    */00023   
  30 LIDIS CHAR(1),      /* LISTE DE DISTRIBUTION                     */00024   
  30 ARTAF CHAR(1),      /* ARTICLE A STOCK AFFECTE                   */00025   
  30 NUEDI CHAR(3),      /* NUMERO EDITEUR                            */00026   
  30 NUDIV CHAR(2),      /* NO DIVISION / EDITEUR                     */00027   
  30 NUCOL CHAR(2),      /* NO COLLECTION / DIVISION                  */00028   
  30 CLADI CHAR(3),      /* CLAUSE DE DISTRIBUTION                    */00029   
  30 NATAU CHAR(1),      /*NATURE DE TAUX 1=TAUX,2=VALEUR A SUPPRIMER */        
  30 COSAI CHAR(1),      /*CODE DE SAISIE A SUPPRIMER(2)              */        
  30 COMED CHAR(1),      /*A SUPPRIMER (3)->(1)+(2)+(3)=>POIDS        */        
  30 EDIAN CHAR(2),      /* NO EDITEUR ANCIEN                         */00033   
  30 COLAN CHAR(2),      /* NO COLL ANCIEN                            */00034   
  30 COTAX CHAR(1),      /* CODE TAXE TVA                             */00035   
  30 PINET CHAR(1),      /* TYPE DE PRIX                              */00036   
  30 ECFAC CHAR(1),      /* ECLATEMENT FACTURATION ETRANGER           */00037   
  30 VENET CHAR(2),      /* VENTILATION NATURE PRODUIT ETRANGER       */00038   
  30 VENBB CHAR(1),      /* VENTILATION NATURE PRODUIT BB             */00039   
  30 EXSEX CHAR(4),      /* EXPLOITATION - SOUS EXPLOITATION          */00040   
  30 COGAN CHAR(2),      /* CODE COGAN                                */00041   
  30 DEDIT CHAR(2),      /* DEPARTEMENT EDITEUR                       */00042   
  30 CATRA CHAR(1),      /* CATEGORIE REMISE ACHAT                    */00043   
  30 GEPRO CHAR(2),      /* GESTIONNAIRE DE PRODUIT                   */00044   
  30 RSGPS CHAR(4),      /* REGROUPEMENT STATISTIQUE                  */00045   
  30 VOYAR CHAR(2),      /* VOYAGEUR ARTICLE                          */00046   
  30 ARSON CHAR(1),      /* ARTICLE A SONDER                          */00047   
  30 COUVE CHAR(1),      /* COURANT DE VENTE                          */00048   
  30 COLBB CHAR(2),      /* COLLECTION BB                             */00049   
  30 GENBB CHAR(2),      /* GENRE DE PRODUITS BB                      */00050   
  30 TYVEN CHAR(1),      /* TYPE DE VENTE                             */00051   
  30 LIBTI CHAR(45),     /* LIBELLE TITRE                             */00052   
  30 LIBAU CHAR(25),     /* NOM AUTEUR                                */00053   
  30 FIN   CHAR(0),                                                     00054   
  /*F*/                                                                 00055   
 /*    END INCLUDE++                                                  */        
 /*    INCLUDE++ IDDCREFP                                             */00154   
        /* DATA SET IDDCREFP   AT LEVEL 001 AS OF 18/02/84    */                
0/* ZONE COMMUNE  REM,FAC                                 AU 10/09/79 */00001   
 /*********************************************************************/00002   
 /*D 01 WTCRF */                                                        00003   
 20 RF,                                                                 00004   
  30 REPIE CHAR(4),      /* REFERENCE PIECE                           */00005   
  30 LOTIR FIXED DEC(3), /* LOT DE TIRAGE                             */00006   
  30 CABOT CHAR(1),      /* CATEGORIE DE BORDEREAU ------------------ */00007   
  30 TRIFA CHAR(1),      /* ----------------------------------------- */00008   
  30 FIN CHAR(0),                                                       00009   
 /*F*/                                                                  00010   
 /*    END INCLUDE++                                                  */        
 /*    INCLUDE++ IDDCRESP                                             */00155   
        /* DATA SET IDDCRESP   AT LEVEL 001 AS OF 18/02/84    */                
0/* ZONE COMMUNE  REM,RES                                 AU 10/09/79 */00001   
 /*-------------------------------------------------------------------*/00002   
 /*D 01 WTCRS */                                                        00003   
 20 RS,                                                                 00004   
  30 POILU FIXED DEC(9,3), /* POIDS DE L UNITE DE CONDITIONNEMENT     */00005   
  30 REMBA FIXED DEC(5,2), /* REMISE DE BASE  ----------------------- */00006   
  30 TARDI CHAR(1),      /*------------------------------------------ */00007   
  30 COBAR CHAR(1),      /* CODE BARETTE  B,1=CDL,2=CRDL              */00008   
  30 HEBFA CHAR(1),      /* HEBDO FACTURATION OPTION TRAITEMENT       */00009   
  30 ORPRO CHAR(1),      /* ORIGINE PROGRAMME  1=RASSORT  2=OFFICE    */00010   
                         /* 3=CONTROLE  5=OFFREC SUR FICHIER RESULTAT */00011   
                         /* 6=OFFREC SUR FICHIER ATTENTE              */00012   
  30 NUBOR FIXED DEC (3),/* NUMERO DE BORDEREAU                       */00013   
  30 DEBOR CHAR(1),      /* DERNIER BORDEREAU CODE FIN DE LOREC       */00014   
  30 ZOGEO CHAR(1),      /* ZONE GEOGRAPHIQUE(M:MAUREPAS,C:COULOMMIER)*/00015   
  30 FIN   CHAR(0),                                                     00016   
 /*F*/                                                                  00017   
 /*    END INCLUDE++                                                  */        
 /*    INCLUDE++ IDDZVALP                                             */00156   
        /* DATA SET IDDZVALP   AT LEVEL 001 AS OF 18/02/84    */                
0/* RESULTATS DE FACTURATION FAC1A/FAD1A/FDI1A......      AU 17/01/80 */00001   
 /*-------------------------------------------------------------------*/00002   
 20  VA ,                                                               00003   
  30 CLIST CHAR(6) ,     /* COMPTE DE REGROUPEMENTS STATISTIQUES      */00004   
  30 DEPCO CHAR(2) ,     /* DEPARTEMENT COMPTABLE                     */00005   
  30 TRACO CHAR(1) ,     /* TRAITEMENT  COMPTABLE                     */00006   
  30 MAGES CHAR(3) ,     /* MAGASIN DE GESTION                        */00007   
  30 CADIS CHAR(1) ,     /* CANAL   DE DISTRIBUTION                   */00008   
  30 POFIS CHAR(1) ,     /* POSITION FISCALE                          */00009   
  30 REGFA CHAR(1) ,     /* REGIME DE FACTURATION                     */00010   
  30 CADOR CHAR(1) ,     /* CATEGORIE DE DOSSIER RECU                 */00011   
  30 TYCLI CHAR(1) ,     /* TYPE DE CLIENTELE                         */00012   
  30 SYPRO CHAR(2) ,     /* SYSTEME DE PROSPECTION                    */00013   
  30 REMAR CHAR(2) ,     /* CODE REGION MARCHE                        */00014   
  30 EDIPA CHAR(1) ,     /* EDITION PAPIER   1=FRANCE 2=GIH 9=NON EDIT*/00015   
  30 FACSP CHAR(1) ,     /* FACTURATION SPECIALE   1=ECHE. A FIXER    */00016   
                         /* 2=AUTORISATION RETOUR  3=PROFORMA         */00017   
                         /* 4=FACTUR. ANTICIPEE    5=FACTUR. NORMALE  */00018   
  30 GNATO CHAR(2) ,     /* GROUPE DE NATURES D'OPERATION             */00019   
  30 GNAT1 CHAR(2) ,     /* REGROUPEMENT DE GNATO POUR TRI            */00020   
  30 CLASS CHAR(1) ,     /* CLASSE DE NATURE D'OPERATIONS             */00021   
  30 LISUM CHAR(1) ,     /* LIGNES A SUMMARIZER   0=NON  1=OUI        */00022   
  30 DANTI ,             /* DATE ANTICIPATION                         */00023   
   40 AA   CHAR(2) ,     /* ANNEE                                     */00024   
   40 MM   CHAR(2) ,     /* MOIS                                      */00025   
  30 SMANU CHAR(1) ,     /* SURREMISE MANUELLE     1=OUI   0=NON      */00026   
  30 PUNHT DEC FIXED(7,2),/* PRIX UNITAIRE NET  HORS REMISE HORS TAXE */00027   
  30 RAPLI DEC FIXED(5,2),/* REMISE APPLIQUEE                         */00028   
  30 FORLI DEC FIXED(11,2),/* FORT FACTURE DE LA LIGNE                */00029   
  30 NETLI DEC FIXED(11,2),/* NET  FACTURE DE LA LIGNE                */00030   
  30 TAXLI DEC FIXED(11,2),/* MONTANT DES TAXES DE LA LIGNE           */00031   
  30 NBTOM DEC FIXED(7,0),/* NOMBRE DE TOMES                          */00032   
  30 GEFDI CHAR(1) ,      /* CODE GENERATION VERS RESULTATS ACTIVITE  */00033   
                          /* B = NON GENER.  1 = GENERATION FACT.DIFF.*/00034   
  30 FIN   CHAR(0) ,      /*                                          */00035   
 /*    END INCLUDE++                                                  */        
             20 POIDF FIXED DEC(7),     /*POIDS FACTURE = POIFA */      00157   
             20 REFAD      CHAR(4),     /*REFERENCE ADRESSE     */      00158   
             20 EANNU      CHAR(13),    /*CPEAN NUART           */      00159   
             20 EANNA      CHAR(13),    /*CPEAN NARSE           */      00160   
             10 FILLER        CHAR (0);                                 00161   
             PENRWFAC         = ADDR(ENRWFAC);                          00162   
                                        /*   ZONE DE LECTURE F A FACTU*/00163   
       DCL   ZENRWFAC         CHAR (602);                               00164   
       DCL 1 ZWTFAC           LIKE WTFAC BASED(PZENRWFAC);              00165   
             PZENRWFAC        = ADDR(ZENRWFAC);                         00166   
0      DCL   CLICONUM         PIC'(6)9' BASED (PCLICO);                 00167   
             PCLICO           = ADDR(WTCLI1.CLICO);                     00168   
       DCL   NUCLINUM         PIC'(6)9' BASED (PNUCLI);                 00169   
             PNUCLI           = ADDR(WTFAC.NUCLI);                      00170   
       DCL   NBFACNUM         PIC'(1)9' BASED (PNBFAC);                 00171   
             PNBFAC           = ADDR(WTFAC.NBFAC);                      00172   
       DCL   COTAXNUM         PIC'(1)9' BASED (P_COTAX);                00173   
             P_COTAX          = ADDR(WTFAC.COTAX);                      00174   
       DCL   ECHEANUM         PIC'(2)9' BASED (P_ECHEA);                00175   
             P_ECHEA          = ADDR(WTFAC.ECHEA);                      00176   
       DCL   NUARTNUM         PIC'(7)9' BASED (P_NUART);                00177   
             P_NUART          = ADDR(WTFAC.NUART);                      00178   
       DCL   NARSENUM         PIC'(7)9' BASED (P_NARSE);                00179   
             P_NARSE          = ADDR(WTFAC.NARSE);                      00180   
       DCL 1 COENRED          BASED (P_COENR),                          00181   
             2 COENR1         CHAR (1),                                 00182   
             2 COENR2         CHAR (1),                                 00183   
             2 COENR3         CHAR (1);                                 00184   
       DCL 1 COENRED_2        BASED (P_COENR),                          00185   
             2 COENR1         CHAR (1),                                 00186   
             2 COENR23        CHAR (2);                                 00187   
             P_COENR          = ADDR(WTFAC.COENR);                      00188   
       DCL 1 ZCOENRED         BASED (P_ZCOENR),                         00189   
             2 ZCOENR1        CHAR (1),                                 00190   
             2 ZCOENR2        CHAR (1),                                 00191   
             2 ZCOENR3        CHAR (1);                                 00192   
             P_ZCOENR         = ADDR(ZWTFAC.COENR);                     00193   
       DCL 1 VENETRED         BASED (P_VENET),                          00194   
             2 NATUR          CHAR (1),                                 00195   
             2 EXPLO          CHAR (1);                                 00196   
       DCL 1 VENETBIS         BASED (P_VENET),                          00197   
             2 NATURBIS       CHAR (1),                                 00198   
             2 EXPLONUM       PIC'9';                                   00199   
             P_VENET          = ADDR(WTFAC.VENET);                      00200   
       DCL 1 POIDFRED         BASED (P_POIDF),                          00201   
             2 POIDSF         FIXED DEC (7,3) ;                         00202   
             P_POIDF          = ADDR(WTFAC.POIDF);                      00203   
       DCL 1 ECFACX           BASED (P_ECFAC),                          00204   
             2 ECFAC9         PIC'9' ;                                  00205   
             P_ECFAC          = ADDR(WTFAC.ECFAC);                      00206   
0      DCL   (PCLICO,PNUCLI,PNBFAC,P_POIDF)    PTR;                     00207   
       DCL   (P_COENR,P_ZCOENR,P_ECHEA)        PTR;                     00208   
       DCL   (P_NUART,P_NARSE,P_COTAX,P_VENET) PTR;                     00209   
       DCL    P_ECFAC                          PTR;                     00210   
                                                                        00211   
1                                       /******************************/00212   
                                        /* AJOUT LE 03 11 92          */00213   
                                        /* FICHIER AUXILIAIRE CLIENTS */00214   
                                        /* CLIENT                     */00215   
 /*    INCLUDE++ EXAUCLI                                              */00216   
        /* DATA SET EXAUCLI    AT LEVEL 006 AS OF 09/11/92    */                
  DCL ZEXCLI CHAR(450) ;                                                00001**2
  /*-------------------------------------------------------------*/     00002**3
  /*      DESCRIPTION DU FICHIER CLIENT AUXILIAIRE EXPORT        */     00003**3
  /*-------------------------------------------------------------*/     00004**3
  DCL 1 WEXCLI BASED(ADDR(ZEXCLI)),                                     00005**2
      2 CODCLI CHAR(06),                   /* CODE CLIENT    -CLE-    */00006**4
      2 FI1CLI CHAR(01),                   /* FILLER                  */00007**1
      2 RASCLI CHAR(26),                   /* RAISON SOCIALE CLIENT   */00008**1
      2 FI2CLI CHAR(01),                   /* FILLER                  */00009**1
      2 VILCLI CHAR(26),                   /* VILLE CLIENT            */00010**1
      2 FI3CLI CHAR(01),                   /* FILLER                  */00011**1
      2 PAYCLI CHAR(03),                   /* CODE PAYS CLIENT        */00012**1
      2 FI4CLI CHAR(01),                   /* FILLER                  */00013**1
      2 LIPCLI CHAR(25),                   /* LIBELLE PAYS            */00014**1
      2 FI5CLI CHAR(09),                   /* FILLER                  */00015**1
      2 COLCLI CHAR(01),                   /* CONDI COLIS             */00016**1
      2 PALCLI CHAR(01),                   /* CONDI PALETTE           */00017**1
      2 SPECLI CHAR(02),                   /* SPENV CLIENT            */00018**1
      2 MODCLI CHAR(02),                   /* MODE ENVOI CLIENT       */00019**1
      2 ASSCLI CHAR(03),                   /* TAUX ASSURANCE CLIENT   */00020**1
      2 FACCLI CHAR(06),                   /* VENTILATION FACTURE     */00021**1
      2 FRACLI CHAR(06),                   /* MONTANT FRAIS CLIENT    */00022**1
      2 FI6CLI CHAR(02),                   /* FILLER                  */00023**1
      2 DOCCLI CHAR(08),                   /* DOCUMENTS CLIENT        */00024**1
      2 TRACLI CHAR(15),                   /* NOM TRANSPORTEUR CLIENT */00025**1
      2 REMCLI CHAR(02),                   /* REMISE MOYENNE CLIENT   */00026**1
      2 AUTCLI CHAR(01),                   /* AUTRES FRAIS            */00027**1
      2 SALCLI CHAR(01),                   /* ZONE SAL                */00028**1
      2 FI7CLI CHAR(01),                   /* FILLER                  */00029**1
      2 CONCLI CHAR(255),                  /* CONDITIONS PARTICULIERES*/00030**1
      2 FI8CLI CHAR(1),                    /* FILLER                  */00031**6
      2 CEECLI CHAR(14),                   /* N� IDENTIFICATION ACQUE-*/00032**1
                                           /* REUR CEE                */00033**1
      2 FI9CLI CHAR(30) ,                  /* FILLER                  */00034**6
      2 F_WEXCLI CHAR(0);                                               00035**1
 /*    END INCLUDE++                                                  */        
                                        /* FIN AJOUT                  */00217   
1                                       /******************************/00218   
                                        /* AJOUT LE 03 10 06 YFB      */00219   
                                        /* FICHIER ENTETES FIR        */00220   
       DCL     LGENT           FIXED BIN(15)   INIT (220);              00221   
       DCL     WZON_ENT            CHAR(220) INIT (' ')   ;             00222   
                                                                        00223   
 /*    INCLUDE++ FIRZENTP                                             */00224   
                                                                                
1        /***************************************************/          INV00080
         /*      DESCRITION FICHIER LIGENT  (ENTETE)        */          INV00090
         /***************************************************/          INV00100
       DCL 1   WENR_ENT    BASED (ADDR(WZON_ENT))         ,             INV00200
           2 KEY_ENT                                ,                   INV00200
             3 E_NUPAC            FIXED DEC (9,0)   ,                   INV00200
           2 E_NUCLI              CHAR(6)           ,                   INV00200
           2 E_NORUN              CHAR(3)           ,                   INV00200
           2 E_LOREC              FIXED DEC (5,0)   ,                   INV00200
           2 E_NUBOR              FIXED DEC (3,0)   ,                   INV00200
           2 E_DAMIS              CHAR(6)           ,                   INV00200
           2 E_BORFI              FIXED DEC (3,0)   ,                   INV00200
           2 E_BORCO              CHAR(1)           ,                   INV00200
           2 E_CLILI              CHAR(6)           ,                   INV00200
           2 E_NUORD              FIXED DEC (5,0)   ,                   INV00200
           2 E_NBETI              FIXED DEC (5,0)   ,                   INV00200
           2 E_ZONTI              CHAR(1)           ,                   INV00200
           2 E_MAGTI              CHAR(3)           ,                   INV00200
           2 E_REPIE              CHAR(4)           ,                   INV00200
           2 E_PREPA              CHAR(1)           ,                   INV00200
           2 E_MOTRA              CHAR(3)           ,                   INV00200
           2 E_SPENV              CHAR(2)           ,                   INV00200
           2 E_TRACR              CHAR(3)           ,                   INV00200
           2 E_FRANC              CHAR(1)           ,                   INV00200
           2 E_MACOM              CHAR(3)           ,                   INV00200
           2 E_POIDS              FIXED DEC (7,0)   ,                   INV00200
           2 E_POIGL              FIXED DEC (7,0)   ,                   INV00200
           2 E_TRADI              CHAR(5)           ,                   INV00200
           2 E1_XCLCAM            CHAR(6)           ,                   INV00200
           2 E1_XDATEX            CHAR(6)           ,                   INV00200
           2 E1_NBVAL             DEC FIXED (5,0)   ,                   INV00200
           2 E1_XMOTRA            CHAR(3)           ,                   INV00200
           2 E1_XNBUEX            FIXED DEC (3,0)   ,                   INV00200
           2 E1_XCOLPA            CHAR(1)           ,                   INV00200
           2 E_MAGAS              CHAR(5)           ,                   INV00200
           2 E_NATBT              CHAR(4)           ,                   INV00200
           2 E_BTSRA              CHAR(6)           ,                   INV00200
           2 E_SECLA              CHAR(2)           ,                   INV00200
           2 E_EXMUL              CHAR(1)           ,                   INV00200
           2 E_DAVAR              CHAR(06)          ,                   INV00200
           2 E_HEVAR              PIC'999999'       ,                   INV00200
           2 E_CONTR              CHAR(04)          ,                   INV00200
           2 E_FILL08             CHAR(08)          ,                   INV00200
           2 E_PEFAC              CHAR(1)           ,                   INV00200
           2 E_BOREC              CHAR(1)           ,                   INV00200
           2 E_DEMFA              CHAR(6)           ,                   INV00200
           2 E_RUNFA              CHAR(3)           ,                   INV00200
           2 E_NUFAC              FIXED DEC (5,0)   ,                   INV00200
           2 E_DOCUM              CHAR(1)           ,                   INV00200
           2 E_CLICO              CHAR(6)           ,                   INV00200
           2 E_NATOP              CHAR(2)           ,                   INV00200
           2 E_TRACO              CHAR(1)           ,                   INV00200
           2 E_DEPCO              CHAR(2)           ,                   INV00200
           2 E_TYCLI              CHAR(1)           ,                   INV00200
           2 E_RECOM              CHAR(25)          ,                   INV00200
           2 E_DCOFA              CHAR(6)           ,                   INV00200
           2 E_FAREC              CHAR(1)           ,                   INV00200
           2 E_PFIAN              FIXED DEC (9,0)   ,                   INV00200
           2 E_TRIFA              CHAR(1)           ,                   INV00200
           2 E_CODAD              CHAR(2)           ,                   INV00200
           2 E_TOPRE              CHAR(1)           ,                   INV00200
           2 E_MAGES              CHAR(3)           ,                           
           2 E_NATRE              CHAR(2)           ,                           
           2 E_ECFAC              CHAR(1)           ,                           
           2 E_LOCAM              CHAR(6)           ,                           
           2 FILLER1              CHAR(3)         ;                             
 /*    END INCLUDE++                                                  */        
  /***************************************************/                 00225   
        DCL     CLE_ENT                FIXED DEC (9,0)     ;            00226   
        DCL     LGCLE_ENT       FIXED BIN(15)   INIT (5);               00227   
        DCL 1   WCLE_ENT            BASED (ADDR(CLE_ENT))  ,            00228   
           2  WE_NUPAC         FIXED DEC (9,0)       ;                  00229   
                                                                        00230   
                                        /* FIN AJOUT                  */00231   
1                                       /******************************/00232   
1                                       /******************************/00233   
                                        /* AJOUT LE 15 01 97   �$     */00234   
                                        /* ANALYSE PIED DE FACTURE    */00235   
0      DCL 1 FD_IDPIEDF5   CHAR (64);                                   00236   
0      DCL 1 FD_IDPIEDF5_B       BASED (ADDR(FD_IDPIEDF5)),             00237   
 /*    INCLUDE++ IDPIEDF5                                             */00238   
      /* ECART TVA S/CALCUL LIGNE ET PIED FACTURE*/                             
      /*  GENERE LE 28/10/98 A 18H12 PAR ANJLA0 */                              
           02 PI5_PIEDF,                                                        
          /* NUMERO DE RUN                            */                        
            03 PI5_NORUNX,                                                      
             04 PI5_NORUN PIC'(03)9',                                           
          /* DATE DE LA FACTURE                       */                        
            03 PI5_SSCOM CHAR(02),                                              
            03 PI5_AACOM CHAR(02),                                              
            03 PI5_MMCOM CHAR(02),                                              
            03 PI5_JJCOM CHAR(02),                                              
          /* GROUPE DE NATURE D'OPERATION             */                        
            03 PI5_GNATO CHAR(02),                                              
          /* NUMERO CLIENT                            */                        
            03 PI5_NUCLI CHAR(06),                                              
          /* NUMERO DE FACTURE                        */                        
            03 PI5_NUFACX,                                                      
             04 PI5_NUFAC FIXED DEC(05,0),                                      
          /* MONTANT TTC FACTURE AS                   */                        
            03 PI5_MTCFAX,                                                      
             04 PI5_MTCFA FIXED DEC(11,2),                                      
          /* MONTANT TTC FACTURE NS                   */                        
            03 PI5_MTCF1X,                                                      
             04 PI5_MTCF1 FIXED DEC(11,2),                                      
          /* MONTANT DES TAXES AS                     */                        
            03 PI5_TAXESX,                                                      
             04 PI5_TAXES FIXED DEC(11,2),                                      
          /* MONTANT DES TAXES NS                     */                        
            03 PI5_MTAXX,                                                       
             04 PI5_MTAX FIXED DEC(11,2),                                       
          /* ECART DE TVA  NS - AS                    */                        
            03 PI5_ECTVAX,                                                      
             04 PI5_ECTVA FIXED DEC(11,2),                                      
          /* FILLER X(20)                             */                        
            03 PI5_COEN7 CHAR(07),                                              
            03 PI5_TRACO CHAR(01),                                              
            03 PI5_FIL12 CHAR(04),                                              
            03 PI5_XXXXX CHAR(0);                                               
 /*    END INCLUDE++                                                  */        
                                                                        00239   
                                        /*  COMPLEMENT REF.DE COMMANDE*/00240   
0      DCL 1 FD_IDREFCO1   CHAR (40);                                   00241   
0      DCL 1 FD_IDREFCO1_B       BASED (ADDR(FD_IDREFCO1)),             00242   
 /*    INCLUDE++ IDREFCO1                                             */00243   
      /* REFERENCES COMMANDES RUN OFFICE         */                             
      /*  GENERE LE 15/01/97 A 11H09 PAR YCH    */                              
           02 RF1_REFCO,                                                        
          /* CLE                                      */                        
            03 RF1_CLE01,                                                       
          /* NUMERO DE RUN                            */                        
             04 RF1_NORUNX,                                                     
              05 RF1_NORUN PIC'(03)9',                                          
          /* NUMERO CLIENT                            */                        
             04 RF1_NUCLI CHAR(06),                                             
          /* REFERENCE COMMANDE EFFECTIVE             */                        
            03 RF1_RECO1,                                                       
          /* 12 PREMIERS CARACT REFERENCE COMMANDE    */                        
             04 RF1_REC12 CHAR(12),                                             
          /* FILLER X(05)                             */                        
             04 RF1_FIL05 CHAR(05),                                             
          /* FILLER X(14)                             */                        
            03 RF1_FIL14 CHAR(14),                                              
            03 RF1_XXXXX CHAR(0);                                               
 /*    END INCLUDE++                                                  */        
0      DCL 1 FD_CLE_IDREFCO1   CHAR (09);                               00244   
       DCL 1 FD_CLE_IDREFCO1_B   BASED (ADDR(FD_CLE_IDREFCO1)),         00245   
             2  FD_RF1_NORUN   CHAR (03),                               00246   
             2  FD_RF1_NUCLI   CHAR (06);                               00247   
                                        /* FIN AJOUT                  */00248   
1                                       /******************************/00249   
                                                                        00250   
1                                       /*******************************00251   
                                        *                              *00252   
                                        *    ETATS EN SORTIE           *00253   
                                        *                              *00254   
                                        *******************************/00255   
0                                       /*******************************00256   
                                        *                              *00257   
                                        *    DESCRIPTION DE            *00258   
                                        *    LA FACTURE                *00259   
                                        *    SAUT ASA                  *00260   
                                        *                              *00261   
                                        *    LONGUEUR MAXI = 123       *00262   
                                        *                              *00263   
                                        *******************************/00264   
0      DCL 1 ENTET1,                    /*   ENTETE FACTURE           */00265   
             2 SAUT           CHAR (1)  INIT ('1'),                     00266   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00267   
             2 NUFAC          CHAR (5)  INIT (' '),/*   PIC'99999'    */00268   
             2 ENVEL          CHAR (1)  INIT (' '),                     00269   
             2 FIL1           CHAR (30) INIT ((30)' '),/*YDV 27*/       00270   
             2 NOCRD          CHAR (47),               /*YDV 50*/       00271   
             2 FIL2           CHAR (1)  INIT (' '),                     00272   
             2 EDIPA          CHAR (1),                                 00273   
             2 TRACO          CHAR (1),                                 00274   
             2 POREC          CHAR (1),                                 00275   
             2 GNATO          CHAR (2),                                 00276   
             2 FIL9           CHAR (2)  INIT ('/ '),                    00277   
             2 MACOM          CHAR (3),                                 00278   
             2 FIL3           CHAR (3)  INIT (' . '),                   00279   
             2 FACSP          CHAR (1),                                 00280   
             2 FIL4           CHAR (3)  INIT (' . '),                   00281   
             2 CADOR          CHAR (1),                                 00282   
             2 FIL5           CHAR (1)  INIT (' '),                     00283   
             2 LSCAD          CHAR (5),                                 00284   
             2 FIL6           CHAR (2)  INIT ('. '),                    00285   
             2 GNAT1          CHAR (2),                                 00286   
             2 FIL7           CHAR (3)  INIT (' . '),                   00287   
             2 PEFAC          CHAR (1),                                 00288   
             2 FIL8           CHAR (1)  INIT (' ');                     00289   
0      DCL 1 ENTET2,                                                    00290   
             2 SAUT           CHAR (1)  INIT (' '),                     00291   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00292   
             2 FIL1           CHAR (36)  INIT ((36)' '),/*YDV*/         00293   
             2 ADCRD          CHAR (47),                                00294   
             2 FIL2           CHAR (30) INIT ((30)' '),                 00295   
             2 MOTRA          CHAR (3),                                 00296   
             2 FIL6           CHAR (1)  INIT ((1)' ');                  00297   
0      DCL 1 ENTET3,                                                    00298   
             2 SAUT           CHAR (1)  INIT (' '),                     00299   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00300   
             2 FIL1           CHAR (36) INIT ((36)' '), /*YDV*/         00301   
             2 VICRD          CHAR (47),                                00302   
             2 FIL2           CHAR (34) INIT ((34)' '),                 00303   
             2 RASOC1         CHAR(26),                                 00304   
             2 FIL3           CHAR(1)   INIT ((1)' '),                  00305   
             2 RASOC2         CHAR(26);                                 00306   
0      DCL 1 ENTET4,                                                    00307   
             2 SAUT           CHAR (1)  INIT (' '),                     00308   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00309   
             2 FIL1           CHAR (36) INIT ((36)' '),/*YDV*/          00310   
             2 RCCRD          CHAR (47),                                00311   
             2 FIL2           CHAR (8)  INIT ((8)' '),                  00312   
             2 FIL3           CHAR (10) INIT (' '),  /* D . C */        00313   
             2 NUCLI          PIC'99B999B9',                            00314   
             2 EXEMP          PIC'ZZ9',                                 00315   
             2 FOLIO          PIC'ZZZ9',                                00316   
             2 FIL4           CHAR (1)  INIT ((1)' '),                  00317   
             2 NOCLI1         CHAR(15),                                 00318   
             2 FIL5           CHAR (12) INIT ((12)' '),                 00319   
             2 NOCLI2         CHAR(15),                                 00320   
             2 FIL6           CHAR (11) INIT ((11)' ');                 00321   
0      DCL 1 ENTET5,                                                    00322   
             2 SAUT           CHAR (1)  INIT (' '),                     00323   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00324   
             2 FIL121         CHAR (117) INIT ((117)' '), /*YDV*/       00325   
             2 ADCLI1         CHAR (26),                                00326   
             2 FIL1           CHAR (1)  INIT ((1)' '),                  00327   
             2 ADCLI2         CHAR (26);                                00328   
0      DCL 1 ENTET7,                                                    00329   
             2 SAUT           CHAR (1)  INIT (' '),                     00330   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00331   
             2 FIL1           CHAR (03) INIT ((03)' '), /*YDV*/         00332   
             2 LIDOC          CHAR (20) INIT ((20)' '),                 00333   
             2 LGNAT          CHAR (22) INIT ((22)' '),                 00334   
             2 LECFA          CHAR (15) INIT ((15)' '),                 00335   
 /*          2 FIL2           CHAR (53) INIT ((53)' '),            */   00336   
             2 FIL2           CHAR(16)  INIT(' '),                      00337   
             2 LIBCEE         CHAR(09)  INIT(' '),                      00338   
             2 IDCLI          CHAR(14)  INIT(' '),                      00339   
             2 FIL4           CHAR(10)  INIT(' '),                      00340   
             2 NUFAC          PIC'99999',                               00341   
             2 ENVEL          CHAR (1) ,                                00342   
             2 FIL3           CHAR (01) INIT ((01)' '),                 00343   
             2 LORES1         CHAR (26),                                00344   
             2 FIL5           CHAR (02) INIT ((02)' '),                 00345   
             2 LORES2         CHAR (26),                                00346   
             2 FIL6           CHAR (01) INIT ((01)' ');                 00347   
       DCL 1 NUFACCHAR        CHAR (5)  BASED (ADDR(ENTET7.NUFAC));     00348   
0      DCL 1 ENTET7_1,                  /*   GRAS POLICE FACTURE AVOIR*/00349   
             2 SAUT           CHAR (01) INIT ('+'),                     00350   
             2 POLIC          CHAR (01) INIT ('04'X),                   00351   
             2 FIL1           CHAR (03) INIT ((03)' '),                 00352   
             2 LIDOC          CHAR (20) ,                               00353   
             2 LGNAT          CHAR (22) ,                               00354   
             2 LECFA          CHAR (15) INIT ((15)' '),                 00355   
             2 FIL2           CHAR (16) INIT ((16)' '),                 00356   
             2 LIBCEE         CHAR (09) INIT ((09)' '),                 00357   
             2 IDCLI          CHAR (14) INIT ((14)' '),                 00358   
             2 FIL4           CHAR (10) INIT ((10)' '),                 00359   
             2 NUFAC          CHAR (05) INIT ((05)' '),                 00360   
             2 ENVEL          CHAR (01) INIT ((01)' '),                 00361   
             2 FIL3           CHAR (01) INIT ((01)' '),                 00362   
             2 LORES1         CHAR (26) INIT ((26)' '),                 00363   
             2 FIL5           CHAR (02) INIT ((02)' '),                 00364   
             2 LORES2         CHAR (26) INIT ((26)' '),                 00365   
             2 FIL6           CHAR (01) INIT ((01)' ');                 00366   
0                                       /*   ECRITUR AVEC ENTET7_1_EDI*/00367   
       DCL 1 ENTET7_1_EDI     LIKE ENTET7_1 ;                           00368   
       DCL 1 ENTET7_1_60      CHAR (60) BASED(ADDR(ENTET7_1_EDI.FIL1)); 00369   
0      DCL 1 ENTET65,                                                   00370   
             2 SAUT           CHAR (1)  INIT (' '),                     00371   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00372   
             2 FIL1           CHAR (18) INIT ((18)' '),                 00373   
             2 TITRE          CHAR (9),                                 00374   
             2 FIL2           CHAR (29) INIT ((29)' '),/*YDV*/          00375   
             2 LIPEF          CHAR (15),                                00376   
             2 FIL00          CHAR (02) INIT ((02)' '),                 00377   
             2 SCLICO         CHAR (10),                                00378   
             2 FIL01          CHAR (02) INIT ((02)' '),                 00379   
             2 VENET          CHAR (2),                                 00380   
             2 FIL02          CHAR (02) INIT ((02)' '),                 00381   
             2 COMPTA         CHAR (10),                                00382   
             2 FIL03          CHAR (02) INIT ((02)' '),                 00383   
             2 STRET          CHAR (1),                                 00384   
             2 FIL04          CHAR (03) INIT ((03)' '),                 00385   
             2 RUN            CHAR (4),                                 00386   
             2 DAT13,                                                   00387   
               3 JJ           CHAR (2),                                 00388   
               3 FIL05        CHAR (1)  INIT ('.'),                     00389   
               3 MM           CHAR (2),                                 00390   
               3 FIL06        CHAR (1)  INIT ('.'),                     00391   
               3 AA           CHAR (2),                                 00392   
             2 CPCLI1         CHAR (5),                                 00393   
             2 FIL7           CHAR (1)  INIT (' '),                     00394   
             2 LOBDI1         CHAR (20),                                00395   
             2 FIL8           CHAR (1)  INIT (' '),                     00396   
             2 CPCLI2         CHAR (5),                                 00397   
             2 FIL9           CHAR (1)  INIT (' '),                     00398   
             2 LOBDI2         CHAR (26);                                00399   
0      DCL 1 ENTET70S,                  /*   ANCIEN ENTET70           */00400   
             2 SAUT           CHAR (1)  INIT (' '),                     00401   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00402   
             2 LIPEF          CHAR (15),                                00403   
             2 FIL00          CHAR (02) INIT ((02)' '),                 00404   
             2 SCLICO         CHAR (10),                                00405   
             2 FIL01          CHAR (02) INIT ((02)' '),                 00406   
             2 VENET          CHAR (2),                                 00407   
             2 FIL02          CHAR (02) INIT ((02)' '),                 00408   
             2 COMPTA         CHAR (10),                                00409   
             2 FIL03          CHAR (02) INIT ((02)' '),                 00410   
             2 STRET          CHAR (1),                                 00411   
             2 FIL04          CHAR (03) INIT ((03)' '),                 00412   
             2 RUN            CHAR (4),                                 00413   
             2 DAT13,                                                   00414   
               3 JJ           CHAR (2),                                 00415   
               3 FIL05        CHAR (1)  INIT ('.'),                     00416   
               3 MM           CHAR (2),                                 00417   
               3 FIL06        CHAR (1)  INIT ('.'),                     00418   
               3 AA           CHAR (2),                                 00419   
             2 FIL1           CHAR (03) INIT ((03)' '),                 00420   
             2 NUCLI          PIC'99B999B9',                            00421   
             2 FIL4           CHAR (5)  INIT ((5)' '),                  00422   
             2 NORUN          CHAR (3),                                 00423   
             2 FIL5           CHAR (1)  INIT ('.'),                     00424   
             2 REFFA          PIC'Z9999',                               00425   
             2 FIL6           CHAR (10) INIT ((10)' '),                 00426   
             2 DAT10,                                                   00427   
               3 JJ           CHAR (2),                                 00428   
               3 FIL7         CHAR (1)  INIT ('.'),                     00429   
               3 MM           CHAR (2),                                 00430   
               3 FIL8         CHAR (1)  INIT ('.'),                     00431   
               3 AA           CHAR (2),                                 00432   
             2 FIL9           CHAR (06) INIT ((06)' '),                 00433   
             2 FOLIO          PIC'ZZZ',                                 00434   
             2 FIL2           CHAR (13) INIT ((13)' ');                 00435   
0      DCL 1 FOLIO_70SGIH     PIC'ZZ9' BASED(ADDR(ENTET70S.FOLIO));     00436   
0      DCL 1 ENTET70,                                                   00437   
             2 SAUT           CHAR (1)  INIT (' '),                     00438   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00439   
             2 FIL1           CHAR (04) INIT ((04)' '),                 00440   
             2 NUCLI          PIC'99B999B9',                            00441   
             2 FIL4           CHAR (5)  INIT ((5)' '),                  00442   
             2 NORUN          CHAR (3),                                 00443   
             2 FIL5           CHAR (1)  INIT ('.'),                     00444   
             2 REFFA          PIC'Z9999',                               00445   
             2 FIL6           CHAR (10) INIT ((10)' '),                 00446   
             2 DAT10,                                                   00447   
               3 JJ           CHAR (2),                                 00448   
               3 FIL7         CHAR (1)  INIT ('.'),                     00449   
               3 MM           CHAR (2),                                 00450   
               3 FIL8         CHAR (1)  INIT ('.'),                     00451   
               3 AA           CHAR (2),                                 00452   
             2 FIL9           CHAR (06) INIT ((06)' '),                 00453   
             2 FOLIO          PIC'ZZZ',                                 00454   
 /*******************************************************************/  00455   
 /* 04 11 92 : DEBUT MODIF TVA CEE 93 : AJOUT N� IDENTIFICATION CEE */  00456   
 /*******************************************************************/  00457   
             2 FIL40          CHAR (64) INIT ((64)' '), /*66YDV*/       00458   
             2 PAYCL1         CHAR (26),                                00459   
             2 FILA           CHAR (1)  INIT (' '),                     00460   
             2 PAYCL2         CHAR (26);                                00461   
       /*    2 FIL10          CHAR(03)  INIT((03)' ') ,  */             00462   
       /*    2 FIL11          CHAR(11)  INIT((11)' ') ,  */             00463   
       /*    2 LIBCEE         CHAR(09)  INIT((09)' ') ,  */             00464   
       /*    2 IDCLI          CHAR(14)  INIT((14)' '),   */             00465   
       /*    2 FIL40          CHAR(28)  INIT ((31)' ')   */             00466   
0      DCL 1 FOLIO_70GIH      PIC'ZZ9' BASED(ADDR(ENTET70.FOLIO));      00467   
 /***********************************/                                  00468   
 /* 01 11 92 : FIN MODIF TVA CEE 93 */                                  00469   
 /***********************************/                                  00470   
 /**************/                                                       00471   
 /* MODIF FLC  */                                                       00472   
 /**************/                                                       00473   
                                      /*   FIN DE FACTURE AVANT PIED */ 00474   
0      DCL 1 FINFAC1 BASED (ADDR(TOTAL14)),                             00475   
             2 SAUT           CHAR (1)  INIT (' '),                     00476   
             2 FIL00          CHAR (32) INIT (''),                      00477   
             2 LIBEL1         CHAR (10) INIT (' '),                     00478   
             2 FIL01          CHAR (00) INIT (' '),                     00479   
             2 DAECH1,                                                  00480   
               3 JJ           CHAR (2),                                 00481   
               3 FIL05        CHAR (1)  INIT ('/'),                     00482   
               3 MM           CHAR (2),                                 00483   
               3 FIL06        CHAR (1)  INIT ('/'),                     00484   
               3 AA           CHAR (2),                                 00485   
             2 FIL02          CHAR (02) INIT (' ') ,                    00486   
             2 ECHEA1         CHAR (02),                                00487   
             2 ECHEAL1        CHAR (01) INIT (' '),                     00488   
             2 ECHEAL2        CHAR (15),                                00489   
             2 MTECH2         PIC'ZZZ.ZZZ.ZZ9V,99-',                    00490   
             2 FIL03          CHAR (07) INIT (' ') ,                    00491   
             2 MTECH1         PIC'ZZZ.ZZZ.ZZ9V,99-',                    00492   
             2 FIL03B         CHAR (37) INIT (' ') ;                    00493   
0      DCL 1 FINFAC2 BASED (ADDR(TOTAL14)),                             00494   
             2 SAUT           CHAR (1)  INIT (' '),                     00495   
             2 FIL00          CHAR (32) INIT (''),                      00496   
             2 LIBEL1         CHAR (10) INIT (' '),                     00497   
             2 FIL01          CHAR (00) INIT (' '),                     00498   
             2 DAECH1,                                                  00499   
               3 JJ           CHAR (2),                                 00500   
               3 FIL05        CHAR (1)  INIT ('/'),                     00501   
               3 MM           CHAR (2),                                 00502   
               3 FIL06        CHAR (1)  INIT ('/'),                     00503   
               3 AA           CHAR (2),                                 00504   
             2 FIL02          CHAR (02) INIT (' '),                     00505   
             2 ECHEA1         CHAR (02),                                00506   
             2 ECHEAL1        CHAR (01) INIT (' '),                     00507   
             2 ECHEAL2        CHAR (15),                                00508   
             2 FIL03          CHAR (23) INIT (' ') ,                    00509   
             2 MTECH1         PIC'ZZZ.ZZZ.ZZ9V,99-',                    00510   
             2 FIL03B         CHAR (37) INIT (' ') ;                    00511   
0      DCL 1 FINFAC3 BASED (ADDR(TOTAL14)),                             00512   
             2 SAUT           CHAR (1)  INIT (' '),                     00513   
             2 FIL01          CHAR (175) INIT ((175)'-');               00514   
0      DCL 1 FINFAC4 BASED (ADDR(TOTAL14)),                             00515   
             2 SAUT           CHAR (1)  INIT (' '),                     00516   
             2 FIL01          CHAR (175) INIT ((175)' ');               00517   
0      DCL 1 FINFAC5 BASED (ADDR(TOTAL14)),                             00518   
             2 SAUT           CHAR (1)  INIT (' '),                     00519   
             2 FIL01          CHAR (32) INIT ((32)' '),                 00520   
             2 FIL02          CHAR (32) INIT                            00521   
                             ('****  DETAIL DES ECHEANCES  ****') ,     00522   
             2 FIL03          CHAR (68) INIT ((68)' ');                 00523   
 /******************/                                                   00524   
 /* FIN MODIF FLC  */                                                   00525   
 /******************/                                                   00526   
       DCL 1 ENT10            BASED (ADDR(ENTET70.FIL9)),               00527   
             2 FERME          CHAR (12),                                00528   
             2 OUFER          CHAR (1);                                 00529   
       DCL   REFFARED         CHAR (5)  BASED (ADDR(ENTET70.REFFA));    00530   
0      DCL 1 ENTET8,                    /*   GROSSE POLICE            */00531   
             2 SAUT           CHAR (1)  INIT (' '),                     00532   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00533   
             2 FIL1           CHAR (1)  INIT (' '),                     00534   
             2 RASOC1         CHAR (26),                                00535   
             2 FIL2           CHAR (18) INIT ((18)' '),                 00536   
             2 RASOC2         CHAR (26),                                00537   
             2 FIL5           CHAR (50) INIT ((50)' ');                 00538   
0      DCL 1 ENTET9,                    /*   GROSSE POLICE            */00539   
             2 SAUT           CHAR (1)  INIT (' '),                     00540   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00541   
             2 FIL1           CHAR (1)  INIT (' '),                     00542   
             2 NOCLI1         CHAR (15),                                00543   
             2 FIL2           CHAR (19) INIT ((19)' '),                 00544   
             2 DELOT          CHAR (2)  INIT ('  '),                    00545   
             2 FIL4           CHAR (08) INIT ((08)' '),                 00546   
             2 NOCLI2         CHAR (15),                                00547   
             2 FIL3           CHAR (61) INIT ((61)' ');                 00548   
0      DCL 1 ENTET10,                   /*   GROSSE POLICE            */00549   
             2 SAUT           CHAR (1)  INIT (' '),                     00550   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00551   
             2 FIL1           CHAR (1)  INIT (' '),                     00552   
             2 ADCLI1         CHAR (26),                                00553   
             2 FIL2           CHAR (18) INIT ((18)' '),                 00554   
             2 ADCLI2         CHAR (26),                                00555   
             2 FIL3           CHAR (6)  INIT ((6)' '),                  00556   
             2 NUCLI          CHAR (8)  INIT ((8)' '),                  00557   
             2 FIL4           CHAR (3)  INIT ((3)' '),                  00558   
             2 NORUN          CHAR (3)  INIT ((3)' '),                  00559   
             2 FIL5           CHAR (1)  INIT (' '),                     00560   
             2 REFFA          CHAR (5)  INIT ((5)' '),                  00561   
             2 FIL6           CHAR (03) INIT ((03)' '),                 00562   
             2 DATE,                                                    00563   
               3 JJ           CHAR (2)  INIT ((2)' '),                  00564   
               3 FIL7         CHAR (1)  INIT (' '),                     00565   
               3 MM           CHAR (2)  INIT ((2)' '),                  00566   
               3 FIL8         CHAR (1)  INIT (' '),                     00567   
               3 AA           CHAR (2)  INIT ((2)' '),                  00568   
             2 FIL9           CHAR (03) INIT ((03)' '),                 00569   
             2 FOLIO          CHAR (03) INIT ((03)' '),                 00570   
             2 FIL10          CHAR (7)  INIT ((7)' ');                  00571   
0      DCL 1 FOLIO_10GIH      PIC'ZZ9' BASED(ADDR(ENTET10.FOLIO));      00572   
0      DCL 1 ENTET11,                   /*   GROSSE POLICE            */00573   
             2 SAUT           CHAR (1)  INIT (' '),                     00574   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00575   
             2 FIL1           CHAR (1)  INIT (' '),                     00576   
             2 LORES1         CHAR (15),                                00577   
             2 FIL2           CHAR (29) INIT ((29)' '),                 00578   
             2 LORES2         CHAR (15),                                00579   
             2 FIL5           CHAR (47) INIT ((47)' '),                 00580   
             2 LIPEF          CHAR (15) INIT ((15)' ');                 00581   
0      DCL 1 ENTET12,                   /*   GROSSE POLICE            */00582   
             2 SAUT           CHAR (1)  INIT (' '),                     00583   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00584   
             2 FIL1           CHAR (1)  INIT (' '),                     00585   
             2 CPCLI1         CHAR (5),                                 00586   
             2 FIL6           CHAR (1)  INIT (' '),                     00587   
             2 LOBDI1         CHAR (26),                                00588   
             2 FIL2           CHAR (2)  INIT ((2)' '),                  00589   
             2 DEPAG          CHAR (2)  INIT ((2)' '),                  00590   
             2 FIL8           CHAR (08) INIT ((08)' '),                 00591   
             2 CPCLI2         CHAR (5),                                 00592   
             2 FIL5           CHAR (1)  INIT (' '),                     00593   
             2 LOBDI2         CHAR (26),                                00594   
             2 FIL3           CHAR (17) INIT ((17)' '),                 00595   
             2 TITRE          CHAR (7)  INIT ((07)' '),                 00596   
             2 FIL7           CHAR (25) INIT ((25)' '),                 00597   
             2 SCLICO         CHAR (10) INIT ((10)' '),                 00598   
             2 FIL4           CHAR (4)  INIT ((4)' ');                  00599   
0      DCL 1 ENTET13,                   /*   GROSSE POLICE    SI GIH  */00600   
             2 SAUT           CHAR (1)  INIT (' '),                     00601   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00602   
             2 FIL1           CHAR (1)  INIT (' '),                     00603   
             2 PAYCL1         CHAR (26),                                00604   
             2 FIL9           CHAR (18) INIT ((18)' '),                 00605   
             2 PAYCL2         CHAR (26),                                00606   
             2 FIL8           CHAR (14) INIT ((14)' '),                 00607   
             2 VENET          CHAR (2)  INIT ((2)' '),                  00608   
             2 FIL2           CHAR (5)  INIT ((5)' '),                  00609   
             2 COMPTA         CHAR (10) INIT ((10)' '),                 00610   
             2 FIL3           CHAR (3)  INIT ((3)' '),                  00611   
             2 STRET          CHAR (1)  INIT (' '),                     00612   
             2 FIL4           CHAR (20) INIT ((20)' '),                 00613   
             2 RUN            CHAR (4)  INIT ((4)' '),                  00614   
             2 DATE,                                                    00615   
               3 JJ           CHAR (2)  INIT ('  '),                    00616   
               3 FIL5         CHAR (1)  INIT ('.'),                     00617   
               3 MM           CHAR (2)  INIT ('  '),                    00618   
               3 FIL6         CHAR (1)  INIT ('.'),                     00619   
               3 AA           CHAR (2)  INIT ('  '),                    00620   
             2 FIL7           CHAR (2)  INIT ((2)' ');                  00621   
             /* ENTETE COLONNE EXPORT*/                                 00622   
0      DCL 1 ENTET14,                   /*   SI  GIH                  */00623   
             2 SAUT           CHAR (1)  INIT (' '),                     00624   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00625   
             2 FIL1           CHAR (70) INIT ((70)' '),                 00626   
             2 LIBEL4         CHAR (7)  INIT ('PRIX TC'),               00627   
             2 FIL3           CHAR (1)  INIT (' '),                     00628   
             2 LIBEL1         CHAR (1)  INIT ('T'),                     00629   
             2 FIL7           CHAR (1)  INIT (' '),                     00630   
             2 LIBEL5         CHAR (7)  INIT ('PRIX HT'),               00631   
             2 FIL2           CHAR (1)  INIT (' '),                     00632   
             2 LIBEL3         CHAR (7)  INIT (' PX.NET'),               00633   
             2 LIBEL2         CHAR (8)  INIT (' REMISE '),              00634   
             2 FIL5           CHAR (4)  INIT ((4)' '),                  00635   
             2 FIL6           CHAR (42) INIT ((42)' ');                 00636   
0      DCL 1 ENTET15          LIKE ENTET14;                             00637   
0      DCL 1 ENTCDE1,                   /*   NIVEAU LOREC             */00638   
             2 SAUT           CHAR (1)  INIT ('0'),                     00639   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00640   
             2 LIBEL1         CHAR (10),                                00641   
             2 LIBEL2         CHAR (4),                                 00642   
             2 DAMIS,                                                   00643   
               3 DAMJJ        CHAR (2),                                 00644   
               3 FIL1         CHAR (1)  INIT ('.'),                     00645   
               3 DAMMM        CHAR (2),                                 00646   
             2 FIL2           CHAR (3)  INIT ('  '),                    00647   
             2 FIL3           CHAR (9)  INIT ('    REF  '),             00648   
             2 NORUN          CHAR (3),                                 00649   
             2 FIL4           CHAR (1)  INIT ('.'),                     00650   
             2 LOREC          PIC'99999',                               00651   
             2 FIL5           CHAR (81) INIT ((81)' ');                 00652   
0      DCL 1 ENTCDE2,                   /*   NIVEAU RESAI             */00653   
             2 SAUT           CHAR (1)  INIT (' '),                     00654   
             2 POLIC          CHAR (1)  INIT ('00'X),                   00655   
             2 FIL1           CHAR (14) INIT ((14)' '),                 00656   
             2 SDAMIS         CHAR (8),                                 00657   
             2 LIBEL          CHAR (9)  INIT ('COMMANDE '),             00658   
             2 RECOM,                                                   00659   
               3 RECO1        CHAR (17),                                00660   
               3 MONTC        CHAR (8),                                 00661   
             2 FIL2           CHAR (1)  INIT (' '),                     00662   
             2 SRESAI         CHAR (15),                                00663   
             2 FIL3           CHAR (2)  INIT (' *'),                    00664   
             2 NATRE          CHAR (2),                                 00665   
             2 FIL6           CHAR (2)  INIT ('* '),                    00666   
             2 SDCOFA         CHAR (8),                                 00667   
             2 FIL4           CHAR (3)  INIT ((3)' '),                  00668   
             2 LISPE          CHAR (15),                                00669   
             2 FIL5           CHAR (17) INIT ((17)' ');                 00670   
0      DCL 1 LIGNE            CHAR (175);/*   LONG UTILE X(119) AS 161*/00671   
0      DCL 1 LIGNE1           BASED (ADDR(LIGNE)),                      00672   
             2 SAUT           CHAR (1),                                 00673   
             2 POLIC          CHAR (1),                                 00674   
             2 NUART          PIC'9999999',                             00675   
             2 FIL1           CHAR (1),                                 00676   
             2 REFLI          CHAR (11),                                00677   
             2 QUANT          PIC'ZZZ.ZZ9-',                            00678   
             2 LIBEL          CHAR (42),                                00679   
             2 PRIBB          PIC'ZZZZ9V,99',                           00680   
             2 FIL5           CHAR (1),                                 00681   
             2 COTAX          CHAR (1),                                 00682   
             2 PIPUB          PIC'ZZZZ9V,99',                           00683   
             2 PUNHT          PIC'ZZZZ9V,99',                           00684   
             2 ASTER          CHAR (2),                                 00685   
             2 REMIS          PIC'ZZ9V,99',                             00686   
             2 NETHT          PIC'ZZZZZ.ZZ9V,99-',                      00687   
             2 ECHEA          CHAR (4),                                 00688   
             2 FIL5A          CHAR (1);     /*YDV*/                     00689   
0      DCL 1 LIGNE1_DEC       BASED (ADDR(LIGNE)),                      00690   
             2 SAUT           CHAR (1),                                 00691   
             2 POLIC          CHAR (1),                                 00692   
             2 NUART          CHAR (7),                                 00693   
             2 FIL1           CHAR (1),                                 00694   
             2 REFLI          CHAR (11),                                00695   
             2 QUANT          CHAR (8),                                 00696   
             2 LIBEL          CHAR (42),                                00697   
             2 PRIBB          CHAR (8),                                 00698   
             2 FIL5           CHAR (1),                                 00699   
             2 COTAX          CHAR (1),                                 00700   
             2 PIPUB          CHAR (8),                                 00701   
             2 PUNHT          CHAR (8),                                 00702   
             2 ASTER          CHAR (2),                                 00703   
             2 REMIS          CHAR (6),                                 00704   
             2 NETHT          CHAR (13),                                00705   
             2 ECHEA          CHAR (4),                                 00706   
             2 FIL5A          CHAR (1);                                 00707   
0      DCL 1 LIGNE_ACC        BASED (ADDR(LIGNE)),                      00708   
             2 SAUT           CHAR (1),                                 00709   
             2 POLIC          CHAR (1),                                 00710   
             2 FIL1           CHAR (7),                                 00711   
             2 TRT1           CHAR (1),                                 00712   
             2 FIL12          CHAR (7),                                 00713   
             2 C_ACCORD       CHAR (11),                                00714   
             2 TRT2           CHAR (1),                                 00715   
             2 TIRET          CHAR (1),                                 00716   
             2 LIBEL          CHAR (39),                                00717   
             2 TRT3           CHAR (1),                                 00718   
             2 FORTC          PIC'ZZZZZ9V,99',                          00719   
             2 TRT4           CHAR (1),                                 00720   
             2 FORHT          PIC'ZZZZZ9V,99',                          00721   
             2 TRT5           CHAR (1),                                 00722   
             2 NETTC          PIC'ZZZZZ9V,99',                          00723   
             2 TRT7           CHAR (1),                                 00724   
             2 NETHT          PIC'ZZZZZ9V,99',                          00725   
             2 TRT8           CHAR (1),                                 00726   
             2 FIL4           CHAR (10);                                00727   
1      DCL 1 LIGNE_BL         BASED (ADDR(LIGNE)),                      00728   
             2 SAUT           CHAR (1),                                 00729   
             2 POLIC          CHAR (1),                                 00730   
             2 FIL1           CHAR (26),                                00731   
             2 TRT1           CHAR (1),                                 00732   
             2 NORUN          CHAR (3),                                 00733   
             2 SEPA1          CHAR (1),                                 00734   
             2 LOREC          PIC'99999',                               00735   
             2 SEPA2          CHAR (1),                                 00736   
             2 NUBOR          PIC'999',                                 00737   
             2 FIL9           CHAR (2),                                 00738   
             2 TRT3           CHAR (1),                                 00739   
             2 NETTC          PIC'---------9V,99',                      00740   
             2 NETHT          PIC'---------9V,99',                      00741   
             2 TAXES          PIC'----9V,99',                           00742   
             2 TRT7           CHAR (1) ,                                00743   
             2 FIL4           CHAR (38);                                00744   
1      DCL 1 LIGNE_FIR        BASED (ADDR(LIGNE)),                      00745   
             2 SAUT           CHAR (1),                                 00746   
             2 POLIC          CHAR (1),                                 00747   
             2 FIL1           CHAR (18),                                00748   
             2 NUFAO          CHAR (9),                                 00749   
             2 SEPA1          CHAR (3),                                 00750   
             2 FIL2           CHAR (13),                                00751   
             2 NUBLO          CHAR (9),                                 00752   
             2 SEPA2          CHAR (3),                                 00753   
             2 FIL3           CHAR (23),                                00754   
             2 RECOO          CHAR (8);                                 00755   
       DCL 1 SVG_LIGNE_FIR    CHAR (175);                               00756   
0      DCL 1 CADRE1_BL,                                                 00757   
             2 SAUT           CHAR (01) INIT ('0'),                     00758   
             2 POLIC          CHAR (01) INIT ('02'X),                   00759   
             2 FIL1           CHAR (26) INIT ((26)' '),                 00760   
             2 TRT1           CHAR (01) INIT ('W'),                     00761   
             2 FIL9           CHAR (16) INIT ((16)'6'),                 00762   
             2 TRT3           CHAR (01) INIT ('1'),                     00763   
             2 NETTC          CHAR (12) INIT ((12)'6'),                 00764   
             2 TRT4           CHAR (01) INIT ('1'),                     00765   
             2 NETHT          CHAR (12) INIT ((12)'6'),                 00766   
             2 TRT5           CHAR (01) INIT ('1'),                     00767   
             2 TAXES          CHAR (07) INIT ((07)'6'),                 00768   
             2 TRT7           CHAR (01) INIT ('X'),                     00769   
             2 FIL4           CHAR (38) INIT ((38)' ');                 00770   
0      DCL 1 CADRE2_BL,                                                 00771   
             2 SAUT           CHAR (01) INIT ('+'),                     00772   
             2 POLIC          CHAR (01) INIT ('02'X),                   00773   
             2 FIL1           CHAR (26) INIT ((26)' '),                 00774   
             2 TRT1           CHAR (01) INIT ('7'),                     00775   
             2 FIL9           CHAR (16) INIT ((16)' '),                 00776   
             2 TRT3           CHAR (01) INIT ('7'),                     00777   
             2 NETTC          CHAR (12) INIT ((12)' '),                 00778   
             2 TRT4           CHAR (01) INIT ('7'),                     00779   
             2 NETHT          CHAR (12) INIT ((12)' '),                 00780   
             2 TRT5           CHAR (01) INIT ('7'),                     00781   
             2 TAXES          CHAR (07) INIT ((07)' '),                 00782   
             2 TRT7           CHAR (01) INIT ('7'),                     00783   
             2 FIL4           CHAR (38) INIT ((38)' ');                 00784   
0      DCL 1 CADRE3_BL,                                                 00785   
             2 SAUT           CHAR (01) INIT (' '),                     00786   
             2 POLIC          CHAR (01) INIT ('02'X),                   00787   
             2 FIL1           CHAR (26) INIT ((26)' '),                 00788   
             2 TRT1           CHAR (01) INIT ('3'),                     00789   
             2 FIL9           CHAR (16) INIT ((16)'6'),                 00790   
             2 TRT3           CHAR (01) INIT ('5'),                     00791   
             2 NETTC          CHAR (12) INIT ((12)'6'),                 00792   
             2 TRT4           CHAR (01) INIT ('5'),                     00793   
             2 NETHT          CHAR (12) INIT ((12)'6'),                 00794   
             2 TRT5           CHAR (01) INIT ('5'),                     00795   
             2 TAXES          CHAR (07) INIT ((07)'6'),                 00796   
             2 TRT7           CHAR (01) INIT ('4'),                     00797   
             2 FIL4           CHAR (38) INIT ((38)' ');                 00798   
0      DCL 1 CADRE4_BL,                                                 00799   
             2 SAUT           CHAR (01) INIT (' '),                     00800   
             2 POLIC          CHAR (01) INIT ('02'X),                   00801   
             2 FIL1           CHAR (26) INIT ((26)' '),                 00802   
             2 TRT1           CHAR (01) INIT ('Z'),                     00803   
             2 FIL9           CHAR (16) INIT ((16)'6'),                 00804   
             2 TRT3           CHAR (01) INIT ('2'),                     00805   
             2 NETTC          CHAR (12) INIT ((12)'6'),                 00806   
             2 TRT4           CHAR (01) INIT ('2'),                     00807   
             2 NETHT          CHAR (12) INIT ((12)'6'),                 00808   
             2 TRT5           CHAR (01) INIT ('2'),                     00809   
             2 TAXES          CHAR (07) INIT ((07)'6'),                 00810   
             2 TRT7           CHAR (01) INIT ('Y'),                     00811   
             2 FIL4           CHAR (38) INIT ((38)' ');                 00812   
0      DCL 1 CADRE5_BL,                                                 00813   
             2 SAUT           CHAR (01) INIT (' '),                     00814   
             2 POLIC          CHAR (01) INIT ('00'X),                   00815   
             2 FIL1           CHAR (26) INIT ((26)' '),                 00816   
             2 TRT1           CHAR (01) INIT (' '),                     00817   
             2 FIL9           CHAR (16) INIT (' REFERENCE '),           00818   
             2 TRT3           CHAR (01) INIT (' '),                     00819   
             2 NETTC          CHAR (13) INIT ('     NETTC'),            00820   
             2 TRT4           CHAR (01) INIT (' '),                     00821   
             2 NETHT          CHAR (12) INIT ('     NETHT'),            00822   
             2 TRT5           CHAR (01) INIT (' '),                     00823   
             2 TAXES          CHAR (07) INIT ('TAXES'),                 00824   
             2 TRT7           CHAR (01) INIT (' '),                     00825   
             2 FIL4           CHAR (38) INIT ((38)' ');                 00826   
0      DCL 1 CADRE6_BL,                                                 00827   
             2 SAUT           CHAR (01) INIT ('-'),                     00828   
             2 POLIC          CHAR (01) INIT ('40'X),                   00829   
             2 FIL1           CHAR (26) INIT ((26)' '),                 00830   
             2 TRT1           CHAR (01) INIT (' '),                     00831   
             2 FIL2           CHAR (20) INIT ('RECAPITULATIF PAR BO'),  00832   
             2 FIL3           CHAR (20) INIT ('RDEREAU DE LIVRAISON'),  00833   
             2 FIL4           CHAR (50) INIT ((50)' ');                 00834   
0      DCL 1 CADRE7_BL,                                                 00835   
             2 SAUT           CHAR (01) INIT ('-'),                     00836   
             2 POLIC          CHAR (01) INIT ('40'X),                   00837   
             2 FIL1           CHAR (26) INIT ((26)' '),                 00838   
             2 TRT1           CHAR (01) INIT (' '),                     00839   
             2 FIL2           CHAR (20) INIT ('LE MONTANT NET POUR '),  00840   
             2 FIL3           CHAR (20) INIT ('REGLER VOTRE FACTURE'),  00841   
             2 FIL4           CHAR (20) INIT (' DOIT ETRE PRIS SUR '),  00842   
             2 FIL5           CHAR (20) INIT ('LE TOTAL DE LA FACTU'),  00843   
             2 FIL6           CHAR (02) INIT ('RE');                    00844   
                                                                        00845   
1      /* LIGNE AFFICHAGE LIBELLE EDITEUR & LIBELLE DIVISION */         00846   
0      DCL 1 LIGNE_NUEDI ,                                              00847   
             2 SAUT           CHAR (1),                                 00848   
             2 POLIC          CHAR (1)   INIT ('00'X),                  00849   
                          /*  CHAR (18)  INIT ('     ** EDITEUR : ') */ 00850   
             2 FIL01          CHAR (27)  INIT (' '),                    00851   
             2 FILED          CHAR (10)  INIT ('EDITEUR : '),           00852   
             2 LIEDI          CHAR (15)  VAR ,                          00853   
             2 FIL02          CHAR (3)   INIT (' - '),                  00854   
             2 LIDIV          CHAR (15);                                00855   
       DCL 1 SVG_LIGNE_NUEDI  LIKE LIGNE_NUEDI ;                        00856   
                                                                        00857   
       DCL 1 HLIEDI_RED       CHAR(15) BASED(ADDR(HLIEDI.SLIEDI(1)));   00858   
       DCL 1 HLIEDI,                                                    00859   
             2 SLIEDI(15)     CHAR(1);                                  00860   
                                                                        00861   
       DCL 1 INX              FIXED BIN (15,0),                         00862   
           1 SVG_INX          FIXED BIN (15,0);                         00863   
                                                                        00864   
       /* DEFINITION DU CADRE POUR CUMUL ACCORD */                      00865   
       DCL 1 CDRE_ACC1,                                                 00866   
             2 SAUT           CHAR (1),                                 00867   
             2 POLIC          CHAR (1),                                 00868   
             2 FIL1           CHAR (7),                                 00869   
             2 TRT1           CHAR (1),                                 00870   
             2 C_ACCORD       CHAR (18),                                00871   
             2 TRT2           CHAR (1),                                 00872   
             2 LIBEL          CHAR (40),                                00873   
             2 TRT3           CHAR (1),                                 00874   
             2 FORTC          CHAR (9),                                 00875   
             2 TRT4           CHAR (1),                                 00876   
             2 FORHT          CHAR (9),                                 00877   
             2 TRT5           CHAR (1),                                 00878   
             2 NETTC          CHAR (9),                                 00879   
             2 TRT7           CHAR (1),                                 00880   
             2 NETHT          CHAR (9),                                 00881   
             2 TRT8           CHAR (1),                                 00882   
             2 FIL4           CHAR (10);      /* HAUT ENT.CDRE ACC */   00883   
       DCL 1 CDRE_ACC2        LIKE CDRE_ACC1; /* N� FOUR....*/          00884   
       DCL 1 CDRE_ACC3        LIKE CDRE_ACC1; /* BAS ENT.CDRE ACCORD */ 00885   
       DCL 1 CDRE_ACC4        LIKE LIGNE_ACC; /* SEP. VERTICAUX */      00886   
       DCL 1 CDRE_ACC4B       LIKE LIGNE_ACC; /* SEP. VERTICAUX */      00887   
       DCL 1 CDRE_ACC5,                       /* INFORMATIONS...*/      00888   
             2 SAUT           CHAR (1),                                 00889   
             2 POLIC          CHAR (1),                                 00890   
             2 FIL1           CHAR (7),                                 00891   
             2 TRT1           CHAR (1),                                 00892   
             2 LIBEL          CHAR (99),                                00893   
             2 TRT5           CHAR (1),                                 00894   
             2 FIL2           CHAR (11),                                00895   
             2 TRT2           CHAR (1),                                 00896   
             2 FORTC          CHAR (9),                                 00897   
             2 TRT3           CHAR (1),                                 00898   
             2 FORHT          CHAR (9),                                 00899   
             2 TRT6           CHAR (1),                                 00900   
             2 NETTC          CHAR (9),                                 00901   
             2 TRT7           CHAR (1),                                 00902   
             2 NETHT          CHAR (9),                                 00903   
             2 TRT8           CHAR (1),                                 00904   
             2 FIL4           CHAR (10);      /* HAUT ENT.CDRE ACC */   00905   
       DCL 1 CDRE_ACC6        LIKE CDRE_ACC1; /* BAS CADRE     */       00906   
0                                       /*   2 ME LIGNE POUR LIBAU    */00907   
       DCL 1 LIGNE2_NUART     CHAR (07) BASED (ADDR(LIGNE1.NUART));     00908   
       DCL 1 LIGNE2_EANNU     CHAR (13) BASED (ADDR(LIGNE1.NUART));     00909   
       DCL 1 LIGNE2_LIBAU     CHAR (25) BASED (ADDR(LIGNE1.LIBEL));     00910   
       DCL 1 LIGNE2_VENET     CHAR (01) BASED (ADDR(LIGNE1.ECHEA));     00911   
       DCL   PRIBBCHAR        CHAR (08) BASED (ADDR(LIGNE1.PRIBB));     00912   
       DCL   PUNHTCHAR        CHAR (08) BASED (ADDR(LIGNE1.PUNHT));     00913   
0      DCL 1 TTLOREC          CHAR (135);                               00914   
       DCL 1 TTLOREC1         BASED(ADDR(TTLOREC)),                     00915   
             2 SAUT           CHAR (1)  INIT (' '),                     00916   
             2 POLIC          CHAR (1),                                 00917   
             2 FIL1           CHAR (09) INIT ((09)' '),                 00918   
             2 FIL2           CHAR (9)  INIT ('TOTAL    '),             00919   
             2 QUANT          PIC'ZZZZ.ZZZ-',                           00920   
             2 FIL3           CHAR (7)  INIT ('  BORD '),               00921   
             2 MINI           CHAR (3)  INIT ('001'),                   00922   
             2 FIL4           CHAR (1)  INIT ('.'),                     00923   
             2 NUBOR          PIC'ZZZ',                                 00924   
             2 FIL5           CHAR (3)  INIT ((3)' '),                  00925   
             2 FRANC          CHAR (14),                                00926   
             2 ZOGEO          CHAR (1),                                 00927   
             2 FIL11          CHAR (1)  INIT ('.'),                     00928   
             2 LOTIR          PIC'ZZ',                                  00929   
             2 FIL6           CHAR (1)  INIT ('.'),                     00930   
             2 LIZTI          CHAR (6),                                 00931   
             2 FIL7           CHAR (1)  INIT ('.'),                     00932   
             2 PREPA          CHAR (1),                                 00933   
             2 FIL8           CHAR (1)  INIT ('.'),                     00934   
             2 CABOT          CHAR (1),                                 00935   
             2 FIL9           CHAR (44) INIT ((44)' ');                 00936   
0      DCL 1 TTLOREC2         BASED(ADDR(TTLOREC)),                     00937   
             2 SAUT           CHAR (1)  INIT (' '),                     00938   
             2 POLIC          CHAR (1),                                 00939   
             2 FIL1           CHAR (09) INIT ((09)' '),                 00940   
             2 FIL2           CHAR (9)  INIT ('TOTAL    '),             00941   
             2 QUANT          PIC'ZZZZ.ZZZ-',                           00942   
             2 FIL3           CHAR (7)  INIT ('  BORD '),               00943   
             2 MINI           CHAR (3)  INIT ('001'),                   00944   
             2 FIL4           CHAR (1)  INIT ('.'),                     00945   
             2 NUBOR          PIC'ZZZ',                                 00946   
             2 FIL5           CHAR (3)  INIT ((3)' '),                  00947   
             2 FRANC          CHAR (14),                                00948   
             2 DIFOF          CHAR (1),                                 00949   
             2 FIL6           CHAR (1)  INIT ('.'),                     00950   
             2 PRIOF          CHAR (1),                                 00951   
             2 FIL7           CHAR (1)  INIT ('.'),                     00952   
             2 MOTRA          CHAR (3),                                 00953   
             2 FIL8           CHAR (1)  INIT ('.'),                     00954   
             2 DEPAY          CHAR (3),                                 00955   
             2 FIL9           CHAR (1)  INIT ('.'),                     00956   
             2 PREPA          CHAR (1),                                 00957   
             2 FIL10          CHAR (1)  INIT ('.'),                     00958   
             2 CABOT          CHAR (1),                                 00959   
             2 FIL11          CHAR (44) INIT ((44)' ');                 00960   
1                                       /*   TOTAL FACTURE            */00961   
0      DCL 1 TTFAC0           BASED(ADDR(TOTAL0)),                      00962   
             2 SAUT           CHAR (1)  INIT ('3'),                     00963   
             2 POLIC          CHAR (1),                                 00964   
             2 FIL1           CHAR (77) INIT ((77)' '),                 00965   
             2 FIL2           CHAR (11) INIT ((11)' '),                 00966   
             2 LIBEL          CHAR (16) INIT ('NET  HORS  TAXES'),      00967   
             2 NETHT          PIC'ZZZZZZ.ZZ9V,99-',                     00968   
             2 FIL3           CHAR (38) INIT ((38)' ');                 00969   
0      DCL 1 TTFAC1           BASED(ADDR(TOTAL1)),                      00970   
             2 SAUT           CHAR (1)  INIT (' '),                     00971   
             2 POLIC          CHAR (1),                                 00972   
             2 FIL1           CHAR (18) INIT ((18)' '),                 00973   
             2 QUANT          PIC'ZZZZ.ZZZ-',                           00974   
             2 FIL2           CHAR (22) INIT ((22)' '),                 00975   
             2 POIDS          PIC'ZZZ.ZZ9V,9',                          00976   
             2 FIL3           CHAR (19) INIT ((19)' '),                 00977   
             2 FIL5           CHAR (11) INIT ((11)' '),                 00978   
             2 LIBEL          CHAR (16) INIT ('INCIDENCE  TAXES'),      00979   
             2 TAXES          PIC'ZZZZZZ.ZZ9V,99-',                     00980   
             2 FIL4           CHAR (38) INIT ((38)' ');                 00981   
0      DCL 1 TTFAC2           BASED(ADDR(TOTAL2)),                      00982   
             2 ENCAR,                                                   00983   
               3 SAUT         CHAR (1)  INIT (' '),                     00984   
               3 POLIC        CHAR (1),                                 00985   
               3 COTAX        CHAR (1),                                 00986   
               3 FIL1         CHAR (1)  INIT ('-'),                     00987   
               3 TOLEG        CHAR (7),                                 00988   
               3 NETTC        PIC'ZZZZZ.ZZ9V,99-',                      00989   
               3 DETAX        PIC'ZZZZZ.ZZ9V,99-',                      00990   
               3 NETHT        PIC'ZZZZZ.ZZ9V,99-',                      00991   
               3 FIL5         CHAR (1)  INIT (' '),                     00992   
             2 FIL8           CHAR (71) INIT ((71)' ');                 00993   
       DCL 1 TTFAC20          BASED(ADDR(TOTAL2)),                      00994   
             2 ENCAR20,                                                 00995   
               3 SAUT         CHAR (1)  INIT (' '),                     00996   
               3 POLIC        CHAR (1),                                 00997   
               3 LIBEL1       CHAR (9)  INIT ('  TAUX   '),             00998   
               3 LIBEL2       CHAR (13) INIT ('    NET T.C. '),         00999   
               3 LIBEL3       CHAR (13) INIT ('       TAXES '),         01000   
               3 LIBEL4       CHAR (13) INIT ('    NET H.T. '),         01001   
             2 FIL4           CHAR (2)  INIT ((2)' '),                  01002   
             2 FIL5           CHAR (26) INIT ('DETAIL PAR ECHEANCE'),   01003   
             2 FIL6           CHAR (58) INIT ((58)' ');                 01004   
0      DCL 1 TTFAC3           BASED(ADDR(TOTAL3)),                      01005   
             2 SAUT           CHAR (1)  INIT (' '),                     01006   
             2 POLIC          CHAR (1),                                 01007   
             2 FIL1           CHAR (49) INIT ((49)' '),                 01008   
             2 LIBEL1         CHAR (9)  INIT ('ECHEANCE '),             01009   
             2 LECHE          CHAR (15),                                01010   
             2 FIL2           CHAR (11) INIT ((11)' '),                 01011   
             2 LIBEL2         CHAR (07) INIT ('A VOTRE'),               01012   
             2 LIBEL3         CHAR (07) INIT ('  '),                    01013   
             2 DEBIT          PIC'ZZZZZZ.ZZZV,ZZ';                      01014   
0      DCL 1 TTFAC3_P,                  /*   MULTI POLICE             */01015   
             2 SAUT           CHAR (1)  INIT ('+'), /*   + ==> 3800   */01016   
             2 POLIC          CHAR (1)  INIT ('01'X),/*  4 ==> 3835   */01017   
             2 FIL1_EURO      CHAR (52) INIT ((52)' '),/* AS 54 SI 4  */01018   
             2 LIBEL2         CHAR (07) INIT ('A VOTRE'),               01019   
             2 LIBEL3         CHAR (07) INIT ('  '),                    01020   
             2 DEBIT          PIC'ZZZZZZ.ZZ9V,99',                      01021   
             2 FIL3           CHAR (18) INIT ((18)' ');                 01022   
       DCL 1 TTFAC4           BASED(ADDR(TOTAL4)),                      01023   
             2 SAUT           CHAR (1)  INIT (' '),                     01024   
             2 POLIC          CHAR (1),                                 01025   
             2 COTAX          CHAR (1),                                 01026   
             2 FIL1           CHAR (1)  INIT ('-'),                     01027   
             2 TOLEG          CHAR (7),                                 01028   
             2 NETTC          PIC'ZZZZZ.ZZ9V,99-',                      01029   
             2 DETAX          PIC'ZZZZZ.ZZ9V,99-',                      01030   
             2 NETHT          PIC'ZZZZZ.ZZ9V,99-',                      01031   
       /*    2 FIL5           CHAR (1)  INIT (' '), YDV*/               01032   
             2 ECHEA          CHAR (2),                                 01033   
             2 FIL7           CHAR (1)  INIT ('-'),                     01034   
             2 LECHE          CHAR (13),           /*14YDV*/            01035   
             2 MTECH          PIC'ZZZZZ.ZZ9V,99',                       01036   
             2 FIL77          CHAR (2) ,                                01037   
             2 FIL5           CHAR (2)  INIT ('  '),                    01038   
             2 FIL14          CHAR (13) INIT (' '),                     01039   
             2 LIBEL          CHAR (11) INIT ('RASSORT  '),             01040   
             2 MENVTE         PIC'ZZZZZZ.ZZ9V,99-',                     01041   
             2 FIL10          CHAR (1)  INIT ((1)' ');                  01042   
       DCL 1 TTFAC4A          BASED(ADDR(TOTAL4)),                      01043   
             2 SAUT           CHAR (1),                                 01044   
             2 POLIC          CHAR (1),                                 01045   
             2 FIL1           CHAR (10),                                01046   
             2 NETTC          CHAR (13),                                01047   
             2 DETAX          CHAR (13),                                01048   
             2 NETHT          CHAR (13),                                01049   
             2 FIL4           CHAR (83);                                01050   
1                                       /*   PIED  FACTURE  CDL       */01051   
       DCL 1 TTFAC5           LIKE TTFAC4    BASED(ADDR(TOTAL5));       01052   
       DCL 1 TTFAC5A          LIKE TTFAC4A   BASED(ADDR(TOTAL5));       01053   
       DCL 1 TTFAC6           LIKE TTFAC4    BASED(ADDR(TOTAL6));       01054   
       DCL 1 TTFAC6A          LIKE TTFAC4A   BASED(ADDR(TOTAL6));       01055   
       DCL 1 TTFAC7           LIKE TTFAC4    BASED(ADDR(TOTAL7));       01056   
       DCL 1 TTFAC7A          LIKE TTFAC4A   BASED(ADDR(TOTAL7));       01057   
       DCL 1 TTFAC8           LIKE TTFAC4    BASED(ADDR(TOTAL8));       01058   
       DCL 1 TTFAC8A          LIKE TTFAC4A   BASED(ADDR(TOTAL8));       01059   
       DCL 1 TTFAC9           LIKE TTFAC4    BASED(ADDR(TOTAL9));       01060   
       DCL 1 TTFAC9A          LIKE TTFAC4A   BASED(ADDR(TOTAL9));       01061   
       DCL 1 TTFAC10          LIKE TTFAC4    BASED(ADDR(TOTAL10));      01062   
       DCL 1 TTFAC10A         LIKE TTFAC4A   BASED(ADDR(TOTAL10));      01063   
       DCL 1 TTFAC11          LIKE TTFAC4    BASED(ADDR(TOTAL11));      01064   
       DCL 1 TTFAC11A         LIKE TTFAC4A   BASED(ADDR(TOTAL11));      01065   
       DCL 1 TTFAC12          LIKE TTFAC4    BASED(ADDR(TOTAL12));      01066   
       DCL 1 TTFAC12A         LIKE TTFAC4A   BASED(ADDR(TOTAL12));      01067   
0                                       /*   PIED  FACTURE  GIH       */01068   
0      DCL 1 TTFAC60          BASED(PTOTAL6),                           01069   
             2 ENCAR2         LIKE TTFAC2.ENCAR,                        01070   
             2 FIL6           CHAR (1)  INIT ((1)' '),                  01071   
             2 FIL60          CHAR (20) INIT ((20)' '),                 01072   
             2 VENTIL(3),                                               01073   
               3 EXPLO        PIC'9'  ,                                 01074   
               3 FIL7         CHAR (1),                                 01075   
               3 LVENE        CHAR (10),                                01076   
               3 FIL70        CHAR (1),                                 01077   
             2 FIL8           CHAR (9)  INIT ((9)' ');                  01078   
0      DCL 1 TTFAC61          BASED(PTOTAL6),                           01079   
             2 ENCAR2         LIKE TTFAC2.ENCAR,                        01080   
             2 FIL6           CHAR (1)  INIT ((1)' '),                  01081   
             2 FIL60          CHAR (20) INIT ((20)' '),                 01082   
             2 VENTIL(3),                                               01083   
               3 EXPLO        CHAR (1),                                 01084   
               3 FIL7         CHAR (1),                                 01085   
               3 LVENE        CHAR (10),                                01086   
               3 FIL70        CHAR (1),                                 01087   
             2 FIL8           CHAR (9)  INIT ((9)' ');                  01088   
0      DCL 1 TTFAC70          BASED(PTOTAL7),                           01089   
             2 SAUT           CHAR (1)  INIT (' '),                     01090   
             2 COTAX          CHAR (1),                                 01091   
             2 FIL1           CHAR (1)  INIT ('-'),                     01092   
             2 TOLEG          CHAR (7),                                 01093   
             2 NETTC          PIC'ZZZZZ.ZZ9V,99-',                      01094   
             2 DETAX          PIC'ZZZZZ.ZZ9V,99-',                      01095   
             2 NETHT          PIC'ZZZZZ.ZZ9V,99-',                      01096   
             2 FIL5           CHAR (1)  INIT (' '),                     01097   
             2 FIL50          CHAR (20) INIT ((20)' '),                 01098   
             2 VENTIL(3),                                               01099   
               3 FIL6         CHAR (1),                                 01100   
               3 MTVEN        PIC'ZZZZ.ZZ9V,99-',                       01101   
             2 FIL60          CHAR (2)  INIT (' '),                     01102   
             2 MTFRP          PIC'ZZZZ9V,99',                           01103   
             2 FIL7           CHAR (2)  INIT ((2)' ');                  01104   
       DCL   MTFRPRED         PIC'ZZZ9V,99-' BASED(PMTFRP);             01105   
0      DCL 1 TTFAC80          LIKE TTFAC70   BASED(PTOTAL8);            01106   
       DCL 1 TTFAC90          LIKE TTFAC70   BASED(PTOTAL9);            01107   
0      DCL 1 TTFAC90_0        BASED(PTOTAL9),                           01108   
             2 ENCAR2         LIKE TTFAC2.ENCAR,                        01109   
             2 FIL6           CHAR (1)  INIT ((1)' '),                  01110   
             2 FIL60          CHAR (20) INIT ((20)' '),                 01111   
             2 VENTIL(3),                                               01112   
               3 EXPLO        PIC'9'  ,                                 01113   
               3 FIL7         CHAR (1),                                 01114   
               3 LVENE        CHAR (10),                                01115   
               3 FIL70        CHAR (1),                                 01116   
             2 FIL8           CHAR (9)  INIT ((9)' ');                  01117   
0      DCL 1 TTFAC90_1        BASED(PTOTAL9),                           01118   
             2 ENCAR2         LIKE TTFAC2.ENCAR,                        01119   
             2 FIL6           CHAR (1)  INIT ((1)' '),                  01120   
             2 FIL60          CHAR (20) INIT ((20)' '),                 01121   
             2 VENTIL(3),                                               01122   
               3 EXPLO        CHAR (1),                                 01123   
               3 FIL7         CHAR (1),                                 01124   
               3 LVENE        CHAR (10),                                01125   
               3 FIL70        CHAR (1),                                 01126   
             2 FIL8           CHAR (9)  INIT ((9)' ');                  01127   
       DCL 1 TTFAC100         LIKE TTFAC70   BASED(PTOTAL10);           01128   
1                                       /*   FACT. OUVERTE PROVISOIRE */01129   
       DCL 1 TTFAC131,                                                  01130   
             2 SAUT           CHAR (1)  INIT (' '),                     01131   
             2 POLIC          CHAR (1)  INIT ('00'X),                   01132   
             2 FIL1           CHAR (6)  INIT ((6)'-'),                  01133   
             2 LIBEL          CHAR (3)  INIT ('TTC'),                   01134   
             2 FIL2           CHAR (22) INIT ('  REPORT FF '),          01135   
             2 MTFAC          PIC'ZZZZZ.ZZ9V,99-',                      01136   
             2 FIL3           CHAR (1)  INIT ((1)' '),                  01137   
             2 FIL7           CHAR (10) INIT ('CREDIT '),               01138   
             2 FIL4           CHAR (19) INIT ('SUR DERNIER FOLIO '),    01139   
             2 FIL5           CHAR (44) INIT ((41)'-'),                 01140   
             2 FIL6           CHAR (2)  INIT ((2)' ');                  01141   
       DCL 1 TTFAC132         ,                                         01142   
             2 SAUT           CHAR (1)  INIT (' '),                     01143   
             2 POLIC          CHAR (1)  INIT ('00'X),                   01144   
             2 FIL1           CHAR (118)INIT ((115)'-'),                01145   
             2 FIL2           CHAR (2)  INIT ((2)' ');                  01146   
       DCL 1 TTFAC133         BASED (PTOTAL13),                         01147   
             2 SAUT           CHAR (1)  INIT (' '),                     01148   
             2 POLIC          CHAR (1)  INIT ('00'X),                   01149   
             2 FIL2           CHAR (81) INIT ((81)' '),                 01150   
             2 REMIS          PIC'ZZZZ9V,99-',                          01151   
             2 FIL3           CHAR (16) INIT ((16)' '),                 01152   
             2 MT             PIC'ZZZZZZ.ZZ9V,99-',                     01153   
             2 FIL4           CHAR (5)  INIT ((5)' ');                  01154   
1                                       /*   VENET                    */01155   
0      DCL   P_LVENET         PTR;                                      01156   
       DCL 1 LIGNE_VENET      BASED(P_LVENET),                          01157   
           2 SAUT             CHAR(1),                                  01158   
           2 POLIC            CHAR(1),                                  01159   
           2 FIL1             CHAR(66), /*   AS X(112)                */01160   
           2 FIL2             CHAR(1),                                  01161   
           2 EXPLO            CHAR(1),                                  01162   
           2 FIL7             CHAR(1),                                  01163   
           2 LVENE            CHAR(10),                                 01164   
           2 FIL77            CHAR(09),                                 01165   
           2 FIL8             CHAR(6),                                  01166   
           2 MTVEN            PIC'ZZZZZZ.ZZ9V,99-';                     01167   
        DCL WEXPLO            PIC'9';                                   01168   
                                                                        01169   
                                                                        01170   
1      DCL   TOTAL0           CHAR (175)   EXTERNAL;                    01171   
       DCL   TOTAL1           CHAR (175)   EXTERNAL;                    01172   
       DCL   TOTAL2           CHAR (175)   EXTERNAL;                    01173   
       DCL   TOTAL3           CHAR (175)   EXTERNAL;                    01174   
       DCL   TOTAL4           CHAR (175)   EXTERNAL;                    01175   
       DCL   TOTAL5           CHAR (175)   EXTERNAL;                    01176   
       DCL   TOTAL6           CHAR (175)   EXTERNAL;                    01177   
       DCL   TOTAL7           CHAR (175)   EXTERNAL;                    01178   
       DCL   TOTAL8           CHAR (175)   EXTERNAL;                    01179   
       DCL   TOTAL9           CHAR (175)   EXTERNAL;                    01180   
       DCL   TOTAL10          CHAR (175)   EXTERNAL;                    01181   
       DCL   TOTAL11          CHAR (175)   EXTERNAL;                    01182   
       DCL   TOTAL12          CHAR (175)   EXTERNAL;                    01183   
       DCL   TOTAL13          CHAR (175)   EXTERNAL;                    01184   
       DCL   TOTAL14          CHAR (175)   EXTERNAL;                    01185   
0            PTOTAL0          = ADDR(TOTAL0);                           01186   
             PTOTAL1          = ADDR(TOTAL1);                           01187   
             PTOTAL2          = ADDR(TOTAL2);                           01188   
             PTOTAL3          = ADDR(TOTAL3);                           01189   
             PTOTAL4          = ADDR(TOTAL4);                           01190   
             PTOTAL5          = ADDR(TOTAL5);                           01191   
             PTOTAL6          = ADDR(TOTAL6);                           01192   
             PTOTAL7          = ADDR(TOTAL7);                           01193   
             PTOTAL8          = ADDR(TOTAL8);                           01194   
             PTOTAL9          = ADDR(TOTAL9);                           01195   
             PTOTAL10         = ADDR(TOTAL10);                          01196   
             PTOTAL11         = ADDR(TOTAL11);                          01197   
             PTOTAL12         = ADDR(TOTAL12);                          01198   
             PTOTAL13         = ADDR(TOTAL13);                          01199   
             PTOTAL14         = ADDR(TOTAL14);                          01200   
0            PMTFRP           = ADDR(TTFAC70.MTFRP);                    01201   
1      DCL 1 LIBELLE          CHAR (70);                                01202   
       DCL 1 LIBEL1           BASED (ADDR(LIBELLE)),                    01203   
             2 TITRE          CHAR (45),                                01204   
             2 AUTEUR         CHAR (25);                                01205   
       DCL 1 LIBEL2           BASED (ADDR(LIBELLE)),                    01206   
             2 TITRE1         CHAR (29),                                01207   
             2 TITRE2         CHAR (16),                                01208   
             2 AUTOR1         CHAR (15),                                01209   
             2 AUTOR2         CHAR (10);                                01210   
       DCL 1 LIBEL5           BASED (ADDR(LIBELLE)),                    01211   
             2 TITRE1         CHAR (24),                                01212   
             2 TITRE2         CHAR (21),                                01213   
             2 AUTOR1         CHAR (10),                                01214   
             2 AUTOR2         CHAR (15);                                01215   
       DCL   LIBTI_SVG        CHAR (45) INIT ((45)' ');                 01216   
       DCL   LIBAU_SVG        CHAR (25) INIT ((25)' ');                 01217   
0      DCL 1 ZLIBEL           CHAR (45) INIT ((45)' ');                 01218   
       DCL 1 LIBEL3           BASED (ADDR(ZLIBEL)),                     01219   
             2 TITRE1         CHAR (30),                                01220   
             2 AUTOR1         CHAR (15);                                01221   
       DCL 1 LIBEL4           BASED (ADDR(ZLIBEL)),                     01222   
             2 QUANT          PIC'ZZ9',                                 01223   
             2 FIL1           CHAR (1),                                 01224   
             2 LIBTI          CHAR (41);                                01225   
0      DCL   (P,PCOMPTA,PMTFRP)                        PTR;             01226   
       DCL   (PENRWFAC,PZENRWFAC,PRUPT,PZRUPT)         PTR;             01227   
       DCL   (PTOTAL1,PTOTAL2,PTOTAL3,PTOTAL4)         PTR;             01228   
       DCL   (PTOTAL5,PTOTAL6,PTOTAL7,PTOTAL8)         PTR;             01229   
       DCL   (PTOTAL9,PTOTAL10,PTOTAL11,PTOTAL12)      PTR;             01230   
       DCL   (PTOTAL0,PTOTAL13)                        PTR;             01231   
       DCL   (PTOTAL14)                                PTR;             01232   
1                                       /*******************************01233   
                                        *                              *01234   
                                        *    RESULTATS DE FACTURATION  *01235   
                                        *                              *01236   
                                        *******************************/01237   
                                        /*   INCLUDE IDDLRESP         */01238   
                                        /*   INCLUDE IDDZCOMP         */01239   
                                        /*   INCLUDE IDDZFACP         */01240   
                                        /*   INCLUDE IDDCRESP         */01241   
                                        /*   INCLUDE IDDZVALP         */01242   
                                        /*   INCLUDE IDDPRESK         */01243   
       DCL 1 WRESL,                     /*   ENREG. RESULT. LIGNE     */01244   
 /*    INCLUDE++ IDDIRESP                                             */01245   
0/* PL1CMS VER 03 * MOD. IDDIRESP * LIB INC * LE 02/07/81 A 10:13:55 */ 00000000
 /* RESULTATS DE FACTURATION                              AU 17/01/80 */00000010
 /*********************************************************************/00000020
010  ID ,                /* ARGUMENT DE TRI                           */00000030
                         /*********************************************/00000040
  20 TYENR CHAR(1) ,     /* CODE ENREGISTREMENT ( 1=LIGNE  5=PIED )   */00000050
  20 GEREF CHAR(1) ,     /* CODE GENERATION VERS RESULTATS ACTIVITE   */00000060
                         /* B = NON GENER.  1 = GENERATION POUR DECA  */00000070
 /*    END INCLUDE++                                                  */        
           10 GS ,                                                      01246   
 /*    INCLUDE++ IDDZCOMP                                             */01247   
        /* DATA SET IDDZCOMP   AT LEVEL 001 AS OF 18/02/84    */                
0/* ZONE COMMUNE TIR1A,TIR1B,FLF,REM,FAC,RES              AU 01/03/79 */00001   
 /*-------------------------------------------------------------------*/00002   
 /*D 01 WTCOM */                                                        00003   
 20 CO,                                                                 00004   
  30 COENR CHAR(3) ,     /* CODE ENREGISTREMENT FACTURATION           */00005   
  30 NATOP CHAR(2) ,     /* NATURE OPERATION                          */00006   
  30 NUCLI CHAR(6) ,     /* NUMERO CLIENT                             */00007   
  30 REPRE CHAR(3) ,     /* CODE REPRESENTANT                         */00008   
  30 MOTRA CHAR(3) ,     /* MODE DE TRANSPORT                         */00009   
  30 RECOM ,             /* REFERENCE COMMANDE                        */00010   
   40 RECO1 CHAR(17),    /* REFERENCE COMMANDE EFFECTIVE              */00011   
   40 MONTC CHAR(08),    /* MONTANT COMPTANT POUR NATOP 21-22         */00012   
                         /* NUCLI NATOP 50-54-70-74(6 DERNIERS CARACT)*/00013   
  30 OPSPE CHAR(1) ,     /* OPERATION SPECIALE                        */00014   
  30 FRANC CHAR(1) ,     /* FRANCO DE PORT                            */00015   
  30 REDAC CHAR(1) ,     /* NUMERO DE REDACTEUR                       */00016   
  30 MAGTI CHAR(3) ,     /* MAGASIN DE TIRAGE                         */00017   
  30 NBFAC CHAR(1) ,     /* NOMBRE DE FACTURES                        */00018   
  30 PEFAC CHAR(1) ,     /* PERIODICITE DE FACTURATION                */00019   
  30 TYVAR CHAR(1) ,     /* TYPE DE VALORISATION RETOUR (0,1)         */00020   
  30 NATRE CHAR(2) ,     /* NATURE RETOUR EDITEUR                     */00021   
  30 RESAI ,             /* REFERENCE SAISIE                          */00022   
   40 ANNEE CHAR(2),     /* ANNEE                                     */00023   
   40 RUN   CHAR(3),     /* NO DE RUN                                 */00024   
   40 ORIGI CHAR(2),     /* ORIGINE                                   */00025   
   40 NUMRO FIXED DEC(5),/* NUMERO D ORDRE                            */00026   
  30 NUSEQ FIXED DEC(5) ,/* NUMERO DE SEQUENCE                        */00027   
  30 NUART CHAR(7) ,     /* NUMERO ARTICLE                            */00028   
  30 QUANT FIXED DEC(5), /* QUANTITE                                  */00029   
  30 REFLI CHAR(10),     /* REFERENCE LIGNE                           */00030   
  30 CATLI CHAR(1) ,     /* CATEGORIE LIGNE - BLANC,0,1,2,3           */00031   
  30 MACOM CHAR(3) ,     /* MAGASIN COMMERCIAL                        */00032   
  30 NORUN CHAR(3),      /* NUMERO DE RUN                             */00033   
  30 LOREC FIXED DEC(5), /* LOT DE REGROUPEMENT COMMANDES             */00034   
  30 CTRLI FIXED DEC(7), /* COMPTEUR DE LIGNES / RUN                  */00035   
  30 NARSE CHAR(7) ,     /* NO ARTICLE SECONDAIRE (COMPOSANT COLIS)   */00036   
  30 DAMIS ,             /* DATE DE MISE A JOUR STOCK                 */00037   
   40 DAMAA CHAR(2),     /* ANNEE                                     */00038   
   40 DAMMM CHAR(2),     /* MOIS                                      */00039   
   40 DAMJJ CHAR(2),     /* JOUR                                      */00040   
  30 DCOFA ,             /* DATE DE CONDITIONS DE FACTURATION ------- */00041   
   40 DCOAA CHAR(2),     /* ANNEE                                     */00042   
   40 DCOMM CHAR(2),     /* MOIS                                      */00043   
   40 DCOJJ CHAR(2),     /* JOUR                                      */00044   
  30 ZONTI CHAR(1),      /* ZONE DE TIRAGE                            */00045   
  30 PREPA CHAR(1),      /* CODE PREPARATION  ----------------------- */00046   
  30 SPENV CHAR(2),      /* SPECIFICATIONS D ENVOI ------------------ */00047   
  30 STRET CHAR(1),      /* ----------------------------------------- */00048   
  30 DIFOF CHAR(1),      /* DIFFUSION OFFICE ------------------------ */00049   
  30 FRAET CHAR(1),      /* CODE FRANCE = 1 , ETRANGER = 2 ---------- */00050   
  30 DEPAY CHAR(3),      /* CODE DEPARTEMENT PAYS-------------------- */00051   
  30 FIN CHAR(0),                                                       00052   
 /*F*/                                                                  00053   
 /*    END INCLUDE++                                                  */        
 /*    INCLUDE++ IDDZFACP                                             */01248   
        /* DATA SET IDDZFACP   AT LEVEL 003 AS OF 23/01/86    */                
0/* ZONE COMMUNE TIR1A,TIR1B,FLF,REM,FAC,RES              AU 01/03/79 */00001   
 /*-------------------------------------------------------------------*/00002   
 /*D 01 WTZFA */                                                        00003   
 20 FA,                                                                 00004   
  30 ECHEA CHAR(2),      /* CODE ECHEANCE                             */00005   
  30 IMPEC CHAR(1),      /* ECHEANCE IMPOSEE                          */00006   
  30 RETAU CHAR(1),      /* RETOUR AUTORISE ( 0 = NON,1 = OUI )       */00007   
  30 SUFAI CHAR(1),      /* SURREMISE FAITE (0,1)                     */00008   
  30 ORIMP CHAR(1),      /* ORIGINE D IMPOSITION 1=COMPENSE,2=NCOMP.  */00009   
  30 TYSUR CHAR(1),      /* TYPE DE SURREMISE (0,1,2,3,9)             */00010   
  30 SRIMP FIXED DEC(5,2), /* SURREMISE IMPOSEE                       */00011   
  30 PRIFA FIXED DEC(7,2), /* PRIX DE FACTURATION                     */00012   
  30 PRIBA FIXED DEC(7,2), /* PRIX DE BASE (COMPTABILITE MATIERE)     */00013   
  30 NIMPR CHAR(1),      /* NATURE D IMPOSITION (BLANC,1,2,3,4,5)     */00014   
  30 PRIBB FIXED DEC(7,2), /* PRIX BB GARE                            */00015   
  30 GPREM CHAR(2),      /* GROUPE PRODUIT REMISE                     */00016   
  30 CLAXX CHAR(3),      /* CLAUSE SURREMISE                          */00017   
  30 GPSUX CHAR(3),      /* GROUPE PRODUIT SURREMISE                  */00018   
  30 TYREF CHAR(1),      /* TYPE DE REFERENCE                         */00019   
  30 RACBA FIXED DEC(5,2), /* REMISE ACHAT DE BASE (COMPTA MATIERES)  */00020   
  30 RACRE FIXED DEC(5,2), /* REMISE ACHAT EDITEUR                    */00021   
  30 ORDIA CHAR(1),      /* ORIGINE DIFFERENCE ACHAT ((0,1,2,3)       */00022   
  30 TAUDI FIXED DEC(5,2), /* TAUX DE DISTRIBUTION                    */00023   
  30 LIDIS CHAR(1),      /* LISTE DE DISTRIBUTION                     */00024   
  30 ARTAF CHAR(1),      /* ARTICLE A STOCK AFFECTE                   */00025   
  30 NUEDI CHAR(3),      /* NUMERO EDITEUR                            */00026   
  30 NUDIV CHAR(2),      /* NO DIVISION / EDITEUR                     */00027   
  30 NUCOL CHAR(2),      /* NO COLLECTION / DIVISION                  */00028   
  30 CLADI CHAR(3),      /* CLAUSE DE DISTRIBUTION                    */00029   
  30 NATAU CHAR(1),      /*NATURE DE TAUX 1=TAUX,2=VALEUR A SUPPRIMER */        
  30 COSAI CHAR(1),      /*CODE DE SAISIE A SUPPRIMER(2)              */        
  30 COMED CHAR(1),      /*A SUPPRIMER (3)->(1)+(2)+(3)=>POIDS        */        
  30 EDIAN CHAR(2),      /* NO EDITEUR ANCIEN                         */00033   
  30 COLAN CHAR(2),      /* NO COLL ANCIEN                            */00034   
  30 COTAX CHAR(1),      /* CODE TAXE TVA                             */00035   
  30 PINET CHAR(1),      /* TYPE DE PRIX                              */00036   
  30 ECFAC CHAR(1),      /* ECLATEMENT FACTURATION ETRANGER           */00037   
  30 VENET CHAR(2),      /* VENTILATION NATURE PRODUIT ETRANGER       */00038   
  30 VENBB CHAR(1),      /* VENTILATION NATURE PRODUIT BB             */00039   
  30 EXSEX CHAR(4),      /* EXPLOITATION - SOUS EXPLOITATION          */00040   
  30 COGAN CHAR(2),      /* CODE COGAN                                */00041   
  30 DEDIT CHAR(2),      /* DEPARTEMENT EDITEUR                       */00042   
  30 CATRA CHAR(1),      /* CATEGORIE REMISE ACHAT                    */00043   
  30 GEPRO CHAR(2),      /* GESTIONNAIRE DE PRODUIT                   */00044   
  30 RSGPS CHAR(4),      /* REGROUPEMENT STATISTIQUE                  */00045   
  30 VOYAR CHAR(2),      /* VOYAGEUR ARTICLE                          */00046   
  30 ARSON CHAR(1),      /* ARTICLE A SONDER                          */00047   
  30 COUVE CHAR(1),      /* COURANT DE VENTE                          */00048   
  30 COLBB CHAR(2),      /* COLLECTION BB                             */00049   
  30 GENBB CHAR(2),      /* GENRE DE PRODUITS BB                      */00050   
  30 TYVEN CHAR(1),      /* TYPE DE VENTE                             */00051   
  30 LIBTI CHAR(45),     /* LIBELLE TITRE                             */00052   
  30 LIBAU CHAR(25),     /* NOM AUTEUR                                */00053   
  30 FIN   CHAR(0),                                                     00054   
  /*F*/                                                                 00055   
 /*    END INCLUDE++                                                  */        
 /*    INCLUDE++ IDDCRESP                                             */01249   
        /* DATA SET IDDCRESP   AT LEVEL 001 AS OF 18/02/84    */                
0/* ZONE COMMUNE  REM,RES                                 AU 10/09/79 */00001   
 /*-------------------------------------------------------------------*/00002   
 /*D 01 WTCRS */                                                        00003   
 20 RS,                                                                 00004   
  30 POILU FIXED DEC(9,3), /* POIDS DE L UNITE DE CONDITIONNEMENT     */00005   
  30 REMBA FIXED DEC(5,2), /* REMISE DE BASE  ----------------------- */00006   
  30 TARDI CHAR(1),      /*------------------------------------------ */00007   
  30 COBAR CHAR(1),      /* CODE BARETTE  B,1=CDL,2=CRDL              */00008   
  30 HEBFA CHAR(1),      /* HEBDO FACTURATION OPTION TRAITEMENT       */00009   
  30 ORPRO CHAR(1),      /* ORIGINE PROGRAMME  1=RASSORT  2=OFFICE    */00010   
                         /* 3=CONTROLE  5=OFFREC SUR FICHIER RESULTAT */00011   
                         /* 6=OFFREC SUR FICHIER ATTENTE              */00012   
  30 NUBOR FIXED DEC (3),/* NUMERO DE BORDEREAU                       */00013   
  30 DEBOR CHAR(1),      /* DERNIER BORDEREAU CODE FIN DE LOREC       */00014   
  30 ZOGEO CHAR(1),      /* ZONE GEOGRAPHIQUE(M:MAUREPAS,C:COULOMMIER)*/00015   
  30 FIN   CHAR(0),                                                     00016   
 /*F*/                                                                  00017   
 /*    END INCLUDE++                                                  */        
 /*    INCLUDE++ IDDZVALP                                             */01250   
        /* DATA SET IDDZVALP   AT LEVEL 001 AS OF 18/02/84    */                
0/* RESULTATS DE FACTURATION FAC1A/FAD1A/FDI1A......      AU 17/01/80 */00001   
 /*-------------------------------------------------------------------*/00002   
 20  VA ,                                                               00003   
  30 CLIST CHAR(6) ,     /* COMPTE DE REGROUPEMENTS STATISTIQUES      */00004   
  30 DEPCO CHAR(2) ,     /* DEPARTEMENT COMPTABLE                     */00005   
  30 TRACO CHAR(1) ,     /* TRAITEMENT  COMPTABLE                     */00006   
  30 MAGES CHAR(3) ,     /* MAGASIN DE GESTION                        */00007   
  30 CADIS CHAR(1) ,     /* CANAL   DE DISTRIBUTION                   */00008   
  30 POFIS CHAR(1) ,     /* POSITION FISCALE                          */00009   
  30 REGFA CHAR(1) ,     /* REGIME DE FACTURATION                     */00010   
  30 CADOR CHAR(1) ,     /* CATEGORIE DE DOSSIER RECU                 */00011   
  30 TYCLI CHAR(1) ,     /* TYPE DE CLIENTELE                         */00012   
  30 SYPRO CHAR(2) ,     /* SYSTEME DE PROSPECTION                    */00013   
  30 REMAR CHAR(2) ,     /* CODE REGION MARCHE                        */00014   
  30 EDIPA CHAR(1) ,     /* EDITION PAPIER   1=FRANCE 2=GIH 9=NON EDIT*/00015   
  30 FACSP CHAR(1) ,     /* FACTURATION SPECIALE   1=ECHE. A FIXER    */00016   
                         /* 2=AUTORISATION RETOUR  3=PROFORMA         */00017   
                         /* 4=FACTUR. ANTICIPEE    5=FACTUR. NORMALE  */00018   
  30 GNATO CHAR(2) ,     /* GROUPE DE NATURES D'OPERATION             */00019   
  30 GNAT1 CHAR(2) ,     /* REGROUPEMENT DE GNATO POUR TRI            */00020   
  30 CLASS CHAR(1) ,     /* CLASSE DE NATURE D'OPERATIONS             */00021   
  30 LISUM CHAR(1) ,     /* LIGNES A SUMMARIZER   0=NON  1=OUI        */00022   
  30 DANTI ,             /* DATE ANTICIPATION                         */00023   
   40 AA   CHAR(2) ,     /* ANNEE                                     */00024   
   40 MM   CHAR(2) ,     /* MOIS                                      */00025   
  30 SMANU CHAR(1) ,     /* SURREMISE MANUELLE     1=OUI   0=NON      */00026   
  30 PUNHT DEC FIXED(7,2),/* PRIX UNITAIRE NET  HORS REMISE HORS TAXE */00027   
  30 RAPLI DEC FIXED(5,2),/* REMISE APPLIQUEE                         */00028   
  30 FORLI DEC FIXED(11,2),/* FORT FACTURE DE LA LIGNE                */00029   
  30 NETLI DEC FIXED(11,2),/* NET  FACTURE DE LA LIGNE                */00030   
  30 TAXLI DEC FIXED(11,2),/* MONTANT DES TAXES DE LA LIGNE           */00031   
  30 NBTOM DEC FIXED(7,0),/* NOMBRE DE TOMES                          */00032   
  30 GEFDI CHAR(1) ,      /* CODE GENERATION VERS RESULTATS ACTIVITE  */00033   
                          /* B = NON GENER.  1 = GENERATION FACT.DIFF.*/00034   
  30 FIN   CHAR(0) ,      /*                                          */00035   
 /*    END INCLUDE++                                                  */        
 /*    INCLUDE++ IDDLRESP                                             */01251   
0/* PL1CMS VER 06 * MOD. IDDLRESP * LIB INC * LE 02/07/81 A 10:15:57 */ 00000000
 /* RESULTATS DE FACTURATION                              AU 17/01/80 */00000010
 /*********************************************************************/00000020
020  RL ,                /* ENREGISTREMENT NIVEAU  LIGNE FACTUREE     */00000030
                         /*********************************************/00000040
  30 CECOM CHAR(3) ,     /* CENTRE COMPTABLE                          */00000050
  30 DOMOF CHAR(1) ,     /* DOMAINE OFFICE                            */00000060
  30 CACLI CHAR(2) ,     /* CATEGORIE DE CLIENT OU TYPE DE POSTE BB   */00000070
  30 ARRON CHAR(2) ,     /* ARRONDISSEMENT                            */00000080
  30 BALAN CHAR(1) ,     /* CODE BALANCE                              */00000090
  30 CAREM CHAR(3) ,     /* CATEGORIE DE REMISE                       */00000100
  30 TRAST CHAR(1) ,     /* TRAITEMENT  STATISTIQUE                   */00000110
  30 CLISU CHAR(1) ,     /* CLIENT A SURREMISE ANNUELLE               */00000120
  30 CALIT CHAR(1) ,     /* CATEGORIE LITTERAURE                      */00000130
  30 CACLA CHAR(1) ,     /* CATEGORIE CLASSIQUE                       */00000140
  30 RUNFA CHAR(3) ,     /* NUMERO DE RUN                             */00000150
  30 NUFAC DEC FIXED(5,0),/* NUMERO SEQUENTIEL DE LA FACTURE          */00000160
  30 DEMFA ,             /* DATE DE MISE EN FACTURATION               */00000170
   40 DEMAA CHAR(2),     /* ANNEE                                     */00000180
   40 DEMMM CHAR(2),     /* MOIS                                      */00000190
   40 DEMJJ CHAR(2),     /* JOUR                                      */00000200
  30 FIN   CHAR(0) ,     /*                                           */00000210
 /*    END INCLUDE++                                                  */        
             /* � AJOUT ZONE REFAD */                                   01252   
      10 REFAD         CHAR (4),                                        01253   
      10 FILLER        CHAR (0);                                        01254   
                                                                        01255   
                                                                        01256   
       DCL 1 WRESP            BASED (PMAXI),                            01257   
 /*    INCLUDE++ IDDIRESP                                             */01258   
0/* PL1CMS VER 03 * MOD. IDDIRESP * LIB INC * LE 02/07/81 A 10:13:55 */ 00000000
 /* RESULTATS DE FACTURATION                              AU 17/01/80 */00000010
 /*********************************************************************/00000020
010  ID ,                /* ARGUMENT DE TRI                           */00000030
                         /*********************************************/00000040
  20 TYENR CHAR(1) ,     /* CODE ENREGISTREMENT ( 1=LIGNE  5=PIED )   */00000050
  20 GEREF CHAR(1) ,     /* CODE GENERATION VERS RESULTATS ACTIVITE   */00000060
                         /* B = NON GENER.  1 = GENERATION POUR DECA  */00000070
 /*    END INCLUDE++                                                  */        
           10 GS ,                      /*   ENREG. RESULT. PIED      */01259   
 /*    INCLUDE++ IDDPRESK                                             */01260   
        /* DATA SET IDDPRESK   AT LEVEL 007 AS OF 17/03/20    */                
 /* OBJET CREE PAR : RSANZMA  LE 13/03/20 A 12:57:12        */          00001   
 /* ENREGISTREMENT NIVEAU  PIED DE FACTURE                  */          00002   
0/* PL1CMS VER 04 * MOD. IDDPRESP * LIB INC * LE 02/07/81 A 10:16:18 */ 00003**2
 /* RESULTATS DE FACTURATION                              AU 04/04/80 */00004**2
 /*********************************************************************/00005**2
020  RP ,                /* ENREGISTREMENT NIVEAU  PIED DE FACTURE    */00006**2
                         /*********************************************/00007**2
  30 NUCLI CHAR(6) ,     /* NUMERO DE CLIENT                          */00008**2
  30 CLICO CHAR(6) ,     /* COMPTE REGROUPEMENT COMPTABLE             */00009**2
  30 DEPCO CHAR(2) ,     /* DEPARTEMENT COMPTABLE                     */00010**2
  30 TRACO CHAR(1) ,     /* TRAITEMENT COMPTABLE                      */00011**2
  30 CECOM CHAR(3) ,     /* CENTRE COMPTABLE                          */00012**2
  30 MACOM CHAR(3) ,     /* MAGASIN COMMERCIALE                       */00013**2
  30 REMAR CHAR(2) ,     /* REGION  MARCHE                            */00014**2
  30 DEPAY CHAR(3) ,     /* DEPARTEMENT  PAYS                         */00015**2
  30 POFIS CHAR(1) ,     /* POSITION FISCALE                          */00016**2
  30 BALAN CHAR(1) ,     /* CODE BALANCE                              */00017**2
  30 TYCLI CHAR(1) ,     /* TYPE DE CLIENTELE                         */00018**2
  30 N0GIH ,             /* NUMERO DE COMPTE  GIH                     */00019**2
   40 NOMCO CHAR(5),     /* NOMENCLATURE DU COMPTE                    */00020**2
   40 CATCO CHAR(1),     /* CATEGORIE DE COMPTE                       */00021**2
   40 NATCO CHAR(2),     /* NATURE DE COMPTE                          */00022**2
   40 DEVIS CHAR(1),     /* DEVISE                                    */00023**2
  30 RUNFA  CHAR(3),     /* NUMERO DE RUN                             */00024**2
  30 NUFAC  DEC FIXED(5,0),/* NUMERO SEQUENTIEL DE LA FACTURE         */00025**2
  30 DEMFA ,             /* DATE DE MISE EN FACTURATION               */00026**2
   40 DEMAA CHAR(2),     /* ANNEE                                     */00027**2
   40 DEMMM CHAR(2),     /* MOIS                                      */00028**2
   40 DEMJJ CHAR(2),     /* JOUR                                      */00029**2
  30 GNATO CHAR(2) ,     /* GROUPE DE NATURES D'OPERATION             */00030**2
  30 ECFAC CHAR(1) ,     /* ECLATEMENT DE LA FACTURE                  */00031**2
  30 STRET CHAR(1) ,     /* STATISTIQUE RETOUR                        */00032**2
  30 SPENV CHAR(2) ,     /* SPECIFICATION D'ENVOI                     */00033**2
  30 ECHEA CHAR(2) ,     /* CODE ECHEANCE                             */00034**2
  30 QUANT DEC FIXED(7,0),/* QUANTITE                                 */00035**2
  30 POIDS DEC FIXED(9,3),/* POIDS                                    */00036**2
  30 FORHT DEC FIXED(11,2),/* FORT DE LA FACTURE                      */00037**2
  30 NETTC DEC FIXED(11,2),/* NET  DE LA FACTURE                      */00038**2
  30 TAXES DEC FIXED(11,2),/* MONTANT DES TAXES                       */00039**2
  30 NBTAX DEC FIXED(1,0),/* NOMBRE DE CODE TAXE DIFF.                */00040**2
  30 RES (L REFER (NBTAX)),/* RESULTATS PAR CODE TAXE                 */00041**2
   40 COTAX CHAR(1),       /* CODE TAXE                               */00042**2
   40 NETC DEC FIXED(11,2),/* NET                                     */00043**2
   40 MTAX DEC FIXED(11,2),/* MONTANT DES TAXES                       */00044**2
  30 DAECH CHAR(8)      ,/* DATE D ECHEANCE AAAAMMJJ                  */00045**7
  30 FIN   CHAR(0);      /*                                           */00046**2
 /*    END INCLUDE++                                                  */        
          /* 10 FILLER        CHAR (0)    */                            01261   
       DCL   MAXI             CHAR (300);                               01262   
             PMAXI            = ADDR(MAXI);                             01263   
1                                       /*******************************01264   
                                        *                              *01265   
                                        *    CANADA PRO FORMA          *01266   
                                        *                              *01267   
                                        *******************************/01268   
       DCL 1 WCAN4P,                    /*   ENREG. RESULT. LIGNE     */01269   
 /*    INCLUDE++ CANADA4P                                             */01270   
        /* DATA SET CANADA4P   AT LEVEL 001 AS OF 13/06/02    */                
      /* IDIL _ FACTURE PRO FORMA CANADA         */                     00001   
      /*  GENERE LE 13/06/02 A 11H24 PAR YDU    */                      00002   
           02 C4P_NADA4,                                                00003   
          /* MOIS COMPTABLE AAAAMM                    */                00004   
            03 C4P_MOICO CHAR(06),                                      00005   
          /* NUMERO CLIENT                            */                00006   
            03 C4P_NUCLI CHAR(06),                                      00007   
          /* NUMERO DE RUN                            */                00008   
            03 C4P_NORUNX,                                              00009   
             04 C4P_NORUN PIC'(03)9',                                   00010   
          /* LOT DE REGROUPEMENT COMMANDES            */                00011   
            03 C4P_LORECX,                                              00012   
             04 C4P_LOREC FIXED DEC(05,0),                              00013   
          /* NUMERO DE FACTURE                        */                00014   
            03 C4P_NUFACX,                                              00015   
             04 C4P_NUFAC FIXED DEC(05,0),                              00016   
          /* DATE DE VALEUR DE FACTURATION            */                00017   
            03 C4P_DAFAC,                                               00018   
             04 C4P_DAFACD,                                             00019   
              05 C4P_DAFACA PIC '9999',                                 00020   
              05 C4P_DAFACM PIC '99',                                   00021   
             04 C4P_DAFACJ PIC '99',                                    00022   
          /* NUMERO ARTICLE                           */                00023   
            03 C4P_NUART CHAR(07),                                      00024   
          /* INDICATEUR VRAC COLIS                    */                00025   
            03 C4P_COVRACOL CHAR(01),                                   00026   
          /* NOMBRE DE TOMES                          */                00027   
            03 C4P_NBTOMX,                                              00028   
             04 C4P_NBTOM FIXED DEC(07,0),                              00029   
          /* FILLER X(10)                             */                00030   
            03 C4P_FIL10 CHAR(10),                                      00031   
            03 C4P_XXXXX CHAR(0);                                       00032   
 /*    END INCLUDE++                                                  */        
1                                       /*******************************01271   
                                        *                              *01272   
                                        *    EXPORT INFOCENTRE HARRY   *01273   
                                        *                              *01274   
                                        *******************************/01275   
 /*    INCLUDE++ IDDEXPHA                                             */01276   
        /* DATA SET IDDEXPHA   AT LEVEL 025 AS OF 16/03/10    */                
 /* OBJET CREE PAR : YDU      LE 27/06/08 A 17:43:19        */          00001   
 /* IDIL                                                    */          00002   
0/* FICHIER FACTURES EXPORT POUR INFOCENTRE                D=27/06/08 */00003**2
 /*-------------------------------------------------------------------*/00004**2
 DCL 1 WEXPO,                                                           00005**8
 10  GS ,                                /*   LONGUEUR X(550)         */00006*21
  20 NUFAC   FIXED DEC (5),/* NUMERO DE LA FACTURE                    */00007*23
  20 DAFAC   CHAR(08)  ,   /* DATE   DE LA FACTURE AAAAMMJJ           */00008*13
  20 INCLI             ,   /* INFO CLIENT                             */00009*13
    30 NUCLI CHAR(06)  ,   /* NUMERO DE CLIENT                        */00010*13
    30 RASOC CHAR(26)  ,   /* RAISON SOCIALE                          */00011*13
    30 NOCLI CHAR(15)  ,   /* NOM DU CLIENT                           */00012*13
    30 ADCLI CHAR(26)  ,   /* ADRESSE                                 */00013*13
    30 LORES CHAR(15)  ,   /* LOCALITE RESIDENCE                      */00014*13
    30 CPCLI CHAR(05)  ,   /* CODE POSTAL                             */00015*13
    30 LOBDI CHAR(26)  ,   /* BUREAU DISTRIBUTEUR                     */00016*11
    30 DEPAY CHAR(03)  ,   /* DEPARTEMENT PAYS                        */00017*11
    30 PAYCL CHAR(26)  ,   /* NOM DU PAYS                             */00018*11
  20 INCFA             ,   /* INFO CLIFA                              */00019*11
    30 CLIFA CHAR(06)  ,   /* NUMERO DU CLIFA                         */00020*11
    30 RASOC CHAR(26)  ,   /* RAISON SOCIALE                          */00021*11
    30 NOCLI CHAR(15)  ,   /* NOM DU CLIENT                           */00022*11
    30 ADCLI CHAR(26)  ,   /* ADRESSE                                 */00023*11
    30 LORES CHAR(15)  ,   /* LOCALITE RESIDENCE                      */00024*11
    30 CPCLI CHAR(05)  ,   /* CODE POSTAL                             */00025*11
    30 LOBDI CHAR(26)  ,   /* BUREAU DISTRIBUTEUR                     */00026*11
    30 DEPAY CHAR(03)  ,   /* DEPARTEMENT PAYS                        */00027*11
    30 PAYCL CHAR(26)  ,   /* NOM DU PAYS                             */00028*11
  20 RECOM             ,   /* REFERENCE COMMANDE                      */00029*11
    30 RECO1 CHAR(17)  ,   /* REFERENCE COMMANDE EFFECTIVE            */00030*11
    30 MONTC CHAR(08)  ,   /* MONTANT COMPTANT POUR NATOP 21-22       */00031*11
  20 MOTRA   CHAR(03)  ,   /* MODE DE TRANSPORT                       */00032*11
  20 SPENV   CHAR(02)  ,   /* SPECIFICATION ENVOI                     */00033*11
  20 MODTR   CHAR(50)  ,   /* MODE DE TRANSPORT AERIEN MARITIME ...   */00034*17
  20 SPECL   CHAR(50)  ,   /* SPECIFICATION ENVOI CLIENT              */00035*17
  20 TRALO   CHAR(50)  ,   /* LIBELLE LONG TRANSITAIRE                */00036*17
  20 NBCOL   FIXED DEC (5),/* NOMBRE DE COLIS TOTAL                   */00037*10
  20 NBPAL   FIXED DEC (5),/* NOMBRE DE PALETTES                      */00038*20
  20 POIDF   FIXED DEC (15,3),/* POIDS TOTAL FACTURE                  */00039*18
  20 MTMAR   FIXED DEC (15,2),/* MONTANT DES MARCHANDISES             */00040*10
  20 MTFRN   FIXED DEC (15,2),/* MONTANT DES FRAIS ANNEXES            */00041*10
  20 MTFRT   FIXED DEC (15,2),/* MONTANT DES FRAIS DE TRANSPORT       */00042*10
  20 NORUN   CHAR(03)  ,   /* NUMERO RUN DE FACTURATION               */00043*24
  20 SYPRO   CHAR(02)  ,   /* SYSTEME DE PROSPECTION                  */00044*25
  20 LIBRE   CHAR(20)  ;   /* DISPONIBLE                              */00045*25
 /*    END INCLUDE++                                                  */        
1                                       /*******************************01277   
                                        *                              *01278   
                                        *    FICH. BORDEREAUX COMPTANT *01279   
                                        *                              *01280   
                                        *******************************/01281   
                                        /*   INCLUDE IDDIBOCP         */01282   
                                        /*   INCLUDE IDDBOCOP         */01283   
       DCL 1 WTBOR ,                                                    01284   
 /*    INCLUDE++ IDDIBOCP                                             */01285   
        /* DATA SET IDDIBOCP   AT LEVEL 001 AS OF 18/02/84    */                
 /* BORDEREAUX COMPTANT                                   AU 25/09/79 */00001   
 /* FICHIER VARIABLE BLOQUE                                           */00002   
 /*********************************************************************/00003   
010  ID ,                /* ARGUMENT DE TRI                           */00004   
                         /*********************************************/00005   
  20 CODET CHAR(4) ,     /* CODE ETAT EDITION (472 = FACTURE COMPTANT)*/00006   
  20 MACOM CHAR(3) ,     /* MAGASIN COMMERCIAL                        */00007   
  20 NUCLI CHAR(6) ,     /* NUMERO DE CLIENT                          */00008   
  20 DCOFA ,             /* DATE DES CONDITIONS DE FACTURATION        */00009   
   30 DCOAA CHAR(2),     /* ANNEE                                     */00010   
   30 DCOMM CHAR(2),     /* MOIS                                      */00011   
   30 DCOJJ CHAR(2),     /* JOUR                                      */00012   
  20 REPIE CHAR(4),      /* REFERENCE PIECE                           */00013   
  20 RESAI ,             /* REFERENCE SAISIE                          */00014   
   30 ANNEE CHAR(2),     /* ANNEE                                     */00015   
   30 RUN   CHAR(3),     /* NO RUN                                    */00016   
   30 ORIGI CHAR(2),     /* ORIGINE                                   */00017   
   30 NUMRO DEC FIXED(5),/* NUMERO D'ORDRE                            */00018   
  20 NATOP CHAR(2) ,     /* NATURE D'OPERATION                        */00019   
  20 NUART CHAR(7) ,     /* NUMERO D'ARTICLE                          */00020   
  20 CTRLI DEC FIXED(7), /* COMPTEUR DE LIGNES / RUN                  */00021   
 /*    END INCLUDE++                                                  */        
           10 GS ,                                                      01286   
 /*    INCLUDE++ IDDBOCOP                                             */01287   
        /* DATA SET IDDBOCOP   AT LEVEL 001 AS OF 18/02/84    */                
 /* BORDEREAUX COMPTANT                                   AU 25/09/79 */00001   
 /*********************************************************************/00002   
020  BC ,                /* ENREGISTREMENT ETAT BORDEREAUX COMPTANT   */00003   
                         /*********************************************/00004   
  30 CODET CHAR(4) ,     /* CODE ETAT EDITION (472 = FACTURE COMPTANT)*/00005   
  30 COENR CHAR(3) ,     /* CODE ENREGISTREMENT                       */00006   
  30 NATOP CHAR(2) ,     /* NATURE D'OPERATIONS                       */00007   
  30 NUCLI CHAR(6) ,     /* NUMERO DE CLIENT                          */00008   
  30 MONTC CHAR(8) ,     /* MONTANT COMPTANT NATOP 21-22              */00009   
  30 RESAI ,             /* REFERENCE SAISIE                          */00010   
   40 ANNEE CHAR(2),     /* ANNEE                                     */00011   
   40 RUN   CHAR(3),     /* NO RUN                                    */00012   
   40 ORIGI CHAR(2),     /* ORIGINE                                   */00013   
   40 NUMRO DEC FIXED(5),/* NUMERO D'ORDRE                            */00014   
  30 NUART CHAR(7) ,     /* NUMERO D'ARTICLE                          */00015   
  30 MACOM CHAR(3) ,     /* MAGASIN COMMERCIAL                        */00016   
  30 DCOFA ,             /* DATE DES CONDITIONS DE FACTURATION        */00017   
   40 DCOAA CHAR(2),     /* ANNEE                                     */00018   
   40 DCOMM CHAR(2),     /* MOIS                                      */00019   
   40 DCOJJ CHAR(2),     /* JOUR                                      */00020   
  30 SRIMP DEC FIXED(5,2),/* SURREMISE IMPOSEE                        */00021   
  30 PRIFA DEC FIXED(7,2),/* PRIX DE FACTURATION                      */00022   
  30 NIMPR CHAR(1) ,     /* NATURE D'IMPOSITION (BLANC,1,2,3,4,5)     */00023   
  30 TYREF CHAR(1) ,     /* TYPE DE REFERENCE                         */00024   
  30 COTAX CHAR(1) ,     /* CODE TAXE TVA                             */00025   
  30 REPIE CHAR(4) ,     /* REFERENCE PIECE                           */00026   
  30 DEPCO CHAR(2) ,     /* DEPARTEMENT COMPTABLE                     */00027   
  30 POFIS CHAR(1) ,     /* POSITION FISCALE                          */00028   
  30 TYCLI CHAR(1) ,     /* TYPE DE CLIENTELE                         */00029   
  30 NETLI DEC FIXED(11,2),/* NET FACTURE DE LA LIGNE                 */00030   
  30 TAXLI DEC FIXED(11,2),/* MONTANT DES TAXES DE LA LIGNE           */00031   
  30 FIN   CHAR(0) ,     /*                                           */00032   
 /*    END INCLUDE++                                                  */        
             10 FILLER        CHAR (0);                                 01288   
1                                       /*******************************01289   
                                        *                              *01290   
                                        *    FICHIER DES ANOMALIES     *01291   
                                        *                              *01292   
                                        *******************************/01293   
                                        /*   INCLUDE IDDACTFE         */01294   
                                        /*   INCLUDE IDDACTFL         */01295   
                                        /*   INCLUDE IDDZANOP         */01296   
0      DCL 1 WANOE            EXTERNAL, /*   ANOMALIE ENTETE          */01297   
 /*    INCLUDE++ IDDACTFE                                             */01298   
   /*---------------------------------------------------------------*/  00000000
   /*--     IDIL170                                               --*/  00000010
   /*-- ETAT D ANOMALIE DES COMMANDES  :  DESCRIPTION DE L ENTETE --*/  00000020
   /*--  POUR CONTROLE ,TIRAGE ET FACTURATION 13/07/79   26/09/79 --*/  00000030
   /*---------------------------------------------------------------*/  00000040
  10 ID,                                                                00000050
   20 SCODE       CHAR(01) , /* SUR CODE */                             00000060
   20 CODET       CHAR(03) , /* = 150 */                                00000070
   20 CANOM       CHAR(04) ,                                            00000080
   20 LICOR       CHAR(02) , /* LIEU DE CORRECTION */                   00000090
   20 NATOP       CHAR(02) , /* NATURE D OPERATION */                   00000100
   20 CADOR       CHAR(01) , /* CATEGORIE DOSSIER */                    00000110
   20 NUCLI       CHAR(06) , /* NUMERO CLIENT */                        00000120
   20 RESAI, /* REFERENCE SAISIE */                                     00000130
    30 AA         CHAR(02) , /* ANNEE */                                00000140
    30 RUN        CHAR(03) , /* NUMERO DU RUN */                        00000150
    30 ORIGI      CHAR(02) , /* ORIGINE ECRAN OU 37-41 */               00000160
    30 NUMRO FIXED DEC(5,0), /* NUMERO D ORDRE */                       00000170
   20 TYPEN       CHAR(01) , /* TYPE ENREGISTREMENT =1 POUR L ENTETE */ 00000180
   20 COENR       CHAR(03) , /* CODE ENREGISTREMENT */                  00000190
   20 FILLER      CHAR(17) ,                                            00000200
  10 GS,                                                                00000210
   20 SCODE       CHAR(01),                                             00000220
   20 CODET       CHAR(03),                                             00000230
   20 CADOR       CHAR(01) ,                                            00000240
   20 COENR       CHAR(03) ,                                            00000250
   20 COMVT       CHAR(01) ,                                            00000260
   20 LICOR       CHAR(02) ,                                            00000270
   20 NATOP       CHAR(02) ,                                            00000280
   20 NUCLI       CHAR(06) ,                                            00000290
   20 REPRE       CHAR(03) , /* NUMERO REPRESENTANT */                  00000300
   20 PRIOR       CHAR(01) , /* CODE PRIORITE */                        00000310
   20 MOTRA       CHAR(03) , /* MODE DE TRANSPORT */                    00000320
   20 ZONTI       CHAR(01) , /* ZONE DE TIRAGE */                       00000330
   20 CONOT       CHAR(01) , /* CODE NOTATION */                        00000340
   20 ECHEA       CHAR(02) , /* CODE ECHEANCE */                        00000350
   20 REPIE       CHAR(04) , /* REFERENCE PIECE */                      00000360
   20 RECOM                , /* REFERENCE COMMANDE */                   00000370
      30 RECO1    CHAR(17) ,                                            00000371
      30 MONTC    CHAR(08) ,                                            00000372
   20 REGRO       CHAR(01) , /* CODE REGROUPEMENT */                    00000380
   20 OPSPE       CHAR(01) , /* CODE OPERATION SPECIALE */              00000390
   20 RETAU       CHAR(01) , /* AUTORISATION RETOUR */                  00000400
   20 FRANC       CHAR(01) , /* FRANCO DE PORT */                       00000410
   20 ORIMP       CHAR(01) , /* ORIGINE IMPOSITION REMISE */            00000420
   20 TYSUR       CHAR(01) , /* TYPE DE SURREMISE */                    00000430
   20 SRIMP       CHAR(05) , /* SURREMISE IMPOSEE */                    00000440
   20 REDAC       CHAR(01) , /* NUMERO DE REDACTEUR */                  00000450
   20 MAGTI       CHAR(03) , /* MAGASIN DE TIRAGE */                    00000460
   20 DAMIT       CHAR(06) , /* DATE DE MISE EN TIRAGE */               00000470
   20 DEXPE       CHAR(06) , /* DATE D EXPEDITION */                    00000480
   20 DATCO       CHAR(06) , /* DATE SAISIE COMMANDE */                 00000490
   20 CODIN       CHAR(01) , /* CODE INDEXATION */                      00000500
   20 SPENV       CHAR(02) , /* SPECIFICATION ENVOI G.I.H */            00000510
   20 FABRI       CHAR(01) , /* SPECIFICATION FABRICATION */            00000520
   20 CONDI       CHAR(01) , /* CONDITIONNEMENT PALETTE OU COLIS */     00000530
   20 PREPA       CHAR(01) , /* CODE PREPARATION COLISAGE */            00000540
   20 REFAD       CHAR(04) , /* REFERENCE ADMINISTRATIVE */             00000550
   20 NBFAC       CHAR(01) , /* NOMBRE INMPRESSION FACTURE */           00000560
   20 PEFAC       CHAR(01) , /* PERIODE DE FACTURATION */               00000570
   20 TYVAR       CHAR(01) , /* TYPE DE VALORISATION RETOUR */          00000580
   20 NATRE       CHAR(02) , /* NATURE RETOUR OU RECEPTION */           00000590
   20 PACON       CHAR(01) ,                                            00000600
   20 RESAI,                                                            00000610
    30 AA         CHAR(02) ,                                            00000620
    30 RUN        CHAR(03) ,                                            00000630
    30 ORIGI      CHAR(02) ,                                            00000640
    30 NUMRO FIXED DEC(5,0),                                            00000650
  20 TBANO(06)   CHAR(04) , /* TABLEAU DES 6 CODES ANOMALIES */         00000660
  20 PLUS6       CHAR(01) , /*REPERE NBRE ANO > 6 */                    00000670
 /*    END INCLUDE++                                                  */        
  10 FIN   CHAR(0) ;                                                    01299   
0      DCL 1 WANOL            EXTERNAL, /*   ANOMALIE LIGNE           */01300   
 /*    INCLUDE++ IDDACTFL                                             */01301   
   /*-----------------------------------------------------------------*/00000000
   /*--      IDIL170                                                --*/00000010
   /*--  ETAT D ANOMALIES DES COMMANDES : DESCRIPTION DE LA LIGNE   --*/00000020
   /*--  POUR CONTROLE, TIRAGE ET FACTURATION  13/07/79  26/09/79   --*/00000030
   /*-----------------------------------------------------------------*/00000040
   10 ID,                                                               00000050
    20 SCODE        CHAR(01), /* SUR CODE */                            00000060
    20 CODET        CHAR(03), /* CODE ETAT = 150 */                     00000070
    20 CANOM        CHAR(04),                                           00000080
    20 LICOR        CHAR(02), /* LIEU DE CORRECTION */                  00000090
    20 NATOP        CHAR(02), /* NATURE D OPERATION */                  00000100
    20 CADOR        CHAR(01), /* CATEGORIE DE DOSSIER */                00000110
    20 NUCLI        CHAR(06), /* NUMERO CLIENT */                       00000120
    20 RESAI, /* REFERENCE DE SAISIE */                                 00000130
     30 ANNEE       CHAR(02), /* ANNEE */                               00000140
     30 NUJOU       CHAR(03), /* NUMERO DU RUN */                       00000150
     30 ORIGI       CHAR(02), /* ORIGINE DE LA SAISIE */                00000160
     30 NUMRO FIXED DEC(5,0), /* NUMERO D ORDRE */                      00000170
    20 TYPEN        CHAR(01), /* CODE ENREGISTREMENT =2 POUR LIGNE */   00000180
    20 COENR        CHAR(03), /* CODE ENREGISTREMENT */                 00000190
    20 NUART        CHAR(07), /* NUMERO ARTICLE */                      00000200
    20 CTRLI        FIXED DEC(7,0),                                     00000210
    20 FILLER       CHAR(06),                                           00000220
   10 GS,                                                               00000230
    20 SCODE        CHAR(01),                                           00000240
    20 CODET        CHAR(03),                                           00000250
    20 CADOR        CHAR(01),                                           00000260
    20 COENR        CHAR(03),                                           00000270
    20 COMVT        CHAR(01),                                           00000280
    20 LICOR        CHAR(02),                                           00000290
    20 NATOP        CHAR(02),                                           00000300
    20 NUCLI        CHAR(06),                                           00000310
    20 NUART        CHAR(07), /* NUMERO ARTICLE */                      00000320
    20 QUANT        CHAR(05), /* QUANTITE COMMANDEE */                  00000330
    20 REFLI        CHAR(10), /* REFERENCE LIGNE ARTICLE */             00000350
    20 CONOT        CHAR(01), /* CODE NOTATION */                       00000360
    20 ORIMP        CHAR(01), /* ORIGINE IMPOSITION REMISE */           00000370
    20 TYSUR        CHAR(01), /* TYPE DE SURREMISE */                   00000380
    20 SRIMP        CHAR(05), /* REMISE IMPOSEE */                      00000390
    20 PRIMP        CHAR(06), /* PRIX IMPOSE */                         00000400
    20 RESEG        CHAR(01), /* RESERVE GLOBALE */                     00000420
    20 NALIG        CHAR(01), /* NATURE DE LA LIGNE */                  00000430
    20 ECHEA        CHAR(02), /* ECHEANCE A LA LIGNE */                 00000430
    20 LIMPO        CHAR(54), /* LIBELLE IMPOSE */                      00000440
    20 DATCO                , /* DATE DE SAISIE DE LA COMMANDE */       00000450
     30 DATCA       CHAR(02),                                           00000451
     30 DATCM       CHAR(02),                                           00000452
     30 DATCJ       CHAR(02),                                           00000453
    20 RESAI,                                                           00000460
     30 ANNEE       CHAR(02),                                           00000470
     30 NUJOU       CHAR(03),                                           00000480
     30 ORIGI       CHAR(02),                                           00000490
     30 NUMRO FIXED DEC(5,0),                                           00000500
   20 NUSEQ  FIXED DEC(5),   /* NUMERO SEQUENCE                    */   00037**3
   20 ZONTI  CHAR(1),        /* ZONE TIRAGE                        */   00038**3
   20 NUBOR  FIXED DEC(3),   /* NUMERO BORDEREAU                   */   00039*11
   20 TBANO(06)    CHAR(04), /* CODES ANOMALIES */                      00000510
   20 PLUS6        CHAR(01), /* REPERE : + 6 ANO */                     00000520
   20 CPINV        CHAR(07), /* NUMERO DU COMPOSANT INVALIDE */         00000530
   20 PLUS1        CHAR(01), /* REPERE : PLUS D UN COMP INV  */         00000540
   20 REPIE        CHAR(04),                                            00000550
 /*    END INCLUDE++                                                  */        
  10 FIN   CHAR(0) ;                                                    01302   
0      DCL 1 WANOT            EXTERNAL, /*   ANOMALIE TECHNIQUE       */01303   
 /*    INCLUDE++ IDDZANOP                                             */01304   
        /* DATA SET IDDZANOP   AT LEVEL 001 AS OF 18/02/84    */                
       /*---------ENRG ANOMALIE TECHNIQUE  ---------------------------*/00001   
       10 ID,                                                           00002   
         20 SURCO         CHAR(01),       /* SURCODE = 9              */00003   
         20 NPROG         CHAR(07),       /* NOM PROGRAMME            */00004   
         20 NUANO         FIXED DEC(7),   /* SEQUENCE ANOMALIE / PROG */00005   
         20 NOFIC         CHAR(05),       /* NOM FICHIER, OU          */00006   
                                          /* TNNNN, NNNN = NO TABLE   */00007   
         20 LIANO         CHAR(60),       /* LIBELLE ANOMALIE         */00008   
 /*    END INCLUDE++                                                  */        
  10 GS ,                                                               01305   
  20 ENREG CHAR(468);                                                   01306   
1                                       /*******************************01307   
                                        *                              *01308   
                                        *    JOURNAL DE FACTURATION    *01309   
                                        *                              *01310   
                                        *******************************/01311   
                                        /*   INCLUDE IDDIJOUP         */01312   
                                        /*   INCLUDE IDDJOURP         */01313   
                                        /*   INCLUDE IDDJOUFP         */01314   
       DCL 1 WJOUR,                     /*   NIVEAU RESAI             */01315   
 /*    INCLUDE++ IDDIJOUP                                             */01316   
        /* DATA SET IDDIJOUP   AT LEVEL 001 AS OF 18/02/84    */                
0/**********************************************************************00001   
 *                       ARGUMENT DE TRI DU                 D=20/10/79 *00002   
 *                       JOURNAL DE FACTURATION                        *00003   
 **********************************************************************/00004   
010  ID ,                /* ARGUMENT DE TRI                           */00005   
                         /*********************************************/00006   
  20 CODET CHAR(4) ,     /* CODE ETAT EDITION  471=JOURNAL FACTURA.   */00007   
  20 EDIPA CHAR(1) ,     /* EDITION PAPIER  1=FRANCE  2=GIH  9=NO EDIT*/00008   
  20 MACOM CHAR(3) ,     /* MAGASIN COMMERCIAL                        */00009   
  20 TRACO CHAR(1) ,     /* TRAITEMENT  COMPTABLE                     */00010   
  20 CADOR CHAR(1) ,     /* CATEGORIE DE DOSSIER RECU                 */00011   
  20 GNAT1 CHAR(2) ,     /* REGROUPEMENT DE GNATO                     */00012   
  20 GNATO CHAR(2) ,     /* GROUPE DE NATOP                           */00013   
  20 NUCLI CHAR(6) ,     /* NUMERO DE CLIENT                          */00014   
  20 RUNFA CHAR(3) ,     /* NUMERO DE RUN DE FACTURATION              */00015   
  20 NUFAC DEC FIXED(5), /* NUMERO DE LA FACTURE                      */00016   
  20 CODEN CHAR(1) ,     /* CODE ENREGISTREMENT 1=ENTET.FACTU 2=RESAI */00017   
  20 TRIFA CHAR(1) ,     /* CODE DE TRI POUR GIH                      */00018   
  20 DAMIS ,             /* DATE DE MISE A JOUR DU STOCK              */00019   
   30 DAMAA CHAR(2),     /* ANNEE                                     */00020   
   30 DAMMM CHAR(2),     /* MOIS                                      */00021   
   30 DAMJJ CHAR(2),     /* JOUR                                      */00022   
  20 NORUN CHAR(3) ,     /* NO DE RUN DE CREATION DES COENR = NORUN   */00023   
  20 LOREC DEC FIXED(5), /* LOT DE REGROUPEMENT DE COMMANDES          */00024   
  20 LINOU CHAR(1),      /* LIGNE NOUVELLE                            */00025   
  20 RESAI ,             /* REFERENCE DE SAISIE                       */00026   
   30 ANNEE CHAR(2),     /* ANNEE                                     */00027   
   30 RUN   CHAR(3),     /* NUMERO DE RUN                             */00028   
   30 ORIGI CHAR(2),     /* ORIGINE                                   */00029   
   30 NUMRO DEC FIXED(5),/* NUMERO D ORDRE                            */00030   
  20 FILLER CHAR(0),     /* LIBRE                                     */00031   
 /*    END INCLUDE++                                                  */        
 10 GS,                                 /*   ZONE DE GESTION          */01317   
 /*    INCLUDE++ IDDJOURP                                             */01318   
        /* DATA SET IDDJOURP   AT LEVEL 001 AS OF 18/02/84    */                
0/* ZONES DE GESTION DU JOURNAL DE FACTURATION            AU 20/10/79 */00001   
 /*********************************************************************/00002   
 /*D 01 WTJOU */                                                        00003   
020 JR,                  /* ENREGISTREMENT RESAI                      */00004   
  30 CODET CHAR(4) ,     /* CODE ETAT EDITION   471=JOURNAL FACTURA.  */00005   
  30 CODEN CHAR(1) ,     /* CODE ENREGISTREMENT   2=RESAI             */00006   
  30 EDIPA CHAR(1) ,     /* EDITION PAPIER 1=CDL 2=GIH 3=NON EDITION  */00007   
  30 MACOM CHAR(3) ,     /* MAGASIN COMMERCIAL                        */00008   
  30 TRACO CHAR(1) ,     /* TRAITEMENT  COMPTABLE                     */00009   
  30 CADOR CHAR(1) ,     /* CATEGORIE DE DOSSIER RECU                 */00010   
  30 GNATO CHAR(2) ,     /* GROUPE DE NATOP                           */00011   
  30 NUCLI CHAR(6) ,     /* NUMERO CLIENT                             */00012   
  30 RUNFA CHAR(3) ,     /* NUMERO DE RUN DE FACTURATION              */00013   
  30 NUFAC DEC FIXED(5,0),/* NUMERO DE FACTURE                        */00014   
  30 TRIFA CHAR(1) ,     /* CODE TRI POUR GIH                         */00015   
  30 ORPRO CHAR(1) ,     /* ORIGINE PROGRAMME  1=RASSORT  2=OFFICE    */00016   
                         /* 3=CONTROLE  5=OFFREC SUR FICHIER RESULTAT */00017   
                         /* 6=OFFREC SUR FICHIER ATTENTE              */00018   
  30 NORUN CHAR(3) ,     /* NUMERO DE RUN                             */00019   
  30 LOREC FIXED DEC(5), /* LOT DE REGROUPEMENT COMMANDES             */00020   
  30 REPIE CHAR(4) ,     /* REFERENCE PIECE                           */00021   
  30 MAGTI CHAR(3) ,     /* MAGASIN DE TIRAGE                         */00022   
  30 LOTIR DEC FIXED(3), /* LOT DE TIRAGE                             */00023   
  30 MOTRA CHAR(3) ,     /* MODE DE TRANSPORT                         */00024   
  30 CATLI CHAR(1) ,     /* CATEGORIE DE LIGNE  BLANC,0,1,2,3,5       */00025   
  30 RESAI ,             /* REFERENCE SAISIE                          */00026   
   40 ANNEE CHAR(2),     /* ANNEE                                     */00027   
   40 RUN   CHAR(3),     /* NO DE RUN                                 */00028   
   40 ORIGI CHAR(2),     /* ORIGINE                                   */00029   
   40 NUMRO FIXED DEC(5),/* NUMERO D ORDRE                            */00030   
  30 NATOP CHAR(2) ,     /* NATURE OPERATION                          */00031   
  30 REDAC CHAR(1) ,     /* NUMERO DE REDACTEUR                       */00032   
  30 ECHEA CHAR(2) ,     /* CODE ECHEANCE                             */00033   
  30 IMPEC CHAR(1) ,     /* IMPOSITION D ECHEANCE                     */00034   
  30 OPSPE CHAR(1) ,     /* OPERATION SPECIALE                        */00035   
  30 QUANT FIXED DEC(7), /* QUANTITE                                  */00036   
  30 FIN CHAR(0),                                                       00037   
 /*F*/                                                                  00038   
 /*    END INCLUDE++                                                  */        
  10 FILLER CHAR(0);                                                    01319   
       DCL 1 WJOUF,                     /*   NIVEAU FACTURE           */01320   
 /*    INCLUDE++ IDDIJOUP                                             */01321   
        /* DATA SET IDDIJOUP   AT LEVEL 001 AS OF 18/02/84    */                
0/**********************************************************************00001   
 *                       ARGUMENT DE TRI DU                 D=20/10/79 *00002   
 *                       JOURNAL DE FACTURATION                        *00003   
 **********************************************************************/00004   
010  ID ,                /* ARGUMENT DE TRI                           */00005   
                         /*********************************************/00006   
  20 CODET CHAR(4) ,     /* CODE ETAT EDITION  471=JOURNAL FACTURA.   */00007   
  20 EDIPA CHAR(1) ,     /* EDITION PAPIER  1=FRANCE  2=GIH  9=NO EDIT*/00008   
  20 MACOM CHAR(3) ,     /* MAGASIN COMMERCIAL                        */00009   
  20 TRACO CHAR(1) ,     /* TRAITEMENT  COMPTABLE                     */00010   
  20 CADOR CHAR(1) ,     /* CATEGORIE DE DOSSIER RECU                 */00011   
  20 GNAT1 CHAR(2) ,     /* REGROUPEMENT DE GNATO                     */00012   
  20 GNATO CHAR(2) ,     /* GROUPE DE NATOP                           */00013   
  20 NUCLI CHAR(6) ,     /* NUMERO DE CLIENT                          */00014   
  20 RUNFA CHAR(3) ,     /* NUMERO DE RUN DE FACTURATION              */00015   
  20 NUFAC DEC FIXED(5), /* NUMERO DE LA FACTURE                      */00016   
  20 CODEN CHAR(1) ,     /* CODE ENREGISTREMENT 1=ENTET.FACTU 2=RESAI */00017   
  20 TRIFA CHAR(1) ,     /* CODE DE TRI POUR GIH                      */00018   
  20 DAMIS ,             /* DATE DE MISE A JOUR DU STOCK              */00019   
   30 DAMAA CHAR(2),     /* ANNEE                                     */00020   
   30 DAMMM CHAR(2),     /* MOIS                                      */00021   
   30 DAMJJ CHAR(2),     /* JOUR                                      */00022   
  20 NORUN CHAR(3) ,     /* NO DE RUN DE CREATION DES COENR = NORUN   */00023   
  20 LOREC DEC FIXED(5), /* LOT DE REGROUPEMENT DE COMMANDES          */00024   
  20 LINOU CHAR(1),      /* LIGNE NOUVELLE                            */00025   
  20 RESAI ,             /* REFERENCE DE SAISIE                       */00026   
   30 ANNEE CHAR(2),     /* ANNEE                                     */00027   
   30 RUN   CHAR(3),     /* NUMERO DE RUN                             */00028   
   30 ORIGI CHAR(2),     /* ORIGINE                                   */00029   
   30 NUMRO DEC FIXED(5),/* NUMERO D ORDRE                            */00030   
  20 FILLER CHAR(0),     /* LIBRE                                     */00031   
 /*    END INCLUDE++                                                  */        
 10 GS,                                 /*   ZONE DE GESTION          */01322   
 /*    INCLUDE++ IDDJOUFP                                             */01323   
        /* DATA SET IDDJOUFP   AT LEVEL 001 AS OF 18/02/84    */                
0/* ZONES DE GESTION DU JOURNAL DE FACTURATION            AU 20/10/79 */00001   
 /*********************************************************************/00002   
 /*D 01 WTJOU */                                                        00003   
020 JF,                  /* ENREGISTREMENT ENTETE FACTURE             */00004   
  30 CODET CHAR(4) ,     /* CODE ETAT EDITION   471=JOURNAL FACTURA.  */00005   
  30 CODEN CHAR(1) ,     /* CODE ENREGISTREMENT   1=ENTETE FACTURE    */00006   
  30 EDIPA CHAR(1) ,     /* EDITION PAPIER  1=CDL  2=GIH  9=NO.EDIT.  */00007   
  30 MACOM CHAR(3) ,     /* MAGASIN COMMERCIAL                        */00008   
  30 TRACO CHAR(1) ,     /* TRAITEMENT  COMPTABLE                     */00009   
  30 CADOR CHAR(1) ,     /* CATEGORIE DE DOSSIER RECU                 */00010   
  30 GNATO CHAR(2) ,     /* GROUPE DE NATOP                           */00011   
  30 NUCLI CHAR(6) ,     /* NUMERO CLIENT                             */00012   
  30 RASOC CHAR(26),     /* RAISON SOCIALE                            */00013   
  30 CPCLI CHAR(5) ,     /* CODE POSTAL                               */00014   
  30 LOBDI CHAR(26),     /* LOCALITE BUREAU DISTRIBUTEUR              */00015   
                         /* OU VILLE ETRANGER                         */00016   
  30 PAYCL CHAR(26),     /* PAYS                                      */00017   
  30 FRAET CHAR(1) ,     /*                                           */00018   
  30 RUNFA CHAR(3) ,     /* NUMERO DE RUN DE FACTURATION              */00019   
  30 NUFAC DEC FIXED(5,0),/* NUMERO DE FACTURE                        */00020   
  30 FACSP CHAR(1) ,     /* FACTURATION SPECIALE                      */00021   
  30 PEFAC CHAR(1) ,     /* PERIODICITE DE FACTURATION                */00022   
  30 ECFAC CHAR(1) ,     /* ECLATEMENT FACTURATION ETRANGER           */00023   
  30 DEPCO CHAR(2) ,     /* DEPARTEMENT COMPTABLE                     */00024   
  30 MOFOR DEC FIXED(11,2),/* MONTANT FORT                            */00025   
  30 MONET DEC FIXED(11,2),/* MONTANT NET                             */00026   
  30 MOTAX DEC FIXED(11,2),/* MONTANT TAXE                            */00027   
  30 QUANT FIXED DEC(7), /* QUANTITE                                  */00028   
  30 FIN CHAR(0),                                                       00029   
 /*F*/                                                                  00030   
 /*    END INCLUDE++                                                  */        
  10 FILLER CHAR(0);                                                    01324   
1                                       /*******************************01325   
                                        *                              *01326   
                                        *    FICHIER DES MICROFICHES   *01327   
                                        *                              *01328   
                                        *******************************/01329   
                                        /*   INCLUDE IDDIMICP         */01330   
                                        /*   INFO X(135)              */01331   
       DCL 1 WTMIC,                                                     01332   
 /*    INCLUDE++ IDDIMICP                                             */01333   
        /* DATA SET IDDIMICP   AT LEVEL 001 AS OF 18/02/84    */                
0/* ARGUMENT TRI FICHIER MICROFICHES /FMICRO/..            D=17/06/80 */00001   
 /*-------------------------------------------------------------------*/00002   
 10  ID ,                                                               00003   
  20 EDIPA CHAR(1) ,     /* CODE EDITION PAPIER  1=CDL  2=GIH         */00004   
  20 MACOM CHAR(3) ,     /* MAGASIN COMMERCIAL                        */00005   
  20 TRACO CHAR(1) ,     /* TRAITEMENT  COMPTABLE                     */00006   
  20 POREC CHAR(1) ,     /* POSTES RECLAMATIONS                       */00007   
  20 NUCLI CHAR(6) ,     /* NUMERO DE CLIENT                          */00008   
  20 GNATO CHAR(2) ,     /* GROUPE DE NATOP                           */00009   
  20 RUNFA CHAR(3) ,     /* NO DE RUN DE FACTURATION  CARTE PARAMETRE */00010   
  20 NUFAC DEC FIXED(5), /* INDICATIF DE LA FACTURE                   */00011   
  20 NULIG DEC FIXED(5), /* NUMERO DE LIGNES DANS LA FACTURE          */00012   
 /*    END INCLUDE++                                                  */        
 10 GS,                                 /*   ZONE DE GESTION          */01334   
    20 INFO CHAR(175),                                                  01335   
  10 FILLER CHAR(0);                                                    01336   
1                                       /*******************************01337   
                                        *                              *01338   
                                        *    FICHIER INDEX PAGE FACTURE*01339   
                                        *                              *01340   
                                        *******************************/01341   
                                        /*   INCLUDE IDDIPAGP         */01342   
 /*    INCLUDE++ IDDIPAGP                                             */01343   
        /* DATA SET IDDIPAGP   AT LEVEL 005 AS OF 11/02/03    */                
        /* DATA SET IDDIPAGP   AT LEVEL 005 AS OF 20/12/91    */        00001   
0/* FICHIER INDEX NOMBRE DE PAGES PAR FACTURE              D=17/12/91 */00002   
 /*-------------------------------------------------------------------*/00003   
 DCL 1 WIPAG,                                                           00004   
 10  GS ,                                /*   LONGUEUR X(050)         */00005   
  20 AUTOM CHAR(1) ,     /* A=FACTURE AUTOMATIQUE     M=MANUELLE      */00006   
  20 CLIFA CHAR(6) ,     /* NUMERO DE CLIFA                           */00007   
  20 NUCLI CHAR(6) ,     /* NUMERO DE CLIENT                          */00008   
  20 NUFAC PIC'(5)9'   , /* NUMERO DE LA FACTURE                      */00009   
  20 NBFAC DEC FIXED(5), /* NOMBRE DE FACTURES                        */00010   
  20 FOLIO DEC FIXED(15),/* NOMBRE DE FOLIOS DANS UN EXEMPLAIRE       */00011   
  20 NBPAG DEC FIXED(15),/* NOMBRE DE PAGES  DANS LA FACTURE          */00012   
  20 FRAFI CHAR(1) ,     /* EXISTENCE FRAIS FINANCIERS                */00013**4
  20 EXPOR CHAR(1) ,     /* FACTURE EXPORT OUI,NON                    */00014**5
  20 LIBRE CHAR(11);     /* DISPONIBLE                                */00015**5
 /*    END INCLUDE++                                                  */        
1                                       /*******************************01344   
                                        * FICHIER ENTETE FACTURE PCF   *01345   
                                        * AJOUT 22 01 02 YDU/YHM PCF   *01346   
                                        * INCLUDE IDDPCFEN             *01347   
                                        *******************************/01348   
 /*    INCLUDE++ IDDPCFEN                                             */01349   
        /* DATA SET IDDPCFEN   AT LEVEL 005 AS OF 12/09/07    */                
      /* IDIL _ PCF DUPLI FACTURE _ ENTETE            */                00001**5
      /*  GENERE LE 08/10/02 A 11H59 PAR YDU          */                00002**5
      DCL 01  PEN_ENTET,                                                00003**5
           02 PEN_DPCFE,                                                00004**5
          /* NUMERO CLIENT                            */                00005**5
            03 PEN_NUCLI CHAR(06),                                      00006**5
          /* NUMERO DE RUN DE FACTURATION             */                00007**5
            03 PEN_RUNFA CHAR(03),                                      00008**5
          /* NUMERO DE FACTURE                        */                00009**5
            03 PEN_NUFACX,                                              00010**5
             04 PEN_NUFAC FIXED DEC(05,0),                              00011**5
          /* DATE DE LA FACTURE IMPRIMEE              */                00012**5
            03 PEN_DAFACDIM,                                            00013**5
             04 PEN_DAFACDIMD,                                          00014**5
              05 PEN_DAFACDIMA CHAR(04)  ,                              00015**5
              05 PEN_DAFACDIMM CHAR(02)  ,                              00016**5
             04 PEN_DAFACDIMJ  CHAR(02)  ,                              00017**5
          /* CODE FOND DE PAGE SITE CENTRAL           */                00018**5
            03 PEN_COFPAGSC CHAR(08),                                   00019**5
          /* MONTANT TTC DE LA FACTURE IMPRIMEE EN EU */                00020**5
            03 PEN_MTCEUFIMX,                                           00021**5
             04 PEN_MTCEUFIM FIXED DEC(09,2),                           00022**5
          /* NOMBRE DE PAGES DE LA FACTURE IMPRIMEE   */                00023**5
            03 PEN_NBPAGFIMX,                                           00024**5
             04 PEN_NBPAGFIM FIXED BIN(15,0),                           00025**5
          /* LIBELLE DE LA FACTURE DISTRIBUTION IMPRI */                00026**5
            03 PEN_LIFACTUR CHAR(40),                                   00027**5
          /* TYPE DE FACTURE IDIL, DEMAT, PAPIER      */                00028**5
            03 PEN_TYPFA    CHAR(01),                                   00029**5
            03 PEN_XXXXX CHAR(0);                                       00030**5
 /*    END INCLUDE++                                                  */        
1                                       /*******************************01350   
                                        * FICHIER LIGNES FACTURE PCF   *01351   
                                        * AJOUT 22 01 02 YDU/YHM PCF   *01352   
                                        * INCLUDE IDDPCFLI             *01353   
                                        *******************************/01354   
 /*    INCLUDE++ IDDPCFLI                                             */01355   
        /* DATA SET IDDPCFLI   AT LEVEL 006 AS OF 25/05/04    */                
      /* IDIL _ PCF DUPLI FACTURE _ LIGNE             */                00001*64
      /*  GENERE LE 08/10/02 A 12H04 PAR YDU          */                00002*64
      DCL 01  PLI_LIGNE,                                                00003*64
           02 PLI_DPCFL,                                                00004*64
          /* NUMERO CLIENT                            */                00005*64
            03 PLI_NUCLI CHAR(06),                                      00006*64
          /* NUMERO DE RUN DE FACTURATION             */                00007*64
            03 PLI_RUNFA CHAR(03),                                      00008*64
          /* NUMERO DE FACTURE                        */                00009*64
            03 PLI_NUFACX,                                              00010*64
             04 PLI_NUFAC FIXED DEC(05,0),                              00011*64
          /* DATE DE LA FACTURE IMPRIMEE              */                00012*64
            03 PLI_DAFACDIM,                                            00013*64
             04 PLI_DAFACDIMD,                                          00014*64
              05 PLI_DAFACDIMA CHAR(04)  ,                              00015**6
              05 PLI_DAFACDIMM CHAR(02)  ,                              00016**6
             04 PLI_DAFACDIMJ  CHAR(02)  ,                              00017**6
          /* NUMERO DE PAGE FACTURE DISTRIBUTION      */                00018*64
            03 PLI_IIPAGEFDX,                                           00019*64
             04 PLI_IIPAGEFD FIXED BIN(15,0),                           00020*64
          /* NUMERO DE LIGNE DANS LA PAGE FACTURE DIS */                00021*64
            03 PLI_IILIGNFDX,                                           00022*64
             04 PLI_IILIGNFD FIXED BIN(15,0),                           00023*64
          /* CODE FOND DE PAGE SITE CENTRAL           */                00024*64
            03 PLI_COFPAGSC CHAR(08),                                   00025*64
          /* NUMERO D'ORDRE DANS LA LIGNE FACTURE DIS */                00026*64
            03 PLI_IIORLIFDX,                                           00027*64
             04 PLI_IIORLIFD FIXED BIN(15,0),                           00028*64
          /* IDENTIFIANT DE LA POLICE DE CARACTERES S */                00029*64
            03 PLI_IDPOCASC PIC'999',                                   00030**5
          /* TEXTE DE LA LIGNE FACTURE DISTRIBUTION   */                00031*64
            03 PLI_TELIGNFD,                                            00032*64
          /* FILLER X(50)                             */                00033*64
             04 PLI_FIL50_1 CHAR(50),                                   00034**4
          /* FILLER X(50)                             */                00035*64
             04 PLI_FIL50_2 CHAR(50),                                   00036**4
          /* FILLER X(50)                             */                00037*64
             04 PLI_FIL50_3 CHAR(50),                                   00038**4
          /* FILLER X(50)                             */                00039*64
             04 PLI_FIL50_4 CHAR(50),                                   00040**4
          /* FILLER X(50)                             */                00041*64
             04 PLI_FIL50_5 CHAR(50),                                   00042**4
          /* FILLER X(05)                             */                00043*64
             04 PLI_FIL05 CHAR(05),                                     00044*64
             03 PLI_XXXXX CHAR(0);                                      00045*64
 /*    END INCLUDE++                                                  */        
      DCL 01  PLI_LIGNE_R       CHAR(292) BASED (ADDR(PLI_LIGNE));      01356   
      DCL 01  PLIB_LIGNE,                                               01357   
           02 PLIB_DPCFL,                                               01358   
            03 PLIB_NUCLI       CHAR(06),                               01359   
            03 PLIB_RUNFA       CHAR(03),                               01360   
            03 PLIB_NUFACX,                                             01361   
             04 PLIB_NUFAC      FIXED DEC(05,0),                        01362   
            03 PLIB_DAFACDIM,                                           01363   
             04 PLIB_DAFACDIMD,                                         01364   
              05 PLIB_DAFACDIMA CHAR(04)  ,                             01365   
              05 PLIB_DAFACDIMM CHAR(02)  ,                             01366   
             04 PLIB_DAFACDIMJ  CHAR(02)  ,                             01367   
            03 PLIB_IIPAGEFDX,                                          01368   
             04 PLIB_IIPAGEFD   FIXED BIN(15,0),                        01369   
            03 PLIB_IILIGNFDX,                                          01370   
             04 PLIB_IILIGNFD   FIXED BIN(15,0),                        01371   
            03 PLIB_COFPAGSC    CHAR(08),                               01372   
            03 PLIB_IIORLIFDX,                                          01373   
             04 PLIB_IIORLIFD   FIXED BIN(15,0),                        01374   
            03 PLIB_IDPOCASC    PIC'999',                               01375   
            03 PLIB_TELIGNFD,                                           01376   
             04 PLIB_FIL50_1    CHAR(50),                               01377   
             04 PLIB_FIL50_2    CHAR(50),                               01378   
             04 PLIB_FIL50_3    CHAR(50),                               01379   
             04 PLIB_FIL50_4    CHAR(50),                               01380   
             04 PLIB_FIL50_5    CHAR(50),                               01381   
             04 PLIB_FIL05      CHAR(05),                               01382   
             03 PLIB_XXXXX      CHAR(0);                                01383   
      DCL 01  PLIB_LIGNE_R      CHAR(292) BASED (ADDR(PLIB_LIGNE));     01384   
      DCL 01  SAUT_LIG          DEC FIXED (5,0);                        01385   
      DCL 01  PCFLI_ECRIT       CHAR(01);                               01386   
                                                                        01387   
1                                       /*******************************01388   
                                        * FIC. INDEX BX LIVRAISON PCF  *01389   
                                        * AJOUT 22 01 02 YDU/YHM PCF   *01390   
                                        * INCLUDE IDDPCFIN             *01391   
                                        *******************************/01392   
 /*    INCLUDE++ IDDPCFIN                                             */01393   
        /* DATA SET IDDPCFIN   AT LEVEL 004 AS OF 25/05/04    */                
      /* IDIL _ PCF DUPLI FACTURE _ INDEX             */                00001*64
      /*  GENERE LE 04/10/02 A 16H53 PAR YDU          */                00002*64
      DCL 01 PIN_INDEX,                                                 00003*64
           02 PIN_DPCFI,                                                00004*64
          /* NUMERO CLIENT                            */                00005*64
            03 PIN_NUCLI CHAR(06),                                      00006*64
          /* NUMERO DE RUN DE FACTURATION             */                00007*64
            03 PIN_RUNFA CHAR(03),                                      00008*64
          /* NUMERO DE FACTURE                        */                00009*64
            03 PIN_NUFACX,                                              00010*64
             04 PIN_NUFAC FIXED DEC(05,0),                              00011*64
          /* DATE DE LA FACTURE IMPRIMEE              */                00012*64
            03 PIN_DAFACDIM,                                            00013*64
             04 PIN_DAFACDIMD,                                          00014*64
              05 PIN_DAFACDIMA CHAR(04)  ,                              00015**4
              05 PIN_DAFACDIMM CHAR(02)  ,                              00016**4
             04 PIN_DAFACDIMJ  CHAR(02)  ,                              00017**4
          /* NUMERO DE RUN                            */                00018*64
            03 PIN_NORUNX,                                              00019*64
             04 PIN_NORUN PIC'(03)9',                                   00020*64
          /* LOT DE REGROUPEMENT COMMANDES OFFICE OU  */                00021*64
            03 PIN_IILOREXP CHAR(05),                                   00022*64
            03 PIN_XXXXX CHAR(0);                                       00023*64
 /*    END INCLUDE++                                                  */        
1                                       /*******************************01394   
                                        *    FICHIER AUTO CONTROLE     *01395   
                                        *******************************/01396   
       DCL   ZONCTL           CHAR (80) EXTERNAL;                       01397   
       DCL 1 MACFA            EXTERNAL  ,                               01398   
 /*    INCLUDE++ MACID1DP                                             */01399   
        /* DATA SET MACID1DP   AT LEVEL 002 AS OF 23/02/11    */                
 /* IDENTIF ENREGISTREMENT AUTO-CONTROLE D=79/02/20 V2 */               00001240
 /*----------------------------------------------------*/               00002240
010 ID,                                                                 00003240
  20 COMVT CHAR(1),       /* CODE MVT = D OU R                        */00004240
  20 CTRUN CHAR(2),       /* NOMBRE DE RUN/FICHIER                    */00005240
  20 CTDEB CHAR(2),       /* NOMBRE DE MVT/MACRUN                     */00006240
  20 NORUN CHAR(3),       /* NUMERO DE RUN (INIT. DANS MACRUN)        */00007240
  20 SQRUN CHAR(1),       /* SEQUENCE RUN (REPRISE )                  */00008240
  20 DATCP,               /* DATE CARTE PARAMETRE (INIT. DANS MACRUN) */00009240
   30 AA   CHAR(2),                                                     00010240
   30 MM   CHAR(2),                                                     00011240
   30 JJ   CHAR(2),                                                     00012240
  20 DATED,               /* DATE DEBUT DE PHASE (ORDINATEUR)         */00013240
   30 AA   CHAR(2),                                                     00014240
   30 MM   CHAR(2),                                                     00015240
   30 JJ   CHAR(2),                                                     00016240
  20 HEURD,               /* HEURE DEBUT TRAITEMENT                   */00017240
   30 HH   CHAR(2),                                                     00018240
   30 MM   CHAR(2),                                                     00019240
   30 SS   CHAR(2),                                                     00020240
   30 MI   CHAR(3),                                                     00021240
  20 DATEF,               /* DATE FIN DE PHASE(ORDINATEUR)            */00022240
   30 AA   CHAR(2),                                                     00023240
   30 MM   CHAR(2),                                                     00024240
   30 JJ   CHAR(2),                                                     00025240
  20 HEURF,               /* HEURE FIN DE PHASE                       */00026240
   30 HH   CHAR(2),                                                     00027240
   30 MM   CHAR(2),                                                     00028240
   30 SS   CHAR(2),                                                     00029240
   30 MI   CHAR(3),                                                     00030240
  20 NOPHA CHAR(8),       /* NOM DE PHASE (A INITIALISER)             */00031240
  20 SQPHA CHAR(1),       /* SEQUENCE PHASE (REPRISE)                 */00032240
  20 INF01 FIXED DEC(5),  /* NOMBRE DE MESSAGES DE NIVEAU 1           */00033240
  20 INF02 FIXED DEC(5),  /* NOMBRE DE MESSAGES DE NIVEAU 2           */00034240
  20 ANO03 FIXED DEC(5),  /* NOMBRE DE MESSAGES DE NIVEAU 3           */00035240
  20 ANO04 FIXED DEC(5),  /* NOMBRE DE MESSAGES DE NIVEAU 4           */00036240
  20 ERLOG CHAR(1),       /* ERREUR LOGIQUE                           */00037240
  20 ERFAT CHAR(1),       /* ERREUR FATALE                            */00038240
  20 COCTL CHAR(1),       /* NOMBRE MAXIMUM DE MESSAGES (=1)          */00039240
  20 NBCTL FIXED DEC(5),  /* NB MESSAGES ECRITS  SUR F.AUTO-CTL       */00040240
  20 LGDON FIXED DEC(3),  /* LONGUEUR DES DONNEES (A INITIALISER)     */00041240
  20 FILXX CHAR(06),      /* NON UTILISE                              */00042240
 /*    END INCLUDE++                                                  */        
 10 GS,                                                                 01400   
  20 NBLUS DEC FIXED (7,0),             /*   NBRE MOUVEMENTS EN ENTREE*/01401   
  20 NBGIH DEC FIXED (7,0),             /*   NBRE FACTURES GIH EDITEES*/01402   
  20 NBCRD DEC FIXED (7,0),             /*   NBRE FACTURES CRD EDITEES*/01403   
  20 NBCDL DEC FIXED (7,0),             /*   NBRE FACTURES CDL EDITEES*/01404   
  20 NBMIC DEC FIXED (7,0),             /*   NBRE MVTS MICROFICHES    */01405   
  20 NBANO DEC FIXED (7,0),             /*   NBRE MVTS ERRONES        */01406   
  20 NBBOR DEC FIXED (7,0),             /*   NBRE BORDEREAUX COMPTANTS*/01407   
  20 NBJOU DEC FIXED (7,0),             /*   NBRE MVTS JOURNAL FACT.  */01408   
  20 NBRES DEC FIXED (7,0);             /*   NBRE MVTS RESULTATS FACT.*/01409   
1                                       /*******************************01410   
                                        *    FICHIER HISTORIQUE ACCORD *01411   
                                        *******************************/01412   
       DCL 1 FHACC,                                                     01413   
 /*    INCLUDE++ IDDHACCP                                             */01414   
        /* DATA SET IDDHACCP   AT LEVEL 005 AS OF 03/07/96    */                
        /************************************/                          00001**4
        /*       AJOUT LE 17/05/96          */                          00002**4
        /*  COPY FICHIER HISTORIQUE ACCORD  */                          00003**3
        /************************************/                          00004**3
   10 ID,                                                               00005**2
    20 NUCLI   CHAR(6),                                                 00006**2
    20 SYPRO   CHAR(2),                                                 00007**2
    20 AFFIL   CHAR(2),                                                 00008**2
    20 DAFAC,                                                           00009**2
     30 AAAA   CHAR(4),                                                 00010**2
     30 MM     CHAR(2),                                                 00011**2
     30 JJ     CHAR(2),                                                 00012**2
    20 ACCOR   CHAR(11),                                                00013**2
    20 FORTC   DEC FIXED (15,2),                                        00014**5
    20 FORHT   DEC FIXED (15,2),                                        00015**5
    20 NETTC   DEC FIXED (15,2),                                        00016**5
    20 NETHT   DEC FIXED (15,2),                                        00017**5
    20 FILLER  CHAR(09);                                                00018**5
 /*    END INCLUDE++                                                  */        
-      DCL 1 DESTI            EXTERNAL,                                 01415   
 /*    INCLUDE++ MACDS1D3                                             */01416   
        /* DATA SET MACDS1D3   AT LEVEL 002 AS OF 30/09/09    */                
 /* OBJET CREE PAR : WAM      LE 30/09/09 A 14:26:47        */          00001   
 /* PARAMETRE AUTOCONTROLE / VERSION AMODE31                */          00002   
0/*-----------------------------------------------------*/              00003**2
0/* PARAMETRE DESTINATION POUR AUTO-CONTROLE            */              00004**2
 /* POINTS D'ENTREE DANS MACMES3                        */              00005**2
 /* VERSION ADDRESSING MODE 31                          */              00006**2
 /*-----------------------------------------------------*/              00007**2
   20 MAE    CHAR(1) INIT('2'), /* CODE DE CONTROLE ECRITURE MAE    */  00008**2
   20 SYSLST CHAR(1) INIT('1'), /* CODE DE CONTROLE ECRITURE SYSLST */  00009**2
   20 CTL    CHAR(1) INIT('1'), /* CODE DE CONTROLE ECRITURE  FAUTO */  00010**2
   20 TRA    CHAR(1) INIT('0'), /* CONTROLE CLE. 0=TRA. 1=FAUTO     */  00011**2
   20 XXX    CHAR(6) INIT(' ');                                         00012**2
0DCL (MACRUN3, /* MACRUN3(DESTI,E.A.U)                              */  00013**2
      MACDEB3, /* MACDEB3(DESTI,E.A.U)                              */  00014**2
      MACMES3, /* MACDEB3(DESTI,CLASSE,MESSAGE)                     */  00015**2
      MACFIN3) /* MACFIN3(DESTI,E.A.U.)                             */  00016**2
  ENTRY OPTIONS (ASM INTER);                                            00017**2
0DCL (MACLIR3, /* MACLIR3(DESTI,POINTEUR,CLE) * CLE EN FIXED BIN(31)*/  00018**2
      MACECR3) /* MACLIR3(DESTI,POINTEUR,CLE) * CLE EN FIXED BIN(31)*/  00019**2
  ENTRY(,,FIXED BIN(31)) OPTIONS (ASM INTER);                           00020**2
 /*    END INCLUDE++                                                  */        
-      DCL 1 ZCTL1,                                                     01417   
             2 FIL1           CHAR (6)  INIT ((6)' '),                  01418   
             2 CPTR           PIC'Z.ZZZ.ZZ9',                           01419   
             2 FIL2           CHAR (65) INIT ((65)' ');                 01420   
-      DCL 1 ZCTL2,                                                     01421   
             2 FIL1           CHAR (5)  INIT ((5)' '),                  01422   
             2 CPTR           PIC'ZZ.ZZZ.ZZ9',                          01423   
             2 FIL2           CHAR (65) INIT ((65)' ');                 01424   
1                                       /*******************************01425   
                                        *                              *01426   
                                        *    TABLES                    *01427   
                                        *                              *01428   
                                        *******************************/01429   
 /*    INCLUDE++ TABREF3                                              */01430   
        /* DATA SET TABREF3    AT LEVEL 004 AS OF 23/06/10    */                
 /* OBJET CREE PAR : WAM      LE 02/11/09 A 09:43:41        */          00001   
 /* PARAMETRE BIBTAB / VERSION AMODE31                      */          00002   
 /* DEFINITION DE TABLE DE REFERENCE                        */          00003**3
  DCL (CHTBOP3,CHTBSE3,CHTBGB3,CHTBCL3) ENTRY OPTIONS (ASM INTER) ;     00004**3
      DCL 1  TABREF3 STATIC,                                            00005**4
           2 ID   ,                                                     00006**2
           3 NUTAB FIXED BIN(31)  INIT(0),   /*NUMERO DE LA TABLE*PROG*/00007**2
           3 LGMAX FIXED BIN(31)  INIT(0),   /* LG MAXI DE CHARG.*PROG*/00008**2
           3 INDCH FIXED BIN (31) INIT(0),   /*NB ELEMENT CHARGES*SYST*/00009**2
           3 CODER FIXED BIN(15)  INIT(0),   /*CODE ERREUR       *SYST*/00010**2
           3 LGINF FIXED BIN(15)  INIT(0),   /*LG ELEMENT CHARGE *SYST*/00011**2
           3 DTFTB CHAR (80)      INIT('');  /*RESERVE AU SYSTEME*SYST*/00012**2
 /*    END INCLUDE++                                                  */        
       DCL   PTRET            PTR EXT;                                  01431   
       DCL   PTRBIN           FIXED BIN (31) BASED(P);                  01432   
             P                = ADDR(PTRET);                            01433   
0                                       /*   DEF. CLES DE RECHERCHE   */01434   
       DCL   CLE7             CHAR (7)  EXT;                            01435   
       DCL   CLE5             CHAR (5)  EXT;                            01436   
       DCL   CLE4             CHAR (4)  EXT;                            01437   
       DCL   CLE3             CHAR (3)  EXT;                            01438   
       DCL   CLE2             CHAR (2)  EXT;                            01439   
       DCL   CLE1             CHAR (1)  EXT;                            01440   
       DCL   CLE2NUM          PIC'99'   BASED(PCLE2);                   01441   
             PCLE2            = ADDR(CLE2);                             01442   
       DCL   (PCLE2)          PTR;                                      01443   
       DCL   (PTRCLE7,PTRCLE5,PTRCLE4,PTRCLE3,PTRCLE2,PTRCLE1) PTR EXT; 01444   
             PTRCLE7          = ADDR(CLE7);                             01445   
             PTRCLE5          = ADDR(CLE5);                             01446   
             PTRCLE4          = ADDR(CLE4);                             01447   
             PTRCLE3          = ADDR(CLE3);                             01448   
             PTRCLE2          = ADDR(CLE2);                             01449   
             PTRCLE1          = ADDR(CLE1);                             01450   
0      DCL 1 TBVENET          EXT,      /*   VENTILATION EXPLOITATION */01451   
             2 ID             LIKE TABREF3.ID,                          01452   
             2 FORMA(3)       CHAR (15) INIT ('VENET,X=2',              01453   
                                              'LVENE,X=10',             01454   
                                              'FINFORMAT');             01455   
       DCL   TBVENE(TBVENET.INDCH + 1)  CHAR (12) CONTROLLED EXT;       01456   
       DCL 1 ZTBVENET(50)     BASED(PVENET),                            01457   
             2 VENET          CHAR (2),                                 01458   
             2 LVENE          CHAR (10);                                01459   
       DCL   WTBVENET         LIKE ZTBVENET  BASED(PTRET);              01460   
       DCL   PVENET           PTR  EXT;                                 01461   
       DCL   LPVENET          FIXED BIN (15) EXT,                       01462   
             LEVENET          FIXED BIN (15) EXT,                       01463   
             NBVENET          FIXED BIN (15) EXT;                       01464   
0      DCL 1 TBTRANS          EXT,      /*   STAT. TRANSPORTS GIH     */01465   
             2 ID             LIKE TABREF3.ID,                          01466   
             2 FORMA(4)       CHAR (15) INIT ('STRET,X=1',              01467   
                                              'SPENV,X=2',              01468   
                                              'TRANS,X=1',              01469   
                                              'FINFORMAT');             01470   
       DCL   TBTRAN(TBTRANS.INDCH + 1)  CHAR (4) CONTROLLED EXT;        01471   
       DCL 1 ZTBTRANS(100)    BASED(PTRANS),                            01472   
             2 STRET          CHAR (1),                                 01473   
             2 SPENV          CHAR (2),                                 01474   
             2 TRANS          CHAR (1);                                 01475   
       DCL   WTBTRANS         LIKE ZTBTRANS  BASED(PTRET);              01476   
       DCL   PTRANS           PTR  EXT;                                 01477   
       DCL   LPTRANS          FIXED BIN (15) EXT,                       01478   
             LETRANS          FIXED BIN (15) EXT,                       01479   
             NBTRANS          FIXED BIN (15) EXT;                       01480   
0      DCL 1 TBLIFAC          EXT,      /*   TRACO GNATO              */01481   
             2 ID             LIKE TABREF3.ID,                          01482   
             2 FORMA(7)       CHAR (15) INIT ('GNATO,X=2',              01483   
                                              'TRACO,X=1',              01484   
                                              'NATOP,X=2',              01485   
                                              'LIDOC,X=20',             01486   
                                              'LGNAT,X=20',             01487   
                                              'TYPFA,X=3',              01488   
                                              'FINFORMAT');             01489   
       DCL   TBLIFA(TBLIFAC.INDCH + 1)  CHAR (48) CONTROLLED EXT;       01490   
       DCL 1 ZTBLIFAC(300)    BASED(PLIFAC),                            01491   
             2 GNATO          CHAR (2),                                 01492   
             2 TRACO          CHAR (1),                                 01493   
             2 NATOP          CHAR (2),                                 01494   
             2 LIDOC          CHAR (20),                                01495   
             2 LGNAT          CHAR (20),                                01496   
             2 TYPFA          CHAR (3);                                 01497   
                                                                        01498   
                                                                        01499   
       DCL   WTBLIFAC         LIKE ZTBLIFAC  BASED(PTRET);              01500   
       DCL   PLIFAC           PTR  EXT;                                 01501   
       DCL   LPLIFAC          FIXED BIN (15) EXT,                       01502   
             LELIFAC          FIXED BIN (15) EXT,                       01503   
             NBLIFAC          FIXED BIN (15) EXT;                       01504   
0      DCL 1 TBOPSPE          EXT,      /*   OPERATIONS SPECIALES     */01505   
             2 ID             LIKE TABREF3.ID,                          01506   
             2 FORMA(3)       CHAR (15) INIT ('OPSPE,X=1',              01507   
                                              'LISPE,X=15',             01508   
                                              'FINFORMAT');             01509   
       DCL   TBOPSP(TBOPSPE.INDCH + 1)  CHAR (16) CONTROLLED EXT;       01510   
       DCL 1 ZTBOPSPE(40)     BASED(POPSPE),                            01511   
             2 OPSPE          CHAR (1),                                 01512   
             2 LISPE          CHAR (15);                                01513   
       DCL   WTBOPSPE         LIKE ZTBOPSPE  BASED(PTRET);              01514   
       DCL   POPSPE           PTR  EXT;                                 01515   
       DCL   LPOPSPE          FIXED BIN (15) EXT,                       01516   
             LEOPSPE          FIXED BIN (15) EXT,                       01517   
             NBOPSPE          FIXED BIN (15) EXT;                       01518   
0      DCL 1 TBNUDIV          EXT,      /*   EDITEUR DIVISION         */01519   
             2 ID             LIKE TABREF3.ID,                          01520   
             2 FORMA(4)       CHAR (15) INIT ('NUEDI,X=3',              01521   
                                              'NUDIV,X=2',              01522   
                                              'LIDIV,X=15',             01523   
                                              'FINFORMAT');             01524   
       DCL   TBNUDI(TBNUDIV.INDCH + 1)  CHAR (20) CONTROLLED EXT;       01525   
       DCL 1 ZTBNUDIV(5000)   BASED(PNUDIV),                            01526   
             2 NUEDI          CHAR (3),                                 01527   
             2 NUDIV          CHAR (2),                                 01528   
             2 LIDIV          CHAR (15);                                01529   
       DCL   WTBNUDIV         LIKE ZTBNUDIV  BASED(PTRET);              01530   
       DCL   PNUDIV           PTR  EXT;                                 01531   
       DCL   LPNUDIV          FIXED BIN (15) EXT,                       01532   
             LENUDIV          FIXED BIN (15) EXT,                       01533   
             NBNUDIV          FIXED BIN (15) EXT;                       01534   
0      DCL 1 TBCOTAX          EXT,      /*   CODE TAXE                */01535   
             2 ID             LIKE TABREF3.ID,                          01536   
             2 FORMA(6)       CHAR (15) INIT ('COTAX,X=1',              01537   
                                              'TOLEG,X=7',              01538   
                                              'TORE3,X=7',              01539   
                                              'TORE5,X=7',              01540   
                                              'TORE7,X=7',              01541   
                                              'FINFORMAT');             01542   
       DCL   TBCOTA(TBCOTAX.INDCH + 1)  CHAR (29) CONTROLLED EXT;       01543   
       DCL 1 ZTBCOTAX(40)     BASED(PCOTAX),                            01544   
             2 COTAX          CHAR (1),                                 01545   
             2 TOLEG          PIC'999V9999',                            01546   
             2 TORE3          PIC'999V9999',                            01547   
             2 TORE5          PIC'999V9999',                            01548   
             2 TORE7          PIC'999V9999';                            01549   
       DCL   WTBCOTAX         LIKE ZTBCOTAX  BASED(PTRET);              01550   
       DCL   PCOTAX           PTR  EXT;                                 01551   
       DCL   LPCOTAX          FIXED BIN (15) EXT,                       01552   
             LECOTAX          FIXED BIN (15) EXT,                       01553   
             NBCOTAX          FIXED BIN (15) EXT;                       01554   
0      DCL 1 TBECFAC          EXT,      /*   ECLATEMENT FACTURATION   */01555   
             2 ID             LIKE TABREF3.ID,                          01556   
             2 FORMA(3)       CHAR (15) INIT ('ECFAC,X=1',              01557   
                                              'LECFA,X=15',             01558   
                                              'FINFORMAT');             01559   
       DCL   TBECFA(TBECFAC.INDCH + 1)  CHAR (16) CONTROLLED EXT;       01560   
       DCL 1 ZTBECFAC(40)     BASED(PECFAC),                            01561   
             2 ECFAC          CHAR (1),                                 01562   
             2 LECFA          CHAR (15);                                01563   
       DCL   WTBECFAC         LIKE ZTBECFAC  BASED(PTRET);              01564   
       DCL   PECFAC           PTR  EXT;                                 01565   
       DCL   LPECFAC          FIXED BIN (15) EXT,                       01566   
             LEECFAC          FIXED BIN (15) EXT,                       01567   
             NBECFAC          FIXED BIN (15) EXT;                       01568   
0      DCL 1 TBACRDL          EXT,      /*   MAGASINS CRDL            */01569   
             2 ID             LIKE TABREF3.ID,                          01570   
             2 FORMA(6)       CHAR (15) INIT ('NCRDL,X=3',              01571   
                                              'NOCRD,X=50',             01572   
                                              'ADCRD,X=50',             01573   
                                              'VICRD,X=50',             01574   
                                              'RCCRD,X=50',             01575   
                                              'FINFORMAT');             01576   
       DCL   TBACRD(TBACRDL.INDCH + 1)  CHAR (203) CONTROLLED EXT;      01577   
       DCL 1 ZTBACRDL(100)    BASED(PNCRDL),                            01578   
             2 NCRDL          CHAR (3),                                 01579   
             2 NOCRD          CHAR (50),                                01580   
             2 ADCRD          CHAR (50),                                01581   
             2 VICRD          CHAR (50),                                01582   
             2 RCCRD          CHAR (50);                                01583   
       DCL   WTBACRDL         LIKE ZTBACRDL  BASED(PTRET);              01584   
       DCL   PNCRDL           PTR  EXT;                                 01585   
       DCL   LPNCRDL          FIXED BIN (15) EXT,                       01586   
             LENCRDL          FIXED BIN (15) EXT,                       01587   
             NBNCRDL          FIXED BIN (15) EXT;                       01588   
0      DCL 1 TBECHEA          EXT,      /*   ECHEANCES                */01589   
             2 ID             LIKE TABREF3.ID,                          01590   
             2 FORMA(4)       CHAR (15) INIT ('ECHEA,X=2',              01591   
                                              'ECHAN,X=2',              01592   
                                              'LECHE,X=15',             01593   
                                              'FINFORMAT');             01594   
       DCL   TBECHE(TBECHEA.INDCH + 1)  CHAR (19) CONTROLLED EXT;       01595   
       DCL 1 ZTBECHEA(100)    BASED(PECHEA),                            01596   
             2 ECHEA          CHAR (2),                                 01597   
             2 ECHAN          CHAR (2),                                 01598   
             2 LECHE          CHAR (15);                                01599   
       DCL   WTBECHEA         LIKE ZTBECHEA  BASED(PTRET);              01600   
       DCL   PECHEA           PTR  EXT;                                 01601   
       DCL   LPECHEA          FIXED BIN (15) EXT,                       01602   
             LEECHEA          FIXED BIN (15) EXT,                       01603   
             NBECHEA          FIXED BIN (15) EXT;                       01604   
0      DCL 1 TBMOREG          EXT,      /*   MODE DE REGLEMENT        */01605   
             2 ID             LIKE TABREF3.ID,                          01606   
             2 FORMA(4)       CHAR (15) INIT ('MOREG,X=2',              01607   
                                              'LMORE,X=20',             01608   
                                              'COPAE,X=2',              01609   
                                              'FINFORMAT');             01610   
       DCL   TBMORE(TBMOREG.INDCH + 1)  CHAR (24) CONTROLLED EXT;       01611   
       DCL 1 ZTBMOREG(100)    BASED(PMOREG),                            01612   
             2 MOREG          CHAR (2),                                 01613   
             2 LMORE          CHAR (20),                                01614   
             2 COPAE          CHAR (2);                                 01615   
       DCL   WTBMOREG         LIKE ZTBMOREG  BASED(PTRET);              01616   
       DCL   PMOREG           PTR  EXT;                                 01617   
       DCL   LPMOREG          FIXED BIN (15) EXT,                       01618   
             LEMOREG          FIXED BIN (15) EXT,                       01619   
             NBMOREG          FIXED BIN (15) EXT;                       01620   
0      DCL 1 TBCADOR          EXT,      /*   CATEGORIE DOSSIER RECU   */01621   
             2 ID             LIKE TABREF3.ID,                          01622   
             2 FORMA(4)       CHAR (15) INIT ('CADOR,X=1',              01623   
                                              'LCADO,X=15',             01624   
                                              'LSCAD,X=5',              01625   
                                              'FINFORMAT');             01626   
       DCL   TBCADO(TBCADOR.INDCH + 1)  CHAR (21) CONTROLLED EXT;       01627   
       DCL 1 ZTBCADOR(40)     BASED(PCADOR),                            01628   
             2 CADOR          CHAR (1),                                 01629   
             2 LCADO          CHAR (15),                                01630   
             2 LSCAD          CHAR (5);                                 01631   
       DCL   WTBCADOR         LIKE ZTBCADOR  BASED(PTRET);              01632   
       DCL   PCADOR           PTR  EXT;                                 01633   
       DCL   LPCADOR          FIXED BIN (15) EXT,                       01634   
             LECADOR          FIXED BIN (15) EXT,                       01635   
             NBCADOR          FIXED BIN (15) EXT;                       01636   
0      DCL 1 TBDEPAY          EXT,      /*   PAYS GIH ASSIMILES FRANCE*/01637   
             2 ID             LIKE TABREF3.ID,                          01638   
             2 FORMA(6)       CHAR (15) INIT ('FRAET,X=1',              01639   
                                              'DEPAY,X=3',              01640   
                                              'REPRI,X=1',              01641   
                                              'DISAU,X=1',              01642   
                                              'PYDOU,X=2',              01643   
                                              'FINFORMAT');             01644   
       DCL   TBDEPA(TBDEPAY.INDCH + 1)  CHAR (8) CONTROLLED EXT;        01645   
       DCL 1 ZTBDEPAY(40)     BASED(PDEPAY),                            01646   
             2 FRAET          CHAR (1),                                 01647   
             2 DEPAY          CHAR (3),                                 01648   
             2 REPRI          CHAR (1),                                 01649   
             2 DISAU          CHAR (1),                                 01650   
             2 PYDOU          CHAR (2);                                 01651   
       DCL   WTBDEPAY         LIKE ZTBDEPAY  BASED(PTRET);              01652   
       DCL   PDEPAY           PTR  EXT;                                 01653   
       DCL   LPDEPAY          FIXED BIN (15) EXT,                       01654   
             LEDEPAY          FIXED BIN (15) EXT,                       01655   
             NBDEPAY          FIXED BIN (15) EXT;                       01656   
0      DCL 1 TBZONTI          EXT,      /*   ZONE DE TIRAGE           */01657   
             2 ID             LIKE TABREF3.ID,                          01658   
             2 FORMA(3)       CHAR (15) INIT ('ZONTI,X=1',              01659   
                                              'LIZTI,X=6',              01660   
                                              'FINFORMAT');             01661   
       DCL   TBZONT(TBZONTI.INDCH + 1)  CHAR (7)  CONTROLLED EXT;       01662   
       DCL 1 ZTBZONTI(40)     BASED(PZONTI),                            01663   
             2 ZONTI          CHAR (1),                                 01664   
             2 LIZTI          CHAR (6);                                 01665   
       DCL   WTBZONTI         LIKE ZTBZONTI  BASED(PTRET);              01666   
       DCL   PZONTI           PTR  EXT;                                 01667   
       DCL   LPZONTI          FIXED BIN (15) EXT,                       01668   
             LEZONTI          FIXED BIN (15) EXT,                       01669   
             NBZONTI          FIXED BIN (15) EXT;                       01670   
0      DCL 1 TBEDICO          EXT,      /*   EDITEUR COLLECTION       */01671   
             2 ID             LIKE TABREF3.ID,                          01672   
             2 FORMA(7)       CHAR (15) INIT ('NUEDI,X=3',              01673   
                                              'NUDIV,X=2',              01674   
                                              'NUCOL,X=2',              01675   
                                              'COSUM,X=1',              01676   
                                              'LICOL,X=30',             01677   
                                              'FILLER,L=15',            01678   
                                              'FINFORMAT');             01679   
       DCL   TBEDIC(TBEDICO.INDCH + 1)  CHAR (53) CONTROLLED EXT;       01680   
       DCL 1 ZTBEDICO(1000)   BASED(PEDICO),                            01681   
             2 NUEDI          CHAR (3),                                 01682   
             2 NUDIV          CHAR (2),                                 01683   
             2 NUCOL          CHAR (2),                                 01684   
             2 COSUM          CHAR (1),                                 01685   
             2 LICOL          CHAR (30),                                01686   
             2 LIDIV          CHAR (15);                                01687   
       DCL   WTBEDICO         LIKE ZTBEDICO  BASED(PTRET);              01688   
       DCL   PEDICO           PTR  EXT;                                 01689   
       DCL   LPEDICO          FIXED BIN (15) EXT,                       01690   
             LEEDICO          FIXED BIN (15) EXT,                       01691   
             NBEDICO          FIXED BIN (15) EXT;                       01692   
0      DCL 1 TBFASUC          EXT,      /*   MAGASINS CRDL            */01693   
                                        /*   SUCCES YOUPIE 01.09.87   */01694   
             2 ID             LIKE TABREF3.ID,                          01695   
             2 FORMA(6)       CHAR (15) INIT ('NCRDL,X=3',              01696   
                                              'NOCRD,X=50',             01697   
                                              'ADCRD,X=50',             01698   
                                              'VICRD,X=50',             01699   
                                              'RCCRD,X=50',             01700   
                                              'FINFORMAT');             01701   
       DCL   TBFASU(TBFASUC.INDCH + 1)  CHAR (203) CONTROLLED EXT;      01702   
       DCL 1 ZTBFASUC(100)    BASED(PFASUC),                            01703   
             2 NCRDL          CHAR (3),                                 01704   
             2 NOCRD          CHAR (50),                                01705   
             2 ADCRD          CHAR (50),                                01706   
             2 VICRD          CHAR (50),                                01707   
             2 RCCRD          CHAR (50);                                01708   
       DCL   WTBFASUC         LIKE ZTBFASUC  BASED(PTRET);              01709   
       DCL   PFASUC           PTR  EXT;                                 01710   
       DCL   LPFASUC          FIXED BIN (15) EXT,                       01711   
             LEFASUC          FIXED BIN (15) EXT,                       01712   
             NBFASUC          FIXED BIN (15) EXT;                       01713   
-      DCL 01 TBNUEDIF,                 /*   TBNUEDI 1305             */01714   
0         02  ID              LIKE TABREF3.ID,                          01715   
0         02  FORMAT(03)      CHAR(15) INIT('NUEDI,X=3',                01716   
                                            'LIEDI,X=15',               01717   
                                            'FINFORMAT');               01718   
0      DCL TBNUEDIC(TBNUEDIF.INDCH+1) CHAR (18) CTL;                    01719   
       DCL PDNUEDI            PTR;                                      01720   
0      DCL 01 TBNUEDIT(10000) BASED (PDNUEDI),                          01721   
           02 NUEDI           CHAR(3),                                  01722   
           02 LIEDI           CHAR(15);                                 01723   
       DCL   INDTAB           BIN FIXED(15);                            01724   
       DCL   SV_NUEDI         CHAR(3);                                  01725   
       DCL   SV_NUDIV5        CHAR(5);                                  01726   
       DCL   SV_LIEDI         CHAR(15);                                 01727   
       DCL   SV_LIDIV         CHAR(15);                                 01728   
0      DCL   WLSCAD           CHAR (5)  EXT,                            01729   
             WNOCRD           CHAR (50) EXT,                            01730   
             WADCRD           CHAR (50) EXT,                            01731   
             WVICRD           CHAR (50) EXT,                            01732   
             WRCCRD           CHAR (50) EXT,                            01733   
             WLVENE           CHAR (10) EXT,                            01734   
             WLECFA           CHAR (15) EXT,                            01735   
             WLIDOC           CHAR (20) EXT,                            01736   
             WLGNAT           CHAR (20) EXT,                            01737   
             WLIZTI           CHAR (6)  EXT,                            01738   
             WLISPE           CHAR (15) EXT,                            01739   
             WLECHE           CHAR (15) EXT,                            01740   
             WECHAN           CHAR (2)  EXT,                            01741   
             WLICOL           CHAR (30) EXT,                            01742   
             WLIDIV           CHAR (15) EXT,                            01743   
             WTOLEG           CHAR (6)  EXT,                            01744   
             WTRANS           CHAR (1)  EXT,                            01745   
             WNUFAC           DEC FIXED (5,0) EXT,                      01746   
             WEREUR           CHAR (1)  EXT,                            01747   
             WNOANO           CHAR (1)  EXT,                            01748   
             WTABLE           CHAR (1)  EXT;                            01749   
       DCL   WREPRI           CHAR (1)  EXT;                            01750   
       DCL   WDISAU           CHAR (1)  EXT;                            01751   
       DCL   WPYDOU           CHAR (2)  EXT;                            01752   
       DCL   WPOFIS           CHAR (1)  EXT;                            01753   
       DCL   WTYPFA           CHAR (3)  EXT;                            01754   
       DCL   WCOPAE           CHAR (2)  EXT;                            01755   
0                                       /*   NBRE MVTS JOURNAL SUCCES */01756   
       DCL   WNBJSU           FIXED DEC (15,0) EXT ;                    01757   
                                        /*   NBRE BORDEREAUX SUCCES   */01758   
       DCL   WNBBSU           FIXED DEC (15,0) EXT ;                    01759   
                                        /*   PRESENCE MVTS DEPCO=10   */01760   
       DCL   WSUCCES          CHAR (1)         EXT ;                    01761   
                                        /*   NBRE MVTS JOURNAL GHI    */01762   
       DCL   WNBJGH           FIXED DEC (15,0) EXT ;                    01763   
       DCL   WNBJMD           FIXED DEC (15,0) EXT ;   /* SPOOL7 -    */01764   
       DCL   WNBFEA           FIXED DEC (15,0) EXT ;   /* SP7 EXPO AUT*/01765   
1                                       /*******************************01766   
                                        *                              *01767   
                                        *    TABLES MTAB               *01768   
                                        *                              *01769   
                                        *******************************/01770   
       DCL  MTABCHG  ENTRY OPTIONS(ASM INTER);                          01771   
                                                                        01772   
                                        /*   MERNUCLI                 */01773   
       DCL 1  MTAB01,                                                   01774   
           2  NOMTAB    CHAR(8)         INIT('MERNUCLI'),               01775   
           2  ADZTAB    PTR,                                            01776   
           2  LONGTAB   BIN FIXED(31,0) INIT(0),                        01777   
           2  NBPOSTE   BIN FIXED(31,0) INIT(0),                        01778   
           2  CODER     BIN FIXED(31,0) INIT(0),                        01779   
           2  LGPOSTE   BIN FIXED(31,0) INIT(0),                        01780   
           2  OPEDIT    BIN FIXED(31,0) INIT(0),  /* OPTION EDITION */  01781   
           2  SELECT(3) CHAR(5) INIT('NUCLI','LIBEL','FINTB');          01782   
       DCL  DEFPTR1     BIN FIXED(31) BASED(ADDR(MTAB01.ADZTAB));       01783   
       DEFPTR1 = - 1;                                                   01784   
       DCL 1 TABCHAR1     BASED(MTAB01.ADZTAB),                         01785   
           2 MT_POSTE     DEC FIXED(3),                                 01786   
           2 MT_MERNUCLI  (MTAB01.NBPOSTE REFER(TABCHAR1.MT_POSTE)),    01787   
            3 MT1_NUCLI   CHAR(6),                                      01788   
            3 MT1_LIBEL   CHAR(20);                                     01789   
                                                                        01790   
       DCL   I_MERNUCLI   DEC FIXED(5) INIT(0);                         01791   
       DCL   NBP_MERNUCLI DEC FIXED(5);                                 01792   
                                                                        01793   
1                                       /*******************************01794   
                                        *                              *01795   
                                        *    TABLES SPITAB             *01796   
                                        *                              *01797   
                                        *******************************/01798   
                                                                        01799   
      /*************************************/                           01800   
      /*    TABLE DES MESSAGES ENT FACTURES/*                           01801   
      /*************************************/                           01802   
      DCL 1 CDLFACMB,                                                   01803   
            2 NUSEQ      CHAR(3),                                       01804   
            2 LIBE1      CHAR(50),                                      01805   
            2 LIBE2      CHAR(50),                                      01806   
            2 LIBE3      CHAR(15);                                      01807   
                                                                        01808   
 /*    INCLUDE++ IDDFACMP               /* TABLE DES LIBELLES FACTURE */01809   
        /* DATA SET IDDFACMP   AT LEVEL 006 AS OF 23/09/98    */                
 /* OBJET CREE PAR:YDV      LE:23/09/98 A 09:46:19          */          00001   
 /* SPITAB CDLFACM TABLE LIBELLE FACTURE                    */          00002   
      /* SPITAB CDLFACM LIBELLES ENTETE FACTURE  */                     00003   
      /*  GENERE LE 23/09/98 A 09H39 PAR YPCSA  */                      00004   
    DCL   01 DFACM,                                                     00005   
           02 TF1_DFACM,                                                00006   
          /* NUMERO DE SEQUENCE                       */                00007   
             03 TF1_NUSE3 PIC'(03)9',                                   00008   
          /* LIBELLE NO 1                             */                00009   
            03 TF1_LIBE1 CHAR(50),                                      00010   
          /* LIBELLE NO 2                             */                00011   
            03 TF1_LIBE2 CHAR(50),                                      00012   
          /* LIBELLE NO 3                             */                00013   
            03 TF1_LIBE3 CHAR(15),                                      00014   
            03 TF1_XXXXX CHAR(0);                                       00015   
 /*    END INCLUDE++                                                  */        
 /*    INCLUDE++ IDDTACCP               /* TABLE DES NUMEROS  ACCORDS */01810   
        /* DATA SET IDDTACCP   AT LEVEL 008 AS OF 23/05/96    */                
      /*************************************/                           00001**3
      /*      TABLE DES NUMEROS ACCORDS     /*                          00002**3
      /*************************************/                           00003**3
      DCL 1 TBACCORD,                                                   00004**2
            2 SYPRO      CHAR(2),                                       00005**2
            2 AFFIL      CHAR(2),                                       00006**2
            2 NUCLI      CHAR(6),                                       00007**6
            2 EDCDEB,                                                   00008**2
              3 EDIDEB   CHAR(3),                                       00009**4
              3 DIVDEB   CHAR(2),                                       00010**2
              3 COLDEB   CHAR(2),                                       00011**2
            2 EDCFIN,                                                   00012**2
              3 EDIFIN   CHAR(3),                                       00013**4
              3 DIVFIN   CHAR(2),                                       00014**2
              3 COLFIN   CHAR(2),                                       00015**2
            2 ACCOR      CHAR(11),                                      00016**8
            2 FILLER     CHAR(10);                                      00017**8
 /*    END INCLUDE++                                                  */        
 /*    INCLUDE++ IDDTACLP               /* TABLE DES LIBELLES ACCORDS */01811   
        /* DATA SET IDDTACLP   AT LEVEL 004 AS OF 21/05/96    */                
         /************************************/                         00001   
         /*      TABLE DES LIBELLES ACCORDS   */                        00002   
         /************************************/                         00003   
      DCL 1 TLACCORD,                                                   00004**3
           2 ACCOR      CHAR (11),                                      00005**4
           2 LIBACC     CHAR (15),                                      00006**2
           2 LIBACL     CHAR (25);                                      00007**2
 /*    END INCLUDE++                                                  */        
 /*    INCLUDE++ CDLSYHMD               /* TABLE HMD SPOOL 7   O      */01812   
      /* IDIL _ FACTURE CLIENTS MULTIMEDIA       */                             
      /*  GENERE LE 25/10/00 A 16H38 PAR YDU     */                             
      DCL 01 CDLSYHMD,                                                          
           02 MDD_LSYHM,                                                        
          /* SYSTEME DE PROSPECTION                   */                        
            03 MDD_SYPRO CHAR(02),                                              
          /* FILLER X(10)                             */                        
            03 MDD_FIL10 CHAR(10),                                              
            03 MDD_XXXXX CHAR(0);                                               
 /*    END INCLUDE++                                                  */        
 /*    INCLUDE++ CDLPAGGP               /* TABLE PAGE DE GARDE A EDIT.*/01813   
        /* DATA SET CDLPAGGP   AT LEVEL 004 AS OF 15/09/05    */                
 /* OBJET CREE PAR:YDU      LE:15/09/05 A 13:07:32          */          00001   
 /* IDIL                                                    */          00002   
         /*---------------------------------  */                        00003**2
         /*      TABLE CDLPAGGA IDENTIFIANT   */                        00004**4
         /*      LES FACTURES EDITEES  AVEC   */                        00005**4
         /*      LA PAGE DE GARDE             */                        00006**4
         /*---------------------------------- */                        00007**2
      DCL 1 TCDLPAGG,                                                   00008**3
           2 SYPRO      CHAR (02),  /* SYSTEME DE PROSPECTION     */    00009**3
           2 AFFIL      CHAR (02),  /* AFFILIATION                */    00010**3
           2 NUCLI      CHAR (06),  /* IDENTIFIANT CLIENT         */    00011**3
           2 FIL10      CHAR (10);  /* FILLER                     */    00012**3
 /*    END INCLUDE++                                                  */        
                                        /* AJOUT 22 10 02 YDU/YHM PCF */01814   
 /*    INCLUDE++ CDLPCFDU               /* TABLE CDLPCFDU DUPLICAT FAC*/01815   
      /* IDIL _ TABLE CDLPCFDU DUPLICAT FACT, PCF     */                        
      /*  GENERE LE 01/10/02 A 15H17 PAR YDU          */                        
      DCL 01  CDLPCFDU ,                                                        
           02 PCU_LPCFD,                                                        
          /* SIGLE PERMETTANT DE TRIER A L'INTERIEUR  */                        
            03 PCU_SIGLE CHAR(05),                                              
          /* VALEUR DE TEST DE LA CONDITION           */                        
            03 PCU_VAL11 CHAR(10),                                              
            03 PCU_XXXXX CHAR(0);                                               
 /*    END INCLUDE++                                                  */        
 /*    INCLUDE++ CDLNUART               /* TABLE CDLNUART IDENTIF  FAC*/01816   
        /* DATA SET CDLNUART   AT LEVEL 003 AS OF 27/01/05    */                
 /* OBJET CREE PAR:YDU      LE:27/01/05 A 11:59:04          */          00001   
 /* IDIL                                                    */          00002   
         /*---------------------------------  */                        00003**2
         /*      TABLE IDENTIFIANT LES        */                        00004**2
         /*      NUART SPECIAUX FRAIS LIBELLE */                        00005**2
         /*                                   */                        00006**2
         /*---------------------------------- */                        00007**2
      DCL 1 TCDLNUAR,                                                   00008**2
           2 NUART      CHAR (07),  /* NUMERO ARTICLE             */    00009**2
           2 IARTI      CHAR (03),  /* IDENTIFIANT ARTICLE        */    00010**2
           2 LARTI      CHAR (20),  /* LIBELLE IDENTIFIANT ARTICLE*/    00011**2
           2 FIL20      CHAR (20);  /* FILLER                     */    00012**3
 /*    END INCLUDE++                                                  */        
 /*    INCLUDE++ CDLCLLME               /* TABLE CDLCLLME CLIENTS  LME*/01817   
     /* DICO009 IDIL - TABLE CDLCLLME - SELECT NUCLI LME */                     
     /*  GENERE LE 06/05/09 A 11H55 PAR YDU              */                     
0/*------------------------------------------------*/                           
 /* TABLE SPITAB CDLCLLME                          */                           
 /*       SELECTION DES CLIENTS LIES A LA LME      */                           
 /*------------------------------------------------*/                           
0DCL 01  CDLCLLME,                                                              
 10      SYPRO        CHAR(02),        /* SYSTEME DE PROSPECTION      */        
 10      AFFIL        CHAR(02),        /* REFERENCE CENTRALE          */        
 10      NUCLI        CHAR(06),        /* NUMERO CLIENT               */        
 10      FIL10        CHAR(10);        /* FILLER                      */        
 /*    END INCLUDE++                                                  */        
 /*    INCLUDE++ CDLTELME               /* TABLE CDLTELME TEXTE    LME*/01818   
     /* DICO009 IDIL - TABLE CDLTELME - MESSAGE LME      */                     
     /*  GENERE LE 06/05/09 A 11H52 PAR YDU              */                     
0/*------------------------------------------------*/                           
 /* TABLE SPITAB CDLTELME                          */                           
 /*       TEXTE LME A EDITER EN FIN DE FACTURE     */                           
 /*------------------------------------------------*/                           
0DCL 01  CDLTELME,                                                              
 10      NUSE3        PIC'(3)9',       /* NUMERO DE SEQUENCE          */        
 10      LIBE1        CHAR(50),        /* LIBELLE NO 1                */        
 10      LIBE2        CHAR(50),        /* LIBELLE NO 2                */        
 10      LIBE3        CHAR(15);        /* LIBELLE NO 3                */        
 /*    END INCLUDE++                                                  */        
0      DCL 1 CDLTXFOB,                                                  01819   
 /*    INCLUDE++ IDTTFOB                /* TABLE VALEUR TAUX FOB      */01820   
        /* DATA SET IDTTFOB    AT LEVEL 002 AS OF 08/04/99    */                
      /* TAUX FREE ON BOARD (FOB)                */                     00001   
      /*  GENERE LE 08/04/99 A 10H00 PAR CVALENT*/                      00002   
           02 TX1_TTFOB,                                                00003   
          /* CLE                                      */                00004   
            03 TX1_CLE01,                                               00005   
          /* CRITERE SELECTION FRANCE_ETRANGER        */                00006   
             04 TX1_FRAET CHAR(01),                                     00007   
          /* DEPARTEMENT OU PAYS                      */                00008   
             04 TX1_DEPAY CHAR(03),                                     00009   
          /* SPECIFICATION D'ENVOI                    */                00010   
             04 TX1_SPENV CHAR(02),                                     00011   
          /* ECLATEMENT FACTURATION ETRANGER          */                00012   
             04 TX1_ECFAC CHAR(01),                                     00013   
          /* TAUX FREE ON BOARD FOB                   */                00014   
            03 TX1_TXFOBX,                                              00015   
             04 TX1_TXFOB PIC'(02)9V(3)9',                              00016   
             03 TX1_XXXXX CHAR(0);                                      00017   
 /*    END INCLUDE++                                                  */        
       /* -- AJOUT SMARTIN 22/11/2004  */                               01821   
 /*    INCLUDE++ CDLEXREF                                             */01822   
        /* DATA SET CDLEXREF   AT LEVEL 002 AS OF 22/11/04    */                
 /* OBJET CREE PAR:SMARTIN  LE:22/11/04 A 11:23:22          */          00001   
 /* TABLE DES REFLI A EXCLURE                               */          00002   
         /************************************/                         00003**2
         /*      TABLE DES REFLI A EXCLURE    */                        00004**2
         /************************************/                         00005**2
      DCL 1 TCDLEXRF,                                                   00006**2
           2 REFLI      CHAR (06),                                      00007**2
           2 REFXX      CHAR (00);                                      00008**2
 /*    END INCLUDE++                                                  */        
       /* -- AJOUT SMARTIN FIN11/2004  */                               01823   
                                                                        01824   
  /*-- -------------------------------------------- --*/                01825   
  /*-- GESTION DES FACTURES DEMATERIALISEES   ----- --*/                01826   
  /*--   DEBUT AJOUT SMARTIN DU 17/12/2004    ----- --*/                01827   
  /*--    TABLE DE SELECTION DES FACTURES A DEMAT   --*/                01828   
 /*    INCLUDE++ CDLFDEMA                                             */01829   
        /* DATA SET CDLFDEMA   AT LEVEL 016 AS OF 03/10/06    */                
 /* OBJET CREE PAR:SMARTIN  LE:16/12/04 A 14:23:38          */          00001   
 /* TABLE SELECTION FACTURE DEMATERIALISEE                  */          00002   
         /*---------------------------------  */                        00003**3
         /*      TABLE DE SELECTION DES       */                        00004**3
         /*      FACTURES A DEMATERIALISER    */                        00005**3
         /*                                   */                        00006**3
         /*---------------------------------- */                        00007**3
      DCL 1 TCDLFDEM,                                                   00008**3
           2 NUCLI      CHAR (06),  /* NUMERO DE CLIENT (CLE)     */    00009**5
           2 CNUDC      CHAR (13),  /* CODE EAN DU CLIENT LIVRE   */    00010*11
           2 FALLE      CHAR (01),  /* FLUX ALLER : OUI/NON       */    00011**8
           2 FRETO      CHAR (01),  /* FLUX RETOUR : OUI/NON      */    00012**8
           2 FRECT      CHAR (01),  /* FLUX RECTIF : OUI/NON      */    00013**8
           2 FRFIN      CHAR (01),  /* FRAIS FINANCIER : OUI-NON  */    00014*14
           2 CNUD2      CHAR (13),  /* CNUD DU LIVRE A            */    00015*13
           2 CNUDF      CHAR (13),  /* CNUD DU FACTURE PAR        */    00016*13
           2 CNUD5      CHAR (13),  /* CNUD DU FACTURE A          */    00017*13
           2 CNUD6      CHAR (13),  /* CNUD DU REGLE A            */    00018*13
           2 CNUD9      CHAR (13),  /* DECLARANT TVA EXPORT       */    00019*15
           2 CNUD7      CHAR (13),  /* CNUD DU LIVRE PAR          */    00020*15
           2 TRECO      CHAR (01),  /* TYPE RECOM ACCEPTEE CLIENT */    00021*13
           2 DADEBDEM   CHAR (08),  /* DATE DEBUT DEMAT.          */    00022**8
           2 DAFINDEM   CHAR (08),  /* DATE FIN DEMAT.            */    00023**8
           2 CNUSS      CHAR (13),  /* CNUD DU SIEGE SOCIAL       */    00024*16
           2 FIL07      CHAR (07);  /* FILLER                     */    00025*16
 /*    END INCLUDE++                                                  */        
  /*--    TABLE DES ADRESSES CLIENTS GENCOD         --*/                01830   
 /*    INCLUDE++ CDLADRES                                             */01831   
        /* DATA SET CDLADRES   AT LEVEL 007 AS OF 12/09/07    */                
 /* OBJET CREE PAR:YDU      LE:17/01/06 A 13:28:57          */          00001**6
 /* IDIL                                                    */          00002**6
         /*---------------------------------  */                        00003**6
         /*      TABLE DE SELECTION DES       */                        00004**6
         /*      FACTURES A DEMATERIALISER    */                        00005**6
         /*                                   */                        00006**6
         /*---------------------------------- */                        00007**6
      DCL 1 TCDLADRE,                                                   00008**6
           2 CNUDC      CHAR (13),  /* CODE EAN DU CLIENT         */    00009**6
           2 RASOC      CHAR (35),  /* RAISON SOCIALE             */    00010**6
           2 NOCLI      CHAR (35),  /* NOM DU CLIENT              */    00011**6
           2 ADCLI      CHAR (35),  /* ADRESSE                    */    00012**6
           2 LORES      CHAR (35),  /* LOCALITE RESIDENCE         */    00013**6
           2 LOBDI      CHAR (35),  /* LOCALITE BUREAU DISTRIBUTEU*/    00014**6
           2 CPCLI      CHAR (09),  /* CODE POSTAL                */    00015**6
           2 CPAYS      CHAR (02),  /* CODE PAYS ISO SUR 2 CARACT.*/    00016**6
           2 SIREN      CHAR (09),  /* NUMERO DE SIREN            */    00017**6
           2 MAGTV      CHAR (13),  /* NUMERO DE TVA MAGASIN      */    00018**6
           2 REGIC      CHAR (30),  /* REGISTRE DU COMMERCE       */    00019**6
           2 FIL22      CHAR (22);  /* FILLER                     */    00020**6
 /*    END INCLUDE++                                                  */        
  /*-- -------------------------------------------- --*/                01832   
  /*--    TABLE DES INFOS SIEGE  FACTURES A DEMAT   --*/                01833   
 /*    INCLUDE++ CDLSIEGE                                             */01834   
        /* DATA SET CDLSIEGE   AT LEVEL 003 AS OF 03/02/05    */                
 /* OBJET CREE PAR:SMARTIN  LE:30/12/04 A 16:03:14          */          00001   
 /* INFOS SIEGE POUR FACTURES DEMATERIALISEES               */          00002   
         /*---------------------------------  */                        00003**2
         /*      TABLE DES INFOS SIEGE        */                        00004**2
         /*      FACTURES A DEMATERIALISER    */                        00005**2
         /*                                   */                        00006**2
         /*---------------------------------- */                        00007**2
      DCL 1 TSIEGE,                                                     00008**2
           2 EAN13      CHAR (13),  /* CODE EAN HACHETTE          */    00009**2
           2 NOSIE      CHAR (35),  /* NOM                        */    00010**2
           2 RASIE      CHAR (35),  /* RAISON SOCIALE             */    00011**2
           2 ADSIE      CHAR (35),  /* ADRESSE VOIE/BP            */    00012**2
           2 LOSIE      CHAR (35),  /* LOCALITE / RESIDENCE       */    00013**2
           2 LBSIE      CHAR (35),  /* COMMUNE                    */    00014**2
           2 CPSIE      CHAR (05),  /* CODE POSTAL                */    00015**2
           2 PASIE      CHAR (03),  /* CODE PAYS                  */    00016**2
           2 FJSIE      CHAR (30),  /* FORME JURIDIQUE            */    00017**2
           2 CASIE      CHAR (12),  /* CAPITAL SOCIALE            */    00018**2
           2 RCSIE      CHAR (30),  /* REGISTRE DU COMMERCE       */    00019**2
           2 TVSIE      CHAR (13),  /* NUMERO CEE TVA             */    00020**2
           2 SIREM      CHAR (09),  /* CNUD SIEGE                 */    00021**3
           2 FILXX      CHAR (11);  /*     FILLER                 */    00022**3
 /*    END INCLUDE++                                                  */        
  /*-- -------------------------------------------- --*/                01835   
  /*-- STRUCTU. FICHIER FACTURE DEMATERIALISEE  --- --*/                01836   
  /*-- -------------------------------------------- --*/                01837   
 /*    INCLUDE++ IDDDEMAP                                             */01838   
        /* DATA SET IDDDEMAP   AT LEVEL 207 AS OF 27/09/07    */                
 /* OBJET CREE PAR:YDU      LE:12/11/04 A 11:19:58          */          00001204
 /* OBJET MODIFIE :SMARTIN  LE:18/11/04                     */          00002204
 /* OBJET MODIFIE :SMARTIN  LE:16/12/04                     */          00003204
 /* IDIL                                                    */          00004204
 /*-------------------------------------------------------------------*/00005204
 /* FICHIER DEMATERIALISATION DE LA FACTURE                D=12/10/04 */00006204
 /* STRUCTURE PL1   IDDDEMAP                                          */00007204
 /* STRUCTURE COBOL DICTIONNAIRE FACDEMA1,5                           */00008204
 /*   09.2007 LONG 1033 ==> 1233 POUR REGISTRE DU COMMERCE            */00009204
 /*-------------------------------------------------------------------*/00010204
0                                                                       00011204
0DCL 01 DEMAT_GEN ,                                                     00012204
 10   ID,                   /* ARGUMENT DE TRI ZONE COMMUNE           */00013204
  20  NUCLI  CHAR(06),      /* NUMERO DE CLIENT                       */00014204
  20  DAFAC  CHAR(08),      /* DATE DE FACTURE AAAAMMJJ               */00015204
  20  GNATO  CHAR(02),      /* GROUPE DE NATOP                        */00016204
  20  RUNFA  CHAR(03),      /* NO DE RUN DE FACTURATION    PARAMETRE  */00017204
  20  NUFAC  DEC FIXED(5),  /* INDICATIF DE LA FACTURE                */00018204
  20  NULIG  DEC FIXED(9),  /* NUMERO DE LIGNES DANS LA FACTURE       */00019204
  20  COENR  CHAR(01),      /* CODE ENREGISTREMENT LIGNE =            */00020204
                            /*   'A' POUR ENT                         */00021204
                            /*   'B' POUR ECH                         */00022204
                            /*   'C' POUR COM                         */00023204
                            /*   'D' POUR REF                         */00024204
                            /*   'E' POUR ADR                         */00025204
                            /*   'F' POUR BOR                         */00026204
                            /*   'G' POUR LIG                         */00027204
                            /*   'H' POUR LEC                         */00028204
                            /*   'I' POUR PIE                         */00029204
  20  TYPDE  CHAR (01),     /* DEMAT TEST (=T) OU PROD (<>T)          */00030204
  20  ENSEQ  DEC FIXED(7),  /* NUMERO DE SEQUENCE DANS LA LIGNE       */00031204
 10   GS,                   /* ZONES DE GESTION                       */00032204
  20  INFO   CHAR(1200);    /* INFORMATIONS                           */00033204
 /*-- ------------------------------------------------------------ --*/ 00034204
 /*-- ------------------------------------------------------------ --*/ 00035204
0DCL 01 DEMAT_FIC ,                                                     00036204
 10   ID     LIKE DEMAT_GEN.ID,                                         00037204
 10   GS,                  /* ZONES DE GESTION DEBUT DE FICHIER       */00038204
  20  TYPEN  CHAR (03),    /* TYPE ENREG "FIC"                        */00039204
  20  NULOT  CHAR (14),    /* NUMERO LOT                              */00040204
  20  DTCRE  CHAR (08),    /* DATE  DE CREATION                       */00041204
  20  HHCRE  CHAR (06),    /* HEURE DE CREATION                       */00042204
  20  NBFAC  PIC  '(7)9',  /* NOMBRE DE FACTURES DANS LE LOT          */00043204
  20  FILRE  CHAR (1162),  /* COMPLEMENT POUR LRECL UNIQUE            */00044204
  20  FILXX  CHAR (00);    /*   FIN ENREGISTREMENT FIC                */00045204
 /*-- ------------------------------------------------------------ --*/ 00046204
0DCL 01 DEMAT_ENT ,                                                     00047204
 10   ID     LIKE DEMAT_GEN.ID,                                         00048204
 10   GS,                  /* ZONES DE GESTION ENTETE DE FACTURE      */00049204
  20  TYPEN  CHAR (03),    /* TYPE ENREG "ENT"                        */00050204
  20  NULOT  CHAR (14),    /* NUMERO LOT                              */00051204
  20  EANFO  CHAR (13),    /* NUMERO CLIENT                           */00052204
  20  NUFAC  CHAR (15),    /* RUNFA NUFAC                             */00053204
  20  TYPFA  CHAR (03),    /* TYPE DE FACTURE                         */00054204
                           /*     380 SI FACTURE                      */00055204
                           /*     381 SI AVOIR                        */00056204
                           /*     381 SI RECTIFICATION                */00057204
  20  SMONHT CHAR (01),    /* SIGNE                                   */00058204
  20  MONHT  PIC '(9)9V99999', /* MONTANT HT                          */00059204
  20  SMTTTC CHAR (01),    /* SIGNE                                   */00060204
  20  MTTTC  PIC '(9)9V99999', /* MONTANT TTC                         */00061204
  20  SMTTVA CHAR (01),    /* SIGNE                                   */00062204
  20  MTTVA  PIC '(9)9V99999', /* MONTANT TVA                         */00063204
  20  SMTEMB CHAR (01),    /* SIGNE                                   */00064204
  20  MTEMB  PIC '(9)9V99999', /* MONTANT EMBALLAGE TTC               */00065204
  20  SMTFRA CHAR (01),    /* SIGNE                                   */00066204
  20  MTFRA  PIC '(9)9V99999', /* MONTANT TRANSPORT TTC               */00067204
  20  DEVIS  CHAR (03),    /* DEVISE = "EUR"                          */00068204
  20  DAFAC  CHAR (08),    /* DATE DE FACTURE AAAAMMJJ                */00069204
  20  DAECH  CHAR (08),    /* DATE D ECHEANCE AAAAMMJJ                */00070204
  20  NBLFA  PIC '(7)9',   /* NOMBRE DE LIGNES DANS LA FACTURE        */00071204
  20  DAINS  CHAR (08),    /* DATE INSERTION                          */00072204
  20  HEINS  CHAR (06),    /* HEURE INSERTION                         */00073204
  20  NBECH  PIC '(5)9',   /* NOMBRE ECHEANCE(S)                      */00074204
  20  SMTTRA CHAR (01),    /* SIGNE                                   */00075204
  20  MTTRA  PIC '(9)9V99999', /* MONTANT TRANSPORT HT                */00076204
  20  CDFON  CHAR (02),    /* CODE FONCTION DU MESSAGE                */00077204
                           /*   ='9 ' FACTURE DEMATERIALISEE  PROD    */00078204
                           /*   ='43' FACTURE ELECTRONIQUE    TEST    */00079204
  20  CDORR  CHAR (01),    /* CODE OFFICE - REASSORT - RECTIF         */00080204
                           /*   ='O' SI OFFICE                        */00081204
                           /*   ='R' SI REASSORT OU RECTIFICATION     */00082204
  20  SMTAFR CHAR (01),    /* SIGNE                                   */00083204
  20  MTAFR  PIC '(9)9V99999', /* MONTANT AUTRES FRAIS                */00084204
  20  NUCLI  CHAR (006),   /* NUCLI POUR FICHIER HARRY                */00085204
  20  TXTVT  PIC '(3)9V99',/* TAUX TVA TRANSPORT                      */00086204
  20  TXTVE  PIC '(3)9V99',/* TAUX TVA EMBALLAGE                      */00087204
  20  TXTVF  PIC '(3)9V99',/* TAUX TVA AUTRES FRAIS                   */00088204
  20  SMTFHT CHAR (01),    /* SIGNE MONTANT FORT HT FACTURE           */00089204
  20  MTFHT  PIC '(9)9V99999', /* MONTANT FORT HT FACTURE             */00090204
  20  COPAE  CHAR (02),    /* CODE PAIEMENT EDI                       */00091204
  20  NUFAO  CHAR (15),    /* NUMERO FACTURE ORIGINE                  */00092204
  20  NUBLO  CHAR (13),    /* NUMERO BL ORIGINE                       */00093204
  20  FILXX  CHAR (933),   /* COMPLEMENT POUR LRECL UNIQUE            */00094204
  20  FXXXX  CHAR (000);   /* FIN ENTETE                              */00095204
 /*-- ------------------------------------------------------------ --*/ 00096204
0DCL 01 DEMAT_ECH ,                                                     00097204
 10   ID     LIKE DEMAT_GEN.ID,                                         00098204
 10   GS,                  /* ZONES DE GESTION ECHEANCE FACTURE       */00099204
  20  TYPEN  CHAR (03),    /* TYPE ENREG "ECH"                        */00100204
  20  NULOT  CHAR (14),    /* NUMERO LOT                              */00101204
  20  EANFO  CHAR (13),    /* NUMERO CLIENT                           */00102204
  20  NUFAC  CHAR (15),    /* RUNFA NUFAC                             */00103204
  20  DTECH  CHAR (08),    /* DATE  ECHEANCE                          */00104204
  20  SMTECH CHAR (01),    /* SIGNE                                   */00105204
  20  MTECH  PIC '(9)9V99999', /* MONTANT ECHEANCE TTC                */00106204
  20  FILRE  CHAR (1132),  /* COMPLEMENT POUR LRECL UNIQUE            */00107204
  20  FILXX  CHAR (00);    /*   FIN ENREGISTREMENT ECH                */00108204
 /*-- ------------------------------------------------------------ --*/ 00109204
0DCL 01 DEMAT_COM ,                                                     00110204
 10   ID     LIKE DEMAT_GEN.ID,                                         00111204
 10   GS,                  /* ZONES DE GESTION LIGNES COMMENTAIRE     */00112204
  20  TYPEN  CHAR (03),    /* TYPE ENREG "COM"                        */00113204
  20  NULOT  CHAR (14),    /* NUMERO LOT                              */00114204
  20  EANFO  CHAR (13),    /* NUMERO CLIENT                           */00115204
  20  NUFAC  CHAR (15),    /* RUNFA NUFAC                             */00116204
  20  TYPCO  CHAR (03),    /* TYPE DE COMMENTAIRE =                   */00117204
                           /* 'PMD' CONDITIONS ESCOMPTE               */00118204
                           /* 'SUR' REMARQUES FOURNISSEURS            */00119204
                           /* 'AAI' INFOS GENERALES                   */00120204
  20  ZOCOM  CHAR (70),    /* ZONE COMMENTAIRE                        */00121204
  20  FILRE  CHAR (1082),  /* COMPLEMENT POUR LRECL UNIQUE            */00122204
  20  FILXX  CHAR (00);    /*   FIN ENREGISTREMENT ECH                */00123204
 /*-- ------------------------------------------------------------ --*/ 00124204
0DCL 01 DEMAT_REF ,                                                     00125204
 10   ID     LIKE DEMAT_GEN.ID,                                         00126204
 10   GS,                  /* ZONES DE GESTION REFERENCE FACTURE      */00127204
  20  TYPEN  CHAR (03),    /* TYPE ENREG "REF"                        */00128204
  20  NULOT  CHAR (14),    /* NUMERO LOT                              */00129204
  20  EANFO  CHAR (13),    /* NUMERO CLIENT                           */00130204
  20  NUFAC  CHAR (15),    /* RUNFA NUFAC                             */00131204
  20  QUALI  CHAR (03),    /* QUALIFIANT :                            */00132204
                           /*  = 'SS ' DISTRIBUTION OFFICE            */00133204
                           /*  = 'VN ' DISTRIBUTION REASSORT          */00134204
                           /*  = 'ON ' CLIENT                         */00135204
                           /*  = 'XXX' SANS REFERENCE                 */00136204
                           /*  = 'DQ ' NUMERO DE BL                   */00137204
  20  RFDIS  CHAR (35),    /* REFERENCE COMMANDE                      */00138204
  20  DAOPE  CHAR (08),    /* DATE OPERATION DU                       */00139204
  20  FILRE  CHAR (1109),  /* COMPLEMENT POUR LRECL UNIQUE            */00140204
  20  FILXX  CHAR (00);    /*   FIN ENREGISTREMENT ECH                */00141204
 /*-- ------------------------------------------------------------ --*/ 00142204
0DCL 01 DEMAT_ADR ,                                                     00143204
 10   ID     LIKE DEMAT_GEN.ID,                                         00144204
 10   GS,                  /* ZONES DE GESTION LIGNE ADRESSE          */00145204
  20  TYPEN  CHAR (03),    /* TYPE ENREG "ADR"                        */00146204
  20  NULOT  CHAR (14),    /* NUMERO LOT                              */00147204
  20  EANFO  CHAR (13),    /* NUMERO CLIENT                           */00148204
  20  NUFAC  CHAR (15),    /* RUNFA NUFAC                             */00149204
  20  CLLIV ,              /* CLIENT LIVRE                            */00150204
   30 NUCLI  CHAR (13),    /* CODE CLIENT                             */00151204
   30 RASOC  CHAR (35),    /* RAISON SOCIALE                          */00152204
   30 NOCLI  CHAR (35),    /* NOM                                     */00153204
   30 ADCLI  CHAR (35),    /* ADRESSE                                 */00154204
   30 LORES  CHAR (35),    /* LOCALITE RESIDENCE                      */00155204
   30 LOBDI  CHAR (35),    /* BUREAU DISTRIBUTEUR COMMUNE             */00156204
   30 CPCLI  CHAR (09),    /* CODE POSTAL                             */00157204
   30 CPAYS  CHAR (03),    /* CODE PAYS ISO SUR 2 OCTETS              */00158204
  20  CLFAC ,              /* CLIENT FACTURE                          */00159204
   30 CLIFA  CHAR (13),    /* CODE CLIENT CLIFA                       */00160204
   30 RASOC  CHAR (35),    /* RAISON SOCIALE                          */00161204
   30 NOCLI  CHAR (35),    /* NOM                                     */00162204
   30 ADCLI  CHAR (35),    /* ADRESSE                                 */00163204
   30 LORES  CHAR (35),    /* LOCALITE RESIDENCE                      */00164204
   30 LOBDI  CHAR (35),    /* BUREAU DISTRIBUTEUR COMMUNE             */00165204
   30 CPCLI  CHAR (09),    /* CODE POSTAL                             */00166204
   30 CPAYS  CHAR (03),    /* CODE PAYS ISO SUR 2 OCTETS              */00167204
   30 SIRFA  CHAR (09),    /* SIREN CLIENT FACTURE A                  */00168204
  20  EMETT ,              /* EMETTEUR DU MESSAGE                     */00169204
   30 MACOM  CHAR (13),    /* CODE CLIENT HACHETTE                    */00170204
   30 NOCLI  CHAR (35),    /* NOM                                     */00171204
   30 RASOC  CHAR (35),    /* RAISON SOCIALE                          */00172204
   30 ADCLI  CHAR (35),    /* ADRESSE                                 */00173204
   30 LORES  CHAR (35),    /* LOCALITE RESIDENCE                      */00174204
   30 LOBDI  CHAR (35),    /* BUREAU DISTRIBUTEUR COMMUNE             */00175204
   30 CPCLI  CHAR (09),    /* LOCALITE RESIDENCE                      */00176204
   30 CPAYS  CHAR (03),    /* CODE PAYS ISO SUR 2 OCTETS              */00177204
   30 NUTEL  CHAR (10),    /* TELEPHONE NOCRD TBACRDL                 */00178204
   30 NUFAX  CHAR (10),    /* FAX                                     */00179204
   30 RECOU  CHAR (10),    /* TELEPHONE RECOUVREMENT                  */00180204
   30 SIREM  CHAR (09),    /* SIREN EMETTEUR DE LA FACTURE            */00181204
  20  SIEGE ,              /* SIEGE SOCIAL                            */00182204
   30 EAN    CHAR (13),    /* CODE CLIENT                             */00183204
   30 NOCLI  CHAR (35),    /* NOM                                     */00184204
   30 RASOC  CHAR (35),    /* RAISON SOCIALE                          */00185204
   30 ADCLI  CHAR (35),    /* ADRESSE                                 */00186204
   30 LORES  CHAR (35),    /* LOCALITE RESIDENCE                      */00187204
   30 LOBDI  CHAR (35),    /* BUREAU DISTRIBUTEUR COMMUNE             */00188204
   30 CPCLI  CHAR (09),    /* CODE POSTAL                             */00189204
   30 CPAYS  CHAR (03),    /* CODE PAYS ISO SUR 2 OCTETS              */00190204
   30 FJURI  CHAR (30),    /* FORME JURIDIQUE                         */00191204
   30 CAPIT  CHAR (12),    /* CAPITAL SOCIAL                          */00192204
   30 CMONA  CHAR (03),    /* CODE MONNAIE "EUR"                      */00193204
   30 RCOMM  CHAR (30),    /* REGISTRE DU COMMERCE                    */00194204
   30 NUCEE  CHAR (13),    /* CODE CEE TVA                            */00195204
   30 MAGTV  CHAR (13),    /* NUMERO TVA MAGASIN                      */00196204
  20  REGIF  CHAR (30),    /* REGISTRE DU COMMERCE DU FACTURE PAR     */00197204
  20  FILXX  CHAR (176),   /* COMPLEMENT POUR LRECL UNIQUE            */00198204
  20  FXXXX  CHAR (00);    /* FIN ADRESSE                             */00199204
0DCL 01 DEMAT_AD2 ,                                                     00200204
 10   ID     LIKE DEMAT_GEN.ID,                                         00201204
 10   GS,                  /* ZONES DE GESTION LIGNE ADRESSE COMPLEM  */00202204
  20  TYPEN  CHAR (03),    /* TYPE ENREG "ADR"                        */00203204
  20  NULOT  CHAR (14),    /* NUMERO LOT                              */00204204
  20  EANFO  CHAR (13),    /* NUMERO CLIENT                           */00205204
  20  NUFAC  CHAR (15),    /* RUNFA NUFAC                             */00206204
  20  LIVREA,              /* CLIENT LIVRE A                          */00207204
   30 CNUD2  CHAR (13),    /* CLIENT   LIVRE A                        */00208204
   30 RASOC  CHAR (35),    /* RAISON SOCIALE                          */00209204
   30 NOCLI  CHAR (35),    /* NOM                                     */00210204
   30 ADCLI  CHAR (35),    /* ADRESSE                                 */00211204
   30 LORES  CHAR (35),    /* LOCALITE RESIDENCE                      */00212204
   30 LOBDI  CHAR (35),    /* BUREAU DISTRIBUTEUR COMMUNE             */00213204
   30 CPCLI  CHAR (09),    /* CODE POSTAL                             */00214204
   30 CPAYS  CHAR (03),    /* CODE PAYS ISO SUR 2 OCTETS              */00215204
   30 SIREN  CHAR (09),    /* SIREN CLIENT                            */00216204
  20  REGLEA,              /* CLIENT REGLE A                          */00217204
   30 CNUD6  CHAR (13),    /* CLIENT   REGLE A                        */00218204
   30 RASOC  CHAR (35),    /* RAISON SOCIALE                          */00219204
   30 NOCLI  CHAR (35),    /* NOM                                     */00220204
   30 ADCLI  CHAR (35),    /* ADRESSE                                 */00221204
   30 LORES  CHAR (35),    /* LOCALITE RESIDENCE                      */00222204
   30 LOBDI  CHAR (35),    /* BUREAU DISTRIBUTEUR COMMUNE             */00223204
   30 CPCLI  CHAR (09),    /* CODE POSTAL                             */00224204
   30 CPAYS  CHAR (03),    /* CODE PAYS ISO SUR 2 OCTETS              */00225204
   30 SIREN  CHAR (09),    /* SIREN CLIENT                            */00226204
  20  DCLTVA,              /* DECLARANT TVA EXPORT                    */00227204
   30 CNUD9  CHAR (13),    /* DECLARANT TVA EXPORT                    */00228204
   30 RASOC  CHAR (35),    /* RAISON SOCIALE                          */00229204
   30 NOCLI  CHAR (35),    /* NOM                                     */00230204
   30 ADCLI  CHAR (35),    /* ADRESSE                                 */00231204
   30 LORES  CHAR (35),    /* LOCALITE RESIDENCE                      */00232204
   30 LOBDI  CHAR (35),    /* BUREAU DISTRIBUTEUR COMMUNE             */00233204
   30 CPCLI  CHAR (09),    /* CODE POSTAL                             */00234204
   30 CPAYS  CHAR (03),    /* CODE PAYS ISO SUR 2 OCTETS              */00235204
   30 SIREN  CHAR (09),    /* SIREN CLIENT                            */00236204
  20  LIVPAR,              /* CLIENT LIVRE PAR                        */00237204
   30 CNUD7  CHAR (13),    /* CLIENT   LIVRE PAR                      */00238204
   30 RASOC  CHAR (35),    /* RAISON SOCIALE                          */00239204
   30 NOCLI  CHAR (35),    /* NOM                                     */00240204
   30 ADCLI  CHAR (35),    /* ADRESSE                                 */00241204
   30 LORES  CHAR (35),    /* LOCALITE RESIDENCE                      */00242204
   30 LOBDI  CHAR (35),    /* BUREAU DISTRIBUTEUR COMMUNE             */00243204
   30 CPCLI  CHAR (09),    /* CODE POSTAL                             */00244204
   30 CPAYS  CHAR (03),    /* CODE PAYS ISO SUR 2 OCTETS              */00245204
   30 SIREN  CHAR (09),    /* SIREN CLIENT                            */00246204
  20  FILXX  CHAR (319),   /* COMPLEMENT POUR LRECL UNIQUE            */00247204
  20  FXXXX  CHAR (00);    /* FIN ADRESSE 2                           */00248204
 /*-- ------------------------------------------------------------ --*/ 00249204
0DCL 01 DEMAT_LIG ,                                                     00250204
 10   ID     LIKE DEMAT_GEN.ID,                                         00251204
 10   GS,                  /* ZONES DE GESTION LIGNE DE FACTURE       */00252204
  20  TYPEN  CHAR (03),    /* TYPE ENREG "LIG"                        */00253204
  20  NULOT  CHAR (14),    /* NUMERO LOT                              */00254204
  20  EANFO  CHAR (13),    /* NUMERO CLIENT                           */00255204
  20  NUFAC  CHAR (15),    /* RUNFA NUFAC                             */00256204
  20  NBCOM  PIC '999',    /* NOMBRE DE COMPOSANTS                    */00257204
  20  NULIG  PIC '(6)9',   /* NUMERO LIGNE                            */00258204
  20  EAN13  CHAR (13),    /* CODE EAN 13 PRODUIT                     */00259204
  20  TYPRO  CHAR (01),    /* TYPE DE PRODUIT                         */00260204
                           /*    ='U' SI UNITAIRE                     */00261204
                           /*    ='C' SI COLIS HOMOGENE TAXE          */00262204
                           /*    ='M' SI COLIS HETEROGENE TAXE        */00263204
                           /*    ='A' SI ATM                          */00264204
 10   CT,                  /* INFO COMPTEURS ET GESTION               */00265204
  20  LIBTI  CHAR (35),    /* DESIGNATION PRODUIT                     */00266204
  20  NUART  CHAR (07),    /* CODE ARTICLE HACHETTE                   */00267204
  20  TXTAX  PIC '999V99', /* TAUX DE TAXE - TAUX TVA                 */00268204
  20  QTFAC  PIC '(10)9V99999',  /*  QUANTITE - NBTOM                 */00269204
  20  PPUHT  PIC '(10)9V99999',  /* PRIX PUBLIC HT                    */00270204
  20  PPUTC  PIC '(10)9V99999',  /* PRIX PUBLIC TC                    */00271204
  20  PUNHT  PIC '(10)9V99999',  /* PRIX UNITAIRE NET HT              */00272204
  20  SNETHT CHAR (01),          /* SIGNE                             */00273204
  20  NETHT  PIC '(9)9V99999',   /* MONTANT NET HT                    */00274204
  20  SMTREM CHAR (01),          /* SIGNE                             */00275204
  20  MTREM  PIC '(9)9V99999',   /* MONTANT REMISE                    */00276204
  20  TXREM  PIC '999V99', /* TAUX DE LA REMISE                       */00277204
  20  NBECH  PIC '(5)9',   /* NOMBRE ECHEANCE(S)                      */00278204
  20  QUARF  CHAR (03),    /* QUALIFIANT REFERENCE LIGNE              */00279204
  20  REFLI  CHAR (15),    /* REFERENCE LIGNE                         */00280204
  20  DTECH  CHAR (08),    /* DATE ECHEANCE                           */00281204
  20  SMTECH CHAR (01),          /* SIGNE                             */00282204
  20  MTECH  PIC '(9)9V99999',   /* MONTANT ECHEANCE                  */00283204
  20  NOAUT  CHAR (35),    /* NOM AUTEUR                              */00284204
  20  LIEDI  CHAR (35),    /* NOM EDITEUR ET DIVISION                 */00285204
  20  SURRE  CHAR (01),    /* CODE SURREMISE                          */00286204
  20  QTPCO  PIC '(10)9V99999',  /*  QUANTITE PAR COMBIEN             */00287204
  20  FILXX  CHAR (858),   /* COMPLEMENT POUR LRECL UNIQUE            */00288204
  20  FXXXX  CHAR (000);   /* FIN LIGNE FACTURE                       */00289204
 /*-- ------------------------------------------------------------ --*/ 00290204
0DCL 01 DEMAT_LEC ,                                                     00291204
 10   ID     LIKE DEMAT_GEN.ID,                                         00292204
 10   GS,                  /* ZONES DE GESTION ECHEANCE LIGNE         */00293204
  20  TYPEN  CHAR (03),    /* TYPE ENREG "LEC"                        */00294204
  20  NULOT  CHAR (14),    /* NUMERO LOT                              */00295204
  20  EANFO  CHAR (13),    /* NUMERO CLIENT                           */00296204
  20  NUFAC  CHAR (15),    /* RUNFA NUFAC                             */00297204
  20  NUMBL  CHAR (13),    /* NUMERO DE BL                            */00298204
  20  NULIG  PIC '(6)9',   /* NUMERO LIGNE                            */00299204
  20  DTECH  CHAR (08),    /* DATE ECHEANCE                           */00300204
  20  SMTECH CHAR (01),    /* SIGNE                                   */00301204
  20  MTECH  PIC '(9)9V99999', /* MONTANT ECHEANCE TTC                */00302204
  20  FILXX  CHAR (1113),  /* COMPLEMENT POUR LRECL UNIQUE            */00303204
  20  FXXXX  CHAR (000);   /* FIN LIGNE FACTURE                       */00304204
 /*-- ------------------------------------------------------------ --*/ 00305204
0DCL 01 DEMAT_PIE ,                                                     00306204
 10   ID     LIKE DEMAT_GEN.ID,                                         00307204
 10   GS,                  /* ZONES DE GESTION PIED DE FACTURE        */00308204
  20  TYPEN  CHAR (03),    /* TYPE ENREG "PIE"                        */00309204
  20  NULOT  CHAR (14),    /* NUMERO LOT                              */00310204
  20  EANFO  CHAR (13),    /* NUMERO CLIENT                           */00311204
  20  NUFAC  CHAR (15),    /* RUNFA NUFAC                             */00312204
  20  TXTVA  PIC '(3)9V99',   /* TAUX TVA                             */00313204
  20  SMONHT CHAR (01),       /* SIGNE                                */00314204
  20  MONHT  PIC '(9)9V99999',/* MONTANT HT                           */00315204
  20  SMTTVA CHAR (01),       /* SIGNE                                */00316204
  20  MTTVA  PIC '(9)9V99999',/* MONTANT TVA                          */00317204
  20  SMTTTC CHAR (01),       /* SIGNE                                */00318204
  20  MTTTC  PIC '(9)9V99999',/* MONTANT TTC                          */00319204
  20  QTTOT  PIC '(10)9V99999',/* TOTAL QUANTITE FACTURE              */00320207
  20  FILXX  CHAR (1090),  /* COMPLEMENT POUR LRECL UNIQUE            */00321206
  20  FXXXX  CHAR (000);   /* FIN PIED FACTURE                        */00322204
 /*-- ------------------------------------------------------------ --*/ 00323204
 /*-- ----- FIN DE STRUCTURE FICHIER FACTURE DEMATERIALISEE ------ --*/ 00324204
 /*-- ------------------------------------------------------------ --*/ 00325204
 /*    END INCLUDE++                                                  */        
  /*-- -------------------------------------------- --*/                01839   
  /*-- STRUCTU. FICHIER LOG DES COMMENTAIRES    --- --*/                01840   
  /*-- -------------------------------------------- --*/                01841   
 /*    INCLUDE++ IDDLOGCO                                             */01842   
        /* DATA SET IDDLOGCO   AT LEVEL 004 AS OF 30/12/04    */                
 /* OBJET CREE PAR:SMARTIN  LE:20/12/04 A 11:39:04          */          00001   
 /* FACTURES DEMATERIALISEES FICHIER LOG COMMENTAIRES       */          00002   
 DCL 01 LOG_COM                            ,                            00003**2
  20  TYPEN  CHAR (03),    /* TYPE ENREG "LOG"                        */00004**2
  20  NORUN  CHAR (03),    /* NUMERO DE RUN                           */00005**2
  20  DTRUN  CHAR (08),    /* DATE   DU RUN                           */00006**4
  20  NULOT  CHAR (14),    /* NUMERO LOT                              */00007**2
  20  EANFO  CHAR (13),    /* NUMERO CLIENT                           */00008**2
  20  NUFAC  CHAR (15),    /* RUNFA NUFAC                             */00009**2
  20  TYPCOM CHAR (03),    /* TYPE DE COMMENTAIRE ='AAI'              */00010**4
  20  ZOCOM  CHAR (70),    /* ZONE COMMENTAIRE                        */00011**2
  20  FILRE  CHAR (100),   /* COMPLEMENT POUR LRECL UNIQUE            */00012**2
  20  FILXX  CHAR (00);    /*   FIN ENREGISTREMENT LOG                */00013**3
 /*    END INCLUDE++                                                  */        
1                                       /*******************************01843   
                                        *    VARIABLES POUR DEMAT      *01844   
                                        *******************************/01845   
       DCL   TOP_DEMA_LIG     CHAR (1) ,                                01846   
             TOP_DEMA_LEC     CHAR (1) ,                                01847   
             SVG_DEMA_FAC     CHAR (1) ,                                01848   
             SVG_DEMA_ECR     CHAR (1)         INIT (' '),              01849   
             SVG_DEMAT_TXTAX  PIC '(3)9V99',                            01850   
             SVG_DEMAT_COTAX  CHAR (1) ,                                01851   
             EDIT_EAN         CHAR (13),                                01852   
             SVG_DAECH        CHAR (6) ,                                01853   
             SVG_RECO1        CHAR (17),                                01854   
             SVG_RECO1_D      CHAR (17),                                01855   
             SVG_RESAI        CHAR (10),                                01856   
             SVG_RESAI_D      CHAR (10),                                01857   
             SVG_REPIE        CHAR (04),                                01858   
             SVG_REPIE_D      CHAR (04),                                01859   
             SVG_NORUN        CHAR (03),                                01860   
             SVG_NORUN_D      CHAR (03),                                01861   
             SVG_TYREF        CHAR (01),                                01862   
             SVG_NUEDI        CHAR (03),                                01863   
             SVG_NUDIV        CHAR (02),                                01864   
             SVG_NUCOL        CHAR (02),                                01865   
             M001_NOCRD       CHAR (50),                                01866   
             M001_ADCRD       CHAR (50),                                01867   
             M001_VICRD       CHAR (50),                                01868   
             COTAX_COLIS      CHAR (01),                                01869   
             TRANSP_DEMAT     CHAR (01),                                01870   
             TRANSP_DEMAT_D   CHAR (01),                                01871   
             TXTVT_DEMAT      CHAR (05),                                01872   
             EMBALL_DEMAT     CHAR (01),                                01873   
             EMBALL_DEMAT_D   CHAR (01),                                01874   
             TXTVE_DEMAT      CHAR (05),                                01875   
             SVG_NUART        CHAR (07),                                01876   
             SVG_LIBEL        CHAR (42),                                01877   
             SVG_OPERA        CHAR (25),                                01878   
             SVG_OPERA_D      CHAR (25),                                01879   
             SVG_LOREC_P      PIC '(5)9',                               01880   
             SVG_LOREC_PD     PIC '(5)9',                               01881   
             SVG_LOREC        DEC FIXED (5),                            01882   
             SVG_LOREC_D      DEC FIXED (5),                            01883   
             SVG_NULIG        DEC FIXED (9)    INIT (0) ,               01884   
             SVG_AMTTC        DEC FIXED (15,2) INIT (0) ,               01885   
             SVG_MTEMB_TTC    DEC FIXED (15,2) INIT (0) ,               01886   
             SVG_MTEMB_HT     DEC FIXED (15,2) INIT (0) ,               01887   
             F15D2            DEC FIXED (15,2) INIT (0) ,               01888   
             DEMAT_QTTOT      DEC FIXED (15,0) INIT (0) ,               01889   
             NBCOM_COLIS      DEC FIXED (15,0) INIT (0) ,               01890   
             NBCOM_COLIS_D    DEC FIXED (15,0) INIT (0) ,               01891   
             NBTAX_COLIS      DEC FIXED (15,0) INIT (0) ,               01892   
             NBCOM_ATM        DEC FIXED (15,0) INIT (0) ,               01893   
             NBCOM_ATM_D      DEC FIXED (15,0) INIT (0) ,               01894   
             NB_FICDEMA       DEC FIXED (15,0) INIT (0) ,               01895   
             NB_FICLCOM       DEC FIXED (15,0) INIT (0) ,               01896   
             CTR_LEC_DEMA     DEC FIXED (15,0) INIT (0) ,               01897   
             CTR_LIG_DEMA     DEC FIXED (15,0) INIT (0) ,               01898   
             DEMAT_REF_EXIST_DQ CHAR (1) ,                              01899   
             DEMAT_REF_EXIST_ON CHAR (1) ,                              01900   
             DEMAT_REF_EXIST_SS CHAR (1) ,                              01901   
             DEMAT_REF_EXIST_VN CHAR (1) ,                              01902   
             DEMAT_REF_EXIST_04G CHAR (1),                              01903   
             MT_PIC           PIC'ZZZ.ZZZ.ZZ9V,99-';                    01904   
       DCL   WS_FD_NBECH      PIC '(5)9';                               01905   
       DCL   PRIX_NS          PIC '(5)9V99';                            01906   
       DCL   PRIX_DEC         CHAR (7)     BASED(ADDR(PRIX_NS));        01907   
       DCL   REMIS_NS         PIC '(3)9V99';                            01908   
       DCL   REMIS_DEC        CHAR (5)     BASED(ADDR(REMIS_NS));       01909   
       DCL   NET_NS           PIC '(8)9V99';                            01910   
       DCL   NET_DEC          CHAR (10)    BASED(ADDR(NET_NS));         01911   
       DCL   QUANT_NS         PIC '(6)9';                               01912   
       DCL   QUANT_DEC        CHAR (6)     BASED(ADDR(QUANT_NS));       01913   
       DCL   TXTVTN_DEMAT     PIC '999V99' BASED(ADDR(TXTVT_DEMAT));    01914   
       DCL   TXTVEN_DEMAT     PIC '999V99' BASED(ADDR(TXTVE_DEMAT));    01915   
       DCL 1 SVG_DEMAT_COLIS,                                           01916   
             10 ID            LIKE DEMAT_GEN.ID,                        01917   
             10 GS            LIKE DEMAT_LIG.GS,                        01918   
             10 CT            LIKE DEMAT_LIG.CT;                        01919   
       DCL 1 SVG_DEMAT_ATM,                                             01920   
             10 ID            LIKE DEMAT_GEN.ID,                        01921   
             10 GS            LIKE DEMAT_LIG.GS,                        01922   
             10 CT            LIKE DEMAT_LIG.CT;                        01923   
1 /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                01924   
  /* DESCRIPTION DES STRUCTURES DU FICHIER DE STOCKAGE*/                01925   
  /* DES FACTURES D�MAT�RIALIS�ES                     */                01926   
  /*-- -------------------------------------------- --*/                01927   
  /*-- STRUCTU. FICHIER STOCK FACT. DEMATERIALSEE - --*/                01928   
  /*-- -------------------------------------------- --*/                01929   
0DCL 01 STO_D_GEN ,                                                     01930   
 10   ID,                   /* ARGUMENT DE TRI ZONE COMMUNE           */01931   
  20  SYPRO  CHAR(02),      /* SYSTEME DE PROSPECTION                 */01932   
  20  AFFIL  CHAR(02),      /* REFERENCE CENTRALE                     */01933   
  20  NUCLI  CHAR(06),      /* NUMERO DE CLIENT                       */01934   
  20  RUNFA  CHAR(03),      /* NO DE RUN DE FACTURATION    PARAMETRE  */01935   
  20  NUFAC  DEC FIXED(5),  /* INDICATIF DE LA FACTURE                */01936   
  20  DAFAC  CHAR(08),      /* DATE DE FACTURE AAAAMMJJ               */01937   
  20  COENR  CHAR(01),      /* CLASSEMENT TYPE DE LIGNES              */01938   
                            /*   'A' POUR ENT                         */01939   
                            /*   'B' POUR ECH                         */01940   
                            /*   'C' POUR COM                         */01941   
                            /*   'D' POUR REF                         */01942   
                            /*   'E' POUR ADR                         */01943   
                            /*   'F' POUR BOR                         */01944   
                            /*   'G' POUR LIG                         */01945   
                            /*   'H' POUR LEC                         */01946   
                            /*   'I' POUR PIE                         */01947   
  20  ENSEQ  DEC FIXED(7),  /* NUMERO DE SEQUENCE DANS LA LIGNE       */01948   
 10   GS,                   /* ZONES DE GESTION                       */01949   
  20  INFO   CHAR(1200);    /* INFORMATIONS                           */01950   
 /*-- ------------------------------------------------------------ --*/ 01951   
0DCL 01 STO_D_FIC ,                                                     01952   
 10   ID     LIKE STO_D_GEN.ID,                                         01953   
 10   GS     LIKE DEMAT_FIC.GS; /* ZONES DE GESTION DEBUT DE FICHIER  */01954   
 /*-- ------------------------------------------------------------ --*/ 01955   
0DCL 01 STO_D_ENT ,                                                     01956   
 10   ID     LIKE STO_D_GEN.ID,                                         01957   
 10   GS     LIKE DEMAT_ENT.GS; /* ZONES DE GESTION ENTETE DE FACTURE */01958   
 /*-- ------------------------------------------------------------ --*/ 01959   
0DCL 01 STO_D_ECH ,                                                     01960   
 10   ID     LIKE STO_D_GEN.ID,                                         01961   
 10   GS     LIKE DEMAT_ECH.GS; /* ZONES DE GESTION ECHEANCE FACTURE  */01962   
 /*-- ------------------------------------------------------------ --*/ 01963   
0DCL 01 STO_D_COM ,                                                     01964   
 10   ID     LIKE STO_D_GEN.ID,                                         01965   
 10   GS     LIKE DEMAT_COM.GS; /* ZONES DE GESTION LIGNES COMMENTAIRE*/01966   
 /*-- ------------------------------------------------------------ --*/ 01967   
0DCL 01 STO_D_REF ,                                                     01968   
 10   ID     LIKE STO_D_GEN.ID,                                         01969   
 10   GS     LIKE DEMAT_REF.GS; /* ZONES DE GESTION REFERENCE FACTURE */01970   
 /*-- ------------------------------------------------------------ --*/ 01971   
0DCL 01 STO_D_ADR ,                                                     01972   
 10   ID     LIKE STO_D_GEN.ID,                                         01973   
 10   GS     LIKE DEMAT_ADR.GS; /* ZONES DE GESTION LIGNE ADRESSE     */01974   
0DCL 01 STO_D_AD2 ,                                                     01975   
 10   ID     LIKE STO_D_GEN.ID,                                         01976   
 10   GS     LIKE DEMAT_AD2.GS; /* ZONES DE GEST.LIGNE ADRESSE COMPLEM*/01977   
 /*-- ------------------------------------------------------------ --*/ 01978   
0DCL 01 STO_D_LIG ,                                                     01979   
 10   ID     LIKE STO_D_GEN.ID,                                         01980   
 10   GS     LIKE DEMAT_LIG.GS, /* ZONES DE GESTION LIGNE DE FACTURE  */01981   
 10   CT     LIKE DEMAT_LIG.CT; /* INFO COMPTEURS ET GESTION          */01982   
 /*-- ------------------------------------------------------------ --*/ 01983   
0DCL 01 STO_D_LEC ,                                                     01984   
 10   ID     LIKE STO_D_GEN.ID,                                         01985   
 10   GS     LIKE DEMAT_LEC.GS; /* ZONES DE GESTION ECHEANCE LIGNE    */01986   
 /*-- ------------------------------------------------------------ --*/ 01987   
0DCL 01 STO_D_PIE ,                                                     01988   
 10   ID     LIKE STO_D_GEN.ID,                                         01989   
 10   GS     LIKE DEMAT_PIE.GS; /* ZONES DE GESTION PIED DE FACTURE   */01990   
  /*-- ------------------------------------------------ --*/            01991   
  /*-- FIN STRUCTU. FICHIER STOCK FACT. DEMATERIALSEE - --*/            01992   
  /*-- ------------------------------------------------ --*/            01993   
                                                                        01994   
  /*DESCRIPTION DE LA STRUCTURE DU FICHIER DE STOCKAGE*/                01995   
  /* DES FACTURES PAPIER                              */                01996   
  /*-- -------------------------------------------- --*/                01997   
  /*-- STRUCTU. FICHIER STOCK FACT. PAPIER        - --*/                01998   
  /*-- -------------------------------------------- --*/                01999   
0DCL 01 STO_P_GEN ,                                                     02000   
 10   ID,                   /* ARGUMENT DE TRI ZONE COMMUNE           */02001   
  20  SYPRO  CHAR(02),      /* SYSTEME DE PROSPECTION                 */02002   
  20  AFFIL  CHAR(02),      /* REFERENCE CENTRALE                     */02003   
  20  NUCLI  CHAR(06),      /* NUMERO DE CLIENT                       */02004   
  20  RUNFA  CHAR(03),      /* NO DE RUN DE FACTURATION    PARAMETRE  */02005   
  20  NUFAC  DEC FIXED(5),  /* INDICATIF DE LA FACTURE                */02006   
  20  DAFAC  CHAR(08),      /* DATE DE FACTURE AAAAMMJJ               */02007   
  20  ENSEQ  DEC FIXED(9),  /* NUMERO DE SEQUENCE DANS LA LIGNE       */02008   
 10   GS,                   /* ZONES DE GESTION                       */02009   
  20  SAUT   CHAR(001) ,    /* INFORMATIONS                           */02010   
  20  POLIC  CHAR(001) ,    /* INFORMATIONS                           */02011   
  20  INFO   CHAR(204) ;    /* INFORMATIONS                           */02012   
0DCL 01 STO_P_GEN_AS        LIKE STO_P_GEN;                             02013   
 DCL 01 STO_P_GEN_CH5A1     LIKE PAG1_POR  BASED(ADDR(STO_P_GEN.GS));   02014   
 DCL 01 STO_P_GEN_CH5A2     LIKE PAG1_POR  BASED(ADDR(STO_P_GEN.GS));   02015   
 DCL 01 FICSTOP_PREV        CHAR (235);                                 02016   
 DCL 01 FICSTOP_PREV_GEN    LIKE STO_P_GEN BASED(ADDR(FICSTOP_PREV));   02017   
  /*-- ------------------------------------------------ --*/            02018   
  /*-- FIN STRUCTU. FICHIER STOCK FACT. PAPIER        - --*/            02019   
  /*-- ------------------------------------------------ --*/            02020   
                                                                        02021   
0 /* DESCRIPTION DES ZONES DE TRAVAIL POUR LE STOCKAGE*/                02022   
  /* DES FACTURES                                     */                02023   
       DCL   COTAX_COLIS_D    CHAR (01)                                 02024   
            ,SVG_STO_D_TXTAX  PIC '(3)9V99'                             02025   
            ,SVG_STO_D_COTAX  CHAR (1)                                  02026   
            ,CTR_ENSEQ_D      DEC FIXED (9)    INIT (0)                 02027   
            ,NBTAX_COLIS_D    DEC FIXED (15,0) INIT (0)                 02028   
            ,NB_FICSTOD       DEC FIXED (15,0) INIT (0)                 02029   
            ,NB_FICSTOP       DEC FIXED (15,0) INIT (0)                 02030   
            ,STO_D_QTTOT      DEC FIXED (15,0) INIT (0)                 02031   
            ,CTR_LIG_STOD     DEC FIXED (15,0) INIT (0)                 02032   
            ,STO_D_REF_EXIST_DQ CHAR (1)                                02033   
            ,STO_D_REF_EXIST_ON CHAR (1)                                02034   
            ,STO_D_REF_EXIST_SS CHAR (1)                                02035   
            ,STO_D_REF_EXIST_VN CHAR (1)                                02036   
            ,STO_D_REF_EXIST_04G CHAR (1)                               02037   
            ,STO_P_SYPRO         CHAR (2)                               02038   
            ,STO_P_AFFIL         CHAR (2)                               02039   
            ;                                                           02040   
0DCL 01 STO_P_WOR                                                       02041   
          /* NUMERO DE PAGE FACTURE DISTRIBUTION      */                02042   
           ,03 IIPAGEFDX                                                02043   
            ,04 IIPAGEFD      FIXED BIN(15,0)                           02044   
          /* NUMERO DE LIGNE DANS LA PAGE FACTURE DIS */                02045   
           ,03 IILIGNFDX                                                02046   
            ,04 IILIGNFD      FIXED BIN(15,0)                           02047   
          /* CODE FOND DE PAGE SITE CENTRAL           */                02048   
           ,03 COFPAGSC       CHAR(08)                                  02049   
          /* NUMERO D'ORDRE DANS LA LIGNE FACTURE DIS */                02050   
           ,03 IIORLIFDX                                                02051   
            ,04 IIORLIFD      FIXED BIN(15,0)                           02052   
          /* IDENTIFIANT DE LA POLICE DE CARACTERES S */                02053   
           ,03 IDPOCASC       PIC'999'                                  02054   
            ;                                                           02055   
      DCL 01  STO_P_WOR_R     CHAR(17) BASED (ADDR(STO_P_WOR));         02056   
      DCL 01  STO_P_WOR_AS    LIKE STO_P_WOR ;                          02057   
                                                                        02058   
0      DCL 1 SVG_STO_D_COLIS,                                           02059   
             10 ID            LIKE STO_D_GEN.ID,                        02060   
             10 GS            LIKE DEMAT_LIG.GS,                        02061   
             10 CT            LIKE DEMAT_LIG.CT;                        02062   
       DCL 1 SVG_STO_D_ATM,                                             02063   
             10 ID            LIKE STO_D_GEN.ID,                        02064   
             10 GS            LIKE DEMAT_LIG.GS,                        02065   
             10 CT            LIKE DEMAT_LIG.CT;                        02066   
       DCL CTR_STO_COM        DEC FIXED(9) INIT (0)     ;               02067   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                02068   
  /*-- -------------------------------------------- --*/                02069   
  /*-- GESTION DES FACTURES DEMATERIALISEES   ----- --*/                02070   
  /*--   DEBUT AJOUT SMARTIN DU 17/12/2004    ----- --*/                02071   
  /*--   VARIABLES GESTION FACT.DEMATERIALISEES     --*/                02072   
       DCL 1 DFDTF,                                                     02073   
             2 AAAA           CHAR (4)     INIT ((4)' '),               02074   
             2 MM             CHAR (2)     INIT ((2)' '),               02075   
             2 JJ             CHAR (2)     INIT ((2)' ');               02076   
       DCL TOP_DEMA_CLI       CHAR (1)     INIT (' ')   ;               02077   
       DCL TOP_DEMA_FAC       CHAR (1)     INIT (' ')   ;               02078   
       DCL TOP_DEMA_ECR       CHAR (1)     INIT (' ')   ;               02079   
       DCL TOP_EDI            CHAR (1)     INIT (' ')   ;               02080   
       DCL MOD_DEMA           CHAR (1)     INIT (' ')   ;               02081   
       DCL DF_TYPFA           CHAR (3)     INIT (' ')   ;               02082   
       DCL WKSIEGE            CHAR (13)    INIT (' ')   ;               02083   
       DCL DF_SVG_RECO1       CHAR (17)    INIT (' ')   ;               02084   
       DCL DF_SVG_RESAI       CHAR (15)    INIT (' ')   ;               02085   
       DCL DF_SVG_LIEDI       CHAR (15)    INIT (' ')   ;               02086   
       DCL DF_SVG_LIDIV       CHAR (15)    INIT (' ')   ;               02087   
       DCL DF_NB_ECH          DEC FIXED(3) INIT (0)     ;               02088   
       DCL DF_NB_LFA          DEC FIXED(9) INIT (0)     ;               02089   
       DCL CTR_LIG_COM        DEC FIXED(9) INIT (0)     ;               02090   
       DCL NTOLEG             PIC '(5)9V99' BASED(P_TOLEG) ;            02091   
       DCL P_TOLEG            PTR                          ;            02092   
       DCL ATOLEG             CHAR (07)                    ;            02093   
       DCL 1 WL_CLLIV ,                                                 02094   
           2 NUCLI          CHAR (13)    INIT (' ')   ,                 02095   
           2 NOCLI          CHAR (35)    INIT (' ')   ,                 02096   
           2 RASOC          CHAR (35)    INIT (' ')   ,                 02097   
           2 ADCLI          CHAR (35)    INIT (' ')   ,                 02098   
           2 LORES          CHAR (35)    INIT (' ')   ,                 02099   
           2 LOBDI          CHAR (35)    INIT (' ')   ,                 02100   
           2 CPCLI          CHAR (09)    INIT (' ')   ,                 02101   
           2 CPAYS          CHAR (02)    INIT (' ')   ,                 02102   
           2 SIRFA          CHAR (09)    INIT (' ')   ,                 02103   
           2 MAGTV          CHAR (13)    INIT (' ')   ;                 02104   
                                                                        02105   
       DCL 1 WF_CLFAC       LIKE WL_CLLIV ;                             02106   
                                                                        02107   
       DCL 1 LC_BORD  ,                                                 02108   
           2 FIL01          CHAR (08)    INIT ('TOTAL    ')   ,         02109   
           2 QUANT          PIC 'ZZZZ.ZZZ-'                   ,         02110   
           2 FIL02          CHAR (03)    INIT ('   ')         ,         02111   
           2 FIL03          CHAR (09)    INIT ('BORD 1 A ')   ,         02112   
           2 NUBOR          PIC 'ZZZ'                         ,         02113   
           2 FIL04          CHAR (03)    INIT ('   ')         ;         02114   
                                                                        02115   
       DCL 1 LA_ENT   ,                                                 02116   
           2 FIL01          CHAR (15)    INIT ('N. FOURNISSEUR ')  ,    02117   
           2 FIL02          CHAR (03)    INIT (' ')                ,    02118   
           2 FIL03          CHAR (14)    INIT ('EDITEUR ')         ,    02119   
           2 FIL04          CHAR (08)    INIT ('  FORTC ')         ,    02120   
           2 FIL05          CHAR (10)    INIT ('    FORHT ')       ,    02121   
           2 FIL06          CHAR (10)    INIT ('    NETTC ')       ,    02122   
           2 FIL07          CHAR (10)    INIT ('    NETHT ')       ;    02123   
                                                                        02124   
       DCL 1 LA_DET   ,                                                 02125   
           2 ACCORD         CHAR (11)    INIT (' ')                ,    02126   
           2 FIL01          CHAR (01)    INIT (' ')                ,    02127   
           2 LIBEL          CHAR (17)    INIT (' ')                ,    02128   
           2 FIL02          CHAR (01)    INIT (' ')                ,    02129   
           2 FORTC          PIC 'ZZZZZ9V,99'                       ,    02130   
           2 FIL03          CHAR (01)    INIT (' ')                ,    02131   
           2 FORHT          PIC 'ZZZZZ9V,99'                       ,    02132   
           2 FIL04          CHAR (01)    INIT (' ')                ,    02133   
           2 NETTC          PIC 'ZZZZZ9V,99'                       ,    02134   
           2 FIL05          CHAR (01)    INIT (' ')                ,    02135   
           2 NETHT          PIC 'ZZZZZ9V,99'                       ,    02136   
           2 FIL06          CHAR (01)    INIT (' ')                ;    02137   
  /*-- -------------------------------------------- --*/                02138   
       DCL F15D3       DEC FIXED (15,3);                                02139   
       DCL F15D4       DEC FIXED (15,4);                                02140   
       DCL CENT        DEC FIXED (15,2) INIT (100) ;                    02141   
       DCL W_FOBFF     DEC FIXED (15,2);                                02142   
       DCL W_FOBEU     DEC FIXED (15,2);                                02143   
       DCL ASS_FOB     DEC FIXED (15,2);                                02144   
       DCL 01 W_CLEFOB,                                                 02145   
             02 W_FRAET     CHAR      (1),                              02146   
             02 W_DEPAY     CHAR      (3),                              02147   
             02 W_SPENV     CHAR      (2),                              02148   
             02 W_ECFAC     CHAR      (1);                              02149   
       DCL W_ENTE_PORT CHAR (3)        ;                                02150   
1                                       /*******************************02151   
                                        *                              *02152   
                                        *    MODULES EXTERNES          *02153   
                                        *                              *02154   
                                        *******************************/02155   
-      DCL   ID470A           ENTRY;    /*   MODULE CHARGEMENT TABLES */02156   
       DCL   ID470B           ENTRY;    /*   MODULE RECHERCHE TABLES  */02157   
       DCL   ID470C           ENTRY;    /*   MODULE CADRAGE PAPIER    */02158   
       DCL   ID470D           ENTRY;    /*   EDITON DES ANOMALIES     */02159   
       DCL   ID470E           ENTRY;    /*   ENREG FF ETATS TEMOINS   */02160   
       DCL   ID470F           ENTRY;    /*   STOCKAGE FACTURES MULTIPL*/02161   
                                        /*   ID470G SUPPRIME  22.04.91*/02162   
-      DCL   HDICHOA          ENTRY OPTIONS(ASM,INTER);                 02163   
       DCL   MACSPOO3         ENTRY OPTIONS(ASM,INTER);                 02164   
     /*DCL   KPUTI10          ENTRY OPTIONS(ASM,INTER);               */02165   
  /*   DCL   HSTATIMS         ENTRY OPTIONS(ASM INTER)  YDU 07.05 */    02166   
       DCL   SPI2TBV          ENTRY OPTIONS(ASM,INTER);                 02167   
 /*    INCLUDE++ SPIDPBAT                                             */02168   
        /* DATA SET SPIDPBAT   AT LEVEL 001 AS OF 02/10/90    */                
        /* DATA SET SPIDPBAT   AT LEVEL 007 AS OF 08/07/87    */        00001   
0/* --- PARAMETRES DU MODULE D'INTERFACE  SPITAB/BATCH            --- */00002   
 DCL 1 SPIPA  ,                                                         00003   
       3 FONCT    CHAR      (   2) , /* FONCTION DEMANDEE             */00004   
       3 NBPOS    FIXED BIN (31,0) , /* NOMBRE DE POSTES              */00005   
       3 CORET    CHAR      (   2) , /* CODE RETOUR DE L'ACCESSEUR    */00006   
       3 COTAB    CHAR      (   8) , /* NOM DE LA TABLE A TRAITER     */00007   
       3 ELDEM    CHAR      (  60) , /* ELEMENTS A ACQUERIR           */00008   
       3 ELREC    CHAR      (  60) , /* ARGUMENTS DE RECHERCHE ('GS') */00009   
       3 OPERA    CHAR      (   2) , /* OPERATEUR (= ,> ,=D,=I)       */00010   
       3 REFPO    CHAR      (  50) , /* REFERENCE DU POSTE            */00011   
       3 REFFI    CHAR      (  50) ; /* REF. FIN DE PLAGE(GT,ST,GS)   */00012   
 DCL 1 SPIFI  ,                                                         00013   
       3 FNAME    CHAR      (   8) , /* NOM DU FICHIER                */00014   
       3 RESER    CHAR      (   2) , /* $$$ RESERVE A SPITAB $$$      */00015   
       3 STATU    CHAR      (   2) ; /* CODE RETOUR VSAM              */00016   
 DCL   SPIIO      CHAR      (4000) ; /* ZONE D'ENTREE SORTIE          */00017   
 /*    END INCLUDE++                                                  */        
1                                                                       02169   
 /*    INCLUDE++ IDD470A                                              */02170   
        /* DATA SET IDD470A    AT LEVEL 001 AS OF 18/02/84    */                
0/* ZONE DE COMMUNICATION ENTRE  IDP470RA ET IDP470F          */        00001   
 /*--------------------------------------------------------*/           00002   
0DCL 01 PASTK EXTERNAL,                                                 00003   
0 02 LGMVT FIXED BIN(31),/* LG ZONE D ENTREE (CALCUL PAR CSTG)        */00004   
  02 PWTMVT PTR   ,      /* ADRESSE MVT A ECRIRE OU LIRE              */00005   
  02 PWTSTK PTR   ,      /* ADRESSE DERNIER MVT STOCKE DANS TBSTK     */00006   
  02 PZASTK PTR   ,      /* ADRESSE ANOMALIE DERNIER MVT DANS TBSTK   */00007   
  02 NBEST FIXED BIN(31),/* NB ENREG. STOCKES EN TABLE / LOT          */00008   
  02 NBELU FIXED BIN(31),/* NB ENREG. LUS     EN TABLE / LOT          */00009   
0 02 CODGT CHAR(1),      /* CODE GENERAL TABLE. D=DEBUT TABLE         */00010   
                         /* O=OUVERTURE FICHIER.F=FERMETUR FICHIER    */00011   
  02 CODLE CHAR(1),      /* CODE LECTURE/ECRITURE  L OU E             */00012   
  02 CODXX CHAR(2),      /* POUR CADRAGE BINAIRE                      */00013   
0 02 ST, /* --- STATISTIQUES DE TRASTK (IDP470F) --- */                 00014   
   03 FSQEC FIXED BIN(31),/* NB BLOCS ECRITS SUR FTRSQ(FITRA)         */00015   
   03 FDAEC FIXED BIN(31),/* NB BLOCS ECRITS SUR FTRDA(FITRA)         */00016   
   03 FDALU FIXED BIN(31),/* NB BLOCS LUS    SUR FTRDA(FITRA)         */00017   
   03 STEEC FIXED BIN(31),/* NB ENREG ECRITS SUR FITRA                */00018   
   03 STELU FIXED BIN(31),/* NB ENREG LUS    SUR FITRA                */00019   
  02 FIN    CHAR(0);                                                    00020   
 /*    END INCLUDE++                                                  */        
1                                                                       02171   
    /*   INCLUDE SPOLASA0               POUR MEMOIRE > 16 M  30.06.10*/ 02172   
 /*    INCLUDE++ SPOLA3A0                                             */02173   
        /* DATA SET SPOLA3A0   AT LEVEL 007 AS OF 24/01/13    */                
 /* OBJET CREE PAR : WAM      LE 28/06/10 A 14:41:50        */          00001   
 /* VARIABLES POUR L UTILISATION DE SPOOLA32 / SPOOLA3B     */          00002**4
0            /*------------------------------------------*/             00003**2
             /* VARIABLES POUR L'UTILISATION DE SPOOLA3B */             00004**3
             /* ET SPOLTIA2 (SPOLIA2)                    */             00005**6
             /*------------------------------------------*/             00006**2
   DCL                                                                  00007**2
          SPOOLA32  ENTRY OPTIONS(ASM,INTER) ;                          00008**3
0  DCL                                                                  00009**2
      1   ZSPOOL              ,                                         00010**2
       2  ZSAUT  CHAR(001)    , /* CODE SAUT : (STANDARD ASA )        */00011**2
       2  ZIMP   CHAR(205)    , /* ZONE A EDITER (MAXIMUM)            */00012**2
                                /*   TRONQUEE EN FONCTION DU RECSIZE  */00013**2
       2  FIN    CHAR(000)    ;                                         00014**2
0  DCL                                                                  00015**2
      1   ZSPOOLP  BASED(ADDR(ZSPOOL)),                                 00016**2
       2  ZSAUT  CHAR(001)    , /* CODE SAUT : (STANDARD ASA )        */00017**2
       2  POLIC  CHAR(001)    , /* CODE POLICE (CODER OPTCD DANS DCB) */00018**2
       2  ZIMP   CHAR(204)    , /* ZONE A EDITER (MAXIMUM)            */00019**2
                                /*   TRONQUEE EN FONCTION DU RECSIZE  */00020**2
       2  FIN    CHAR(000)    ;                                         00021**2
0  DCL                                                                  00022**2
      1   SPOOL_O   STATIC           , /* ZONE POUR L'OPEN            */00023**2
       2  FILL1  CHAR(001)  INIT('') ,                                  00024**2
       2  MESOP  CHAR(023)           ,/* MESSAGE IDENTIFIANT LE SPOOL */00025**2
       2  FILL2  CHAR(008)  INIT('') ,                                  00026**2
       2  CODEH  CHAR(001)  INIT('�'),/* CODE HEXA X'EA' POUR OPEN    */00027**2
       2  LRECL  PIC'999'            ,/* RECSIZE DU FICHIER SPOOL     */00028**2
       2  FIN    CHAR(170)  INIT('') ;                                  00029**2
0  DCL                                                                  00030**2
      1   SPOOL_C   STATIC           , /* ZONE POUR LE CLOSE          */00031**2
       2  FILL1  CHAR(032)  INIT('') ,                                  00032**2
       2  CODEH  CHAR(001)  INIT('�'),/* CODE HEXA X'EF' POUR CLOSE   */00033**2
       2  FIN    CHAR(173)  INIT('') ;                                  00034**2
0  DCL  UN     CHAR(1)    INIT('') ; /* CODE HEXA X'01'              */00035**2
   DCL  DEUX   CHAR(1)    INIT('') ; /* CODE HEXA X'02'              */00036**2
   DCL  TROIS  CHAR(1)    INIT('') ; /* CODE HEXA X'03'              */00037**2
   DCL  QUATRE CHAR(1)    INIT('�') ; /* CODE HEXA X'04'              */00038**2
   DCL  CINQ   CHAR(1)    INIT('	') ; /* CODE HEXA X'05'              */00039**2
   DCL  SIX    CHAR(1)    INIT('�') ; /* CODE HEXA X'06'              */00040**2
   DCL  SEPT   CHAR(1)    INIT('') ; /* CODE HEXA X'07'              */00041**2
   DCL  HUIT   CHAR(1)    INIT('�') ; /* CODE HEXA X'08'              */00042**2
   DCL  NEUF   CHAR(1)    INIT('�') ; /* CODE HEXA X'09'              */00043**2
   DCL  DIX    CHAR(1)    INIT('�') ; /* CODE HEXA X'10'              */00044**2
   DCL  ONZE   CHAR(1)    INIT('') ; /* CODE HEXA X'11'              */00045**2
   DCL  DOUZE  CHAR(1)    INIT('') ; /* CODE HEXA X'12'              */00046**2
   DCL  TREIZ  CHAR(1)    INIT('
') ; /* CODE HEXA X'13'              */00047**2
   DCL  KTORZ  CHAR(1)    INIT('') ; /* CODE HEXA X'14'              */00048**2
   DCL  QUINZ  CHAR(1)    INIT('') ; /* CODE HEXA X'15'              */00049**2
   DCL  SEIZE  CHAR(1)    INIT('') ; /* CODE HEXA X'16'              */00050**2
   DCL  DIX7   CHAR(1)    INIT('') ; /* CODE HEXA X'17'              */00051**2
   DCL  DIX8   CHAR(1)    INIT('') ; /* CODE HEXA X'18'              */00052**2
   DCL  DIX9   CHAR(1)    INIT('') ; /* CODE HEXA X'19'              */00053**2
   DCL  VINGT  CHAR(1)    INIT('�') ; /* CODE HEXA X'20'              */00054**2
0  /* EXEMPLE D'UTILISATION */                                          00055**2
   /* CALL SPOOLA32(UN,ZSPOOL)   */                                     00056**3
-            /*----------------------------------------*/               00057**2
             /* VARIABLES POUR SORTIE DE PAGE DE GARDE */               00058**2
             /* AVEC DES GROSSES LETTRES               */               00059**2
             /*----------------------------------------*/               00060**2
   DCL SPOLIA2 ENTRY ;                                                  00061**6
   DCL                                                                  00062**2
      TBPAGE(4) CHAR(13) ;                                              00063**2
0  /* EXEMPLE D'UTILISATION */                                          00064**2
   /* LA PAGE DE GARDE SE DEFINIT SUR 4 LIGNES                        */00065**2
   /* ON INITIALISE LES POSTES DE TBPAGE AVEC LE CONTENU DE CES LIGNES*/00066**2
   /* CALL SPOLIA2(TBPAGE,ZSPOOL,UN)                                  */00067**7
 /*    END INCLUDE++                                                  */        
1                                       /*****************************/ 02174   
                                        /*TAMPON AVANT ECRITURE FITRA*/ 02175   
       DCL 1 TABLE_PAGE ,     /*YDV P0299*/                             02176   
           5 I_TP  BIN FIXED  (15,0),                                   02177   
           5 J_TP  BIN FIXED  (15,0),                                   02178   
           5 TPLIG (250) CHAR (200);                                    02179   
                                                                        02180   
-      DCL 1 PAG1_POR,                                                  02181   
               3 V_5A         CHAR (01),                                02182   
               3 V_01         CHAR (02),                                02183   
               3 V_D3         CHAR (03),                                02184   
               3 V_00         CHAR (03),                                02185   
               3 V_NOM        CHAR (08),                                02186   
               3 V_23         CHAR (23),                                02187   
               3 FIL          CHAR (95);                                02188   
-      DCL 1 PAG2_POR         LIKE PAG1_POR ;                           02189   
-      DCL 1 PAG1_PAY         LIKE PAG1_POR ;                           02190   
-      DCL 1 PAG2_PAY         LIKE PAG1_POR ;                           02191   
-      DCL 1 PAG1_PPG         LIKE PAG1_POR ;                           02192   
-      DCL 1 PAG2_PPG         LIKE PAG1_POR ;                           02193   
-      DCL 1 PAG1_BLAN        LIKE PAG1_POR ;                           02194   
-      DCL 1 PAG2_BLAN        LIKE PAG1_POR ;                           02195   
1                                       /*******************************02196   
                                        *                              *02197   
                                        *    VARIABLES SPOOLPU3        *02198   
                                        *                              *02199   
                                        *******************************/02200   
0                                       /*   ENREG. ENVOYE A SPOOLPU3 */02201   
1                                      /*    ENREG. FACTURE POUR FTRAV*/02202   
       DCL 1 WTAMPON          CHAR (400)     INIT ((400)' ');           02203   
       DCL 1 WFACT            CHAR (175)     BASED(PLECT);              02204   
       DCL 1 WENTET3          LIKE ENTET3    BASED(PLECT);              02205   
       DCL 1 WENTET4          LIKE ENTET4    BASED(PLECT);              02206   
       DCL 1 WENTET5          LIKE ENTET5    BASED(PLECT);              02207   
       DCL 1 WENTET7          LIKE ENTET7    BASED(PLECT);              02208   
       DCL 1 WENTET65         LIKE ENTET65   BASED(PLECT);              02209   
       DCL 1 WENTET70         LIKE ENTET70   BASED(PLECT);              02210   
       DCL 1 WENTET8          LIKE ENTET8    BASED(PLECT);              02211   
       DCL 1 WENTET9          LIKE ENTET9    BASED(PLECT);              02212   
       DCL 1 WENTET10         LIKE ENTET10   BASED(PLECT);              02213   
       DCL 1 WENTET11         LIKE ENTET11   BASED(PLECT);              02214   
       DCL 1 WENTET12         LIKE ENTET12   BASED(PLECT);              02215   
       DCL 1 WENTET13         LIKE ENTET13   BASED(PLECT);              02216   
             PLECT            = ADDR(WTAMPON);                          02217   
       DCL 1 DTAMPON          CHAR (400)     INIT ((400)' ');           02218   
       DCL 1 DFACT            CHAR (175)     BASED(ADDR(DTAMPON));      02219   
       DCL 1 DENTET3          LIKE ENTET3    BASED(ADDR(DTAMPON));      02220   
       DCL 1 DENTET4          LIKE ENTET4    BASED(ADDR(DTAMPON));      02221   
       DCL 1 DENTET5          LIKE ENTET5    BASED(ADDR(DTAMPON));      02222   
       DCL 1 DENTET7          LIKE ENTET7    BASED(ADDR(DTAMPON));      02223   
       DCL 1 DENTET65         LIKE ENTET65   BASED(ADDR(DTAMPON));      02224   
       DCL 1 DENTET70         LIKE ENTET70   BASED(ADDR(DTAMPON));      02225   
       DCL 1 DENTET8          LIKE ENTET8    BASED(ADDR(DTAMPON));      02226   
       DCL 1 DENTET9          LIKE ENTET9    BASED(ADDR(DTAMPON));      02227   
       DCL 1 DENTET10         LIKE ENTET10   BASED(ADDR(DTAMPON));      02228   
       DCL 1 DENTET11         LIKE ENTET11   BASED(ADDR(DTAMPON));      02229   
       DCL 1 DENTET12         LIKE ENTET12   BASED(ADDR(DTAMPON));      02230   
       DCL 1 DENTET13         LIKE ENTET13   BASED(ADDR(DTAMPON));      02231   
       DCL 1 SVG_WFACT        CHAR (175) ;                              02232   
       DCL 1 ZSPOOLP_SVG      LIKE ZSPOOLP ;                            02233   
             PZIMP            = ADDR(ZSPOOLP_SVG);                      02234   
       DCL   WMONT            DEC FIXED (10,2);                         02235   
       DCL   WMONT_HT         DEC FIXED (10,2);                         02236   
0      DCL 1 NUCLI,                     /*   VARIABLES NIVEAU NUCLI   */02237   
             2 TROUV          CHAR (1),                                 02238   
             2 COTAX          CHAR (1),                                 02239   
             2 NBFAC_AS       CHAR (1);                                 02240   
0      DCL 1 FACT2,                     /*   VARIABLES NIVEAU FACTURE2*/02241   
             2 FINAN_FRAIS    CHAR (1),                                 02242   
             2 FINAN_EXIST    CHAR (1);                                 02243   
0      DCL 1 RFA,                       /*   VARIABLES NIVEAU RFA     */02244   
             2 RFA_ENTETE     CHAR (1),                                 02245   
             2 RFA_DETAIL     CHAR (1);                                 02246   
0      DCL 1 RESAI,                     /*   VARIABLES NIVEAU RESAI   */02247   
             2 QUANT          DEC FIXED (7,0),                          02248   
             2 MTFOR          DEC FIXED (11,2),                         02249   
             2 MTNET          DEC FIXED (11,2),                         02250   
             2 MTTAX          DEC FIXED (11,2);                         02251   
0      DCL 1 LOREC,                     /*   VARIABLES NIVEAU LOREC   */02252   
             2 ZONTI          CHAR (1), /*   ZONES BORD. MAXI DEBOR=1 */02253   
             2 DEBOR          CHAR (1),                                 02254   
             2 PREPA          CHAR (1),                                 02255   
             2 CABOT          CHAR (1),                                 02256   
             2 ZOGEO          CHAR (1),                                 02257   
             2 DIFOF          CHAR (1),                                 02258   
             2 FRAET          CHAR (1),                                 02259   
             2 PRIOF          CHAR (1),                                 02260   
             2 MOTRA          CHAR (3),                                 02261   
             2 DEPAY          CHAR (3),                                 02262   
             2 NUBOR          DEC FIXED (3,0),                          02263   
             2 LOTIR          DEC FIXED (3,0),                          02264   
             2 QUANT          DEC FIXED (7,0),                          02265   
             2 PDFAC          DEC FIXED (12,1),                         02266   
             2 POIDS          DEC FIXED (12,3);                         02267   
0      DCL 1 FACTBIS          CHAR (17450)   EXTERNAL;                  02268   
       DCL 1 FACT             BASED (PFACTBIS),                         02269   
                                        /*   VARIABLES NIVEAU FACTURE */02270   
             2 CODTAX(0:9),             /*   INDICE PAR CODE TAXE     */02271   
               3 COTAX        CHAR (1),                                 02272   
               3 TOLEG        CHAR (6),                                 02273   
               3 DETAXE       DEC FIXED (11,2),                         02274   
               3 NET_HT       DEC FIXED (11,2),                         02275   
               3 NET_TC       DEC FIXED (11,2),                         02276   
             2 VENTIL(0:9),             /*   INDICE PAR CODE VENTILAT.*/02277   
               3 VENET        CHAR (2),                                 02278   
               3 LVENE        CHAR (10),                                02279   
               3 MTVEN        DEC FIXED (11,2),                         02280   
             2 ECHEAN(0:99),            /*   INDICE PAR CODE ECHEANCE */02281   
               3 ECHEA        CHAR (2),                                 02282   
               3 LECHE        CHAR (15),                                02283   
               3 MTECH        DEC FIXED (11,2),                         02284   
               3 QTELI        DEC FIXED (7,0),                          02285   
               3 FORLI        DEC FIXED (11,2),                         02286   
               3 TAXLI        DEC FIXED (11,2),                         02287   
               3 COTAXE(0:9),                                           02288   
                 4 COTA       CHAR (1),                                 02289   
                 4 NETC       DEC FIXED (11,2),                         02290   
                 4 MTAX       DEC FIXED (11,2),                         02291   
                                        /*   TOTAUX PIED DE FACTURE   */02292   
             2 QUANT          DEC FIXED (7,0),                          02293   
             2 FORTHT         DEC FIXED (11,2),                         02294   
             2 MENVTE         DEC FIXED (11,2),                         02295   
             2 RASSOR         DEC FIXED (11,2),                         02296   
             2 NETHT          DEC FIXED (11,2),                         02297   
             2 TAXES          DEC FIXED (11,2),                         02298   
             2 DEBIT          DEC FIXED (11,2),                         02299   
             2 WTAXES         DEC FIXED (11,2),                         02300   
             2 POIDS          DEC FIXED (12,3),                         02301   
             2 EXEMP          DEC FIXED (2,0),                          02302   
             2 FOLIO          DEC FIXED (4,0),                          02303   
             2 LIGNE          DEC FIXED (3,0),                          02304   
             2 WCOTAX         CHAR (1), /*   RUBRIQUES RECHERCH. TABLE*/02305   
             2 WECHEA         CHAR (2),                                 02306   
             2 WVENET         CHAR (2),                                 02307   
             2 LIDOC          CHAR (20),/*   POUR AUTORISAT. RETOUR   */02308   
             2 LGNAT          CHAR (20),                                02309   
             2 ECHGIH         PIC'99',  /*   ECHEANCE UNIQUE DU GIH   */02310   
             2 ECHEAMAX       PIC'99',  /*   ECHEANCE MAXI            */02311   
             2 IMPEC          CHAR (1),                                 02312   
             2 RETOUR         CHAR (1), /*   RUBRIQ. FACTUR. MULTIPLE */02313   
             2 MULFAC         CHAR (1),                                 02314   
             2 NFACTU         CHAR (1),                                 02315   
             2 PDFAC          DEC FIXED (12,1);                         02316   
       DCL     TAXES_AS    DEC FIXED (11,2);                            02317   
       DCL     DEBIT_AS    DEC FIXED (11,2);                            02318   
       DCL     ECART_TVA   DEC FIXED (11,2);                            02319   
       DCL   1 FOLIO_PIC      PIC'9999' ;                               02320   
       DCL   1 FOLIO_CHAR     BASED (ADDR(FOLIO_PIC)),                  02321   
               2 FOLIO_N3     CHAR(3),                                  02322   
               2 FOLIO_N1     CHAR(1);                                  02323   
       DCL     NFACTNUM       PIC'9'    BASED (ADDR(FACT.NFACTU));      02324   
             PFACTBIS         = ADDR(FACTBIS);                          02325   
       DCL 1 FACTINIT         CHAR (17450);                             02326   
       DCL 1 FACTIN2          LIKE FACT BASED (PFACTINIT);              02327   
             PFACTINIT        = ADDR(FACTINIT);                         02328   
0      DCL 1 TRIFA,                     /*   VARIABLES NIVEAU TRIFA   */02329   
             2 LIGNE          DEC FIXED (3,0),                          02330   
             2 IMP(55)        CHAR(175),/*   TABLE LIGNES DE CLOTURE  */02331   
             2 LIBTI(55)      CHAR(045),                                02332   
             2 LIBAU(55)      CHAR(025),                                02333   
             2 NETTC(55)      DEC FIXED (15,2),                         02334   
             2 FORLI(55)      DEC FIXED (15,2),                         02335   
             2 NETLI(55)      DEC FIXED (15,2),                         02336   
             2 EXPHA,                                                   02337   
              5 TYREF(55)     CHAR(001),                                02338   
              5 FRPOR(55)     CHAR(001),                                02339   
              5 NUART(55)     CHAR(007),                                02340   
              5 MONTT(55)     DEC FIXED (15,2);                         02341   
0      DCL 1 SUM,                       /*   RUBRIQ. POUR SUMMARIZAT. */02342   
             2 LISUM          CHAR (1),                                 02343   
             2 LICOL          CHAR (30),                                02344   
             2 LIDIV          CHAR (15),                                02345   
             2 LIBTI          CHAR (45),                                02346   
             2 LIBAU          CHAR (25),                                02347   
             2 QUANT          DEC FIXED (7,0),                          02348   
             2 NBMVT          DEC FIXED (6,0),                          02349   
             2 TAXLI          DEC FIXED (11,2),                         02350   
             2 NETHT          DEC FIXED (11,2),                         02351   
             2 FORHT          DEC FIXED (11,2);                         02352   
0      DCL 1 COLIS,                     /*   RUBRIQ. COLIS SUMMARISES */02353   
             2 TETE           CHAR (1),                                 02354   
             2 ATMGIH         CHAR (1),                                 02355   
             2 PINET          CHAR (1),                                 02356   
             2 LIBTI          CHAR (45),                                02357   
             2 LIBAU          CHAR (25),                                02358   
             2 NUART          PIC'(7)9',                                02359   
             2 REFLI          CHAR (10),                                02360   
             2 TYREF          CHAR (01),                                02361   
             2 EANNU          CHAR (13),                                02362   
             2 QUANT          DEC FIXED (7,0),                          02363   
             2 PUNHT          DEC FIXED (7,2),                          02364   
             2 PIPUB          DEC FIXED (11,2),                         02365   
             2 PRIBB          DEC FIXED (11,2),                         02366   
             2 TAXLI          DEC FIXED (11,2),                         02367   
             2 NETHT          DEC FIXED (11,2),                         02368   
             2 FORHT          DEC FIXED (11,2);                         02369   
0      DCL 1 TAB,                       /*   LIBEL. CREDIT  DEBIT     */02370   
             2 GNATO(20)      CHAR (2)  INIT ('0F','0D','1C','14','70', 02371   
                                              '74','31','32','33','41', 02372   
                                              '50','51','52','53','54', 02373   
                                              '1R','3R','5R','21','22'),02374   
             2 LIDEB(20)      CHAR (1)  INIT ('D','D','C','D','C','D',  02375   
                                              'C','D','C','D','C','C',  02376   
                                              'D','C','D','D','C','C',  02377   
                                              'D','C'),                 02378   
             2 LIBEL          CHAR (1)  INIT (' '),                     02379   
             2 COEFF          DEC FIXED (1,0)  INIT (0);                02380   
0      DCL 1 TABNOM ,                   /*   CUMUL PAR NOMENCLATURE   */02381   
             2 NOMPOI (0:9) ,                                           02382   
               3 NOM_EC   CHAR(1) ,                                     02383   
               3 NOM_POI  DEC FIXED (11,3);                             02384   
1                                       /*******************************02385   
                                        *                              *02386   
                                        *    VARIABLES POUR RECAP BL   *02387   
                                        *                              *02388   
                                        *******************************/02389   
0      DCL 1  BL_TABLEAU,                                               02390   
           05 RECAP_BL        CHAR (3),                                 02391   
           05 BL_INFO,                                                  02392   
            10 BL_LIG (3000),                                           02393   
             20 NORUN         CHAR (3),                                 02394   
             20 LOREC         FIXED DEC(5,0),                           02395   
             20 NUBOR         FIXED DEC(3,0),                           02396   
             20 NETHT         FIXED DEC(15,2),                          02397   
             20 NETTC         FIXED DEC(15,2),                          02398   
             20 TAXES         FIXED DEC(15,2),                          02399   
            10 BL_TAB,                                                  02400   
             20 BL_NUBOR (0:1000),                                      02401   
              30 NUBOR        FIXED DEC(3,0),                           02402   
              30 NETHT        FIXED DEC(15,2),                          02403   
              30 NETTC        FIXED DEC(15,2),                          02404   
              30 TAXES        FIXED DEC(15,2),                          02405   
            10 I_BL_LIG       FIXED BIN(15,0),                          02406   
            10 I_BL_NUBOR     FIXED BIN(15,0);                          02407   
1                                       /*******************************02408   
                                        *                              *02409   
                                        *    VARIABLES INTERNES        *02410   
                                        *                              *02411   
                                        *******************************/02412   
0      DCL   NUMERIC          CHAR (10) INIT ('0123456789'),            02413   
             NUMVENE          CHAR (7)  INIT ('0123458'),               02414   
             SWAFAC           CHAR (1)  INIT ('0'),                     02415   
             SWCRD            CHAR (1)  INIT ('0'),                     02416   
             SWCDL            CHAR (1)  INIT ('0'),                     02417   
             EDIT_FACTU       CHAR (1)  INIT ('O'),                     02418   
             EDIT_PAGGA       CHAR (1)  INIT ('O'),                     02419   
             EDIT_LIG_FIR     CHAR (1)  INIT ('O'),                     02420   
             EDIT_CDLTELME    CHAR (1)  INIT ('N'),                     02421   
             FEXPO_AUTO       CHAR (1)  INIT ('N'),                     02422   
             INDEX_FACTU      CHAR (17) INIT (' '),                     02423   
             INDEX_FACTU2     CHAR (17) INIT (' '),                     02424   
             IRAFAC           PIC'99'   INIT (0),                       02425   
             Z115_CDLTELME    CHAR (115)            INIT (' '),         02426   
             WNUFAC_5         PIC'99999'            INIT (0),           02427   
             I                BINARY FIXED (15,0)   INIT (0),           02428   
             I_DEB            BINARY FIXED (15,0)   INIT (0),           02429   
             SVG_I            BINARY FIXED (15,0)   INIT (0),           02430   
             IND              BINARY FIXED (15,0)   INIT (0),           02431   
             ITRIFA           BINARY FIXED (15,0)   INIT (0),           02432   
             INZ              BINARY FIXED (15,0)   INIT (0),           02433   
             IK               BINARY FIXED (15,0)   INIT (0),           02434   
             IL               BINARY FIXED (15,0)   INIT (0),           02435   
             IT               BINARY FIXED (15,0)   INIT (0),           02436   
             IZ               BINARY FIXED (15,0)   INIT (0),           02437   
             IPIC             PIC'9',                                   02438   
             J                BINARY FIXED (15,0)   INIT (0),           02439   
             K                BINARY FIXED (15,0)   INIT (0),           02440   
             K_CLIFA          BINARY FIXED (15,0)   INIT (0),           02441   
             M                BINARY FIXED (15,0)   INIT (0),           02442   
             I_EXEMP          BINARY FIXED (15,0)   INIT (0),           02443   
             NB_EXEMP         BINARY FIXED (15,0)   INIT (0),           02444   
             UN_M             DEC FIXED (3,0)  INIT (10),               02445   
             DEUX_M           DEC FIXED (3,0)  INIT (20),               02446   
             TROIS_M          DEC FIXED (3,0)  INIT (30),               02447   
             /* BFA$ PASSAGE DE 5 � 7 CARACTERES */                     02448   
             XQUANT           DEC FIXED (7,0)  INIT (0) ,               02449   
             XNUFAC1          DEC FIXED (5,0)  INIT (0) ,               02450   
             XNUFAC2          DEC FIXED (5,0)  INIT (0) ,               02451   
             XNUFAC3          DEC FIXED (5,0)  INIT (0) , /* SPOOL 7 */ 02452   
             FACTU_SUP        DEC FIXED (7,0)  INIT (0) ,               02453   
             NBIPA            DEC FIXED (7,0)  INIT (0) ,               02454   
             NB_FONDP         DEC FIXED (9,0)  INIT (0) ,               02455   
             NB_CDLTELME      DEC FIXED (9,0)  INIT (0) ,               02456   
             DEB_CDLTELME     DEC FIXED (9,0)  INIT (0) ,               02457   
             SIGNE            DEC FIXED (1,0)  INIT (0) ,               02458   
             POIDS_GIH        DEC FIXED (15,3) ,                        02459   
             FRAIS            DEC FIXED (15,2) ,                        02460   
             FRAIS_HT         DEC FIXED (15,2) ,                        02461   
             LG_LIDOC         DEC FIXED (09)   INIT (0),                02462   
             LG_LGNAT         DEC FIXED (09)   INIT (0),                02463   
             LG_LECFA         DEC FIXED (09)   INIT (0),                02464   
             LG_TOTAL         DEC FIXED (09)   INIT (0),                02465   
             I_LG             BINARY FIXED (15,0)   INIT (0),           02466   
             CHAR_60          CHAR (60) INIT   (' '),                   02467   
             PIEDFA           CHAR (1)  INIT   ('1'),                   02468   
             NUCLI_HMD        CHAR (1)  INIT   ('N'),                   02469   
             CANADA_NUCLI       CHAR (1)  INIT   ('N'),                 02470   
             WK_TROUV           CHAR(01)  INIT('O'),                    02471   
             WK_RECHE_IDREFCO1  CHAR(01)  INIT('O'),                    02472   
             WK_RECHE_FIRENT    CHAR(01)  INIT('O'),                    02473   
             WS_ECRI_IDPIEDF5   DEC FIXED (11) INIT   (0),              02474   
             WS_NBMIC           DEC FIXED (15) INIT   (0),              02475   
             WS_NULIG           DEC FIXED (15) INIT   (0),              02476   
             WS_CANA4P          DEC FIXED (15) INIT   (0),              02477   
             WS_NUPAG           DEC FIXED (15) INIT   (0),              02478   
             WS_RECO1_IDREFCO1 CHAR (17),                               02479   
             WS_RECO1         CHAR (17),                                02480   
             WS_FIR_RECOM     CHAR (25),                                02481   
             SVG_RECOM        CHAR (25),                                02482   
             SVG_REFLI        CHAR (10),                                02483   
             SVG_RFDIS        CHAR (35),                                02484   
             SVG_FOLIO        DEC FIXED (4,0)  INIT (0),                02485   
             REFLI_TETE_COLIS CHAR (10),                                02486   
             WS_SVG_NUFAC     PIC'99999',                               02487   
             SVG_ADRESSE      CHAR (80) INIT   (' '),                   02488   
             WNUART           PIC'(7)9' INIT   (0),                     02489   
             WQUANT           PIC'(5)9' INIT   (0),                     02490   
             PTR_LIBEL        PTR ;                                     02491   
       DCL   ICHAR            CHAR (1)  BASED (PIPIC);                  02492   
             PIPIC            = ADDR(IPIC);                             02493   
0      DCL 1 WS_REFLI         CHAR (10);                                02494   
0      DCL 1 EXPORT_LIGFAC    DEC FIXED (15) INIT (0);                  02495   
       DCL 1 EXPORT_LIGFAC_X  CHAR (08) BASED(ADDR(EXPORT_LIGFAC));     02496   
0      DCL 1 INDEX_FACEXX     CHAR (39);                                02497   
       DCL 1 INDEX_FACEXP     BASED(ADDR(INDEX_FACEXX)),                02498   
             5 NUCLI          CHAR (06),                                02499   
             5 CLIFA          CHAR (06),                                02500   
             5 NUFAC          CHAR (05),                                02501   
             5 EXEMP          DEC FIXED (15),                           02502   
             5 NUPAG          DEC FIXED (15),                           02503   
             5 NATOP          CHAR (02),                                02504   
             5 SYPRO          CHAR (02),                                02505   
             5 VILBL          CHAR (01),                                02506   
             5 DISAU          CHAR (01);                                02507   
       DCL   WRESAI           CHAR (15);                                02508   
0      DCL 1 TAB_LIBEL        BASED(PTR_LIBEL),                         02509   
             2 CARAC (1:100)  CHAR (1) ; /*   DECOMPOSITION EN CARACTE*/02510   
                                                                        02511   
       /* � */                                                          02512   
       DCL   WS_ZON06         CHAR (06);                                02513   
       DCL 1 WS_ZON06_B1      BASED(ADDR(WS_ZON06)),                    02514   
             2 WS_ZONE_ENT    CHAR (03),                                02515   
             2 WS_ZONE_VIR    CHAR (01),                                02516   
             2 WS_ZONE_DEC    CHAR (02);                                02517   
       DCL 1 WS_TOLEG_NUM     PIC'(3)9V99' ;                            02518   
       DCL 1 WS_TOLEG_NUM_B1  BASED(ADDR(WS_TOLEG_NUM)),                02519   
             2 WS_TOLEG_ENT    CHAR (03),                               02520   
             2 WS_TOLEG_DEC    CHAR (02);                               02521   
                                                                        02522   
       DCL 1 ZRESAI           BASED(PWRESAI),                           02523   
             2 ANNEE          CHAR (2),                                 02524   
             2 FIL1           CHAR (1)  INIT ('.'),                     02525   
             2 RUN            CHAR (3),                                 02526   
             2 FIL2           CHAR (1)  INIT ('.'),                     02527   
             2 ORIGI          CHAR (2),                                 02528   
             2 FIL3           CHAR (1)  INIT ('.'),                     02529   
             2 NUMRO          PIC'(5)9';                                02530   
             PWRESAI          = ADDR(WRESAI);                           02531   
       DCL   WDATE            CHAR (8);                                 02532   
       DCL 1 ZDATE            BASED(PWDATE),                            02533   
             2 JJ             CHAR (2),                                 02534   
             2 FIL1           CHAR (1)  INIT ('.'),                     02535   
             2 MM             CHAR (2),                                 02536   
             2 FIL2           CHAR (1)  INIT ('.'),                     02537   
             2 AA             CHAR (2);                                 02538   
             PWDATE           = ADDR(WDATE);                            02539   
       DCL   WCOMPTA          CHAR (10);                                02540   
       DCL 1 WCODCDL          BASED(PCOMPTA),                           02541   
             2 ZCLICO         PIC'99B999B9BB';                          02542   
       DCL 1 WCODGIH          BASED(PCOMPTA),                           02543   
             2 WNOMCO         CHAR (5),                                 02544   
             2 WFILER         CHAR (1),                                 02545   
             2 WCATCO         CHAR (1),                                 02546   
             2 WNATCO         CHAR (2),                                 02547   
             2 WDEVIS         CHAR (1);                                 02548   
             PCOMPTA          = ADDR(WCOMPTA);                          02549   
       DCL   DAT1             CHAR (4);                                 02550   
       DCL 1 WDAT1            BASED(PDAT1),                             02551   
             2 AA             CHAR (2),                                 02552   
             2 MM             CHAR (2);                                 02553   
             PDAT1            = ADDR(DAT1);                             02554   
       DCL   DAT2             CHAR (4);                                 02555   
       DCL 1 WDAT2            BASED(PDAT2),                             02556   
             2 AA             CHAR (2),                                 02557   
             2 MM             CHAR (2);                                 02558   
             PDAT2            = ADDR(DAT2);                             02559   
0      DCL 1 NBLIG,                     /*   NOMBRE LIGNES MAXI       */02560   
             2 NLMAX          DEC FIXED (3,0),                          02561   
             2 NLMAX_AS       DEC FIXED (3,0),                          02562   
             2 EDIT_FDPAG     CHAR (1),                                 02563   
             2 NLMAX_1        DEC FIXED (3,0),                          02564   
             2 NLMAX_2        DEC FIXED (3,0),                          02565   
             2 NLMAX_3        DEC FIXED (3,0),                          02566   
             2 NLMAX_5        DEC FIXED (3,0);                          02567   
-                                 /* DEBUT AJOUT 22 01 02 YDU/YHM PCF */02568   
0      DCL 1 WS_BL ,                                                    02569   
            2 PCF_CLIENT CHAR(01) ,                                     02570   
            2 PCF_FACTUR CHAR(01) ;                                     02571   
0      DCL 1 WS_PCF ,                                                   02572   
            2 NB_IDDPCFEN DEC FIXED (15,0) INIT (0) ,                   02573   
            2 NB_IDDPCFLI DEC FIXED (15,0) INIT (0) ,                   02574   
            2 NB_IDDPCFIN DEC FIXED (15,0) INIT (0) ,                   02575   
            2 WS1_IILOREXP PIC'99999' ;                                 02576   
                                  /* FIN   AJOUT 22 01 02 YDU/YHM PCF */02577   
0                                       /*  TABLE MESSAGES ENTETE     */02578   
       DCL 1 CLE_MESSAG           LIKE TF1_DFACM;                       02579   
       DCL   MESSAG_OUI_NON       CHAR (3) INIT ('NON'),                02580   
             TABLE_MESSAG_VIDE    CHAR (3) INIT ('NON');                02581   
                                                                        02582   
       DCL 1 TBL_MESSAG1(60)                   ,                        02583   
             2 SAUT               CHAR (1) INIT (' '),                  02584   
             2 POLICE             CHAR (1) INIT ('00'X),                02585   
             2 FILLER             CHAR (2) ,                            02586   
             2 LIBE1              CHAR (50),                            02587   
             2 LIBE2              CHAR (50),                            02588   
             2 LIBE3              CHAR (15);                            02589   
                                                                        02590   
       DCL 1 TBL_CDLTELME(100)             ,                            02591   
             2 LIBE1              CHAR (50),                            02592   
             2 LIBE2              CHAR (50),                            02593   
             2 LIBE3              CHAR (15);                            02594   
                                                                        02595   
       DCL 1 WS_ACC,                                                    02596   
             2 AUT_FORTC          DEC FIXED (15,2),                     02597   
             2 AUT_FORHT          DEC FIXED (15,2),                     02598   
             2 AUT_NETTC          DEC FIXED (15,2),                     02599   
             2 AUT_NETHT          DEC FIXED (15,2),                     02600   
             2 TOT_FORTC          DEC FIXED (15,2),                     02601   
             2 TOT_FORHT          DEC FIXED (15,2),                     02602   
             2 TOT_NETTC          DEC FIXED (15,2),                     02603   
             2 TOT_NETHT          DEC FIXED (15,2),                     02604   
             2 FORTC              DEC FIXED (15,2),                     02605   
             2 FORHT              DEC FIXED (15,2),                     02606   
             2 NETTC              DEC FIXED (15,2),                     02607   
             2 NETHT              DEC FIXED (15,2),                     02608   
             2 SVG_PRIBB          DEC FIXED (15,2),                     02609   
             2 QTE                DEC FIXED (5),                        02610   
             2 NB_LIGNE_ACC       DEC FIXED (5),                        02611   
             2 ACC_LIGNE          CHAR (11),                            02612   
             2 WS_EDC,                                                  02613   
               3 EDI              CHAR (3),                             02614   
               3 DIV              CHAR (2),                             02615   
               3 COL              CHAR (2);                             02616   
       DCL 1 CLE_ACCORD           LIKE TBACCORD;                        02617   
       DCL 1 WS_EDC_RED           CHAR (7) BASED(ADDR(WS_EDC));         02618   
       DCL   ACCORD_OUI_NON       CHAR (3) INIT ('NON'),                02619   
             PROD_AUTRE           CHAR (3) INIT ('NON'),                02620   
             TABLE_ACCORD_VIDE    CHAR (3) INIT ('NON'),                02621   
             MAX_ACCORD           FIXED BIN(15) INIT(0),                02622   
             NB_ACC_HISTO         DEC FIXED (7,0)  INIT (0) ,           02623   
             PTACCORD1            PTR,                                  02624   
             PTACCORD2            PTR;                                  02625   
       DCL 1 TROUVE_PROSP_OUI_NON CHAR (3) INIT ('NON');                02626   
       DCL 1 TBL_ACCORD1(MAX_ACCORD) CONTROLLED,                        02627   
             2 CODE               CHAR (11),                            02628   
             2 FORTC              DEC FIXED (15,2),                     02629   
             2 FORHT              DEC FIXED (15,2),                     02630   
             2 NETTC              DEC FIXED (15,2),                     02631   
             2 NETHT              DEC FIXED (15,2);                     02632   
       DCL 1 TBL_ACCORD2(MAX_ACCORD) CONTROLLED                         02633   
             LIKE TBL_ACCORD1;                                          02634   
       DCL 1 ACC1(10000)          BASED(PTACCORD1),                     02635   
             2 CODE               CHAR (11),                            02636   
             2 FORTC              DEC FIXED (15,2),                     02637   
             2 FORHT              DEC FIXED (15,2),                     02638   
             2 NETTC              DEC FIXED (15,2),                     02639   
             2 NETHT              DEC FIXED (15,2);                     02640   
       DCL 1 ACC2(10000)          LIKE ACC1                             02641   
                                  BASED(PTACCORD2);                     02642   
0      DCL   (PWRESAI,PWDATE,PZIMP,PFACTBIS)        PTR;                02643   
       DCL   (PMAXI,PDAT1,PDAT2,PENRJOURN)          PTR;                02644   
       DCL   (PIPIC,PLECT,PFACTINIT)                PTR;                02645   
       DCL   (PWTCLI,PWTBAS,PWTCOF)                 PTR;                02646   
       DCL   (PWTGRP,PWTDAT,PWTPAI)                 PTR;                02647   
1                                       /*******************************02648   
                                        *                              *02649   
                                        *    VARIABLES POUR EXPOHARR   *02650   
                                        *                              *02651   
                                        *******************************/02652   
0      DCL   NB_EXPOHA          DEC FIXED (15) INIT   (0),              02653   
             NB_LIGTRA          DEC FIXED (09) INIT   (0),              02654   
             POIDS_CHAR         CHAR (11),                              02655   
             COLIS_CHAR         CHAR (03);                              02656   
       DCL   POIDS_CHAR_NUM     PIC '9999999V,999'                      02657   
                                BASED(ADDR(POIDS_CHAR));                02658   
       DCL   COLIS_CHAR_NUM     PIC '999'      BASED(ADDR(COLIS_CHAR)); 02659   
       DCL   TB_LIGTRA(10)      CHAR (50);                              02660   
1                                       /*   VARIABLES POUR RUPTURES  */02661   
                                        /*   MODIF 07/99 +8 A PARTIR  */02662   
                                        /*   DE LE RUPT2              */02663   
                                        /******************************/02664   
0      DCL 1 RUPT1            CHAR (01)  BASED (PRUPT);                 02665   
       DCL 1 RUPT2            CHAR (46)  BASED (PRUPT);                 02666   
       DCL 1 RUPT3            CHAR (53)  BASED (PRUPT);                 02667   
       DCL 1 RUPT4            CHAR (54)  BASED (PRUPT);                 02668   
       DCL 1 RUPT5            CHAR (66)  BASED (PRUPT);                 02669   
       DCL 1 RUPT6            CHAR (76)  BASED (PRUPT);                 02670   
       DCL 1 RUPT7            CHAR (161) BASED (PRUPT);                 02671   
       DCL 1 RUPT8            CHAR (174) BASED (PRUPT);                 02672   
       DCL 1 RUPT9            CHAR (181) BASED (PRUPT);                 02673   
       DCL 1 RUPT10           CHAR (190) BASED (PRUPT);                 02674   
             PRUPT            = ADDR(ENRWFAC);                          02675   
0      DCL 1 ZRUPT1           CHAR (01)  BASED (PZRUPT);                02676   
       DCL 1 ZRUPT2           CHAR (46)  BASED (PZRUPT);                02677   
       DCL 1 ZRUPT3           CHAR (53)  BASED (PZRUPT);                02678   
       DCL 1 ZRUPT4           CHAR (54)  BASED (PZRUPT);                02679   
       DCL 1 ZRUPT5           CHAR (66)  BASED (PZRUPT);                02680   
       DCL 1 ZRUPT6           CHAR (76)  BASED (PZRUPT);                02681   
       DCL 1 ZRUPT7           CHAR (161) BASED (PZRUPT);                02682   
       DCL 1 ZRUPT8           CHAR (174) BASED (PZRUPT);                02683   
       DCL 1 ZRUPT9           CHAR (181) BASED (PZRUPT);                02684   
       DCL 1 ZRUPT10          CHAR (190) BASED (PZRUPT);                02685   
             PZRUPT           = ADDR(ZENRWFAC);                         02686   
0      DCL   (HIGH,CSTG,STRING,PLIDUMP,INDEX,LOW)    BUILTIN;           02687   
       DCL   (ADDR,SUBSTR,VERIFY,PLIRETC,TRANSLATE)  BUILTIN;           02688   
                                                                        02689   
1               /***************************************                02690   
                *  ZONES POUR MODIF FLC LE 13/05/93    *                02691   
                ****************************************/               02692   
         DCL 01 TBECHEB ,                                               02693   
                02 ID LIKE TABREF3.ID ,                                 02694   
                02 FORMAT(24) CHAR(15) INIT                             02695   
                ('ECHEA,X=2' ,                                          02696   
                 'PERFI,X=1' ,                                          02697   
                 'ECHM1,X=2' ,                                          02698   
                 'ECHM2,X=2' ,                                          02699   
                 'ECHM3,X=2' ,                                          02700   
                 'ECHAN,X=2' ,                                          02701   
                 'NADE1,X=1' ,                                          02702   
                 'DLAI1,X=6' ,                                          02703   
                 'FRAC1,X=3' ,                                          02704   
                 'NADE2,X=1' ,                                          02705   
                 'DLAI2,X=6' ,                                          02706   
                 'FRAC2,X=3' ,                                          02707   
                 'NADE3,X=1' ,                                          02708   
                 'DLAI3,X=6' ,                                          02709   
                 'FRAC3,X=3' ,                                          02710   
                 'NADE4,X=1' ,                                          02711   
                 'DLAI4,X=6' ,                                          02712   
                 'FRAC4,X=3' ,                                          02713   
                 'NADE5,X=1' ,                                          02714   
                 'DLAI5,X=6' ,                                          02715   
                 'FRAC5,X=3' ,                                          02716   
                 'LECHE,X=15' ,                                         02717   
                 'NBJOU,X=3'  ,                                         02718   
                 'FINFORMAT') ;                                         02719   
         DCL 01 TBECHEBC(TBECHEB.INDCH+1) CTL ,                         02720   
                2 TECHEA   CHAR(2)                   ,                  02721   
                2 TPERFI   CHAR(1)                   ,                  02722   
                2 TFILLE1  CHAR(8)                   ,                  02723   
                2 TPOSTEI  (5)                       ,                  02724   
                   3 NADE CHAR(1)                   ,                   02725   
                   3 DLAI PIC'999999'               ,                   02726   
                   3 FRAC PIC'999'                  ,                   02727   
                2 TFILLE2  CHAR(15)                 ,                   02728   
                2 NBJOU    CHAR(3)                  ;                   02729   
1        /*=====================================================*/      02730   
         /* DECLARATIONS INTERNES                               */      02731   
         /*=====================================================*/      02732   
                                        /*   TABLE (5) POUR ECLATEMENT*/02733   
                                        /*   DATE ECHEANCE / MONTANT  */02734   
         DCL 01 T (5),                                                  02735   
                2 DDTDUEB  PIC'999999'               ,                  02736   
                2 CODECHE  CHAR(2)                   ,                  02737   
                2 AMTTC    FIXED DEC(11,2)           ;                  02738   
                                                                        02739   
                                        /*   TABLE DE L'ECHEANCIER    */02740   
                                        /*   BAS DE FACTURE           */02741   
       DCL 1 WS_TAECH,                                                  02742   
             2 TABE(100),              /*   INDICE PAR DATE ET TAUX  */ 02743   
               3 WS_DAECH     CHAR (6),                                 02744   
               3 WS_ECHEA     CHAR (2),                                 02745   
               3 WS_MTECH     DEC FIXED (11,2);                         02746   
                                                                        02747   
                                        /*   TABLE DE L'ECHEANCIER    */02748   
                                        /*   PIED DE FACTURE          */02749   
                                        /*   MODIF JNM DU 09.11.93    */02750   
       DCL 1 WX_TAECH,                                                  02751   
             2 TABX(100),              /*   INDICE PAR DATE ET TAUX  */ 02752   
               3 WX_DAECH     CHAR (6),                                 02753   
               3 WX_ECHEA     CHAR (2),                                 02754   
               3 WX_MTECH     DEC FIXED (11,2);                         02755   
                                        /*   TABLE DE L'ECHEANCIER    */02756   
                                        /*   POUR EDITION 8 POSTES    */02757   
       DCL 1 WZ_TAECH,                                                  02758   
             2 TABZ(8),                /*   INDICE PAR DATE ET TAUX  */ 02759   
               3 WZ_DAECH     CHAR (6),                                 02760   
               3 WZ_MTECH     DEC FIXED (11,2);                         02761   
 /* PCA150825 CONTROLE  CARACTERES SPECIAUX                           */02762   
 /*     DCL 1  KWUTI01,                                                 02763   
             2 KWUTI01_CODE PIC'(1)9' ,                                 02764   
             2 KWUTI01_IND  PIC'(4)9' ,                                 02765   
             2 KWUTI01_ZONE CHAR(100) ; */                              02766   
 /* PCA160311 RENUM�ROTATION FACTURES                                 */02767   
          DCL WEDIPA              CHAR(1) INIT (' ') ;                  02768   
       DCL 1 WS_POSTE,                                                  02769   
               3 WSS_DAECH     CHAR (6),                                02770   
               3 WSS_ECHEA     CHAR (2),                                02771   
               3 WSS_MTECH     DEC FIXED (11,2);                        02772   
                                                                        02773   
          /*   � VARIABLE DE TRAVAIL  */                                02774   
          DCL WS_NUEDI            CHAR(3) ;                             02775   
          DCL WS_NUDIV            CHAR(2) ;                             02776   
          DCL WS_LIEDI            CHAR(15);                             02777   
          DCL WS_LIDIV            CHAR(15);                             02778   
                                                                        02779   
          DCL PDEMFA PIC'999999' INIT (0);                              02780   
          DCL PDTDUEB PIC'999999' DEF (DTDUEB)        ;                 02781   
          DCL ZZ_DAT  CHAR(6)                         ;                 02782   
          DCL EDTDAT  CHAR(6)                         ;                 02783   
          DCL 01 WEDTDAT BASED(ADDR(EDTDAT)),                           02784   
                 02 AN_WEDAT PIC'99'      ,                             02785   
                 02 MO_WEDAT PIC'99'      ,                             02786   
                 02 JR_WEDAT PIC'99'      ;                             02787   
          DCL ZEDDAT  CHAR(8)                         ;                 02788   
          DCL 01 ZEDTDAT BASED(ADDR(ZEDDAT)),                           02789   
                 02 JR_ZEDAT PIC'99'      ,                             02790   
                 02 Q1_WEDAT CHAR(1) INIT('/') ,                        02791   
                 02 MO_ZEDAT PIC'99'      ,                             02792   
                 02 Q2_WEDAT CHAR(1) INIT('/') ,                        02793   
                 02 AN_ZEDAT PIC'99'      ;                             02794   
          DCL DTDUEB  CHAR(6)                         ;                 02795   
          DCL ZTDUEB  CHAR(6)                         ;                 02796   
          DCL 01 WTDUEB BASED(ADDR(ZTDUEB)),                            02797   
                 02 AN_WTDUEB PIC'99'      ,                            02798   
                 02 MO_WTDUEB PIC'99'      ,                            02799   
                 02 JR_WTDUEB PIC'99'      ;                            02800   
          DCL XNBJOUR CHAR(2)                         ;                 02801   
          DCL WNBJOUR PIC'99'     DEF (XNBJOUR)       ;                 02802   
          DCL ZDAT  (12) PIC'99'  INIT                                  02803   
          (31,28,31,30,31,30,31,31,30,31,30,31)       ;                 02804   
          DCL NBJOU_PIC  PIC'999',                                      02805   
              NBMOIS_PIC PIC'999',                                      02806   
              NBANNE_PIC PIC'999';                                      02807   
          DCL NBJOU_CHAR CHAR(3)    BASED(ADDR(NBJOU_PIC));             02808   
          DCL 1 SVG_DAECH_RED       BASED(ADDR(SVG_DAECH)),             02809   
              5 AA_DAECH   PIC '99',                                    02810   
              5 MM_DAECH   PIC '99',                                    02811   
              5 JJ_DAECH   PIC '99';                                    02812   
          DCL MOD      BUILTIN                         ;                02813   
          DCL DIVIDE   BUILTIN                         ;                02814   
          DCL RECLIN0  CHAR(1)                        ;                 02815   
          DCL RECLIN1  PIC'9'                         ;                 02816   
          DCL RECLIN2  PIC'9'                         ;                 02817   
          DCL INI DEC FIXED (5,0) INIT (0)            ;                 02818   
          DCL INJ DEC FIXED (5,0) INIT (0)            ;                 02819   
          DCL INK DEC FIXED (5,0) INIT (0)            ;                 02820   
          DCL INH DEC FIXED (5,0) INIT (0)            ;                 02821   
          DCL INM DEC FIXED (5,0) INIT (0)            ;                 02822   
          DCL INL DEC FIXED (5,0) INIT (0)            ;                 02823   
          DCL INO DEC FIXED (5,0) INIT (0)            ;                 02824   
                                                                        02825   
          DCL IKH DEC FIXED (5,0) INIT (0)            ;                 02826   
                                                                        02827   
          DCL NETCAGR DEC FIXED (11,2) INIT (0)       ;                 02828   
          DCL WS_CUMECH DEC FIXED (11,2) INIT (0)     ;                 02829   
          DCL TROUVE   BIT(1)          INIT('0'B)     ;                 02830   
          DCL RECHERCHE  BIT(1)        INIT('0'B)     ;                 02831   
          DCL NBMOIS PIC '99'                         ;                 02832   
          DCL MMDEMFA PIC '99'                        ;                 02833   
          DCL AADEMFA PIC '99'                        ;                 02834   
          DCL CODECH CHAR (02)      INIT ('00')       ;                 02835   
          DCL CODECH_TRAV PIC'99' INIT(0)             ;                 02836   
          DCL NETTC  FIXED DEC(11,2) INIT(0)          ;                 02837   
                                                                        02838   
          DCL W_NATOP     CHAR(02)                    ;                 02839   
          DCL W_NATOP_FIR CHAR(02)                    ;                 02840   
          DCL W_REFLI     CHAR(10)                    ;                 02841   
          DCL 01 W_ZOPAC BASED(ADDR(W_REFLI)),                          02842   
                 02 W_ETOIL   CHAR (1)       ,                          02843   
                 02 W_NUPAC   PIC'999999999' ;                          02844   
          DCL W_NUPACP  FIXED DEC(9,0)                ;                 02845   
          DCL W_NUPACC CHAR (5) BASED(ADDR(W_NUPACP)) ;                 02846   
                                                                        02847   
          DCL SVG_W_NUFAOC          CHAR(9)    ;                        02848   
          DCL W_NUFAOC              CHAR(9)    ;                        02849   
          DCL 01 W_NUFAO BASED(ADDR(W_NUFAOC)),                         02850   
                 02 W_NUFAO_RUN     CHAR (3)   ,                        02851   
                 02 W_NUFAO_SEP     CHAR (1)   ,                        02852   
                 02 W_NUFAO_NUFAC   PIC'99999' ;                        02853   
          DCL SVG_W_NUBLOC          CHAR(9)    ;                        02854   
          DCL W_NUBLOC              CHAR(9)    ;                        02855   
          DCL 01 W_NUBLO BASED(ADDR(W_NUBLOC)),                         02856   
                 02 W_NUBLO_RUN     CHAR (3)   ,                        02857   
                 02 W_NUBLO_SEP     CHAR (1)   ,                        02858   
                 02 W_NUBLO_LOREC   PIC'99999' ;                        02859   
          DCL W_RECOO   CHAR(8)                       ;                 02860   
          DCL W_RECOO31 CHAR(9)                       ;                 02861   
          DCL 01 W_RECOO9 BASED(ADDR(W_RECOO31)),                       02862   
                 02 W_RECOO_C1      CHAR (1)   ,                        02863   
                 02 W_RECOO_C2      CHAR (8)   ;                        02864   
                                                                        02865   
                                                                        02866   
                /*******************************************            02867   
                *  FIN ZONES POUR MODIF FLC LE 13/05/93    *            02868   
                ********************************************/           02869   
                                                                        02870   
                /*------------------------------------------            02871   
                -  DEBUT AJOUT GESTION TABLE DES REFERENCES             02872   
                -  LIGNE A EDITER SI ENTET70.NORUN = 5 OU 6             02873   
                -   MODIF DU 22/09/2004 SMARTIN                         02874   
                -------------------------------------------*/           02875   
          DCL 01 REFLI_TAB (1000)          ,                            02876   
                 02 REFLI CHAR (10)        ,                            02877   
                 02 REFXX CHAR (00)        ;                            02878   
                                                                        02879   
          DCL NB_REF_LIG     DEC FIXED (3,0) INIT(0)    ;               02880   
          DCL I_REFLI        FIXED BIN (15,0)           ;               02881   
          DCL I_REFLI_MAX    DEC FIXED (5,0) INIT(1000) ;               02882   
          DCL W_RUP_REFLI    CHAR      (10)  INIT ('')  ;               02883   
          DCL TOP_REFLI      CHAR      (01)  INIT ('')  ;               02884   
          DCL TOP_RECOM      CHAR      (01)  INIT ('')  ;               02885   
          DCL I_REFLI_SAVE   DEC FIXED (5,0) INIT (0)   ;               02886   
          DCL RESTE_REFLI    DEC FIXED (4,2) INIT (0)   ;               02887   
                                                                        02888   
          REFLI_TAB(*) = ''                             ;               02889   
                                                                        02890   
       DCL 1 CADRE1_RL,                                                 02891   
             2 SAUT           CHAR (01) INIT ('-'),                     02892   
             2 POLIC          CHAR (01) INIT ('40'X),                   02893   
             2 FIL1           CHAR (26) INIT ((26)' '),                 02894   
             2 TRT1           CHAR (01) INIT (' '),                     02895   
             2 FIL2           CHAR (18) INIT ('RECAPITULATIF PAR '),    02896   
             2 FIL3           CHAR (16) INIT ('REFERENCE LIGNE '),      02897   
             2 FIL4           CHAR (56) INIT ((50)' ');                 02898   
       DCL 1 CADRE2_RL,                                                 02899   
             2 SAUT           CHAR (01) INIT ('0'),                     02900   
             2 POLIC          CHAR (01) INIT ('02'X),                   02901   
             2 FIL1           CHAR (26) INIT ((26)' '),                 02902   
             2 FIL2           CHAR (01) INIT ('W'),                     02903   
             2 FIL3           CHAR (42) INIT ((42)'6'),                 02904   
             2 FIL4           CHAR (01) INIT ('X'),                     02905   
             2 FIL5           CHAR (58) INIT ((58)' ');                 02906   
       DCL 1 CADRE2B_RL,                                                02907   
             2 SAUT           CHAR (01) INIT (' '),                     02908   
             2 POLIC          CHAR (01) INIT ('02'X),                   02909   
             2 FIL1           CHAR (26) INIT ((26)' '),                 02910   
             2 FIL2           CHAR (01) INIT ('3'),                     02911   
             2 FIL3           CHAR (42) INIT ((42)'6'),                 02912   
             2 FIL4           CHAR (01) INIT ('4'),                     02913   
             2 FIL5           CHAR (58) INIT ((58)' ');                 02914   
                                                                        02915   
       DCL 1 CADRE3_RL,                                                 02916   
             2 SAUT           CHAR (01) INIT (' '),                     02917   
             2 POLIC          CHAR (01) INIT ('00'X),                   02918   
             2 FIL1           CHAR (26) INIT ((26)' '),                 02919   
             2 FIL2           CHAR (01) INIT (' '),                     02920   
             2 FIL3           CHAR (16) INIT (' REFERENCE     '),       02921   
             2 FIL4           CHAR (14) INIT ('REFERENCE    '),         02922   
             2 FIL5           CHAR (13) INIT ('REFERENCE   '),          02923   
          /* 2 FIL51          CHAR (13) INIT ('REFERENCE   ') */        02924   
             2 FIL6           CHAR (58) INIT ((58)' ');                 02925   
       DCL 1 CADRE4_RL,                                                 02926   
             2 SAUT           CHAR (01) INIT ('+'),                     02927   
             2 POLIC          CHAR (01) INIT ('02'X),                   02928   
             2 FIL1           CHAR (26) INIT ((26)' '),                 02929   
             2 FIL2           CHAR (01) INIT ('7'),                     02930   
             2 FIL3           CHAR (42) INIT ((42)' '),                 02931   
             2 FIL4           CHAR (01) INIT ('7'),                     02932   
             2 FIL5           CHAR (58) INIT ((58)' ');                 02933   
       DCL 1 CADREF_RL,                                                 02934   
             2 SAUT           CHAR (01) INIT (' '),                     02935   
             2 POLIC          CHAR (01) INIT ('02'X),                   02936   
             2 FIL1           CHAR (26) INIT ((26)' '),                 02937   
             2 FIL2           CHAR (01) INIT ('Z'),                     02938   
             2 FIL3           CHAR (42) INIT ((42)'6'),                 02939   
             2 FIL4           CHAR (01) INIT ('Y'),                     02940   
             2 FIL5           CHAR (58) INIT ((58)' ');                 02941   
       DCL 1 LIGNE_RL         BASED (ADDR(LIGNE)),                      02942   
             2 SAUT           CHAR (1),                                 02943   
             2 POLIC          CHAR (1),                                 02944   
             2 FIL1           CHAR (26),                                02945   
             2 FIL2           CHAR (1),                                 02946   
             2 AST1           CHAR (2),                                 02947   
             2 REF01          CHAR (10),                                02948   
             2 FILA           CHAR (2),                                 02949   
             2 AST3           CHAR (3),                                 02950   
             2 REF02          CHAR (10),                                02951   
             2 FILC           CHAR (1),                                 02952   
             2 AST4           CHAR (3),                                 02953   
             2 FILD           CHAR (1),                                 02954   
             2 REF03          CHAR (10),                                02955   
          /* 2 AST5           CHAR (3)                                  02956   
             2 REF04          CHAR (10)                                 02957   
             2 AST6           CHAR (3) */                               02958   
             2 FIL4           CHAR (58);                                02959   
                /*------------------------------------------            02960   
                                       /*    TABLE TBRECOM N� 1250    */02961   
 /**************************************/                               02962   
 /* ZONE DE GESTION TBRECOM            */                               02963   
 /**************************************/                               02964   
 DCL (IREC,IRECFIN) BIN FIXED(31) INIT(0) ;                             02965   
 DCL WTFIL2   CHAR(2)       INIT('') ;                                  02966   
 DCL WTFIL4   CHAR(4)       INIT('') ;                                  02967   
 DCL WTFIL6   CHAR(6)       INIT('') ;                                  02968   
 DCL WTFIL8   CHAR(8)       INIT('') ;                                  02969   
 DCL RECHCO   CHAR(10)      INIT('') ;                                  02970   
 DCL TEMCOM   CHAR(01)      INIT('') ;                                  02971   
1/**************************************/                               02972   
 /************************************************************/         02973   
 /*     ALLOCATION ET CHARGEMENT TABLE (TBRECOM)             */         02974   
 /*     POUR LES CLIENT FNAC (CONSERVER LA REFLI D'ORIGINE)  */         02975   
 /************************************************************/         02976   
         DCL 01 TBRECOM ,                                               02977   
                02 ID LIKE TABREF3.ID ,                                 02978   
                02 FORMAT(05) CHAR(15) INIT                             02979   
                ('SYPRO,X=2' ,                                          02980   
                 'AFFIL,X=2' ,                                          02981   
                 'NUCLI,X=6' ,                                          02982   
                 'EDREF,X=1' ,                                          02983   
                 'FINFORMAT') ;                                         02984   
         DCL 01 TBRECOC(TBRECOM.INDCH+1) CTL ,                          02985   
                02 SYPRO  CHAR(02) ,                                    02986   
                02 AFFIL  CHAR(02) ,                                    02987   
                02 NUCLI  CHAR(06) ,                                    02988   
                02 EDREF  CHAR(01) ;                                    02989   
                                                                        02990   
-   /* CHARGEMENT TABLE 1250 */                                         02991   
-        TBRECOM = TABREF3, BY NAME ;                                   02992   
         TBRECOM.NUTAB = 1250 ;                                         02993   
         CALL CHTBOP3(TBRECOM) ;                                        02994   
         IF TBRECOM.CODER ^= 0 THEN DO ;                                02995   
           ZONCTL         = 'ANOTB=TBRECOM ' ;                          02996   
           CALL MACMES3 (DESTI,'2',ZONCTL) ;                            02997   
         END ;                                                          02998   
-        ALLOC TBRECOC ;                                                02999   
         TBRECOM.LGMAX = 11*(TBRECOM.INDCH+1) ;                         03000   
         CALL CHTBGB3(TBRECOM,TBRECOC) ;                                03001   
         IF TBRECOM.CODER ^= 0 THEN DO ;                                03002   
           ZONCTL         = 'ANOTB=TBRECOM ' ;                          03003   
           CALL MACMES3 (DESTI,'2',ZONCTL) ;                            03004   
         END ;                                                          03005   
1/************************************************************/         03006   
                /*------------------------------------------            03007   
                -  FIN AJOUT GESTION TABLE DES REFERENCES               03008   
                -------------------------------------------*/           03009   
1                                       /*******************************03010   
                                        *    DEBUT DU TRAITEMENT       *03011   
                                        *******************************/03012   
        /* PUT SKIP LIST ('ETIQ DEBUT TRAIT. DE TEST   ') */            03013   
        /* ---- ----------------------------------------------- --- */  03014   
0          /*                                                           03015   
                    *****************************************           03016   
                    *                                       *           03017   
                    *     FONCTIONS DE CE PROGRAMME :       *           03018   
                    *     - EDITER LES FACTURES             *           03019   
                    *     - CREER LES FICHIERS :            *           03020   
                    *       . RESULTATS DE FACTURATION      *           03021   
                    *       . JOURNAL   DE FACTURATION      *           03022   
                    *       . FACTURES COMPTANT             *           03023   
                    *       . MICROFICHES                   *           03024   
                    *                                       *           03025   
                    *****************************************           03026   
           */                                                           03027   
0      A000D:                                                           03028   
0          ON ERROR BEGIN;              /*   APPEL  DU  DUMP          */03029   
                    ON ERROR SYSTEM;                                    03030   
                    CALL PLIDUMP('TFHB','IDIL470');                     03031   
                    SIGNAL ERROR;                                       03032   
                    END;                                                03033   
0          MACFA          = '';         /*   FICHIER AUTO CONTROLE    */03034   
           ZONCTL         = ' ';                                        03035   
           MACFA.NOPHA    = 'IDIL470';                                  03036   
           MACFA.LGDON    = CSTG(MACFA.GS);                             03037   
           CALL MACDEB3   (DESTI,MACFA);                                03038   
           ZONCTL         = ' ***** IDP470RA * DEBUT *****';            03039   
           CALL MACMES3   (DESTI,'1',ZONCTL);                           03040   
0          WNBJSU         = 0  ;        /*   INIT.  01.09.87 YOUPIE   */03041   
           WNBBSU         = 0  ;                                        03042   
           WNBJGH         = 0  ;                                        03043   
           WNBJMD         = 0  ;                                        03044   
           WNBFEA         = 0  ;                                        03045   
           CALL INIT_DEMA;                                              03046   
           TABE.WS_DAECH(*) = '' ;                                      03047   
           TABE.WS_ECHEA(*) = '' ;                                      03048   
           TABE.WS_MTECH(*) = (0);                                      03049   
     /*    WZ_TAECH         = '' ;      COMMENTAIRES A ENLEVER SI       03050   
           WX_TAECH         = '' ;      ABEND GFR A FAIRE SI EDIPA=9    03051   
           T(*)             = '' ;   */                                 03052   
0                                       /*   OUVERTURE DES FICHIERS   */03053   
           OPEN FILE(FFAC3A), FILE(FEDITI), FILE(FRESUL), FILE(FMICRO), 03054   
                FILE(FIPAGE),FILE(FEXCLI),FILE(FHISTO),FILE(CANADA4P),  03055   
                FILE(IDREFCO1),FILE(IDPIEDF5),FILE(EXPOHARR);           03056   
0                                    /* AJOUT DU 22 10 02 YDU/YHM PCF */03057   
           OPEN FILE(IDDPCFEN), FILE(IDDPCFLI), FILE(IDDPCFIN) ;        03058   
           OPEN FILE(FICDEMA)         ; /*   FICHIER FACT. DEMAT.12.04*/03059   
           OPEN FILE(FICLCOM)         ; /*   FICHIER FACT. DEMAT. LOG */03060   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                03061   
           OPEN FILE(FICSTOD)         ; /*   FICHIER STOCK FACT DEMAT */03062   
           OPEN FILE(FICSTOP)         ; /*   FICHIER STOCK FACT PAPIER*/03063   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                03064   
           OPEN FILE(FIRENT)          ; /*   FICHIER ENTETES FIR YFB  */03065   
                                                                        03066   
0          ON ENDFILE (FFAC3A) BEGIN;   /*   TEST EOF FICH A FACTURER */03067   
                    ZWTFAC.ORPRO   = HIGH(1);                           03068   
                    END;                                                03069   
                                        /*****************************/ 03070   
                                        /* TEST FICHIER CLIENT EXPORT*/ 03071   
                                        /*****************************/ 03072   
           ON UNDEFINEDFILE(FEXCLI) BEGIN ;                             03073   
              PUT EDIT('**** FICHIER CLIENTS EXPORT AUXILIAIRE VIDE'    03074   
              !! ' ====> ARRET TRAITEMENT ****')(SKIP,A);               03075   
              SIGNAL ERROR ;                                            03076   
           END;                                                         03077   
                                                                        03078   
           ON KEY(FEXCLI) BEGIN ;                                       03079   
              WK_TROUV = 'N' ;                                          03080   
           END;                                                         03081   
                                        /*****************************/ 03082   
                                        /*AJOUT LE 15 01 97   �$     */ 03083   
                                        /* TEST FICHIER REF.COMMANDE */ 03084   
                                        /*****************************/ 03085   
           ON UNDEFINEDFILE(IDREFCO1) BEGIN ;                           03086   
              PUT EDIT('FICH.IDREFCO1 REF.DE COMMANDE VIDE')(SKIP,A);   03087   
               WK_RECHE_IDREFCO1  = 'N';                                03088   
           END;                                                         03089   
           ON KEY(IDREFCO1) BEGIN ;                                     03090   
              WK_RECHE_IDREFCO1  = 'N';                                 03091   
           END;                                                         03092   
                                        /*****************************/ 03093   
                                        /*AJOUT LE 03 10 06 YFB      */ 03094   
                                        /* TEST FICHIER ENTETES FIR  */ 03095   
                                        /*****************************/ 03096   
           ON UNDEFINEDFILE(FIRENT) BEGIN ;                             03097   
              PUT EDIT('FICH.FIRENT ENTETES FIR VIDE')(SKIP,A);         03098   
               WK_RECHE_FIRENT  = 'N';                                  03099   
           END;                                                         03100   
           ON KEY(FIRENT) BEGIN ;                                       03101   
              WK_RECHE_FIRENT  = 'N';                                   03102   
           END;                                                         03103   
                                        /*****************************/ 03104   
                                                                        03105   
              /*   CHARGEMENT DE LA TABLE   */                          03106   
              /*   12345 FLC                */                          03107   
           CALL STEP_INIT       ;                                       03108   
              /*   FIN CHARGEMENT DE LA TABLE  */                       03109   
              /*   12345 FLC                   */                       03110   
                                                                        03111   
                                                                        03112   
           CALL SPLAFAC;                /*   1ERE LECTURE FICH A FACTU*/03113   
0                                       /*   OUVERTURES BANDES SPOOL  */03114   
           IF WTFAC.DEPCO = '10'        /*   YOUPIE 01.09.87          */03115   
              THEN  SPOOL_O.MESOP  = 'MONT. FACT. SPECIALE E';          03116   
              ELSE  SPOOL_O.MESOP  = 'MONTER FACTURES DU CDL';          03117   
0          SPOOL_O.LRECL  = 175 + 19 ;  /*   AJOUT INDEX FACTU EN FIN */03118   
           CALL SPOOLA32  (UN,SPOOL_O);                                 03119   
                                                                        03120   
0          SPOOL_O.LRECL  = 175 + 19 ;  /*   FRAIS INDEX FACTU EN FIN */03121   
           CALL SPOOLA32  (CINQ,SPOOL_O);                               03122   
0          SPOOL_O.LRECL  = 175 + 19 ;  /*   FACTURE EN + CLIFA NUCLI */03123   
           CALL SPOOLA32  (QUATRE,SPOOL_O);                             03124   
                                                                        03125   
0          SPOOL_O.LRECL  = 175      ;  /*   GHI EXPORT  HATIER       */03126   
0          SPOOL_O.MESOP  = 'MONTER FACTURES DU GHI';                   03127   
           CALL SPOOLA32  (SIX,SPOOL_O);                                03128   
0          SPOOL_O.MESOP  = 'MONTER FACTURES DU GIH';                   03129   
           SPOOL_O.LRECL  = 167 + 39 ;  /*   AJOUT INDEX FACTU EXPORT */03130   
           CALL SPOOLA32  (DEUX,SPOOL_O);                               03131   
           IF WTFAC.DEPCO = '10'        /*   YOUPIE 01.09.87          */03132   
              THEN  SPOOL_O.MESOP  = 'MONT. FACT. SPECIALE A';          03133   
              ELSE  SPOOL_O.MESOP  = 'MONTER FACTURES CRDL  ';          03134   
           SPOOL_O.LRECL  = 175 ;                                       03135   
           CALL SPOOLA32  (TROIS,SPOOL_O);                              03136   
0          IF WTFAC.DEPCO = '10'        /*   YOUPIE 01.09.87          */03137   
              THEN  WSUCCES        = 'O' ;                              03138   
              ELSE  WSUCCES        = 'N' ;                              03139   
           SPOOL_O.MESOP  = 'MONTER FACTURES DU CDL';                   03140   
0          SPOOL_O.LRECL  = 175 + 19 ;  /*   AJOUT INDEX FACTU EN FIN */03141   
           CALL SPOOLA32  (SEPT,SPOOL_O);                               03142   
0          SPOOL_O.MESOP  = 'MONTER FACT EXP CLINUC';                   03143   
           SPOOL_O.LRECL  = 175 + 19 ;  /*   AJOUT INDEX FACTU EN FIN */03144   
           CALL SPOOLA32  (HUIT,SPOOL_O);                               03145   
0          IF WTFAC.ORPRO = HIGH(1) THEN DO;                            03146   
                                        /*   APPEL AUTO CONTROLE      */03147   
                    ZONCTL         = '                * FICHIER A ' !!  03148   
                                     'FACTURER VIDE ';                  03149   
                    CALL MACMES3 (DESTI,'2',ZONCTL);                    03150   
                    ZONCTL         = '                * PROGRAMME ' !!  03151   
                                     'TERMINE ' ;                       03152   
                    CALL MACMES3 (DESTI,'2',ZONCTL);                    03153   
                    GO TO A000F;                                        03154   
                    END;                                                03155   
           ZRESAI.FIL1    = '.';                                        03156   
           ZRESAI.FIL2    = '.';                                        03157   
           ZRESAI.FIL3    = '.';                                        03158   
           ZDATE.FIL1     = '.';                                        03159   
           ZDATE.FIL2     = '.';                                        03160   
           ENTET15        = '' ;                                        03161   
           ENTET15.POLIC  = '00'X;                                      03162   
           WNOANO         = ' ';        /*   SWITCH NON EDIT ANO TBVEN*/03163   
                                                                        03164   
0          CALL ID470A;                 /*   CHARGEMENT DES TABLES    */03165   
                                                                        03166   
           IF WEREUR = '1' THEN DO;     /*   MAUVAIS CHARGEMENT       */03167   
                    ZONCTL         = '                * ERREUR CHAR' !! 03168   
                                     'GEMENT TABLES ';                  03169   
                    CALL MACMES3 (DESTI,'2',ZONCTL);                    03170   
                    ZONCTL         = '                * PROGRAMME ' !!  03171   
                                     'TERMINE ';                        03172   
                    CALL MACMES3 (DESTI,'2',ZONCTL);                    03173   
                    CALL PLIRETC(15);   /*   QUEUE HOLDEE             */03174   
                    GO TO A000F;                                        03175   
                    END;                                                03176   
                                       /*   CHARGEMENT DE SPITAB     */ 03177   
           SPIPA          = '';        /*   TABLE LIBELLE ACCORD     */ 03178   
           SPIPA.FONCT    = 'GS';                                       03179   
           SPIFI.FNAME    = 'SPI2TAB';                                  03180   
           SPIPA.COTAB    = 'CDLACCL';                                  03181   
           CALL SPI2TBV(SPIPA,TLACCORD,SPIFI);                          03182   
           IF SPIPA.CORET ^= '00' THEN DO;          /*  KO  */          03183   
             ZONCTL = '* ERREUR CHARGEMENT SPITAB TABLE '!!SPIPA.COTAB; 03184   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03185   
             ZONCTL = '* CODE RETOUR= '!!SPIPA.CORET;                   03186   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03187   
           END;                                                         03188   
                                                                        03189   
           IF TABLE_ACCORD_VIDE =  'NON' THEN DO;                       03190   
             MAX_ACCORD = 100;                                          03191   
             ALLOCATE TBL_ACCORD1;      /* ALLOCATION TABLEAU ACCORD  */03192   
             PTACCORD1 = ADDR(TBL_ACCORD1(1));                          03193   
             CALL INIT_CDRE_ACCORD;                                     03194   
             END;                                                       03195   
    /*-- AJOUT SMARTIN DEBUT 22/11/2044    --*/                         03196   
           SPIPA          = '';        /*   TABLE REFLI A EXCLURE    */ 03197   
           SPIPA.FONCT    = 'GS';                                       03198   
           SPIFI.FNAME    = 'SPI2TAB';                                  03199   
           SPIPA.COTAB    = 'CDLEXREF';                                 03200   
           CALL SPI2TBV(SPIPA,TCDLEXRF,SPIFI);                          03201   
           IF SPIPA.CORET ^= '00' THEN DO;          /*  KO  */          03202   
             ZONCTL = '* ERREUR CHARGEMENT SPITAB TABLE '!!SPIPA.COTAB; 03203   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03204   
             ZONCTL = '* CODE RETOUR= '!!SPIPA.CORET;                   03205   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03206   
           END;                                                         03207   
    /*-- AJOUT SMARTIN FIN   22/11/2044    --*/                         03208   
  /*-- -------------------------------------------- --*/                03209   
  /*-- GESTION DES FACTURES DEMATERIALISEES   ----- --*/                03210   
  /*--   DEBUT AJOUT SMARTIN DU 17/12/2004    ----- --*/                03211   
           SPIPA          = '';        /*   TABLE SELECTION FAC-DEMA */ 03212   
           SPIPA.FONCT    = 'GS';                                       03213   
           SPIFI.FNAME    = 'SPI2TAB';                                  03214   
           SPIPA.COTAB    = 'CDLFDEMX';                                 03215   
           CALL SPI2TBV(SPIPA,TCDLFDEM,SPIFI);                          03216   
           IF SPIPA.CORET ^= '00' THEN DO;          /*  KO  */          03217   
             ZONCTL = '* ERREUR CHARGEMENT SPITAB TABLE '!!SPIPA.COTAB; 03218   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03219   
             ZONCTL = '* CODE RETOUR= '!!SPIPA.CORET;                   03220   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03221   
           END;                                                         03222   
           SPIPA          = '';        /*   TABLE INFO DU SIEGE      */ 03223   
           SPIPA.FONCT    = 'GS';                                       03224   
           SPIFI.FNAME    = 'SPI2TAB';                                  03225   
           SPIPA.COTAB    = 'CDLSIEGE';                                 03226   
           CALL SPI2TBV(SPIPA,TSIEGE,SPIFI);                            03227   
           IF SPIPA.CORET ^= '00' THEN DO;          /*  KO  */          03228   
             ZONCTL = '* ERREUR CHARGEMENT SPITAB TABLE '!!SPIPA.COTAB; 03229   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03230   
             ZONCTL = '* CODE RETOUR= '!!SPIPA.CORET;                   03231   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03232   
           END;                                                         03233   
           SPIPA          = '';        /*   TABLE CDLNUART IDENTIFIAN*/ 03234   
           SPIPA.FONCT    = 'GS';                                       03235   
           SPIFI.FNAME    = 'SPI2TAB';                                  03236   
           SPIPA.COTAB    = 'CDLNUART';                                 03237   
           CALL SPI2TBV(SPIPA,TCDLNUAR,SPIFI);                          03238   
           IF SPIPA.CORET ^= '00' THEN DO;          /*  KO  */          03239   
             ZONCTL = '* ERREUR CHARGEMENT SPITAB TABLE '!!SPIPA.COTAB; 03240   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03241   
             ZONCTL = '* CODE RETOUR= '!!SPIPA.CORET;                   03242   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03243   
           END;                                                         03244   
           SPIPA          = '';        /*   TABLE CDLADRES DES ADRESS.*/03245   
           SPIPA.FONCT    = 'GS';                                       03246   
           SPIFI.FNAME    = 'SPI2TAB';                                  03247   
           SPIPA.COTAB    = 'CDLADRES';                                 03248   
           CALL SPI2TBV(SPIPA,TCDLADRE,SPIFI);                          03249   
           IF SPIPA.CORET ^= '00' THEN DO;          /*  KO  */          03250   
             ZONCTL = '* ERREUR CHARGEMENT SPITAB TABLE '!!SPIPA.COTAB; 03251   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03252   
             ZONCTL = '* CODE RETOUR= '!!SPIPA.CORET;                   03253   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03254   
           END;                                                         03255   
  /*-- -------------------------------------------- --*/                03256   
                                                                        03257   
           SPIPA          = '';        /*   TABLE NUMERO ACCORD      */ 03258   
           SPIPA.FONCT    = 'GS';                                       03259   
           SPIFI.FNAME    = 'SPI2TAB';                                  03260   
           SPIPA.COTAB    = 'CDLPAGGA';                                 03261   
           CALL SPI2TBV(SPIPA,TCDLPAGG,SPIFI);                          03262   
           IF SPIPA.CORET ^= '00' THEN DO;          /*  KO  */          03263   
             ZONCTL = '* ERREUR CHARGEMENT SPITAB TABLE '!!SPIPA.COTAB; 03264   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03265   
             ZONCTL = '* CODE RETOUR= '!!SPIPA.CORET;                   03266   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03267   
           END;                                                         03268   
                                                                        03269   
           SPIPA          = '';        /*   TABLE NUMERO ACCORD      */ 03270   
           SPIPA.FONCT    = 'GS';                                       03271   
           SPIFI.FNAME    = 'SPI2TAB';                                  03272   
           SPIPA.COTAB    = 'CDLACCO';                                  03273   
           CALL SPI2TBV(SPIPA,TBACCORD,SPIFI);                          03274   
           IF SPIPA.CORET ^= '00' THEN DO;          /*  KO  */          03275   
             ZONCTL = '* ERREUR CHARGEMENT SPITAB TABLE '!!SPIPA.COTAB; 03276   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03277   
             ZONCTL = '* CODE RETOUR= '!!SPIPA.CORET;                   03278   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03279   
             TABLE_ACCORD_VIDE =  'OUI';                                03280   
           END;                                                         03281   
                                                                        03282   
           SPIPA          = '';                                         03283   
           SPIPA.FONCT    = 'GS';                                       03284   
           SPIFI.FNAME    = 'SPI2TAB';                                  03285   
           SPIPA.COTAB    = 'CDLFACM';                                  03286   
           CALL SPI2TBV(SPIPA,DFACM,SPIFI);                             03287   
           IF SPIPA.CORET ^= '00' THEN DO;                              03288   
             ZONCTL = '* ERREUR CHARGEMENT SPITAB TABLE '!!SPIPA.COTAB; 03289   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03290   
             ZONCTL = '* CODE RETOUR= '!!SPIPA.CORET;                   03291   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03292   
             TABLE_MESSAG_VIDE =  'OUI';                                03293   
           END;                                                         03294   
                                                                        03295   
            DO I = 1 TO 60 ;                                            03296   
               TBL_MESSAG1(I) = '' ;                                    03297   
            END;                                                        03298   
                                                                        03299   
           IF TABLE_MESSAG_VIDE =  'NON' THEN DO;                       03300   
             SPIPA          = '';                                       03301   
             SPIPA.REFPO    = LOW(050);                                 03302   
            DO I =1 TO 60      ;         /* ECRITURE SUR 2EME POSTE*/   03303   
             SPIPA.FONCT = 'RP';                                        03304   
             SPIPA.COTAB = 'CDLFACM';                                   03305   
             SPIPA.OPERA = '>';                                         03306   
             CALL SPI2TBV (SPIPA,DFACM,SPIFI);                          03307   
                IF SPIPA.CORET  = '00' THEN DO;                         03308   
                 SPIPA.REFPO            = DFACM.TF1_NUSE3;              03309   
                 TBL_MESSAG1.POLICE(I)  = '00'X;                        03310   
                 TBL_MESSAG1.LIBE1(I)   = DFACM.TF1_LIBE1;              03311   
                 TBL_MESSAG1.LIBE2(I)   = DFACM.TF1_LIBE2;              03312   
                 TBL_MESSAG1.LIBE3(I)   = DFACM.TF1_LIBE3;              03313   
                END;                                                    03314   
                ELSE  I = 60;                                           03315   
            END;                                                        03316   
           END;                                                         03317   
                                                                        03318   
                                                                        03319   
                                       /*   CHARGEMENT DE SPITAB     */ 03320   
           SPIPA          = '';        /*   TABLE TAUX FOB           */ 03321   
           SPIPA.FONCT    = 'GS';                                       03322   
           SPIFI.FNAME    = 'SPI2TAB';                                  03323   
           SPIPA.COTAB    = 'CDLTXFOB';                                 03324   
           CALL SPI2TBV(SPIPA,CDLTXFOB,SPIFI);                          03325   
           IF SPIPA.CORET ^= '00'                   /*  KO  */          03326   
              & SPIPA.CORET ^= '07' THEN DO;                            03327   
             ZONCTL = '* ERREUR CHARGEMENT SPITAB TABLE '!!SPIPA.COTAB; 03328   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03329   
             ZONCTL = '* CODE RETOUR= '!!SPIPA.CORET;                   03330   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03331   
           END;                                                         03332   
                                                                        03333   
           SPIFI.FNAME    = 'SPI2TAB';                                  03334   
    /*                                             */                   03335   
    /*                                             */                   03336   
    /* PRGM MODIFIE LE 4/5/2001                    */                   03337   
    /*                                             */                   03338   
           SPIPA          = '';        /* TABLE SYSTEME PROSPECTION  */ 03339   
           SPIPA.FONCT    = 'GS';                                       03340   
           SPIFI.FNAME    = 'SPI2TAB';                                  03341   
           SPIPA.COTAB    = 'CDLSYHMD';                                 03342   
           CALL SPI2TBV(SPIPA,CDLSYHMD,SPIFI);                          03343   
           IF SPIPA.CORET ^= '00' THEN DO;                              03344   
             ZONCTL = '* ERREUR CHARGEMENT SPITAB TABLE '!!SPIPA.COTAB; 03345   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03346   
             ZONCTL = '* CODE RETOUR= '!!SPIPA.CORET;                   03347   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03348   
           END;                                                         03349   
    /* ------------------------------------------- */                   03350   
    /* AJOUT 22 10 02 YDU/YHM PCF                  */                   03351   
    /* ------------------------------------------- */                   03352   
           SPIPA          = '';        /*TABLE CDLPCFDU DUPLICAT FACT */03353   
           SPIPA.FONCT    = 'GS';                                       03354   
           SPIFI.FNAME    = 'SPI2TAB';                                  03355   
           SPIPA.COTAB    = 'CDLPCFDU';                                 03356   
           CALL SPI2TBV(SPIPA,CDLPCFDU,SPIFI);                          03357   
           IF SPIPA.CORET ^= '00' THEN DO;                              03358   
             ZONCTL = '* ERREUR CHARGEMENT SPITAB TABLE '!!SPIPA.COTAB; 03359   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03360   
             ZONCTL = '* CODE RETOUR= '!!SPIPA.CORET;                   03361   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03362   
           END;                                                         03363   
1          SPIPA          = '';        /*   TABLE CDLCLLME           */ 03364   
           SPIPA.FONCT    = 'GS';                                       03365   
           SPIFI.FNAME    = 'SPI2TAB';                                  03366   
           SPIPA.COTAB    = 'CDLCLLME';                                 03367   
           CALL SPI2TBV(SPIPA,CDLCLLME,SPIFI);                          03368   
           IF SPIPA.CORET ^= '00'                                       03369   
              & SPIPA.CORET ^= '07' THEN DO;                            03370   
             ZONCTL = '* ERREUR CHARGEMENT SPITAB TABLE '!!SPIPA.COTAB; 03371   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03372   
             ZONCTL = '* CODE RETOUR= '!!SPIPA.CORET;                   03373   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03374   
           END;                                                         03375   
0          SPIPA          = '';        /*   TABLE CDLTELME           */ 03376   
           SPIPA.FONCT    = 'GS';                                       03377   
           SPIFI.FNAME    = 'SPI2TAB';                                  03378   
           SPIPA.COTAB    = 'CDLTELME';                                 03379   
           CALL SPI2TBV(SPIPA,CDLTELME,SPIFI);                          03380   
           IF SPIPA.CORET ^= '00'                                       03381   
              & SPIPA.CORET ^= '07' THEN DO;                            03382   
             ZONCTL = '* ERREUR CHARGEMENT SPITAB TABLE '!!SPIPA.COTAB; 03383   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03384   
             ZONCTL = '* CODE RETOUR= '!!SPIPA.CORET;                   03385   
             CALL MACMES3 (DESTI,'2',ZONCTL);                           03386   
           END;                                                         03387   
0                                      /*   MISE EN TABLE TEXTE LME   */03388   
           NB_CDLTELME    = 0 ;                                         03389   
           TBL_CDLTELME   = '';                                         03390   
0          IF SPIPA.CORET = '00' THEN DO;                               03391   
              SPIPA       = '';                                         03392   
              SPIPA.REFPO = LOW(050);                                   03393   
              SPIPA.FONCT = 'RP';                                       03394   
              SPIPA.COTAB = 'CDLTELME';                                 03395   
              SPIPA.OPERA = '>';                                        03396   
              DO I = 1 TO 99 ;           /*   NBRE POSTES CDLTELME    */03397   
                 CALL SPI2TBV (SPIPA,CDLTELME,SPIFI);                   03398   
                 IF SPIPA.CORET = '00' THEN DO;                         03399   
                    TBL_CDLTELME.LIBE1(I) = CDLTELME.LIBE1;             03400   
                    TBL_CDLTELME.LIBE2(I) = CDLTELME.LIBE2;             03401   
                    TBL_CDLTELME.LIBE3(I) = CDLTELME.LIBE3;             03402   
                    NB_CDLTELME = NB_CDLTELME + 1 ;                     03403   
                    SPIPA.REFPO = CDLTELME.NUSE3;                       03404   
                    END;                                                03405   
                    ELSE  I     = 99;                                   03406   
                 END;                                                   03407   
              END;                                                      03408   
0         IF NB_CDLTELME > 0 THEN DO;                                   03409   
             Z115_CDLTELME      = TBL_CDLTELME.LIBE1(1) !!              03410   
                                  TBL_CDLTELME.LIBE2(1) !!              03411   
                                  TBL_CDLTELME.LIBE3(1) ;               03412   
             DO I = 1 TO 115;            /*   DEBUT TEXTE 1ERE LIGNE  */03413   
                IF SUBSTR(Z115_CDLTELME,I,1) ^= ' ' THEN DO;            03414   
                   DEB_CDLTELME = I ;                                   03415   
                   I            = 115 ;                                 03416   
                   END;                                                 03417   
                END;                                                    03418   
             END;                                                       03419   
0                                        /*   CHARGEMENT MTAB MERNUCLI*/03420   
                                         /*****************************/03421   
           CALL MTABCHG(MTAB01);                                        03422   
                                                                        03423   
           IF MTAB01.CODER = 1 THEN DO;                                 03424   
              ZONCTL       = '* TABLE MERNUCLI INCONNU DS MTAB *****';  03425   
              CALL MACMES3 (DESTI,'1',ZONCTL);                          03426   
              END;                                                      03427   
           IF MTAB01.CODER = 2 THEN DO;                                 03428   
              ZONCTL       = '* TABLE MERNUCLI RUBRIQUE INCONNUE ***';  03429   
              CALL MACMES3 (DESTI,'1',ZONCTL);                          03430   
              END;                                                      03431   
           IF MTAB01.CODER > 2 THEN DO;                                 03432   
              ZONCTL       = '***** ERREUR SYSTEME SUR MTAB ,CODE ' !!  03433   
                              MTAB01.CODER;                             03434   
              CALL MACMES3 (DESTI,'1',ZONCTL);                          03435   
              END;                                                      03436   
           NBP_MERNUCLI    = MTAB01.NBPOSTE;                            03437   
                                                                        03438   
0          FACTIN2        = '' ;        /*   INIT. VARIABLES FACTURE  */03439   
           WTMIC          = '' ;        /*   INIT. ENREG. MICROFICHES */03440   
           WIPAG          = '' ;        /*   INIT. ENREG. INDEX PAG-FA*/03441   
0          WANOE          = '' ;        /*   INIT. FICHIER ANOMALIES  */03442   
           WANOL          = '' ;        /*   CODE ETAT  400           */03443   
           WANOT          = '' ;        /*   ANOMALIES TECHNIQUES     */03444   
           WANOE.ID.CODET = '400' ;                                     03445   
           WANOE.ID.TYPEN = '1' ;                                       03446   
           WANOE.GS.CODET = '400' ;                                     03447   
           WANOL.ID.CODET = '400' ;                                     03448   
           WANOL.ID.TYPEN = '2' ;                                       03449   
           WANOL.GS.CODET = '400' ;                                     03450   
           WANOT.SURCO    = '9'   ;                                     03451   
           WANOT.NPROG    = 'IDIL470';                                  03452   
0          WJOUF          = '';         /*   INIT. JOURNAL DE FACTURA.*/03453   
           IF WTFAC.DEPCO = '10' THEN DO;/*  YOUPIE  01.09.87         */03454   
              WJOUR.ID.CODET = ' 470';  /*   CODE ETAT  470 SUCCES    */03455   
              WJOUR.GS.CODET = ' 470';                                  03456   
              WJOUF.ID.CODET = ' 470';                                  03457   
              WJOUF.GS.CODET = ' 470';                                  03458   
              END;           ELSE DO ;                                  03459   
              WJOUR.ID.CODET = ' 471';  /*   CODE ETAT  471 NORMAL    */03460   
              WJOUR.GS.CODET = ' 471';                                  03461   
              WJOUF.ID.CODET = ' 471';                                  03462   
              WJOUF.GS.CODET = ' 471';                                  03463   
              END;                                                      03464   
           WJOUR.ID.CODEN = '2'   ;                                     03465   
           WJOUR.GS.CODEN = '2'   ;                                     03466   
           WJOUF.ID.CODEN = '1'   ;                                     03467   
           WJOUF.GS.CODEN = '1'   ;                                     03468   
0          IF WTFAC.DEPCO = '10' THEN DO;/*  YOUPIE  01.09.87         */03469   
              WTBOR.ID.CODET = ' 473';  /*   INIT. BORDEREAU COMPTANT */03470   
              WTBOR.GS.CODET = ' 473';  /*   CODE ETAT   473 SUCCES   */03471   
              END;           ELSE DO ;                                  03472   
              WTBOR.ID.CODET = ' 472';  /*   INIT. BORDEREAU COMPTANT */03473   
              WTBOR.GS.CODET = ' 472';  /*   CODE ETAT   472 NORMAL   */03474   
              END;                                                      03475   
0          L              = 10 ;        /*   INIT. FICH. RESULT. FACT.*/03476   
           ALLOCATE WRESP;                                              03477   
           WRESL.TYENR    = '1';        /*   NIVEAU LIGNE             */03478   
           WRESP.TYENR    = '5';        /*   NIVEAU PIED              */03479   
           WRESP.GEREF    = ' ';        WRESL.GEREF      = ' ';         03480   
0          PASTK.ST       = '' ;        /*   INIT. FICH. FACT. MULTI. */03481   
           PASTK.NBELU    = 0  ;        PASTK.CODLE      = 'E';         03482   
           PASTK.NBEST    = 0  ;        PASTK.CODXX      = ' ';         03483   
           PASTK.CODGT    = 'O';                                        03484   
           PASTK.LGMVT    = 175;                                        03485   
           CALL ID470F;                                                 03486   
1                                                                       03487   
                                       /*******************************/03488   
-                                      /*     FOND PAGE FACTURE A4    */03489   
           PAG1_POR       = ''     ;                                    03490   
           PAG1_POR.V_5A  = '5A'X ;                                     03491   
           PAG1_POR.V_01  = '0010'X;                                    03492   
           PAG1_POR.V_D3  = 'D3ABCA'X; /*     FORMDEF                 */03493   
           PAG1_POR.V_00  = LOW(3) ;                                    03494   
           PAG1_POR.V_NOM = 'FCTF61' ;                                  03495   
           PAG2_POR       = PAG1_POR , BY NAME ;                        03496   
           PAG2_POR.V_01  = '0016'X;                                    03497   
           PAG2_POR.V_NOM = 'O1A4FR61' ;                                03498   
           PAG2_POR.V_D3  = 'D3AFD8'X;                                  03499   
           PAG2_POR.V_23  = LOW(23)  ;                                  03500   
                                                                        03501   
           PAG2_PAY       = PAG1_POR , BY NAME ;                        03502   
           PAG2_PAY.V_01  = '0016'X;                                    03503   
           PAG2_PAY.V_NOM = 'O1A4FR63' ;                                03504   
           PAG2_PAY.V_D3  = 'D3ABCA'X;  /*   PAGEDEF                  */03505   
           PAG2_PAY.V_23  = LOW(23)  ;                                  03506   
                                        /*   RECTO VERSO PAGE BLANCHE */03507   
           PAG1_BLAN      = PAG1_POR , BY NAME ;                        03508   
           PAG1_BLAN.V_NOM = 'VIERGE1';                                 03509   
           PAG2_BLAN      = PAG2_POR , BY NAME ;                        03510   
           PAG2_BLAN.V_NOM = 'O1VIERGE';                                03511   
           PAG2_BLAN.V_23  = LOW(23)  ;                                 03512   
0                                       /*   MACOM 001 CDL POUR DEMAT */03513   
           CLE3           = '001' ;                                     03514   
           CALL ID470B(TBACRDL.NUTAB);                                  03515   
           M001_NOCRD     = WNOCRD;                                     03516   
           M001_ADCRD     = WADCRD;                                     03517   
           M001_VICRD     = WVICRD;                                     03518   
           FICSTOP_PREV   = LOW(235);                                   03519   
1                                                                       03520   
                                        /*   SAUT 1 PAGE POUR RECTOVER*/03521   
0          STRING (ZSPOOLP_SVG)    = STRING (PAG1_BLAN);                03522   
           ZSPOOLP                 = ZSPOOLP_SVG;                       03523   
           CALL SPOOLA32(UN,ZSPOOL);                                    03524   
           STRING (ZSPOOLP_SVG)    = STRING (PAG2_BLAN);                03525   
           ZSPOOLP                 = ZSPOOLP_SVG;                       03526   
           CALL SPOOLA32(UN,ZSPOOL);                                    03527   
           ZSPOOLP                 = '';                                03528   
           ZSPOOLP.POLIC           = '00'X;                             03529   
           CALL SPOOLA32(UN,ZSPOOL);                                    03530   
0          STRING (ZSPOOLP_SVG)    = STRING (PAG1_BLAN);                03531   
           ZSPOOLP                 = ZSPOOLP_SVG;                       03532   
           CALL SPOOLA32(DEUX,ZSPOOL);                                  03533   
           STRING (ZSPOOLP_SVG)    = STRING (PAG2_BLAN);                03534   
           ZSPOOLP                 = ZSPOOLP_SVG;                       03535   
           CALL SPOOLA32(DEUX,ZSPOOL);                                  03536   
           ZSPOOLP                 = '';                                03537   
           ZSPOOLP.POLIC           = '00'X;                             03538   
           CALL SPOOLA32(DEUX,ZSPOOL);                                  03539   
0          STRING (ZSPOOLP_SVG)    = STRING (PAG1_BLAN);                03540   
           ZSPOOLP                 = ZSPOOLP_SVG;                       03541   
           CALL SPOOLA32(TROIS,ZSPOOL);                                 03542   
           STRING (ZSPOOLP_SVG)    = STRING (PAG2_BLAN);                03543   
           ZSPOOLP                 = ZSPOOLP_SVG;                       03544   
           CALL SPOOLA32(TROIS,ZSPOOL);                                 03545   
           ZSPOOLP                 = '';                                03546   
           ZSPOOLP.POLIC           = '00'X;                             03547   
           CALL SPOOLA32(TROIS,ZSPOOL);                                 03548   
0          STRING (ZSPOOLP_SVG)    = STRING (PAG1_BLAN);                03549   
           ZSPOOLP                 = ZSPOOLP_SVG;                       03550   
           CALL SPOOLA32(QUATRE,ZSPOOL);                                03551   
           STRING (ZSPOOLP_SVG)    = STRING (PAG2_BLAN);                03552   
           ZSPOOLP                 = ZSPOOLP_SVG;                       03553   
           CALL SPOOLA32(QUATRE,ZSPOOL);                                03554   
           ZSPOOLP                 = '';                                03555   
           ZSPOOLP.POLIC           = '00'X;                             03556   
           CALL SPOOLA32(QUATRE,ZSPOOL);                                03557   
0          STRING (ZSPOOLP_SVG)    = STRING (PAG1_BLAN);                03558   
           ZSPOOLP                 = ZSPOOLP_SVG;                       03559   
           CALL SPOOLA32(CINQ,ZSPOOL);                                  03560   
           STRING (ZSPOOLP_SVG)    = STRING (PAG2_BLAN);                03561   
           ZSPOOLP                 = ZSPOOLP_SVG;                       03562   
           CALL SPOOLA32(CINQ,ZSPOOL);                                  03563   
           ZSPOOLP                 = '';                                03564   
           ZSPOOLP.POLIC           = '00'X;                             03565   
           CALL SPOOLA32(CINQ,ZSPOOL);                                  03566   
0          STRING (ZSPOOLP_SVG)    = STRING (PAG1_BLAN);                03567   
           ZSPOOLP                 = ZSPOOLP_SVG;                       03568   
           CALL SPOOLA32(SIX,ZSPOOL);                                   03569   
           STRING (ZSPOOLP_SVG)    = STRING (PAG2_BLAN);                03570   
           ZSPOOLP                 = ZSPOOLP_SVG;                       03571   
           CALL SPOOLA32(SIX,ZSPOOL);                                   03572   
           ZSPOOLP                 = '';                                03573   
           ZSPOOLP.POLIC           = '00'X;                             03574   
           CALL SPOOLA32(SIX,ZSPOOL);                                   03575   
0          STRING (ZSPOOLP_SVG)    = STRING (PAG1_BLAN);                03576   
           ZSPOOLP                 = ZSPOOLP_SVG;                       03577   
           CALL SPOOLA32(SEPT,ZSPOOL);                                  03578   
           STRING (ZSPOOLP_SVG)    = STRING (PAG2_BLAN);                03579   
           ZSPOOLP                 = ZSPOOLP_SVG;                       03580   
           CALL SPOOLA32(SEPT,ZSPOOL);                                  03581   
           ZSPOOLP                 = '';                                03582   
           ZSPOOLP.POLIC           = '00'X;                             03583   
           CALL SPOOLA32(SEPT,ZSPOOL);                                  03584   
0          STRING (ZSPOOLP_SVG)    = STRING (PAG1_BLAN);                03585   
           ZSPOOLP                 = ZSPOOLP_SVG;                       03586   
           CALL SPOOLA32(HUIT,ZSPOOL);                                  03587   
           STRING (ZSPOOLP_SVG)    = STRING (PAG2_BLAN);                03588   
           ZSPOOLP                 = ZSPOOLP_SVG;                       03589   
           CALL SPOOLA32(HUIT,ZSPOOL);                                  03590   
           ZSPOOLP                 = '';                                03591   
           ZSPOOLP.POLIC           = '00'X;                             03592   
           CALL SPOOLA32(HUIT,ZSPOOL);                                  03593   
0                                       /*   UTILISATION CARTE PARAM. */03594   
           CALL MACLIR3 (DESTI,PWTDAT,1);/*  LECTURE CARTE PARAMETRE  */03595   
           ENTET70.NORUN = ' ';                                         03596   
           IF WRDAT.COENR = 'RA' THEN DO;                               03597   
                                        /*   CARTE RASSORT            */03598   
                    ENTET70.NORUN  = WRDAT.NORUN;                       03599   
                    WRESL.RUNFA    = WRDAT.NORUN;                       03600   
                    WRESP.RUNFA    = WRDAT.NORUN;                       03601   
                    WTMIC.RUNFA    = WRDAT.NORUN;                       03602   
                    WJOUR.GS.RUNFA = WRDAT.NORUN;                       03603   
                    WJOUR.ID.RUNFA = WRDAT.NORUN;                       03604   
                    WJOUF.GS.RUNFA = WRDAT.NORUN;                       03605   
                    WJOUF.ID.RUNFA = WRDAT.NORUN;                       03606   
                    GO TO A010D;                                        03607   
                    END;                                                03608   
           IF WRDAT.COENR = 'OF' THEN DO;                               03609   
                                        /*   CARTE OFFICE             */03610   
                    ENTET70.NORUN  = WTDAT.NORUN;                       03611   
                    WRESL.RUNFA    = WTDAT.NORUN;                       03612   
                    WRESP.RUNFA    = WTDAT.NORUN;                       03613   
                    WTMIC.RUNFA    = WTDAT.NORUN;                       03614   
                    WJOUR.GS.RUNFA = WTDAT.NORUN;                       03615   
                    WJOUR.ID.RUNFA = WTDAT.NORUN;                       03616   
                    WJOUF.GS.RUNFA = WTDAT.NORUN;                       03617   
                    WJOUF.ID.RUNFA = WTDAT.NORUN;                       03618   
                    GO TO A010D;                                        03619   
                    END;                                                03620   
0                                       /*   CARTE DATE INCONNUE      */03621   
           ZONCTL             = '                * ERREUR CARTE PARAM.';03622   
           CALL MACMES3 (DESTI,'2',ZONCTL);                             03623   
           ZONCTL             = '                * PROGRAMME TERMINE '; 03624   
           CALL MACMES3 (DESTI,'2',ZONCTL);                             03625   
           CALL PLIRETC(15);            /*   QUEUE HOLDEE             */03626   
           GO TO A000F;                                                 03627   
1                                       /*******************************03628   
                                        *    MODULE INITIAL CDL GIH    *03629   
                                        *******************************/03630   
       A010D:                                                           03631   
           ENTET7.NUFAC            = 0; /*   R A Z  REFERENCE FACTURE */03632   
           ENTET70.REFFA,WNUFAC_5  = 0;                                 03633   
 /* PCA 20160311                                                        03634   
           PUT SKIP LIST ('WNUFAC : ' !! WNUFAC !! ' DANS A010D.');     03635   
           PUT SKIP LIST ('IRAFAC : ' !! IRAFAC !! ' DANS A010D.');     03636   
           PUT SKIP LIST ('WEDIPA : ' !! WEDIPA !! ' DANS A010D.'); */  03637   
           IF WEDIPA = ' ' THEN DO ;                                    03638   
              WNUFAC                  = 0;                              03639   
              XNUFAC1,XNUFAC2,XNUFAC3 = 0;                              03640   
           END ;                                                        03641   
           IF WEDIPA ^= WTFAC.EDIPA THEN DO ;                           03642   
              WEDIPA = WTFAC.EDIPA ;                                    03643   
           END ;                                                        03644   
 /*        WNUFAC                  = 0;                                 03645   
           XNUFAC1,XNUFAC2,XNUFAC3 = 0;                               */03646   
 /* PCA 20160311 FIN                                                  */03647   
           IF WTFAC.EDIPA     = '9' THEN GO TO A020D;                   03648   
0          IF WTFAC.EDIPA = '2' THEN DO;/*   CAS  DU  GIH             */03649   
                    ENTET65.DAT13.FIL05 = ' ';                          03650   
                    ENTET65.DAT13.FIL06 = ' ';                          03651   
                    CALL ID470C('GIH'); /*   CADRAGE FACTURES GIH     */03652   
                    UN_M          = 20; /*   NON EDITEE 20.12.91      */03653   
                    END;                                                03654   
1                                       /*******************************03655   
                                        *    MODULE INITIAL NUCLI      *03656   
                                        *******************************/03657   
       A020D:                                                           03658   
1                                       /******************************/03659   
                                        /* AJOUT 22 10 02 YDU/YHM PCF */03660   
                                        /******************************/03661   
0                                       /******************************/03662   
                                        /* RECH. TABLE CDLPCFDU       */03663   
                                        /* CLIENT PCF ?               */03664   
                                        /******************************/03665   
           SPIPA          = '';                                         03666   
           SPIPA.FONCT    = 'RP';                                       03667   
           SPIPA.COTAB    = 'CDLPCFDU';                                 03668   
           SPIPA.OPERA    = '=';                                        03669   
           SPIPA.REFPO    = 'TRACO' !! WTFAC.TRACO ;                    03670   
           CALL SPI2TBV (SPIPA,CDLPCFDU,SPIFI);                         03671   
           IF SPIPA.CORET = '00'                                        03672   
           THEN PCF_CLIENT  = 'O' ;                                     03673   
           ELSE PCF_CLIENT  = 'N' ;                                     03674   
1                                                                       03675   
  /*-- -------------------------------------------- --*/                03676   
  /*-- GESTION DES FACTURES DEMATERIALISEES   ----- --*/                03677   
  /*--   DEBUT AJOUT SMARTIN DU 17/12/2004    ----- --*/                03678   
                                                                        03679   
           TOP_DEMA_CLI    = 'N' ;                                      03680   
                                                                        03681   
           SPIPA       = '';                                            03682   
           SPIPA.FONCT = 'RP';                                          03683   
           SPIPA.COTAB = 'CDLFDEMX';                                    03684   
           SPIPA.OPERA = '=';                                           03685   
           SPIPA.REFPO = WTFAC.NUCLI ;                                  03686   
           CALL SPI2TBV (SPIPA,TCDLFDEM,SPIFI);                         03687   
           IF SPIPA.CORET = '00' THEN DO;                               03688   
              WL_CLLIV.NUCLI       = TCDLFDEM.CNUDC ;                   03689   
              WF_CLFAC.NUCLI       = TCDLFDEM.CNUD5 ;                   03690   
              IF TCDLFDEM.CNUD5    = ' ' THEN DO;                       03691   
                 IF TCDLFDEM.CNUDC = ' '                                03692   
                    THEN WF_CLFAC.NUCLI = WL_CLLIV.NUCLI ;              03693   
                    ELSE WF_CLFAC.NUCLI = TCDLFDEM.CNUDC ;              03694   
                 LOG_COM           = ''    ;                            03695   
                 LOG_COM.TYPEN     = 'LOG' ;                            03696   
                 LOG_COM.NORUN     = WTFAC.NORUN ;                      03697   
                 LOG_COM.EANFO     = WTFAC.NUCLI ;                      03698   
                 LOG_COM.ZOCOM     = '*** NUCLI=' !! WTFAC.NUCLI !!     03699   
                                  ' SANS CLIFA DANS TABLE'       !!     03700   
                                  ' CDLFDEMX ' ;                        03701   
                 WRITE FILE(FICLCOM) FROM(LOG_COM);                     03702   
                 NB_FICLCOM        = NB_FICLCOM + 1  ;                  03703   
                 END;                                                   03704   
              TOP_DEMA_CLI         = 'O' ;                              03705   
              END;                      ELSE DO;                        03706   
              TOP_DEMA_CLI         = 'N' ;                              03707   
              END;                                                      03708   
  /*--   FIN   AJOUT SMARTIN DU 17/12/2004    ----- --*/                03709   
1                                       /******************************/03710   
                                        /* RECH. REF.DE CDE 15 01 97�$*/03711   
                                        /* CIBLE: LES CDES OFFICE     */03712   
                                        /******************************/03713   
            WS_RECO1_IDREFCO1 = '';                                     03714   
            FD_RF1_NORUN = WTFAC.NORUN;                                 03715   
            FD_RF1_NUCLI = WTFAC.NUCLI;                                 03716   
            WK_RECHE_IDREFCO1 = 'O';                                    03717   
            READ FILE(IDREFCO1) INTO (FD_IDREFCO1)                      03718   
                                KEY  (FD_CLE_IDREFCO1);                 03719   
                                                                        03720   
            IF WK_RECHE_IDREFCO1 = 'O'                                  03721   
               THEN DO;                                                 03722   
                   WTFAC.RECO1        = STRING(RF1_RECO1);              03723   
                   WS_RECO1_IDREFCO1  = STRING(RF1_RECO1);              03724   
                   SVG_RECOM          = WTFAC.RECO1 !! WTFAC.MONTC ;    03725   
               END;                                                     03726   
                                        /*   COTAX DOCUMENT. OU NON   */03727   
           NBFAC_AS = '0';              /*   POUR MASSICOT 18.12.82   */03728   
           IF WTFAC.POFIS = '4' ! WTFAC.POFIS = '8' THEN DO;            03729   
                    NUCLI.COTAX         = '0';                          03730   
                    END;                ELSE DO;                        03731   
                    NUCLI.COTAX         = '1';                          03732   
                    END;                                                03733   
           CALL INIT_DEMA;                                              03734   
0          CANADA_NUCLI          = 'N'; /*   NUCLI CANADA PROFORMA ?  */03735   
           DO I_MERNUCLI = 1 TO NBP_MERNUCLI;                           03736   
              IF MT1_NUCLI(I_MERNUCLI) = WTFAC.GS.NUCLI THEN DO;        03737   
                 CANADA_NUCLI    = 'O' ;                                03738   
                 END;                                                   03739   
              END;                                                      03740   
                                                                        03741   
0          IF WTFAC.DEPCO = '10'        /*   YOUPIE 01.09.87          */03742   
              THEN  WTMIC.EDIPA  = '3'        ;                         03743   
              ELSE  WTMIC.EDIPA  = WTFAC.EDIPA;                         03744   
-          SSCLI.VAL    = WTFAC.NUCLI;                                  03745   
           CALL LECTDBC;                /*   ACCES DATA BASE CLIENTS  */03746   
                                        /**************************** */03747   
                                        /*  RECHERCHE SI LE CLIENT    */03748   
                                        /*  EST CONCERNE PAR UN ACCORD*/03749   
                                        /**************************** */03750   
           IF TABLE_ACCORD_VIDE =  'NON' THEN DO;                       03751   
             STRING(CLE_ACCORD) = LOW(100);                             03752   
             CLE_ACCORD.SYPRO = WTCLI1.SYPRO;                           03753   
             CLE_ACCORD.AFFIL = WTCLI1.AFFIL;                           03754   
             SPIPA          = '';                                       03755   
             SPIPA.FONCT = 'RP';                                        03756   
             SPIPA.COTAB = 'CDLACCO';                                   03757   
             SPIPA.REFPO = STRING(CLE_ACCORD);                          03758   
             SPIPA.OPERA = '>';                                         03759   
             CALL SPI2TBV (SPIPA,TBACCORD,SPIFI);                       03760   
             ACCORD_OUI_NON = 'NON';                                    03761   
             IF SPIPA.CORET ^= '00' THEN ACCORD_OUI_NON = 'NON';        03762   
             ELSE;                                                      03763   
             IF TBACCORD.SYPRO!!TBACCORD.AFFIL                          03764   
             = WTCLI1.SYPRO!!WTCLI1.AFFIL & TBACCORD.NUCLI = ''         03765   
             THEN ACCORD_OUI_NON = 'OUI';                               03766   
             ELSE;                                                      03767   
             IF TBACCORD.SYPRO!!TBACCORD.AFFIL                          03768   
             = WTCLI1.SYPRO!!WTCLI1.AFFIL &                             03769   
             TBACCORD.NUCLI = WTCLI1.NUCLI                              03770   
             THEN ACCORD_OUI_NON = 'OUI';                               03771   
           END;                                                         03772   
0          IF NB_CDLTELME = 0 THEN DO;                                  03773   
              EDIT_CDLTELME      = 'N' ;                                03774   
              END;                      ELSE DO;                        03775   
              CALL RECH_CDLCLLME;       /*   CLIENT AVEC TEXTE LME ?  */03776   
           END;                                                         03777   
0      A020C:                                                           03778   
           IF NUCLI.TROUV = '0' THEN DO;/*   CLIENT INCONNU DANS DBC  */03779   
0             SSCLI.VAL = '999987' ;    /*   01.09.87 CLIENT PAR DEFAU*/03780   
              CALL LECTDBC;             /*   ACCES DATA BASE CLIENTS  */03781   
0             IF NUCLI.TROUV = '0' THEN DO;                             03782   
                    WANOL.TBANO(1)      = '1010';                       03783   
                    WANOE.TBANO(1)      = '1010';                       03784   
                    WANOL.LIMPO         = '***** NUCLI ' !!             03785   
                                          WTFAC.GS.NUCLI !!             03786   
                                          ' INCONNU   REJETE   *****';  03787   
                    CALL ID470D;        /*   MOUVEMENTS REJETES       */03788   
                    IF IRAFAC > 2 THEN DO;                              03789   
                       CALL SPLAFAC;                                    03790   
                       GO TO A020C;                                     03791   
                       END;   ELSE DO;                                  03792   
                       GO TO A020F;                                     03793   
                       END;                                             03794   
                    END;                /*   FIN NUCLI DEFAUT INCONNU */03795   
              NUCLI.TROUV               = '0' ;                         03796   
              END;                                                      03797   
0          ENTET2.MOTRA       = ' ';                                    03798   
           IF WTGCO.TYREL = '1'                                         03799   
              THEN RECAP_BL   = 'OUI' ;                                 03800   
              ELSE RECAP_BL   = 'NON' ;                                 03801   
           IF WTFAC.EDIPA     = '2'   THEN GO TO A020Q;                 03802   
0      A020P:                           /*   TRAITEMENT FRANCE        */03803   
                                        /******************************/03804   
0          NLMAX             = 60 ;     /*   11.84 FACTUR. LASER=48,31*/03805   
           NLMAX_AS          = 48 ;     /*NBLIG ANCIEN ON A FAIT +20  */03806   
                                        /*YDV P0299*/                   03807   
           NLMAX_1           = NLMAX - 1 ;                              03808   
           NLMAX_2           = NLMAX - 2 ;                              03809   
           NLMAX_3           = NLMAX - 3 ;                              03810   
           NLMAX_5           = NLMAX - 5 ;                              03811   
0          IF WTFAC.EDIPA   ^= '9' THEN DO;                             03812   
              IF WTFACRED.AUTOM = 'A'                                   03813   
                 THEN   UN_M = 10;      /*   MISE SOUS PLI AUTOMATIQUE*/03814   
                 ELSE   UN_M = 30;      /*   MISE SOUS PLI MANUELLE   */03815   
              CALL SYPROSP;             /*   HMD SPOOL 7  UN_M=70 ?   */03816   
              IF SWCDL       = '0' THEN DO;                             03817   
                 IF UN_M = 10 THEN DO;                                  03818   
                    CALL ID470C('CDL'); /*   CADRAGE FACTURES CDL     */03819   
                    SWCDL         = '1';/*   NON EDITEE 20.12.91      */03820   
                    END;                /*   FIN TEST MACOM 001       */03821   
                 END;                   /*   FIN TEST SWCDL = 0       */03822   
              IF SWCRD       = '0' THEN DO;                             03823   
                 IF UN_M = 30 THEN DO;                                  03824   
                    CALL ID470C('CRD'); /*   CADRAGE FACTURES CRDL    */03825   
                    SWCRD         = '1';/*   NON EDITEE 20.12.91      */03826   
                    ENTET1.POREC  = ' ';                                03827   
                    END;                /*   FIN TEST MACOM 001       */03828   
                 END;                   /*   FIN TEST SWCRD = 0       */03829   
              END;                      /*   FIN TEST EDIPA DIFF 9    */03830   
           CALL RENCRDL;                /*   RECHERCHE DU NCRDL       */03831   
           ENTET7_1.LECFA     = ' ';                                    03832   
           IF WTCLI1.CLICO    = ' ' THEN DO;                            03833   
                    ENTET65.COMPTA      = ' ';                          03834   
                    END;                ELSE DO;                        03835   
                    ZCLICO              = CLICONUM;                     03836   
                    ENTET65.COMPTA      = WCOMPTA;                      03837   
                    END;                /*   FIN  TEST  CLICO BLANC   */03838   
           ENTET65.VENET      = ' ';                                    03839   
           ENTET65.STRET      = ' ';                                    03840   
           GO TO A020R;                                                 03841   
0      A020Q:                           /*   TRAITEMENT DU GIH        */03842   
                                        /******************************/03843   
0          NLMAX              = 60 ;    /*   11.84 FACTURE GIH=29,45  */03844   
0          NLMAX_AS           = 48 ;    /*NBLIG ANCIEN ON A FAIT +20  */03845   
                                        /*YDV P0299*/                   03846   
           NLMAX_1            = NLMAX - 1 ;                             03847   
           NLMAX_2            = NLMAX - 2 ;                             03848   
           NLMAX_3            = NLMAX - 3 ;                             03849   
           NLMAX_5            = NLMAX - 5 ;                             03850   
                                        /*    CANAL SPOOLPU3 GIH '20'   03851   
                                         OU   CANAL SPOOLPU3 GHI '60' */03852   
           IF WTGCO.CECOM = '710'                                       03853   
              THEN   UN_M     = 60 ;                                    03854   
              ELSE   UN_M     = 20 ;                                    03855   
                                                                        03856   
           ENTET1.NOCRD       = ' ';                                    03857   
           ENTET2.ADCRD       = ' ';                                    03858   
           ENTET3.VICRD       = ' ';                                    03859   
           ENTET4.RCCRD       = ' ';                                    03860   
0          WFILER             = ' ';    /*   INIT NO CTE CLIDIH       */03861   
           WNOMCO             = WTCLI1.NOMCO;                           03862   
           WCATCO             = WTCLI1.CATCO;                           03863   
           WNATCO             = WTCLI1.NATCO;                           03864   
           WDEVIS             = WTCLI1.DEVIS;                           03865   
           IF WTCLI1.NOMCO = '00000' & WTCLI1.CATCO = '0' &             03866   
              WTCLI1.NATCO = '00'    & WTCLI1.DEVIS = '0'               03867   
              THEN  WCOMPTA   = ' ';                                    03868   
           ENTET65.COMPTA     = WCOMPTA;                                03869   
0      A020R:                           /*   INIT. ENTETE FACTURE     */03870   
                                        /*   COMMUNE  CDL  GIH        */03871   
           ENTET1.FACSP       = WTFAC.FACSP;                            03872   
           ENTET1.MACOM       = WTFAC.MACOM;                            03873   
                                        /*   CADOR GNAT1 LSCAD INIT.  */03874   
                                        /*   SI MACOM=001 CF TRI FACTU*/03875   
           ENTET1.CADOR       = WTFAC.CADOR;                            03876   
           ENTET1.GNAT1       = WTFAC.GNAT1;                            03877   
           CLE1               = WTFAC.CADOR;                            03878   
           CALL ID470B(TBCADOR.NUTAB);                                  03879   
           ENTET1.LSCAD       = WLSCAD;                                 03880   
           ENTET1.PEFAC       = WTFAC.PEFAC;                            03881   
           ENTET70.NUCLI      = NUCLINUM;                               03882   
           ENTET4.NUCLI       = NUCLINUM;                               03883   
0          ENTET70.DAT10.JJ   = ' ';                                    03884   
           ENTET70.DAT10.MM   = ' ';                                    03885   
           ENTET70.DAT10.AA   = ' ';                                    03886   
           ENTET65.LIPEF      = ' ';                                    03887   
0                                       /*   INIT. MICROFICHES        */03888   
           WTMIC.MACOM        = WTFAC.MACOM;                            03889   
           WTMIC.TRACO        = WTFAC.TRACO;                            03890   
           WTMIC.NUCLI        = WTFAC.NUCLI;                            03891   
0                                       /*   INIT. JOURNAL FACTUR.    */03892   
           WJOUF.ID.NUCLI     = WTFAC.NUCLI;                            03893   
           WJOUR.ID.NUCLI     = WTFAC.NUCLI;                            03894   
0                                       /*   UTILISATION CARTE PARAM. */03895   
           IF WRDAT.COENR = 'RA' THEN GO TO A020T;                      03896   
0      A020S:                           /*   CARTE OFFICE             */03897   
           IF WTFAC.PEFAC = '0' !       /*   FACTURATION IMMEDIATE    */03898   
              WTFAC.PEFAC = '9' THEN DO;/*   FACTURATION OUVERTE      */03899   
                    IF WTFAC.TRACO = '0' & WTFAC.DEPCO = '17' THEN DO;  03900   
                         ENTET70.DAT10.JJ = SUBSTR(WTDAT.DAFAE,5,2);    03901   
                         ENTET70.DAT10.MM = SUBSTR(WTDAT.DAFAE,3,2);    03902   
                         ENTET70.DAT10.AA = SUBSTR(WTDAT.DAFAE,1,2);    03903   
                         END;          ELSE DO;                         03904   
                         ENTET70.DAT10.JJ = SUBSTR(WTDAT.DAFAF,5,2);    03905   
                         ENTET70.DAT10.MM = SUBSTR(WTDAT.DAFAF,3,2);    03906   
                         ENTET70.DAT10.AA = SUBSTR(WTDAT.DAFAF,1,2);    03907   
                         END;                                           03908   
                    END;                                                03909   
           GO TO A020U;                                                 03910   
0      A020T:                           /*   CARTE RASSORT            */03911   
           IF WTFAC.PEFAC = '0' !       /*   FACTURATION IMMEDIATE    */03912   
              WTFAC.PEFAC = '9' !       /*   FACTURATION OUVERTE      */03913   
              WTFAC.PEFAC = '3' THEN DO;/*   OU A LA DEMANDE          */03914   
                    ENTET70.DAT10.JJ   = SUBSTR(WRDAT.DAFAC,5,2);       03915   
                    ENTET70.DAT10.MM   = SUBSTR(WRDAT.DAFAC,3,2);       03916   
                    ENTET70.DAT10.AA   = SUBSTR(WRDAT.DAFAC,1,2);       03917   
                    END;                                                03918   
           IF WTFAC.PEFAC = '1' THEN DO;/*   FACTURATION DECADAIRE    */03919   
                    ENTET70.DAT10.JJ   = SUBSTR(WRDAT.DADEC,5,2);       03920   
                    ENTET70.DAT10.MM   = SUBSTR(WRDAT.DADEC,3,2);       03921   
                    ENTET70.DAT10.AA   = SUBSTR(WRDAT.DADEC,1,2);       03922   
                    ENTET65.LIPEF      = WRDAT.LIDEC;                   03923   
                    END;                                                03924   
           IF WTFAC.PEFAC = '2' THEN DO;/*   FACTURATION MENSUELLE    */03925   
                    ENTET70.DAT10.JJ   = SUBSTR(WRDAT.DAMOI,5,2);       03926   
                    ENTET70.DAT10.MM   = SUBSTR(WRDAT.DAMOI,3,2);       03927   
                    ENTET70.DAT10.AA   = SUBSTR(WRDAT.DAMOI,1,2);       03928   
                    ENTET65.LIPEF      = WRDAT.LIMOI;                   03929   
                    END;                                                03930   
0      A020U:                           /*   INIT FICH. RESULT. FACT. */03931   
                                        /*   18.12.81 REPORT DS A030D */03932   
                                        /*   AVEC MAGTI=315 ET TRACO=0*/03933   
                                        /*   INIT DATE ANTICIP. ECHEA */03934   
           WDAT1.AA           = ENTET70.DAT10.AA;                       03935   
           WDAT1.MM           = ENTET70.DAT10.MM;                       03936   
                                                                        03937   
1                                       /*******************************03938   
                                        *    MODULE INITIAL FACTURE    *03939   
                                        *******************************/03940   
       A030D:                           /*   INIT FICH. RESULT. FACT. */03941   
                                        /*EDIT FD PAGE EN PLEINE PAGE*/ 03942   
0          TABLE_PAGE         = '' ;    /*YDV P0299*/                   03943   
           EDIT_FDPAG         = 'O';                                    03944   
           EDIT_LIG_FIR       = 'N';                                    03945   
           LIGNE              = '' ;                                    03946   
           FEXPO_AUTO         = 'N';                                    03947   
           SVG_LIGNE_NUEDI    = '' ;                                    03948   
           CTR_LIG_DEMA       = 0  ;                                    03949   
           CTR_LEC_DEMA       = 0  ;                                    03950   
           SVG_MTEMB_HT       = 0  ;                                    03951   
           SVG_MTEMB_TTC      = 0  ;                                    03952   
           MOD_DEMA           = '' ;                                    03953   
           SVG_RECO1          = '' ;                                    03954   
           SVG_RECO1_D        = '' ;                                    03955   
           SVG_RESAI          = '' ;                                    03956   
           SVG_RESAI_D        = '' ;                                    03957   
           SVG_NORUN          = '' ;                                    03958   
           SVG_NORUN_D        = '' ;                                    03959   
           SVG_LOREC          = '' ;                                    03960   
           SVG_LOREC_D        = '' ;                                    03961   
           SVG_LOREC_P        = '' ;                                    03962   
           SVG_LOREC_PD       = '' ;                                    03963   
           SVG_REPIE          = '' ;                                    03964   
           SVG_REPIE_D        = '' ;                                    03965   
           SVG_DEMAT_COTAX    = '' ;                                    03966   
           SVG_W_NUFAOC       = '' ;                                    03967   
           SVG_W_NUBLOC       = '' ;                                    03968   
           SVG_RFDIS          = '' ;                                    03969   
           DEMAT_QTTOT        = 0  ;                                    03970   
           DEMAT_REF_EXIST_DQ = '' ;                                    03971   
           DEMAT_REF_EXIST_ON = '' ;                                    03972   
           DEMAT_REF_EXIST_SS = '' ;                                    03973   
           DEMAT_REF_EXIST_VN = '' ;                                    03974   
           DEMAT_REF_EXIST_04G = '' ;                                   03975   
           WK_RECHE_FIRENT    = 'N';                                    03976   
           WS_FIR_RECOM       = '' ;                                    03977   
           PCFLI_ECRIT        = 'O';                                    03978   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                03979   
           STO_D_QTTOT        = 0 ;                                     03980   
           CTR_LIG_STOD       = 0  ;                                    03981   
           CTR_ENSEQ_D        = 0  ;                                    03982   
           STO_D_REF_EXIST_DQ = '' ;                                    03983   
           STO_D_REF_EXIST_ON = '' ;                                    03984   
           STO_D_REF_EXIST_SS = '' ;                                    03985   
           STO_D_REF_EXIST_VN = '' ;                                    03986   
           STO_D_REF_EXIST_04G = '' ;                                   03987   
           STO_P_GEN_AS       = '' ;                                    03988   
           STO_P_WOR_AS       = '' ;                                    03989   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                03990   
           IF TOP_DEMA_CLI = 'O' THEN DO;                               03991   
              CALL INIT_DEMA;                                           03992   
              END;                      ELSE DO;                        03993   
              TOP_DEMA_FAC    = '' ;                                    03994   
              TOP_DEMA_ECR    = '' ;                                    03995   
              TOP_EDI         = '' ;                                    03996   
              END;                                                      03997   
0          BL_INFO            = '' ;    /*   TABLEAU POUR RECAP BL    */03998   
                                                                        03999   
           IF TOP_DEMA_CLI = 'N' THEN DO;                               04000   
              TOP_DEMA_FAC = 'N'        ;                               04001   
              GOTO A030D1 ;                                             04002   
              END;                                                      04003   
                                                                        04004   
           TOP_DEMA_FAC = 'O' ;                                         04005   
                                                                        04006   
           IF ENTET70.DAT10.AA > '80'                                   04007   
              THEN  DFDTF.AAAA = '19'!!ENTET70.DAT10.AA;                04008   
              ELSE  DFDTF.AAAA = '20'!!ENTET70.DAT10.AA;                04009   
           DFDTF.MM         = ENTET70.DAT10.MM;                         04010   
           DFDTF.JJ         = ENTET70.DAT10.JJ;                         04011   
                                                                        04012   
           IF STRING(DFDTF) > SUBSTR(TCDLFDEM.DAFINDEM,5,4) !!          04013   
                              SUBSTR(TCDLFDEM.DAFINDEM,3,2) !!          04014   
                              SUBSTR(TCDLFDEM.DAFINDEM,1,2)             04015   
            ! STRING(DFDTF) < SUBSTR(TCDLFDEM.DADEBDEM,5,4) !!          04016   
                              SUBSTR(TCDLFDEM.DADEBDEM,3,2) !!          04017   
                              SUBSTR(TCDLFDEM.DADEBDEM,1,2)             04018   
              THEN DO                              ;                    04019   
                TOP_DEMA_FAC  = 'N'                ;                    04020   
                GOTO A030D1                        ;                    04021   
           END                                     ;                    04022   
           IF WTFAC.COGAN = '17' THEN DO;                               04023   
              IF TCDLFDEM.FRFIN = 'N' ! TCDLFDEM.FRFIN = ' '            04024   
                 THEN TOP_DEMA_FAC  = 'N';                              04025   
              MOD_DEMA              = TCDLFDEM.FRFIN ;                  04026   
              GOTO A030D1;                                              04027   
           END;                                                         04028   
                                                                        04029   
           CLE5           = WTFAC.GNATO !! WTFAC.TRACO !! '  ';         04030   
           CALL ID470B(TBLIFAC.NUTAB);                                  04031   
           DF_TYPFA       = WTYPFA;                                     04032   
           SELECT ( DF_TYPFA ) ;                                        04033   
              WHEN ('ALL') DO;                                          04034   
                 IF TCDLFDEM.FALLE = 'N' ! TCDLFDEM.FALLE = ' '         04035   
                    THEN TOP_DEMA_FAC = 'N';                            04036   
                 MOD_DEMA             = TCDLFDEM.FALLE ;                04037   
                 END;                                                   04038   
              WHEN ('RET') DO;                                          04039   
                 IF TCDLFDEM.FRETO = 'N' ! TCDLFDEM.FRETO = ' '         04040   
                    THEN TOP_DEMA_FAC = 'N';                            04041   
                 MOD_DEMA             = TCDLFDEM.FRETO ;                04042   
                 END;                                                   04043   
              WHEN ('REC') DO;                                          04044   
                 IF TCDLFDEM.FRECT = 'N' ! TCDLFDEM.FRECT = ' '         04045   
                    THEN TOP_DEMA_FAC = 'N';                            04046   
                 MOD_DEMA             = TCDLFDEM.FRECT ;                04047   
                 END;                                                   04048   
              OTHERWISE    DO;                                          04049   
                 END;                                                   04050   
              END;                                                      04051   
       A030D1:                                                          04052   
           IF WTFAC.EDIPA = '9' THEN DO; /*   EDIPA=9 PAS DE DEMAT    */04053   
              TOP_DEMA_FAC    = 'N' ;                                   04054   
              TOP_DEMA_ECR    = 'N' ;                                   04055   
              TOP_EDI         = 'N' ;                                   04056   
              END;                                                      04057   
0             /*===============================================*/       04058   
              /*  AJOUT YFB LECTURE ENTETES FIR POUR RECUP DOC */       04059   
              /*  ORIGINE (FACTURE, BL, COMMANDE) SI REFLI EN  */       04060   
              /*  ENTREE = * + NUPAC ET EN FONCTION DES NATOP  */       04061   
              /*===============================================*/       04062   
              W_REFLI        = WTFAC.REFLI;                             04063   
              SVG_REFLI      = WTFAC.REFLI;                             04064   
              W_NATOP        = WTFAC.NATOP;                             04065   
              W_NATOP_FIR    = '  ';                                    04066   
              SVG_LIGNE_FIR  = ' ';                                     04067   
              CALL GESTION_FIR;                                         04068   
              SVG_LIGNE_FIR  = LIGNE;                                   04069   
                                                                        04070   
 /*************************/                                            04071   
 /* FIN AJOUT LE 04 11 92 */                                            04072   
 /*************************/                                            04073   
   /*  A030D1:  */                      /* FIN SELECT FACT DEMAT      */04074   
0                                       /******************************/04075   
                                        /* AJOUT 22 10 02 YDU/YHM PCF */04076   
           IF PCF_CLIENT = 'O'          /******************************/04077   
           THEN DO ;                                                    04078   
                                        /******************************/04079   
                                        /* RECH. TABLE CDLPCFDU       */04080   
                                        /* FACTURE PCF ?              */04081   
                                        /******************************/04082   
              SPIPA       = '';                                         04083   
              SPIPA.FONCT = 'RP';                                       04084   
              SPIPA.COTAB = 'CDLPCFDU';                                 04085   
              SPIPA.OPERA = '=';                                        04086   
              SPIPA.REFPO = 'GNATO' !! WTFAC.GNATO ;                    04087   
              CALL SPI2TBV (SPIPA,CDLPCFDU,SPIFI);                      04088   
              IF SPIPA.CORET = '00'                                     04089   
              THEN PCF_FACTUR = 'O' ;                                   04090   
              ELSE PCF_FACTUR = 'N' ;                                   04091   
           END ;                                                        04092   
           ELSE PCF_FACTUR = 'N' ;                                      04093   
                                                                        04094   
0          WRESL.DEMAA        = ENTET70.DAT10.AA;                       04095   
           WRESL.DEMMM        = ENTET70.DAT10.MM;                       04096   
           WRESL.DEMJJ        = ENTET70.DAT10.JJ;                       04097   
           WRESP.DEMAA        = ENTET70.DAT10.AA;                       04098   
           WRESP.DEMMM        = ENTET70.DAT10.MM;                       04099   
           WRESP.DEMJJ        = ENTET70.DAT10.JJ;                       04100   
        /*-------------------------------------------------------*/     04101   
           IF ACCORD_OUI_NON = 'OUI' THEN DO;                           04102   
             TBL_ACCORD1(*) = ''; /* RAZ VARIABLES ACCORD */            04103   
             WS_ACC =  '';                                              04104   
             FHACC   = '';         /*   INIT. HISTORIQUE ACCORD  */     04105   
             FHACC.NUCLI = WTCLI1.NUCLI;                                04106   
             FHACC.SYPRO = WTCLI1.SYPRO;                                04107   
             FHACC.AFFIL = WTCLI1.AFFIL;                                04108   
             IF ENTET70.DAT10.AA > '80' THEN                            04109   
                FHACC.DAFAC.AAAA = '19'!!ENTET70.DAT10.AA;              04110   
             ELSE                                                       04111   
                FHACC.DAFAC.AAAA = '20'!!ENTET70.DAT10.AA;              04112   
             FHACC.DAFAC.MM = ENTET70.DAT10.MM;                         04113   
             FHACC.DAFAC.JJ = ENTET70.DAT10.JJ;                         04114   
           END;                                                         04115   
0                                        /*  01.07.89 FACTURE COMPTANT*/04116   
           EDIT_FACTU         = 'O' ;    /*  EDITION FACTURE PAPIER   */04117   
        /*-------------------------------------------------------*/     04118   
        /* COMPLEMENT DU 17.11.93 ET RAJOUT POUR NON EDITION     */     04119   
        /* DES FACTURES CRDL                     (MODIF JNM)     */     04120   
        /*-------------------------------------------------------*/     04121   
           IF WTFAC.GS.NATOP = '21' !    /*  FACTURE AU COMPTANT      */04122   
                                         /*  REFLI = FIR ='$123456789'*/04123   
                                         /*          OU  ='*123456789'*/04124   
                                         /*          OU  ='+123456789'*/04125   
                                         /*          OU  ='-123456789'*/04126   
                                         /* .ORPRO=5   GFR    ==>EDITI*/04127   
                                         /* .REFLI=FIR RECLAM.==>EDITI*/04128   
                                         /* .ORPRO^= 5 ET REFLI ^= FIR*/04129   
                                         /*  ==> NON EDITI. FACTU. PAP*/04130   
              WTFAC.GS.NATOP = '22' !                                   04131   
             (WTFAC.GS.GNATO = '0F' & WTFAC.GS.TRACO ='3') THEN DO;     04132   
              IF WTFAC.GS.ORPRO ^= '5' &                                04133   
                 ^( VERIFY(SUBSTR(WTFAC.GS.REFLI,1,1),'$*+-')  = 0 &    04134   
                    VERIFY(SUBSTR(WTFAC.GS.REFLI,2,9),NUMERIC) = 0 )    04135   
                 THEN         EDIT_FACTU = 'N' ;                        04136   
              END;                                                      04137   
0          FACTBIS            = FACTINIT;/*  RAZ VARIABLES NIVEAU FACT*/04138   
           POIDS_GIH,FRAIS    = 0;                                      04139   
           FRAIS_HT           = 0;                                      04140   
           FACT2              = '';                                     04141   
           RFA                = '';                                     04142   
           FACT.EXEMP         = 1;      /*   INIT. ENTETE FACTURE     */04143   
           WNUFAC             = WNUFAC + 1;                             04144   
           ENTET70.REFFA      = WNUFAC;                                 04145   
           WNUFAC_5           = WNUFAC;                                 04146   
           ENTET70.FIL9       = ' '   ;                                 04147   
           ENTET70.FIL40      = ' '   ;                                 04148   
           ENTET70.FOLIO      = 0     ;                                 04149   
           WRESL.NUFAC        = ENTET70.REFFA ;                         04150   
           WRESP.NUFAC        = ENTET70.REFFA ;                         04151   
           PASTK.CODGT        = 'D';    /*   INIT. FICH. FACT. MULTI. */04152   
                                        /*   INIT. JOURNAL FACTUR.    */04153   
           WJOUR.GS.NUFAC     = ENTET70.REFFA ;                         04154   
           WJOUR.ID.NUFAC     = ENTET70.REFFA ;                         04155   
           WJOUF.ID.NUFAC     = ENTET70.REFFA ;                         04156   
           WJOUF.GS.NUFAC     = ENTET70.REFFA ;                         04157   
                                        /*   INIT. CUMUL NOMENCLATURE */04158   
           NOM_EC (0)          = '0';                                   04159   
           NOM_EC (1)          = '1';                                   04160   
           NOM_EC (2)          = '2';                                   04161   
           NOM_EC (3)          = '3';                                   04162   
           NOM_EC (4)          = '4';                                   04163   
           NOM_EC (5)          = '5';                                   04164   
           NOM_EC (6)          = '6';                                   04165   
           NOM_EC (7)          = '7';                                   04166   
           NOM_EC (8)          = '8';                                   04167   
           NOM_EC (9)          = '9';                                   04168   
           NOM_POI(*)          = '' ;                                   04169   
                                                                        04170   
           /*-- ------------------------------ --------- --*/           04171   
           /*-- -SMARTIN 31/12/2004 FACT DEMAT --------- --*/           04172   
           /*-- ------------------------------ --------- --*/           04173   
           IF TOP_DEMA_FAC = 'O'                                        04174   
             THEN DO ;                                                  04175   
              CALL INIT_ENREG_ENT                     ;                 04176   
              CALL INIT_ENREG_COM                     ;                 04177   
              CALL INIT_ENREG_COMPMD                  ;                 04178   
              CALL INIT_ENREG_LOGCOM                  ;                 04179   
                                                                        04180   
              CALL INIT_ENREG_ECH                     ;                 04181   
              CALL INIT_ENREG_REF                     ;                 04182   
              CALL INIT_ENREG_ADR                     ;                 04183   
          /*  CALL INIT_ENREG_NBL                     */                04184   
              CALL INIT_ENREG_LIG                     ;                 04185   
              CALL INIT_ENREG_LEC                     ;                 04186   
              CALL INIT_ENREG_PIE                     ;                 04187   
           END ;                                                        04188   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                04189   
           CALL INIT_STO_D_ENT                     ;                    04190   
           CALL INIT_STO_D_COM                     ;                    04191   
           CALL INIT_STO_D_COMPMD                  ;                    04192   
           CALL INIT_STO_D_ECH                     ;                    04193   
           CALL INIT_STO_D_REF                     ;                    04194   
           CALL INIT_STO_D_ADR                     ;                    04195   
           CALL INIT_STO_D_LIG                     ;                    04196   
           CALL INIT_STO_D_LEC                     ;                    04197   
           CALL INIT_STO_D_PIE                     ;                    04198   
  /* SAUVEGARDE DES VALEURS DE SYSTEME DE PROSPECTION ET AFFILIATION */ 04199   
  /* POUR LE STOCKAGE DES FACTURES PAPIER                            */ 04200   
       STO_P_SYPRO      = WTCLI1.SYPRO                 ;                04201   
       STO_P_AFFIL      = WTCLI1.AFFIL                 ;                04202   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                04203   
           /*-- ------------------------------ --------- --*/           04204   
           IF WTFAC.EDIPA     = '9' THEN GO TO A040D;                   04205   
           IF WTFAC.EDIPA     = '2' THEN DO;                            04206   
                    FACT.FOLIO=  -1 ;   /*YDV E0299*/                   04207   
                    CLE3                = WTFAC.STRET !! WTFAC.SPENV;   04208   
                    CALL ID470B(TBTRANS.NUTAB);                         04209   
                    WTFAC.STRET         = WTRANS;                       04210   
                    MACFA.NBGIH         = MACFA.NBGIH + 1;              04211   
                    ENTET7.NUFAC        = WNUFAC;                       04212   
                    ENTET2.MOTRA        = ' ';                          04213   
                    ENTET7.ENVEL        = ' ';                          04214   
                    CALL ANTICIP;       /*   ANTICIPATION ECHEANCE    */04215   
                    FACT.ECHGIH         = ECHEANUM;                     04216   
                    FACT.ECHEAMAX       = FACT.ECHGIH;                  04217   
                    IF WTFAC.PEFAC = '9' THEN DO;                       04218   
                                        /*   FACTURE OUVERTE GIH      */04219   
                       ENTET70.FIL5     = ' ';                          04220   
                       ENTET65.DAT13.FIL05  = '.';                      04221   
                       ENTET65.DAT13.FIL06  = '.';                      04222   
                       ENTET65.DAT13.AA = WRESL.DEMAA;                  04223   
                       ENTET65.DAT13.MM = WRESL.DEMMM;                  04224   
                       ENTET65.DAT13.JJ = WRESL.DEMJJ;                  04225   
                       ENTET65.RUN      = WRESL.RUNFA;                  04226   
                       ENTET70.NORUN    = ' ';                          04227   
                       REFFARED         = ' ';                          04228   
                       ENTET65.STRET    = ' ';                          04229   
                       ENTET70.DAT10.JJ = ' ';                          04230   
                       ENTET70.DAT10.MM = ' ';                          04231   
                       ENTET70.DAT10.AA = ' ';                          04232   
                       ENTET70.FIL7     = ' ';                          04233   
                       ENTET70.FIL8     = ' ';                          04234   
                       END;             ELSE DO;                        04235   
                       IF WTFAC.PEFAC   = '0' THEN DO;                  04236   
                          IF WTFAC.ORPRO = '1' ! WTFAC.ORPRO = '2'      04237   
                             THEN DO;                                   04238   
                             ENTET2.MOTRA    = WTFAC.MOTRA ;            04239   
                             END;                                       04240   
                          END;                                          04241   
                       ENTET70.FIL5     = '.';                          04242   
                       ENTET70.NORUN    = WRESL.RUNFA;                  04243   
                       ENTET70.REFFA    = WNUFAC;                       04244   
                       WNUFAC_5         = WNUFAC;                       04245   
                       ENTET70.DAT10.JJ = WRESL.DEMJJ;                  04246   
                       ENTET70.DAT10.MM = WRESL.DEMMM;                  04247   
                       ENTET70.DAT10.AA = WRESL.DEMAA;                  04248   
                       ENTET70.DAT10.FIL7  = '.';                       04249   
                       ENTET70.DAT10.FIL8  = '.';                       04250   
                       ENTET65.DAT13.JJ    = ' ';                       04251   
                       ENTET65.DAT13.MM    = ' ';                       04252   
                       ENTET65.DAT13.AA    = ' ';                       04253   
                       ENTET65.DAT13.FIL05 = ' ';                       04254   
                       ENTET65.DAT13.FIL06 = ' ';                       04255   
                       ENTET65.RUN      = ' ';                          04256   
                       ENTET65.STRET    = WTFAC.STRET;                  04257   
                       END;             /*   FIN  TEST  PEFAC 9       */04258   
                    CLE1                = WTFAC.ECFAC;                  04259   
                    CALL ID470B(TBECFAC.NUTAB);                         04260   
                    ENTET7_1.LECFA      = WLECFA;                       04261   
                    ENTET65.SCLICO      = ' ';                          04262   
0                                       /*   TEST FACTU. AVOIR CREDIT */04263   
                    IF WTFAC.GNATO = '31' THEN DO;                      04264   
                       ENTET65.VENET    = '2' !! WTFAC.ECFAC;           04265   
                       GO TO A030B;                                     04266   
                       END;             /*   FIN TEST GNATO 31        */04267   
                    IF WTFAC.GNATO = '1C' ! WTFAC.GNATO = '22' !        04268   
                       WTFAC.GNATO = '33' ! WTFAC.GNATO = '3R' THEN DO; 04269   
                       ENTET65.VENET    = '1' !! WTFAC.ECFAC;           04270   
                       GO TO A030B;                                     04271   
                       END;             /*   FIN TEST GNATO 1C 3R 33  */04272   
              /*    ENTET65.VENET       = '0' !! WTFAC.ECFAC  YDV 0299*/04273   
                    ENTET65.VENET       = '  ';       /*YCV   YDV 0299*/04274   
                    GO TO A030B;                                        04275   
                    END;                 ELSE DO;                       04276   
0                                       /*   CAS FRANCE               */04277   
                                        /******************************/04278   
0                   IF VERIFY(WTCLI1.OUFER,'0125') ^= 0 THEN DO;        04279   
                       ENT10.FERME      = '      FERME ';               04280   
                       ENT10.OUFER      = WTCLI1.OUFER;                 04281   
                       END;             /*   FIN  TEST  OUFER DIFF 0  */04282   
                    IF WTFACRED.AUTOM = 'A'                             04283   
                       THEN   UN_M = 10;/*   MISE SOUS PLI AUTOMATIQUE*/04284   
                       ELSE   UN_M = 30;/*   MISE SOUS PLI MANUELLE   */04285   
0                                       /*   COLIS EN SOUFFRANCE      */04286   
                    /* �4 DISPACTCH AVOIRS)       */                    04287   
                    IF SUBSTR(WTFAC.RECO1,1,1) = '1' &                  04288   
                          (WTFAC.SYPRO = '20' ! WTFAC.SYPRO = '21') &   04289   
                           WTFAC.NATOP  = '31' THEN DO;                 04290   
                       UN_M = 30 ;      /*   FORCAGE SPOOL MANUEL     */04291   
                       END;                                             04292   
                                               /* CAS FACT HMD SPOOL 7*/04293   
                    /* XNUFAC3      = XNUFAC3 + 1                       04294   
                       ENTET7.NUFAC = XNUFAC3                           04295   
                       WNBFEA       = WNBFEA  + 1                       04296   
                       ENTET7.ENVEL = 'A'                               04297   
                    */                                                  04298   
                    IF UN_M= 10 THEN DO;/* CAS FACTURES CDL           */04299   
                       IF ^(WTFAC.GS.TRACO = '2' & WTFAC.GS.DEPCO = '16'04300   
                           )            /*   20.11.84                 */04301   
                          & EDIT_FACTU = 'O' THEN DO;                   04302   
                          XNUFAC1       = XNUFAC1 + 1;                  04303   
                          MACFA.NBCDL   = MACFA.NBCDL + 1;              04304   
                          ENTET7.NUFAC  = XNUFAC1;                      04305   
                                        /*   MASSICOT AUTOMATIQUE     */04306   
                          ENTET7.ENVEL  = 'A';                          04307   
                          END;                                          04308   
                       END;   ELSE DO;  /*   CAS FACTURES CRDL        */04309   
                       IF ^(WTFAC.GS.TRACO = '2' & WTFAC.GS.DEPCO = '16'04310   
                           )            /*   20.11.84                 */04311   
                          & EDIT_FACTU = 'O' THEN DO;                   04312   
                          MACFA.NBCRD   = MACFA.NBCRD + 1;              04313   
                          XNUFAC2       = XNUFAC2 + 1;                  04314   
                          ENTET7.NUFAC  = XNUFAC2;                      04315   
                                        /*   MASSICOT MANUELLE        */04316   
                          ENTET7.ENVEL  = 'M';                          04317   
                          END;                                          04318   
                       END;             /*   FIN CAS FACTURES CDL     */04319   
                    END;                /*   FIN TEST EDIPA 2         */04320   
           ENTET7_1.LECFA     = ' ';                                    04321   
           IF WTCLI1.CLICO    = ' ' THEN DO;                            04322   
                    ENTET65.SCLICO      = ' ';                          04323   
                    END;                ELSE DO;                        04324   
                    ZCLICO              = CLICONUM;                     04325   
                    ENTET65.SCLICO      = WCOMPTA;                      04326   
                    END;                /*   FIN  TEST  CLICO BLANC   */04327   
           ENTET13            = '';                                     04328   
           ENTET13.POLIC      = '00'X;                                  04329   
           ENTET65.COMPTA,ENTET65.VENET,ENTET65.STRET,ENTET65.RUN = '' ;04330   
           ENTET65.DAT13      = '';                                     04331   
0      A030B:                                                           04332   
0                                       /*   INIT. MICROFICHES        */04333   
           ENTET1.EDIPA       = WTFAC.EDIPA;                            04334   
           ENTET1.TRACO       = WTFAC.TRACO;                            04335   
           ENTET1.GNATO       = WTFAC.GNATO;                            04336   
           ENTET1.FIL9        = '/';                                    04337   
           ENTET1.POREC       = WTMIC.POREC;                            04338   
           WTMIC.GNATO        = WTFAC.GNATO;                            04339   
           WTMIC.NUFAC        = WNUFAC;                                 04340   
           WTMIC.NULIG        = 0;                                      04341   
           WS_NULIG           = 0;                                      04342   
                                                                        04343   
           /*�3 ACCES SERONT FAIT, N01  AVEC GNATO TRACO NATOP          04344   
                 ET SI NON TROUVE N02  AVEC GNATO TRACO & NATOP=BLANC*/ 04345   
                                                                        04346   
0          CLE5           = WTFAC.GNATO !! WTFAC.TRACO !! WTFAC.NATOP;  04347   
           CALL ID470B(TBLIFAC.NUTAB);  /*   RECH. LIBEL TRACO GNATO  */04348   
           FACT.LIDOC         = WLIDOC;                                 04349   
           FACT.LGNAT         = WLGNAT;                                 04350   
0          IF WTFAC.COGAN  = '17' THEN DO;                              04351   
              FINAN_FRAIS  = 'O' ;      /*   MODIF. ENTETE FACTURE    */04352   
              SELECT (WTFAC.NATOP) ;                                    04353   
                 WHEN ('12') FACT.LGNAT = 'RECTIF.S/ FRAIS FIN.';       04354   
                 WHEN ('14') FACT.LGNAT = 'FRAIS FINANCIERS    ';       04355   
                 OTHERWISE   DO ;                                       04356   
                    ZONCTL              = 'FRAIS FINANCIER NATOP DIF' !!04357   
                                          'F. 12,14 =' !! WTFAC.NATOP ; 04358   
                    CALL MACMES3   (DESTI,'1',ZONCTL);                  04359   
                    END;                                                04360   
              END;                                                      04361   
             END;                      /*   FIN FRAIS FINANCIER      */ 04362   
0          IF WTFAC.COGAN  = '23' ! WTFAC.COGAN = '24' THEN DO;         04363   
              RFA_ENTETE   = 'O' ;      /*   MODIF. ENTETE FACTURE    */04364   
              SELECT (WTFAC.NATOP) ;                                    04365   
                 WHEN ('12') FACT.LGNAT = 'SURREMISE           ';       04366   
                 WHEN ('14') FACT.LGNAT = 'RECTIF. SURREMISE   ';       04367   
                 OTHERWISE   DO ;                                       04368   
                    ZONCTL              = 'REMISE FIN ANNEE NATOP DI' !!04369   
                                          'FF.12,14 =' !! WTFAC.NATOP ; 04370   
                    CALL MACMES3   (DESTI,'1',ZONCTL);                  04371   
                    END;                                                04372   
                 END;                                                   04373   
              END;                      /*   FIN RFA                  */04374   
1                                       /*   GESTION NBFAC            */04375   
0                                       /*   DETERMIN. SI FACT. MULT. */04376   
           IF WTCLIB = ' '                                              04377   
              THEN WTCLI2.NBFAC = 0 ;                                   04378   
           FACT.NFACTU          = WTFAC.NBFAC;                          04379   
0          IF FACT.NFACTU = ' ' ! FACT.NFACTU = HIGH(1) !               04380   
              FACT.NFACTU = LOW(1) THEN DO;                             04381   
                                        /*   NBFAC NON IMPOSEE EN ENTR*/04382   
              IF WTCLI1.CLIFA   = ' ' ! WTCLI1.CLIFA = '000000' THEN DO;04383   
                                        /*   CLIFA N EXISTE PAS       */04384   
                 NFACTNUM               = WTCLI1.NBFAC;                 04385   
                 IF NFACTNUM = 0 THEN DO;                               04386   
                                        /*   AU MOINS 1 FACTURE EDITEE*/04387   
                                        /*   EDITION    .....   NUCLI */04388   
                    NFACTNUM            = 1 ;                           04389   
                    WTCLI1.NBFAC        = 1 ;                           04390   
                    END;                                                04391   
                 END;                   ELSE DO;                        04392   
                                        /*   CLIFA EXISTE             */04393   
                 NFACTNUM               = WTCLI2.NBFAC;                 04394   
                 IF NFACTNUM = 0 THEN DO;                               04395   
                                        /*   PAS EDITI. NUCLI   CLIFA */04396   
                    NFACTNUM            = WTCLI1.NBFAC;                 04397   
                    IF NFACTNUM = 0 THEN DO;                            04398   
                                        /*   AU MOINS 1 FACTURE EDITEE*/04399   
                       NFACTNUM         = 1 ;                           04400   
                       WTCLI1.NBFAC     = 1 ;                           04401   
                       END;                                             04402   
                                        /*   EDITION    CLIFA   NUCLI */04403   
                                        /*   INVERSION  ADRESSE       */04404   
                                        /*   RAISON SOCIALE           */04405   
                    SVG_ADRESSE         = WENTET8.RASOC1;               04406   
                    WENTET8.RASOC1      = WENTET8.RASOC2;               04407   
                    WENTET8.RASOC2      = SUBSTR(SVG_ADRESSE,1,26);     04408   
                                        /*   NOM CLIENT               */04409   
                    SVG_ADRESSE         = WENTET9.NOCLI1;               04410   
                    WENTET9.NOCLI1      = WENTET9.NOCLI2;               04411   
                    WENTET9.NOCLI2      = SUBSTR(SVG_ADRESSE,1,15);     04412   
                                        /*   ADRESSE                  */04413   
                    SVG_ADRESSE         = WENTET10.ADCLI1;              04414   
                    WENTET10.ADCLI1     = WENTET10.ADCLI2;              04415   
                    WENTET10.ADCLI2     = SUBSTR(SVG_ADRESSE,1,26);     04416   
                                        /*   LOCALITE                 */04417   
                    SVG_ADRESSE         = WENTET11.LORES1;              04418   
                    WENTET11.LORES1     = WENTET11.LORES2;              04419   
                    WENTET11.LORES2     = SUBSTR(SVG_ADRESSE,1,15);     04420   
                                        /*   CODE POSTAL              */04421   
                    SVG_ADRESSE         = WENTET12.CPCLI1;              04422   
                    WENTET12.CPCLI1     = WENTET12.CPCLI2;              04423   
                    WENTET12.CPCLI2     = SUBSTR(SVG_ADRESSE,1,5);      04424   
                    SVG_ADRESSE         = WENTET12.LOBDI1;              04425   
                    WENTET12.LOBDI1     = WENTET12.LOBDI2;              04426   
                    WENTET12.LOBDI2     = SUBSTR(SVG_ADRESSE,1,26);     04427   
                                        /*   PAYS                     */04428   
                    SVG_ADRESSE         = WENTET13.PAYCL1;              04429   
                    WENTET13.PAYCL1     = WENTET13.PAYCL2;              04430   
                    WENTET13.PAYCL2     = SUBSTR(SVG_ADRESSE,1,26);     04431   
                    END;                                                04432   
                 END;                                                   04433   
              END;                      ELSE DO;                        04434   
                                        /*   NBFAC IMPOSEE EN ENTREE  */04435   
                                        /*   ET EST DIFFERENT 0       */04436   
              END;                                                      04437   
0          IF  WTFAC.TRACO = '0'  & WTFAC.DEPCO = '17' &                04438   
              (WTFAC.GNATO = '31' ! WTFAC.GNATO = '32' !                04439   
               WTFAC.GNATO = '33' ! WTFAC.GNATO = '3R' ) THEN DO;       04440   
                    IF WTFAC.NATOP = '31' & FACT.NFACTU > '3'           04441   
                       THEN DO;                                         04442   
                       FACT.NFACTU = '3' ;                              04443   
                       END;             ELSE DO;                        04444   
                       IF FACT.NFACTU > '2'                             04445   
                          THEN FACT.NFACTU = '2' ;                      04446   
                       END;                                             04447   
                    END;                /*   RETOUR RECT. GIH 30.09.87*/04448   
0          FACT.RETOUR    = '0' ;                                       04449   
           IF WTFAC.FACSP = '2'         /*   AUTORISATION DE RETOUR   */04450   
                    THEN FACT.RETOUR = '1';                             04451   
0          IF  FACT.RETOUR = '1' ! FACT.NFACTU > '1' !                  04452   
               WTFAC.EDIPA = '2' !                                      04453   
              (WTFAC.TRACO = '0' & WTFAC.DEPCO = '17' )                 04454   
                    THEN FACT.MULFAC = '1';                             04455   
             /*     ELSE FACT.MULFAC = '0'   FORCAGE CLIFA NUCLI      */04456   
           FACT.MULFAC    = '1';                                        04457   
1          TAB.LIBEL      = ' ' ;       /*   GNATO = CREDIT DEBIT     */04458   
           TAB.COEFF      = 1;          /*   LIBELLE MT TOTAL FACTURE */04459   
0          DO I = 1 TO 20;              /*   RECHERCHE DU GNATO       */04460   
              IF TAB.GNATO(I) = WTFAC.GNATO THEN DO;                    04461   
                    TAB.LIBEL           = TAB.LIDEB(I);                 04462   
                    GO TO A030C;                                        04463   
                    END;                /*   FIN  TEST  GNATO         */04464   
              END;                      /*   FIN  BOUCLE  DO          */04465   
           WANOL.TBANO(1) = '2372';     /*   GNATO INCONNU            */04466   
           WANOE.TBANO(1) = '2372';                                     04467   
           WANOL.LIMPO    = '***** GNATO ' !! WTFAC.GNATO !!            04468   
                            ' INCONNU DANS TABLE   FACT. ' !! WNUFAC;   04469   
           CALL ID470D;                 /*   ANOMALIE UTILISATEUR     */04470   
           WANOT.NUANO    = WANOT.NUANO + 1;                            04471   
           WANOT.NOFIC    = 'TGNAT';    /*   ANOMALIE TECHNIQUE       */04472   
           WANOT.ENREG    = ENRWFAC;                                    04473   
           WANOT.LIANO    = '***** GNATO ' !! WTFAC.GNATO !!            04474   
                            ' INCONNU DANS TABLE   FACT. ' !! WNUFAC;   04475   
           WRITE FILE (FEDITI) FROM (WANOT);                            04476   
0      A030C:                                                           04477   
           IF WTFAC.TRACO ^= '0'                                        04478   
              THEN  ENTET65.TITRE       = ' XXXXXXX ';                  04479   
              ELSE  ENTET65.TITRE       = ' ';                          04480   
0          IF WTFAC.FRAET = '2' !       /*   30.01.85 AJOUT TBDEPAY   */04481   
              WTFAC.EDIPA = '2' THEN DO;/*   POUR SPOOL7 EXPORT AUTOM */04482   
              CLE4        = WTFAC.FRAET !! WTFAC.DEPAY ;                04483   
              CALL ID470B (TBDEPAY.NUTAB);                              04484   
              END;                      ELSE DO;                        04485   
              WREPRI      = ' ' ;                                       04486   
              WDISAU      = ' ' ;                                       04487   
              END;                                                      04488   
0          IF WTFAC.EDIPA     = '2'     /*   FACTURE EXPORT AUTOMATIQU*/04489   
            & WDISAU         ^= 'O'                                     04490   
            & (WTFAC.NATOP    = '01' ! WTFAC.NATOP = '31')              04491   
            & SUBSTR(ENTET12.LOBDI2,2,25) ^= ' '                        04492   
              THEN DO;                                                  04493   
              FEXPO_AUTO      = 'O';                                    04494   
              UN_M            = 70 ;                                    04495   
              END;                                                      04496   
0          IF UN_M = 20 ! UN_M = 70 THEN DO;                            04497   
              INDEX_FACEXP.NUCLI         = WTFAC.NUCLI;                 04498   
              INDEX_FACEXP.CLIFA         = WTCLI1.CLIFA;                04499   
              INDEX_FACEXP.NUFAC         = ENTET70.REFFA;               04500   
              IF SUBSTR(INDEX_FACEXP.NUFAC,1,1) = ' '                   04501   
                 THEN SUBSTR(INDEX_FACEXP.NUFAC,1,1) = '0';             04502   
              INDEX_FACEXP.NUPAG         = 0 ;                          04503   
              INDEX_FACEXP.EXEMP         = 1 ;                          04504   
              INDEX_FACEXP.NATOP         = WTFAC.NATOP;                 04505   
              INDEX_FACEXP.SYPRO         = WTFAC.SYPRO;                 04506   
              IF SUBSTR(ENTET12.LOBDI2,2,25) = ' '                      04507   
                 THEN INDEX_FACEXP.VILBL = 'O' ;                        04508   
                 ELSE INDEX_FACEXP.VILBL = 'N' ;                        04509   
              INDEX_FACEXP.DISAU         = WDISAU;                      04510   
              END;                       ELSE DO;                       04511   
              INDEX_FACEXP               = ''  ;                        04512   
              END;                                                      04513   
0          INDEX_FACTU     = WTFACRED.CLIFA !! WTFAC.NUCLI !!           04514   
                             ENTET70.REFFA  ;                           04515   
1          /********************************************************  */04516   
           /************ P O R T R A I T ***************************  */04517   
           /********************************************************  */04518   
                                                                        04519   
           ENTET3.RASOC1 , ENTET3.RASOC2     = '' ;                     04520   
           ENTET4.NOCLI1 , ENTET4.NOCLI2     = '' ;                     04521   
           ENTET5.ADCLI1 , ENTET5.ADCLI2     = '' ;                     04522   
           ENTET7.LORES1 , ENTET7.LORES2     = '' ;                     04523   
           ENTET65.CPCLI1 , ENTET65.CPCLI2   = '' ;                     04524   
           ENTET65.LOBDI1 , ENTET65.LOBDI2   = '' ;                     04525   
           ENTET70.PAYCL1 , ENTET70.PAYCL2   = '' ;                     04526   
0          PAG1_POR            = ''     ;                               04527   
           PAG1_POR.V_5A       = '5A'X ;                                04528   
           PAG1_POR.V_01       = '0010'X;                               04529   
           PAG1_POR.V_D3       = 'D3ABCA'X;                             04530   
           PAG1_POR.V_00       = LOW(3) ;                               04531   
0          PAG2_POR            = ''     ;                               04532   
           PAG2_POR.V_5A       = '5A'X ;                                04533   
           PAG2_POR.V_01       = '0016'X;                               04534   
           PAG2_POR.V_D3       = 'D3AFD8'X;                             04535   
           PAG2_POR.V_00       = LOW(3) ;                               04536   
           PAG2_POR.V_NOM      = 'O1A4FR61' ;                           04537   
           PAG2_POR.V_23       = LOW(23)  ;                             04538   
0          SELECT (UN_M)      ;                                         04539   
              WHEN (10,30) DO ;          /*POUR LA FRANCE*/             04540   
                PAG1_POR.V_NOM  = 'FCTF61' ;                            04541   
                PAG2_POR.V_NOM  = 'O1A4FR61' ;                          04542   
                END;                                                    04543   
              WHEN (20,70) DO ;          /*POUR L EXPORT HACHETTE*/     04544   
                PAG1_POR.V_NOM  = 'FCTH91' ;                            04545   
                PAG2_POR.V_NOM  = 'O1A4FH91' ;                          04546   
                END;                                                    04547   
              WHEN (60) DO ;             /*POUR L EXPORT GHI*/          04548   
                PAG1_POR.V_NOM  = 'FCTH91' ;                            04549   
                PAG2_POR.V_NOM  = 'O1A4FH91' ;                          04550   
                END;                                                    04551   
              OTHERWISE   DO;            /*    AUTRES       */          04552   
                PAG1_POR.V_NOM  = 'FCTH91' ;                            04553   
                PAG2_POR.V_NOM  = 'O1A4FH91' ;                          04554   
                END;                                                    04555   
              END;                                                      04556   
                                                                        04557   
                                                                        04558   
0          IF WTFAC.DEPCO = '10' THEN DO ;  /* YDV FRANCE EDDL      */  04559   
                PAG1_POR.V_NOM  = 'A4EDD11' ;                           04560   
                PAG2_POR.V_NOM  = 'A4EDD11' ;                           04561   
           END;                                                         04562   
           IF NUCLI_HMD = 'O' THEN DO;   /*   POUR MULTIMED HMD       */04563   
              PAG1_POR.V_NOM    = 'FCTM31' ;                            04564   
              PAG2_POR.V_NOM    = 'O1A4FR61' ;                          04565   
              END;                                                      04566   
0          W_ENTE_PORT     = 'OUI' ;                                    04567   
0          CALL RECH_CDLPAGGA      ;     /*  TABLE CDLPAGGA PAGE GARDE*/04568   
0          IF WTFAC.TRACO ^= '4'         /*  NON EDIT PAGE DE GARDE   */04569   
            & EDIT_PAGGA   = 'O' THEN DO;                               04570   
              STRING (ZSPOOLP_SVG) = STRING (PAG1_POR) ;                04571   
              CALL ECRITUR_AS ;                                         04572   
              STRING (ZSPOOLP_SVG) = STRING (PAG2_POR) ;                04573   
              CALL ECRITUR_AS ;                                         04574   
              END;                      /*   FIN TEST DIFF TRACO 4    */04575   
           EDIT_FDPAG           = 'N';                                  04576   
0          IF WTFAC.TRACO ^= '4'         /*  NON EDIT PAGE DE GARDE   */04577   
            & EDIT_PAGGA   = 'O' THEN DO;                               04578   
              CALL ENTCDL;              /*   ECRITURE ENTETE FACTURE  */04579   
              ZSPOOLP_SVG = '' ;        /*   ECRITURE 1 LIGNE A BLANC */04580   
              ZSPOOLP_SVG.POLIC   = '00'X;                              04581   
              CALL ECRITUR_AS;                                          04582   
                                        /*   ECRITURE MESSAGE ENTETE  */04583   
                                                                        04584   
              DO I = 1 TO 60 ;                                          04585   
                 IF SUBSTR(TBL_MESSAG1.POLICE(I),1,1) ^= '' THEN DO ;   04586   
                    STRING (ZSPOOLP_SVG) = STRING (TBL_MESSAG1(I));     04587   
                    CALL ECRITUR_AS ;                                   04588   
                    END;                                                04589   
                    ELSE I = 60 ;                                       04590   
                 END;                                                   04591   
              END;                      /*   FIN TEST DIFF TRACO 4    */04592   
           W_ENTE_PORT     = 'NON' ;                                    04593   
0          ENTET9.DELOT    = '  ';      /*   TRAITEMENT PAGE COURANTE */04594   
           ENTET12.DEPAG   = '  ';      /*   ET NON PLUS DEBUT LOT    */04595   
           ENTET7.ENVEL    = ' ' ;                                      04596   
           NBFAC_AS        = FACT.NFACTU;                               04597   
0          IF WTFAC.EDIPA  = '2'        /*   CAS EXEMPLAIRE = 0 GIH   */04598   
            & FACT.FOLIO   = -1                                         04599   
            & EDIT_PAGGA   = 'N'                                        04600   
              THEN FACT.FOLIO           = 0 ;                           04601   
1          /********************************************************  */04602   
           /************ P A Y S A G E   ***************************  */04603   
           /********************************************************  */04604   
    /*     ENTET3.RASOC1  = ENTET8.RASOC1       ;                       04605   
           ENTET3.RASOC2  = ENTET8.RASOC2       ;                       04606   
           ENTET4.NOCLI1  = ENTET9.NOCLI1       ;                       04607   
           ENTET4.NOCLI2  = ENTET9.NOCLI2       ;                       04608   
           ENTET5.ADCLI1  = ENTET10.ADCLI1      ;                       04609   
           ENTET5.ADCLI2  = ENTET10.ADCLI2      ;                       04610   
           ENTET7.LORES1  = ENTET11.LORES1      ;                       04611   
           ENTET7.LORES2  = ENTET11.LORES2      ;                       04612   
           ENTET65.CPCLI1 = ENTET12.CPCLI1      ;                       04613   
           ENTET65.CPCLI2 = ENTET12.CPCLI2      ;                       04614   
           ENTET65.LOBDI1 = ENTET12.LOBDI1      ;                       04615   
           ENTET65.LOBDI2 = ENTET12.LOBDI2      ;                       04616   
           ENTET70.PAYCL1 = ENTET13.PAYCL1      ;                       04617   
           ENTET70.PAYCL2 = ENTET13.PAYCL2      ; */                    04618   
0          PAG1_PAY       = ''     ;                                    04619   
           PAG1_PAY.V_5A  = '5A'X ;                                     04620   
           PAG1_PAY.V_01  = '0010'X;                                    04621   
           PAG1_PAY.V_D3  = 'D3ABCA'X;                                  04622   
           PAG1_PAY.V_00  = LOW(3) ;                                    04623   
           PAG1_PAY.V_NOM = 'FCTF63' ;                                  04624   
0          PAG2_PAY       = ''     ;                                    04625   
           PAG2_PAY.V_5A  = '5A'X ;                                     04626   
           PAG2_PAY.V_01  = '0016'X;                                    04627   
           PAG2_PAY.V_D3  = 'D3AFD8'X;                                  04628   
           PAG2_PAY.V_00  = LOW(3) ;                                    04629   
           PAG2_PAY.V_NOM = 'O1A4FR63' ;                                04630   
           PAG2_PAY.V_23  = LOW(23)  ;                                  04631   
                                            /*YDV P0299*/               04632   
           PAG1_PPG       = PAG1_PAY , BY NAME;                         04633   
           PAG2_PPG       = PAG2_PAY , BY NAME;                         04634   
                                                                        04635   
0          SELECT (UN_M)      ;                                         04636   
              WHEN (10,30) DO ;          /*POUR LA FRANCE*/             04637   
                PAG1_PAY.V_NOM = 'FCTF63' ;                             04638   
                PAG2_PAY.V_NOM = 'O1A4FR63' ;                           04639   
                PAG1_PPG.V_NOM = 'FCTF62' ; /*PLEINE PAGE*/             04640   
                PAG2_PPG.V_NOM = 'O1A4FR62' ;                           04641   
                END;                                                    04642   
              WHEN (20,70) DO ;          /*POUR L EXPORT HACHETTE*/     04643   
                PAG1_PAY.V_NOM = 'FCTH93' ; /* IBAN BIC 25-08-03      */04644   
                PAG2_PAY.V_NOM = 'O1A4FH93' ;                           04645   
                PAG1_PPG.V_NOM = 'FCTH92' ; /*PLEINE PAGE*/             04646   
                PAG2_PPG.V_NOM = 'O1A4FH92' ;                           04647   
                END;                                                    04648   
              WHEN (60) DO ;             /*POUR L EXPORT GHI*/          04649   
                PAG1_PAY.V_NOM = 'FCTH93' ;                             04650   
                PAG2_PAY.V_NOM = 'O1A4FH93' ;                           04651   
                PAG1_PPG.V_NOM = 'FCTH92' ; /*PLEINE PAGE*/             04652   
                PAG2_PPG.V_NOM = 'O1A4FH92' ;                           04653   
                END;                                                    04654   
              OTHERWISE   DO;            /*    AUTRES       */          04655   
                PAG1_PAY.V_NOM = 'FCTF63' ;                             04656   
                PAG2_PAY.V_NOM = 'O1A4FR63' ;                           04657   
                PAG1_PPG.V_NOM = 'FCTF62' ; /*PLEINE PAGE*/             04658   
                PAG2_PPG.V_NOM = 'O1A4FR62' ;                           04659   
                END;                                                    04660   
              END;                                                      04661   
                                                                        04662   
0          IF WTFAC.DEPCO = '10' THEN DO ;  /* YDV FRANCE EDDL      */  04663   
                PAG1_PAY.V_NOM  = 'A4EDD13' ;                           04664   
                PAG2_PAY.V_NOM  = 'A4EDD13' ;                           04665   
                PAG1_PPG.V_NOM  = 'A4EDD12' ; /*PLEINE PAGE*/           04666   
                PAG2_PPG.V_NOM  = 'A4EDD12' ;                           04667   
           END;                                                         04668   
           IF NUCLI_HMD = 'O' THEN DO;   /*   POUR MULTIMED HMD       */04669   
              PAG1_PAY.V_NOM    = 'FCTM33' ;                            04670   
              PAG2_PAY.V_NOM    = 'O1A4FR63' ;                          04671   
              PAG1_PPG.V_NOM    = 'FCTM32' ; /*PLEINE PAGE*/            04672   
              PAG2_PPG.V_NOM    = 'O1A4FR62' ;                          04673   
              END;                                                      04674   
           EDIT_FDPAG           = 'O';                                  04675   
           IF TOP_DEMA_FAC = 'O' THEN DO;                               04676   
              CALL INIT_ENREG_LIG ;                                     04677   
              END;                                                      04678   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                04679   
           CALL INIT_STO_D_LIG ;                                        04680   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                04681   
           IF EDIT_LIG_FIR = 'O' THEN DO;                               04682   
              STRING(ZSPOOLP_SVG) = LIGNE ;                             04683   
              CALL ECRITUR;                                             04684   
              FACT.LIGNE          = FACT.LIGNE + 1;                     04685   
              END;                                                      04686   
                                                                        04687   
1                                       /*******************************04688   
                                        *    MODULE INITIAL TRIFA      *04689   
                                        *******************************/04690   
       A040D:                                                           04691   
0          TRIFA          = '';                                         04692   
1                                       /*******************************04693   
                                        *    MODULE INITIAL DAMIS LOREC*04694   
                                        *******************************/04695   
                                                                        04696   
       A050D:                                                           04697   
           LOREC          = '';         /*   RAZ  VARIABLES NIV. LOREC*/04698   
           SVG_OPERA      = '';         /*   RAZ  REFERENCE DEMAT     */04699   
           SVG_OPERA_D    = '';         /*   RAZ  REFERENCE DEMAT     */04700   
           DO I_BL_NUBOR  = 0 TO 999 ;  /*   RAZ  RECAP POUR BL       */04701   
              BL_NUBOR(I_BL_NUBOR) = '';                                04702   
              END;                                                      04703   
0          IF WTFAC.EDIPA = '9' !                                       04704   
              WTFAC.TRIFA = '4' THEN GO TO A060D;                       04705   
           IF SVG_REFLI ^= WTFAC.REFLI THEN DO;                         04706   
                                        /*   AFFICHAGE INFO FIR ?     */04707   
              SVG_REFLI    = WTFAC.REFLI;                               04708   
              W_REFLI      = WTFAC.REFLI;                               04709   
              W_NATOP      = WTFAC.NATOP;                               04710   
              W_NATOP_FIR  = ' ' ;                                      04711   
              EDIT_LIG_FIR = 'N' ;                                      04712   
              LIGNE        = ' ' ;                                      04713   
              CALL GESTION_FIR;                                         04714   
              IF EDIT_LIG_FIR = 'O'                                     04715   
               & SVG_LIGNE_FIR ^= LIGNE                                 04716   
               & (  LIGNE_FIR.NUFAO ^= ' '                              04717   
                  ! LIGNE_FIR.NUBLO ^= ' '                              04718   
                  ! LIGNE_FIR.RECOO ^= ' ' ) THEN DO;                   04719   
                 SVG_LIGNE_FIR       = LIGNE ;                          04720   
                 STRING(ZSPOOLP_SVG) = ''    ;                          04721   
                 CALL ECRITUR;                                          04722   
                 STRING(ZSPOOLP_SVG) = LIGNE ;                          04723   
                 CALL ECRITUR;                                          04724   
                 FACT.LIGNE          = FACT.LIGNE + 2;                  04725   
                 END;                                                   04726   
              END;                                                      04727   
           IF WTFAC.ORPRO = '1'  ! WTFAC.ORPRO = '2' !                  04728   
            ( WTFAC.ORPRO = '3'  &                                      04729   
              WTFAC.REPIE = ' '  &                                      04730   
             (WTFAC.NATOP = '02' ! WTFAC.NATOP = '21' )) THEN DO;       04731   
                                        /*   PREFACTURATION           */04732   
             /*    PUT SKIP LIST ('ETIQ  A050D: ' !!                    04733   
                     ' WTFAC.EDIPA: ' !! WTFAC.EDIPA !!                 04734   
                     ' WTFAC.TRIFA: ' !! WTFAC.TRIFA !!                 04735   
                     ' WTFAC.ORPRO: ' !! WTFAC.ORPRO !!                 04736   
                     ' WTFAC.REPIE: ' !! WTFAC.REPIE !!                 04737   
                     ' WTFAC.NATOP: ' !! WTFAC.NATOP )   */             04738   
                                                                        04739   
                    ENTCDE1.LIBEL1      = 'OPERATION ';                 04740   
                    ENTCDE1.LIBEL2      = ' DU ';                       04741   
                    ENTCDE1.DAMJJ       = WTFAC.DAMJJ;                  04742   
                    ENTCDE1.DAMMM       = WTFAC.DAMMM;                  04743   
                    ENTCDE1.NORUN       = WTFAC.NORUN;                  04744   
                    ENTCDE1.LOREC       = WTFAC.LOREC;                  04745   
                    SVG_OPERA           = ' OPERATION DU '   !!         04746   
                                          WTFAC.DAMJJ !! '.' !!         04747   
                                          WTFAC.DAMMM ;                 04748   
                                        /*   DEMANDE CARREFOUR 01.06  */04749   
                    SVG_OPERA           = '' ;                          04750   
                    SVG_OPERA_D         = '' ;                          04751   
                    IF FACT.LIGNE       > NLMAX_2 THEN CALL ENTCDL;     04752   
                    IF FACT.LIGNE       = 0  THEN DO;                   04753   
                            ENTCDE1.SAUT= ' ' ;                         04754   
                            FACT.LIGNE  = FACT.LIGNE + 1;               04755   
                            END;        ELSE DO;                        04756   
                            ENTCDE1.SAUT= '0';                          04757   
                            FACT.LIGNE  = FACT.LIGNE + 2;               04758   
                            END;                                        04759   
                    STRING(ZSPOOLP_SVG) = STRING(ENTCDE1);              04760   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            04761   
                    TOP_DEMA_ECR = 'N' ;                                04762   
                    DEMAT_REF.DAOPE     = '20' !! WTFAC.DAMAA !!        04763   
                                          WTFAC.DAMMM !! WTFAC.DAMJJ;   04764   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            04765   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                04766   
                    STO_D_REF.DAOPE     = '20' !! WTFAC.DAMAA !!        04767   
                                          WTFAC.DAMMM !! WTFAC.DAMJJ;   04768   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                04769   
                    CALL ECRITUR;                                       04770   
                    END;                /*   FIN TEST ORPRO           */04771   
1                                       /*******************************04772   
                                        *    MODULE INITIAL RESAI      *04773   
                                        *******************************/04774   
                                                                        04775   
                                        /*----------------------------*/04776   
                                        /* AJOUT LE 15 01 97   �$     */04777   
       A050E:                           /*   AFFICHAGE REF.CDE OFFICE */04778   
                                        /*----------------------------*/04779   
           WS_NUEDI = '';                                               04780   
                                                                        04781   
           IF WTFAC.ORPRO = '2'                                         04782   
              THEN DO;                                                  04783   
              /* -> AFFICHAGE  REF. DE CDE SI ELLE A ETE TROUVEE  */    04784   
              IF WS_RECO1_IDREFCO1    ^= ''                             04785   
                 THEN DO;                                               04786   
                    ENTCDE2.RECO1       = WS_RECO1_IDREFCO1;            04787   
                    ENTCDE2.MONTC       = WTFAC.MONTC;                  04788   
                    IF (WTFAC.NATOP = '12' ! WTFAC.NATOP = '14' !       04789   
                        WTFAC.NATOP = '15' ! WTFAC.NATOP = '32' !       04790   
                        WTFAC.NATOP = '33' ! WTFAC.NATOP = '52' !       04791   
                        WTFAC.NATOP = '53' )                            04792   
                     &  WK_RECHE_FIRENT = 'O'                           04793   
                     &  WS_FIR_RECOM   ^= ' ' THEN DO;                  04794   
                       ENTCDE2.RECO1    = WS_FIR_RECOM ;                04795   
                       END;             /*   07.08 FORCAGE RECOM<--FIR*/04796   
                    ENTCDE2.LISPE       = '';                           04797   
                    ENTCDE2.LIBEL       = 'COMMANDE ';                  04798   
                    ENTCDE2.SRESAI      = '';                           04799   
                    ENTCDE2.SAUT        = ' ';                          04800   
                    IF FACT.LIGNE       > NLMAX_2 THEN CALL ENTCDL;     04801   
                    IF FACT.LIGNE       = 0  THEN DO;                   04802   
                       ENTCDE2.SAUT     = ' ';                          04803   
                       FACT.LIGNE       = FACT.LIGNE + 1;               04804   
                       END;             ELSE DO;                        04805   
                       ENTCDE2.SAUT     = '0';                          04806   
                       FACT.LIGNE       = FACT.LIGNE + 2;               04807   
                       END;                                             04808   
                    STRING(ZSPOOLP_SVG) = STRING(ENTCDE2) ;             04809   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            04810   
                    TOP_DEMA_ECR = 'N' ;                                04811   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            04812   
                    CALL ECRITUR;                                       04813   
                 END;              /*----------------------------*/     04814   
               END;                /* AJOUT LE 15 01 97   �$ FIN */     04815   
                                   /*   AFFICHAGE REF.CDE OFFICE */     04816   
                                   /*----------------------------*/     04817   
       A060D:                                                           04818   
     /*    PUT SKIP LIST ('ETIQ   A060D:' )  */                         04819   
           RESAI          = ''  ;       /*   RAZ VARIABLES NIV.RESAI  */04820   
0          IF WTFAC.EDIPA = '9' THEN GO TO A070D;                       04821   
0          IF SVG_REFLI ^= WTFAC.REFLI THEN DO;                         04822   
                                        /*   AFFICHAGE INFO FIR ?     */04823   
              SVG_REFLI    = WTFAC.REFLI;                               04824   
              W_REFLI      = WTFAC.REFLI;                               04825   
              W_NATOP      = WTFAC.NATOP;                               04826   
              W_NATOP_FIR  = ' ' ;                                      04827   
              EDIT_LIG_FIR = 'N' ;                                      04828   
              LIGNE        = ' ' ;                                      04829   
              CALL GESTION_FIR;                                         04830   
              IF EDIT_LIG_FIR = 'O'                                     04831   
               & SVG_LIGNE_FIR ^= LIGNE                                 04832   
               & (  LIGNE_FIR.NUFAO ^= ' '                              04833   
                  ! LIGNE_FIR.NUBLO ^= ' '                              04834   
                  ! LIGNE_FIR.RECOO ^= ' ' ) THEN DO;                   04835   
                 SVG_LIGNE_FIR       = LIGNE ;                          04836   
                 STRING(ZSPOOLP_SVG) = ''    ;                          04837   
                 CALL ECRITUR;                                          04838   
                 STRING(ZSPOOLP_SVG) = LIGNE ;                          04839   
                 CALL ECRITUR;                                          04840   
                 FACT.LIGNE          = FACT.LIGNE + 2;                  04841   
                 END;                                                   04842   
              END;                                                      04843   
           ENTCDE2        = ' ' ;                                       04844   
           ENTCDE2.POLIC  = '00'X;                                      04845   
           IF WTFAC.TRIFA = '4' THEN DO;/*   LIGNES DE CLOTURE DU GIH */04846   
                    LIGNE1.SAUT         = '0';                          04847   
                    GO TO A070D;                                        04848   
                    END;                                                04849   
           IF WTFAC.NATOP = '51' THEN GO TO A060Q;                      04850   
           IF WTFAC.TRACO = '4' THEN DO;/*   TEST TRACO 4 NATRE       */04851   
                    ENTCDE2.FIL3        = ' *';                         04852   
                    ENTCDE2.NATRE       = WTFAC.NATRE;                  04853   
                    ENTCDE2.FIL6        = '* ';                         04854   
                    END;                /*   FIN  TEST  TRACO 4       */04855   
       A060P:                           /*   NATOP DIFF. RECEPTION    */04856   
     /*    PUT SKIP LIST ('ETIQ   A060P:' )    */                       04857   
           IF WTFAC.ORPRO = '3' ! WTFAC.ORPRO = '5' !                   04858   
              WTFAC.ORPRO = '6' THEN DO ;                               04859   
                    IF WTFAC.ORPRO  = '3'  &                            04860   
                       WTFAC.REPIE  = ' '  &                            04861   
                       (WTFAC.NATOP = '02' ! WTFAC.NATOP  = '21' )      04862   
                       THEN DO;         /*   FACTURE CRDL = CDL       */04863   
                       GO TO A060Q;                                     04864   
                       END;                                             04865   
                    IF WTFAC.NATOP = '02' ! WTFAC.NATOP = '03' !        04866   
                       WTFAC.NATOP = '06' ! WTFAC.NATOP = '41' !        04867   
                       WTFAC.NATOP = '50' ! WTFAC.NATOP = '70' THEN DO; 04868   
                                        /*   POSTFACTURATION          */04869   
                         IF WTFAC.NATOP = '06' & WTFAC.ORPRO ^= '3'     04870   
                            THEN GO TO A060R;                           04871   
                         ENTCDE2.FIL1   = 'OPERATION DU ';              04872   
                         ZDATE.JJ       = WTFAC.DCOJJ;                  04873   
                                        /*   RETOUR ADMINISTRATIF     */04874   
                         IF  WTFAC.GS.TYVAR = '9'                       04875   
                             & (  WTFAC.GS.NATOP = '70' !               04876   
                                        /*   RETOUR EDITEUR A SUMMAR. */04877   
                                ( WTFAC.GS.TRACO = '4'  &               04878   
                                 (WTFAC.GS.NATOP = '03' !               04879   
                                  WTFAC.GS.NATOP = '06' )))             04880   
                            THEN        ZDATE.JJ = ' ';                 04881   
                         ZDATE.MM       = WTFAC.DCOMM;                  04882   
                         ZDATE.AA       = '  ';                         04883   
                         ZDATE.FIL2     = ' ';                          04884   
                         ENTCDE2.SDAMIS = WDATE;                        04885   
                         DEMAT_REF.DAOPE = '20' !! WTFAC.DCOAA !!       04886   
                                          WTFAC.DCOMM !! WTFAC.DCOJJ;   04887   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                04888   
                         STO_D_REF.DAOPE = '20' !! WTFAC.DCOAA !!       04889   
                                          WTFAC.DCOMM !! WTFAC.DCOJJ;   04890   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                04891   
                         END;           ELSE DO;                        04892   
                         IF WTFAC.TRIFA = '3' THEN                      04893   
                           ENTCDE2.FIL1 = ' AVOIR ';                    04894   
                         END;           /*   FIN TEST NATOP           */04895   
       A060R:                                                           04896   
0                                       /*   COLIS EN SOUFFRANCE      */04897   
                    IF WTFAC.NATOP  = '31' THEN DO;                     04898   
                       ENTCDE2.RECO1    = SUBSTR(WTFAC.RECO1,2,16);     04899   
                       END;             ELSE DO;                        04900   
                       ENTCDE2.RECO1    = WTFAC.RECO1;                  04901   
                       IF (WTFAC.NATOP = '12' ! WTFAC.NATOP = '14' !    04902   
                           WTFAC.NATOP = '15' ! WTFAC.NATOP = '32' !    04903   
                           WTFAC.NATOP = '33' ! WTFAC.NATOP = '52' !    04904   
                           WTFAC.NATOP = '53' )                         04905   
                        &  WK_RECHE_FIRENT = 'O'                        04906   
                        &  WS_FIR_RECOM   ^= ' ' THEN DO;               04907   
                          ENTCDE2.RECO1    = WS_FIR_RECOM ;             04908   
                          END;          /*   07.08 FORCAGE RECOM<--FI */04909   
                       END;                                             04910   
                    ENTCDE2.MONTC       = WTFAC.MONTC;                  04911   
0                   IF WTFAC.OPSPE ^= ' ' THEN DO;                      04912   
                       CLE1             = WTFAC.OPSPE;                  04913   
                       CALL ID470B(TBOPSPE.NUTAB);                      04914   
                       END;             ELSE DO;                        04915   
                       WLISPE           = ' ';                          04916   
                       END;             /*   FIN  TEST  LISPE BLANC   */04917   
                    ENTCDE2.LISPE       = WLISPE;                       04918   
                    ENTCDE2.LIBEL       = '    REF  ';                  04919   
0                   IF WTFAC.REPIE      = ' ' THEN DO;                  04920   
                       ZRESAI.ANNEE     = WTFAC.ANNEE;                  04921   
                       ZRESAI.RUN       = WTFAC.RUN;                    04922   
                       ZRESAI.ORIGI     = WTFAC.ORIGI;                  04923   
                       ZRESAI.NUMRO     = WTFAC.NUMRO;                  04924   
                       ENTCDE2.SRESAI   = WRESAI;                       04925   
                       END;             ELSE DO;                        04926   
                       ENTCDE2.SRESAI   = WTFAC.REPIE;                  04927   
                       END;             /*   FIN  TEST  REPIE         */04928   
                    ENTCDE2.SAUT        = ' ';                          04929   
                    IF FACT.LIGNE       > NLMAX_2 THEN CALL ENTCDL;     04930   
                    IF FACT.LIGNE       = 0  THEN DO;                   04931   
                       ENTCDE2.SAUT     = ' ';                          04932   
                       FACT.LIGNE       = FACT.LIGNE + 1;               04933   
                       END;             ELSE DO;                        04934   
                       ENTCDE2.SAUT     = '0';                          04935   
                       FACT.LIGNE       = FACT.LIGNE + 2;               04936   
                       END;                                             04937   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            04938   
                    TOP_DEMA_ECR = 'N' ;                                04939   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            04940   
                    STRING(ZSPOOLP_SVG) = STRING(ENTCDE2) ;             04941   
                    CALL ECRITUR;                                       04942   
                    GO TO A070D;                                        04943   
                    END;                /*   FIN  TEST  ORPRO 3 5 6   */04944   
       A060Q:                           /*   NATOP = 51 = RECEPTION   */04945   
      /*   PUT SKIP LIST ('ETIQ   A060Q:' )     */                      04946   
           IF WTFAC.ORPRO  = '1'  ! WTFAC.ORPRO = '2'  !                04947   
             (WTFAC.ORPRO  = '3'  &                                     04948   
              WTFAC.REPIE  = ' '  &                                     04949   
              (WTFAC.NATOP = '02' ! WTFAC.NATOP  = '21' ))              04950   
              THEN DO;                                                  04951   
              IF WTFAC.CATLI = ' ' ! WTFAC.CATLI = '5' THEN DO;         04952   
                                                                        04953   
                                                                        04954   
                                        /*   LIGNES  NOUVELLES        */04955   
                 ENTCDE2.LIBEL          = 'COMMANDE ';                  04956   
                 ZRESAI.ANNEE           = WTFAC.ANNEE;                  04957   
                 ZRESAI.RUN             = WTFAC.RUN;                    04958   
                 ZRESAI.ORIGI           = WTFAC.ORIGI;                  04959   
                 ZRESAI.NUMRO           = WTFAC.NUMRO;                  04960   
                 ENTCDE2.SRESAI         = WRESAI;                       04961   
0                                       /*   COLIS EN SOUFFRANCE      */04962   
                 IF WTFAC.NATOP  = '31' THEN DO;                        04963   
                    ENTCDE2.RECO1       = SUBSTR(WTFAC.RECO1,2,16);     04964   
                    END;                ELSE DO;                        04965   
                    ENTCDE2.RECO1       = WTFAC.RECO1;                  04966   
                    IF (WTFAC.NATOP = '12' ! WTFAC.NATOP = '14' !       04967   
                        WTFAC.NATOP = '15' ! WTFAC.NATOP = '32' !       04968   
                        WTFAC.NATOP = '33' ! WTFAC.NATOP = '52' !       04969   
                        WTFAC.NATOP = '53' )                            04970   
                     &  WK_RECHE_FIRENT = 'O'                           04971   
                     &  WS_FIR_RECOM   ^= ' ' THEN DO;                  04972   
                       ENTCDE2.RECO1    = WS_FIR_RECOM ;                04973   
                       END;             /*   07.08 FORCAGE RECOM<--FIR*/04974   
                    END;                                                04975   
                 ENTCDE2.MONTC          = WTFAC.MONTC;                  04976   
                 ENTCDE2.SAUT           = 'J';                          04977   
0                IF WTFAC.OPSPE        ^= ' ' THEN DO;                  04978   
                    CLE1                = WTFAC.OPSPE;                  04979   
                    CALL ID470B(TBOPSPE.NUTAB);                         04980   
                    END;                ELSE DO;                        04981   
                    WLISPE              = ' ' ;                         04982   
                    END;                /*   FIN TEST OPSPE BLANC     */04983   
                 ENTCDE2.LISPE          = WLISPE;                       04984   
0                IF FACT.LIGNE          > NLMAX_2 THEN CALL ENTCDL;     04985   
                 ENTCDE2.SAUT           = '0';                          04986   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            04987   
                    TOP_DEMA_ECR = 'N' ;                                04988   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            04989   
                 STRING(ZSPOOLP_SVG)    = STRING(ENTCDE2);              04990   
                 FACT.LIGNE             = FACT.LIGNE + 2;               04991   
                 CALL ECRITUR;                                          04992   
                 END;                   ELSE DO;                        04993   
                                        /*   LIGNES ANCIENNES         */04994   
                 IF FACT.LIGNE          > NLMAX_2 THEN CALL ENTCDL;     04995   
                 FACT.LIGNE             = FACT.LIGNE + 1 ;              04996   
                 ZSPOOLP_SVG            = '' ;                          04997   
                 ZSPOOLP_SVG.POLIC      = '00'X;                        04998   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            04999   
                    TOP_DEMA_ECR = 'N' ;                                05000   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            05001   
                 CALL ECRITUR;                                          05002   
                 END;                   /*   FIN  TEST  CATLI         */05003   
              END;                      /*   FIN  TEST  ORPRO         */05004   
1                                       /*******************************05005   
                                        *    MODULE INITIAL COLLECTION *05006   
                                        *******************************/05007   
       A070D:                                                           05008   
                                                                        05009   
          /*���-> EDITION LIBELLE EDITEUR A CHAQUE RUPTURE EDITEUR   */ 05010   
          /* AJOUT 25.07.01                                          */ 05011   
          /* LIBELLE EDITEUR/DIVISION A CHAQUE RUPTURE EDITEUR/DIVIS.*/ 05012   
          /* AVANT DE RENSEIGNER LA VARIABLE LIGNE_NUEDI.LIEDI       */ 05013   
          /* ENLEVER LES ESPACES A LA FIN DE LA CHAINE DE CARACTERES */ 05014   
                                                                        05015   
          IF WS_NUEDI !! WS_NUDIV  ^= WTFACRED.NUEDI !! WTFACRED.NUDIV  05016   
             THEN DO;                                                   05017   
             WS_NUEDI               = WTFACRED.NUEDI ;                  05018   
             WS_NUDIV               = WTFACRED.NUDIV ;                  05019   
             IF SUBSTR(WTFACRED.LIEDI,1,1) = HIGH(1) THEN DO;           05020   
                WTFACRED.LIEDI      = ' ' ;                             05021   
                WTFACRED.LIDIV      = ' ' ;                             05022   
                LIGNE_NUEDI.LIEDI   = WTFACRED.LIEDI;                   05023   
                LIGNE_NUEDI.LIDIV   = WTFACRED.LIDIV;                   05024   
                END;                ELSE DO;                            05025   
                LIGNE_NUEDI.LIDIV   = WTFACRED.LIDIV;                   05026   
                HLIEDI_RED = WTFACRED.LIEDI;     /* ENLEVER LES BLANCS*/05027   
                SVG_INX    = 15 ;                                       05028   
                DO INX = 15 TO 1 BY - 1;         /* EDITEUR/DIVISION  */05029   
                   IF HLIEDI.SLIEDI(INX) ^= ' ' THEN DO;                05030   
                      SVG_INX       = INX;                              05031   
                      INX           = 1  ;                              05032   
                      END;                                              05033   
                   END;                                                 05034   
                LIGNE_NUEDI.LIEDI   = SUBSTR(HLIEDI_RED,1,SVG_INX) ;    05035   
0               IF WTFAC.TRACO = '4' THEN DO; /* CAS PARTICULIER EDITE*/05036   
                   IF LIGNE_NUEDI.LIEDI = ' ' &                         05037   
                      LIGNE_NUEDI.LIDIV = ' ' THEN DO;                  05038   
                      SV_NUEDI          = WTFAC.NUEDI;                  05039   
                      CALL RECH_TBNUEDI;                                05040   
                      LIGNE_NUEDI.LIEDI = SV_LIEDI;                     05041   
                      SV_NUDIV5         = WTFAC.NUEDI !! WTFAC.NUDIV ;  05042   
                      CALL RECH_TBNUDIV;                                05043   
                      LIGNE_NUEDI.LIDIV = SV_LIDIV;                     05044   
                      END;                                              05045   
                   END;                                                 05046   
                END;                                                    05047   
                                                                        05048   
0            IF WTFAC.TRACO = '4' THEN DO;    /* CAS PARTICULIER EDITE*/05049   
                IF STRING(SVG_LIGNE_NUEDI)    = STRING(LIGNE_NUEDI)     05050   
                   THEN GO TO A070DA;         /*  PAS EDITION MEME INF*/05051   
                END;                                                    05052   
             IF WTFACRED.TRIFA   = '4' &                                05053   
                WTFACRED.LIEDI   = ' ' THEN DO;                         05054   
                                 /*   LIBEL EDITEUR A BLANC NON EDITE */05055   
                END;             ELSE DO;                               05056   
                IF FACT.LIGNE    > NLMAX_2 THEN CALL ENTCDL;            05057   
                IF FACT.LIGNE    = 0  THEN DO;                          05058   
                   LIGNE_NUEDI.SAUT = ' ';                              05059   
                   FACT.LIGNE    = FACT.LIGNE + 1;                      05060   
                   END;          ELSE DO;                               05061   
                   LIGNE_NUEDI.SAUT  = '0';                             05062   
                   FACT.LIGNE    = FACT.LIGNE + 2;                      05063   
                   END;                                                 05064   
                STRING(ZSPOOLP_SVG) = STRING(LIGNE_NUEDI);              05065   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            05066   
                    TOP_DEMA_ECR = 'N' ;                                05067   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            05068   
                CALL ECRITUR;                                           05069   
0               IF WTFAC.TRACO = '4' THEN DO; /* CAS PARTICULIER EDITE*/05070   
                   STRING(SVG_LIGNE_NUEDI)    = STRING(LIGNE_NUEDI) ;   05071   
                   END;                                                 05072   
                END;                                                    05073   
          END;                                                          05074   
                                                                        05075   
       A070DA:                                                          05076   
                                                                        05077   
       /**************************************************************/ 05078   
       /* SI UN ACCORD EST PASSE AVEC LE CLIENT, DETERMINER SI LA COLL*/05079   
       /* DE L'ARTICLE APPARTIENT A LA FOURCHETTE EDI/DIV/COL         */05080   
       /* SI OUI, ON RAMENE LE NUMERO D'ACCORD                        */05081   
       /* SI NON, ON INITIALISE PROD_AUTRE A OUI                      */05082   
       /**************************************************************/ 05083   
        IF ACCORD_OUI_NON = 'OUI' &  WTFAC.TYREF ^= '3' THEN DO;        05084   
          WS_EDC_RED = '';                                              05085   
                                                                        05086   
                                                                        05087   
          WS_EDC.EDI = WTFAC.NUEDI;                                     05088   
          WS_EDC.DIV = WTFAC.NUDIV;                                     05089   
          WS_EDC.COL = WTFAC.NUCOL;                                     05090   
          PROD_AUTRE = 'OUI';                                           05091   
          SPIPA.FONCT = 'RP';                                           05092   
          SPIPA.COTAB    = 'CDLACCO';                                   05093   
          SPIPA.REFPO = STRING(CLE_ACCORD);                             05094   
          SPIPA.OPERA = '>';                                            05095   
          CALL SPI2TBV (SPIPA,TBACCORD,SPIFI);                          05096   
          BCL0: DO WHILE (CLE_ACCORD.SYPRO!!CLE_ACCORD.AFFIL            05097   
             = TBACCORD.SYPRO!!TBACCORD.AFFIL);                         05098   
             IF SPIPA.CORET ^= '00' THEN DO;                            05099   
               PROD_AUTRE = 'OUI';                                      05100   
               LEAVE BCL0;                                              05101   
               END;                                                     05102   
             ELSE DO;                                                   05103   
             IF WS_EDC_RED = STRING(TBACCORD.EDCDEB) !                  05104   
                WS_EDC_RED = STRING(TBACCORD.EDCFIN) !                  05105   
                ((STRING(TBACCORD.EDCDEB) < WS_EDC_RED) &               05106   
                (WS_EDC_RED < STRING(TBACCORD.EDCFIN))) THEN DO;        05107   
                  IF TBACCORD.NUCLI = '' !                              05108   
                    (TBACCORD.NUCLI ^='' & TBACCORD.NUCLI               05109   
                                       = WTCLI1.NUCLI)                  05110   
                    THEN DO;                                            05111   
                    PROD_AUTRE = 'NON';                                 05112   
                    ACC_LIGNE = TBACCORD.ACCOR;                         05113   
                    LEAVE BCL0;                                         05114   
                    END; /* FIN CODE ACCORD TROUVE    */                05115   
                END;   /* FIN COLL. COMPRIS FOURCHETTE */               05116   
             END;     /* FIN RECHERCHE TABLE OK       */                05117   
           CALL SPI2TBV (SPIPA,TBACCORD,SPIFI);                         05118   
           END BCL0;    /* FIN TANT QUE ACCORD CLIENT   */              05119   
         END; /* FIN SI ACCORD CLIENT EXISTANT */                       05120   
0          SUM.LICOL          = ' ';    /*   RAZ LIBELLES  SUMMARIZ.  */05121   
           SUM.LIDIV          = ' ';                                    05122   
1                                       /*******************************05123   
                                        *    MODULE INITIAL COND. VENTE*05124   
                                        *******************************/05125   
       A080D:                                                           05126   
0          SUM.NBMVT          = 0;      /*   INIT VARIABL. SUMMARIZ.  */05127   
           SUM.QUANT          = 0;                                      05128   
           SUM.NETHT          = 0;                                      05129   
           SUM.TAXLI          = 0;                                      05130   
           SUM.FORHT          = 0;                                      05131   
           SUM.LISUM          = WTFAC.LISUM;                            05132   
           IF SUM.LISUM      ^= '1' THEN GO TO A090D;                   05133   
           CLE7               = WTFAC.NUEDI !! WTFAC.NUDIV !!           05134   
                                WTFAC.NUCOL ;                           05135   
           IF COENR2 = '2' ! COENR2 = '3' ! COENR2 = '5'                05136   
              THEN GO TO A090D;        /*    NON RECH TBEDICO SI COLIS*/05137   
           CALL ID470B(TBEDICO.NUTAB);                                  05138   
           SUM.LICOL          = WLICOL;                                 05139   
           SUM.LIDIV          = WLIDIV;                                 05140   
           IF SUM.LICOL = ' ' & SUM.LIDIV = ' ' THEN SUM.LISUM = '0';   05141   
                                        /*   PAS DE SUMMAR. SI INCONNU*/05142   
1                                       /*******************************05143   
                                        *    MODULE INITIAL NUART      *05144   
                                        *******************************/05145   
       A090D:                                                           05146   
           WNUART             = 0;                                      05147   
           COLIS              = '';                                     05148   
           NBTAX_COLIS        = 0 ;                                     05149   
           COTAX_COLIS        = '';                                     05150   
           REFLI_TETE_COLIS   = '';                                     05151   
           IF TOP_DEMA_FAC = 'O' THEN DO;                               05152   
              DEMAT_LIG.ENSEQ    = 0 ;                                  05153   
              SVG_DEMAT_ATM      = '';                                  05154   
              END ;                                                     05155   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                05156   
           NBTAX_COLIS_D      = 0 ;                                     05157   
           COTAX_COLIS_D      = '';                                     05158   
           SVG_STO_D_ATM      = '';                                     05159   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                05160   
1                                       /*******************************05161   
                                        *    MODULE CENTRAL DE CALCUL  *05162   
                                        *           RUN CTRLI          *05163   
                                        *******************************/05164   
       A100D:                                                           05165   
0          IF SVG_REFLI ^= WTFAC.REFLI THEN DO;                         05166   
                                        /*   AFFICHAGE INFO FIR ?     */05167   
              SVG_REFLI    = WTFAC.REFLI;                               05168   
              W_REFLI      = WTFAC.REFLI;                               05169   
              W_NATOP      = WTFAC.NATOP;                               05170   
              W_NATOP_FIR  = ' ' ;                                      05171   
              EDIT_LIG_FIR = 'N' ;                                      05172   
              LIGNE        = ' ' ;                                      05173   
              CALL GESTION_FIR;                                         05174   
              IF EDIT_LIG_FIR = 'O'                                     05175   
               & SVG_LIGNE_FIR ^= LIGNE                                 05176   
               & (  LIGNE_FIR.NUFAO ^= ' '                              05177   
                  ! LIGNE_FIR.NUBLO ^= ' '                              05178   
                  ! LIGNE_FIR.RECOO ^= ' ' ) THEN DO;                   05179   
                 SVG_LIGNE_FIR       = LIGNE ;                          05180   
                 STRING(ZSPOOLP_SVG) = ''    ;                          05181   
                 CALL ECRITUR;                                          05182   
                 STRING(ZSPOOLP_SVG) = LIGNE ;                          05183   
                 CALL ECRITUR;                                          05184   
                 FACT.LIGNE          = FACT.LIGNE + 2;                  05185   
                 END;                                                   05186   
              END;                                                      05187   
0          IF TOP_DEMA_FAC = 'O' THEN DO;/*   09.07 SI 2 NUART IDENTIQ*/05188   
              DEMAT_LIG.GS.NULIG = DEMAT_LIG.GS.NULIG + 1 ;             05189   
              DEMAT_LIG.ID.NULIG = DEMAT_LIG.ID.NULIG + 1 ;             05190   
              SVG_NULIG          = DEMAT_LIG.ID.NULIG     ;             05191   
              END ;                                                     05192   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                05193   
           STO_D_LIG.GS.NULIG = STO_D_LIG.GS.NULIG + 1 ;                05194   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                05195   
0          SVG_RECOM             = WTFAC.RECO1 !! WTFAC.MONTC ;         05196   
0                                       /*   COLIS EN SOUFFRANCE      */05197   
           IF WTFAC.NATOP  = '31'  THEN DO;                             05198   
              WS_RECO1                  = SUBSTR(WTFAC.RECO1,2,16);     05199   
              WTFAC.RECO1               = WS_RECO1 ;                    05200   
              SVG_RECOM                 = WTFAC.RECO1 !! WTFAC.MONTC ;  05201   
              END;                      ELSE DO;                        05202   
              IF (WTFAC.NATOP = '12' ! WTFAC.NATOP = '14' !             05203   
                  WTFAC.NATOP = '15' ! WTFAC.NATOP = '32' !             05204   
                  WTFAC.NATOP = '33' ! WTFAC.NATOP = '52' !             05205   
                  WTFAC.NATOP = '53' )                                  05206   
               &  WK_RECHE_FIRENT = 'O'                                 05207   
               &  WS_FIR_RECOM   ^= ' ' THEN DO;                        05208   
                 WTFAC.RECO1            = WS_FIR_RECOM ;                05209   
                 END;                   /*   07.08 FORCAGE RECOM<--FIR*/05210   
              END;                                                      05211   
           IF NUCLI.TROUV = '0' THEN DO;/*   CLIENT INCONNU DANS DBC  */05212   
                    WANOL.TBANO(1)      = '1010';                       05213   
                    WANOE.TBANO(1)      = '1010';                       05214   
                    WANOL.LIMPO         = '***** NUCLI ' !!             05215   
                                          WTFAC.GS.NUCLI !!             05216   
                                          ' INCONNU DANS DB CLIENTS ';  05217   
                    CALL ID470D;        /*   MOUVEMENTS EN ANOMALIES  */05218   
                    END;                /*   01.09.87                 */05219   
0          IF WTFAC.NATOP  = '41' &     /*   CANADA PROFORMA          */05220   
              WTFAC.NETLI ^=  0   &     /*   MT NON NUL COMMENTAIRE   */05221   
              CANADA_NUCLI = 'O' THEN DO;                               05222   
              C4P_NUCLI    = WTFAC.GS.NUCLI   ;                         05223   
              C4P_NORUN    = ENTET70.NORUN    ;                         05224   
              C4P_LOREC    = WTFAC.LOREC      ;                         05225   
              C4P_NUFAC    = WNUFAC           ;                         05226   
              C4P_DAFACJ   = ENTET70.DAT10.JJ ;                         05227   
              C4P_DAFACM   = ENTET70.DAT10.MM ;                         05228   
              C4P_DAFACA   = ENTET70.DAT10.AA ;                         05229   
              C4P_DAFACA   = C4P_DAFACA + 2000;                         05230   
              C4P_NUART    = WTFAC.NUART      ;                         05231   
              /*     BFA$ */                                            05232   
              C4P_NBTOM    = WTFAC.NBTOM      ;                         05233   
              C4P_FIL10    = ''               ;                         05234   
              C4P_MOICO    = C4P_DAFACA !! C4P_DAFACM ;                 05235   
              SELECT (COENR23) ;                                        05236   
                 WHEN ('13','43','63','14','44','64') DO;               05237   
                    C4P_COVRACOL = 'V' ;                                05238   
                    WRITE FILE (CANADA4P) FROM (WCAN4P);                05239   
                    WS_CANA4P    = WS_CANA4P + 1 ;                      05240   
                    END;                                                05241   
                 WHEN ('23','33','53','24','34','54') DO;               05242   
                    C4P_COVRACOL = 'C' ;                                05243   
                    WRITE FILE (CANADA4P) FROM (WCAN4P);                05244   
                    WS_CANA4P    = WS_CANA4P + 1 ;                      05245   
                    END;                                                05246   
                 OTHERWISE DO ;                                         05247   
                    END;                                                05248   
                 END;                                                   05249   
              END;                                                      05250   
0          IF TOP_DEMA_FAC = 'O' THEN DO;                               05251   
              CALL GEST_REFERENCE ;     /*   REFERENC.CLIENT DISTRIBUT*/05252   
              END;                                                      05253   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                05254   
           CALL GEST_REFERENCE_D ;     /*   REFERENC.CLIENT DISTRIBUT*/ 05255   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                05256   
0          IF WTFAC.EDIPA = '2' THEN DO;/*   ECHEANCE FORCEE SI GIH   */05257   
                    WTFAC.ECHEA         = FACT.ECHGIH;                  05258   
                    WTFAC.STRET         = WTRANS;                       05259   
                    GO TO A100A;                                        05260   
                    END;                /*   FIN TEST EDIPA 2         */05261   
           CALL ANTICIP;                /*   ANTICIPATION ECHEANCE    */05262   
0      A100A:                                                           05263   
           LIBTI_SVG      = WTFAC.LIBTI;                                05264   
           LIBAU_SVG      = WTFAC.LIBAU;                                05265   
           WTFAC.LIBTI    = TRANSLATE(WTFAC.LIBTI,'  ','�');           05266   
           WTFAC.LIBAU    = TRANSLATE(WTFAC.LIBAU,'  ','�');           05267   
0                                       /*   FRAIS FINANCIERS         */05268   
           IF WTFAC.COGAN = '17' THEN DO;                               05269   
              FINAN_EXIST = 'O' ;                                       05270   
              END;                                                      05271   
0                                       /*   REMISE FIN ANNEE         */05272   
           IF WTFAC.COGAN  = '23' ! WTFAC.COGAN = '24' THEN DO;         05273   
              RFA_DETAIL  = 'O' ;                                       05274   
              END;                                                      05275   
0                                       /*   ELIMINATION DE 2 BLANCS  */05276   
           IND                  = INDEX(WTFAC.LIBTI,'   ');             05277   
           IF IND ^= 0 & IND < 3 & WTFAC.LIBTI ^= ' ' THEN DO;          05278   
              WTFAC.LIBTI = SUBSTR(WTFAC.LIBTI,1,IND - 1 ) !!           05279   
                            SUBSTR(WTFAC.LIBTI,IND + 2 ) ;              05280   
              END;                                                      05281   
0          IF WTFAC.NATOP = '21' ! WTFAC.NATOP = '22' !                 05282   
              WTFAC.NATOP = '02' ! WTFAC.NATOP = '12' !                 05283   
              WTFAC.NATOP = '14' THEN DO;/*  18.11.84                 */05284   
                                        /*   FACTURE COMPTANT         */05285   
                                        /******************************/05286   
                    WTBOR.ID.MACOM      = WTFAC.MACOM;                  05287   
                    WTBOR.ID.NUCLI      = WTFAC.NUCLI;                  05288   
                    WTBOR.ID.ANNEE      = WTFAC.ANNEE;                  05289   
                    WTBOR.ID.RUN        = WTFAC.RUN;                    05290   
                    WTBOR.ID.ORIGI      = WTFAC.ORIGI;                  05291   
                    WTBOR.ID.NUMRO      = WTFAC.NUMRO;                  05292   
                    WTBOR.ID.DCOAA      = WTFAC.DCOAA;                  05293   
                    WTBOR.ID.DCOMM      = WTFAC.DCOMM;                  05294   
                    WTBOR.ID.DCOJJ      = WTFAC.DCOJJ;                  05295   
                    WTBOR.ID.NATOP      = WTFAC.NATOP;                  05296   
                    WTBOR.ID.REPIE      = WTFAC.REPIE;                  05297   
                    WTBOR.ID.NUART      = WTFAC.NUART;                  05298   
                    WTBOR.CTRLI         = WTFAC.CTRLI;                  05299   
                    WTBOR.MONTC         = WTFAC.MONTC;                  05300   
                    IF VERIFY(WTBOR.MONTC,'0123456789') ^= 0            05301   
                       THEN GO TO A100S;/*   30.01.85 CF NATOP        */05302   
                    WTBOR.BC            = WTFAC.CO , BY NAME ;          05303   
                    WTBOR.BC            = WTFAC.FA , BY NAME ;          05304   
                    WTBOR.BC            = WTFAC.RF , BY NAME ;          05305   
                    WTBOR.BC            = WTFAC.VA , BY NAME ;          05306   
                    IF WTFAC.POFIS = '4' ! WTFAC.POFIS = '6' !          05307   
                       WTFAC.POFIS = '8' ! WTFAC.POFIS = '9' THEN       05308   
                       WTBOR.TAXLI      = 0;                            05309   
                                        /*   ECRIT. FICH. FACT. COMPT.*/05310   
                    WRITE FILE (FEDITI) FROM (WTBOR) ;                  05311   
                    IF WTFAC.DEPCO = '10' THEN DO;                      05312   
                       WNBBSU           = WNBBSU + 1;                   05313   
                       END;             ELSE DO;                        05314   
                       MACFA.NBBOR      = MACFA.NBBOR + 1;              05315   
                       END;             /*   YOUPIE 01.09.87          */05316   
                    END;                /*   FIN FACTURE COMPTANT     */05317   
0      A100S:                                                           05318   
0          LIGNE              = ' ';                                    05319   
           LIGNE1.POLIC       = '00'X;  /*   GT15                     */05320   
           TAB.COEFF          = 1;      /*   RECHERCHE MTS A SIGNER - */05321   
           IF WTFAC.GNATO = '0D' THEN DO;                               05322   
                    IF WTFAC.NATOP = '12' ! WTFAC.NATOP = '15' THEN DO; 05323   
                       TAB.COEFF        = -1;                           05324   
                       WTFAC.NETLI      = WTFAC.NETLI * TAB.COEFF;      05325   
                       WTFAC.TAXLI      = WTFAC.TAXLI * TAB.COEFF;      05326   
                       WTFAC.FORLI      = WTFAC.FORLI * TAB.COEFF;      05327   
                       WTFAC.QUANT      = WTFAC.QUANT * TAB.COEFF;      05328   
                       /* BFA$ : DEBUT MODIF AJOUT NBTOM */             05329   
                       WTFAC.NBTOM      = WTFAC.NBTOM * TAB.COEFF;      05330   
                       /* BFA$ : FIN MODIF AJOUT NBTOM */               05331   
                       END;                                             05332   
                    END;                                                05333   
           /* BFA$ : DEBUT MODIF REMPLACER QUANT PAR NBTOM */           05334   
           /*XQUANT         = WTFAC.QUANT;*/                            05335   
           XQUANT         = WTFAC.NBTOM;/*   SVG QUANT                */05336   
           /* BFA$ : FIN MODIF REMPLACER QUANT PAR NBTOM */             05337   
0      A100B:                                                           05338   
0          IF WTFAC.EDIPA = '9' THEN GO TO A100I;                       05339   
0          IF WTFAC.TRIFA = '4' THEN DO;/*   LIGNES DE CLOTURE        */05340   
                                        /*   TYREF = 5  FRAIS         */05341   
                    IF WTFAC.TYREF      = '5' THEN GO TO A100E;         05342   
                    LIGNE1.NUART        = NUARTNUM;                     05343   
                    LIGNE1.REFLI        = WTFAC.REFLI;                  05344   
                    CALL MEF_REFLI;     /*   EDITION NATRE RET EDITEUR*/05345   
                    IF WTFAC.TYREF      = '3' THEN DO;                  05346   
                       IF WTFAC.QUANT   > 1   THEN DO;                  05347   
                         LIGNE1.PIPUB = WTFAC.PRIFA;                    05348   
                         /*     BFA$ */                                 05349   
                         LIGNE1.QUANT = XQUANT;                         05350   
                         END;          ELSE DO;                         05351   
                         XQUANT        = 0;                             05352   
                         END;          /*   FIN TEST QUANT SUP. 1    */ 05353   
                       END;             ELSE DO;                        05354   
                       LIGNE1.PIPUB     = WTFAC.PRIFA;                  05355   
                       IF WTFAC.EDIPA = '2' &                           05356   
                        ( WTFAC.REGFA = '2' ! WTCLI1.TYFAC = '6' !      05357   
                        ( WTFAC.FRAET = '2' & WREPRI = '1' ))           05358   
                          THEN DO;                                      05359   
                          PRIBBCHAR     = ' ';                          05360   
                          SVG_PRIBB     = WTFAC.PRIBB;                  05361   
                          END;          ELSE DO;                        05362   
                          LIGNE1.PRIBB  = WTFAC.PRIBB;                  05363   
                          END;                                          05364   
                       /*     BFA$ */                                   05365   
                       LIGNE1.QUANT     = XQUANT;                       05366   
                       LIGNE1.PUNHT     = WTFAC.PUNHT;                  05367   
                       CALL ECRLIGN;                                    05368   
                       END;             /*   FIN TEST TYREF 3         */05369   
                    LIGNE1.NETHT        = WTFAC.NETLI;                  05370   
                    RESAI.QUANT         = RESAI.QUANT + XQUANT;         05371   
                    CALL CALCUL;                                        05372   
                    CALL REPOIDS;                                       05373   
                    IF RECAP_BL         = 'OUI' THEN CALL STOCKAGE_BL;  05374   
                    IF WTFAC.IMPEC = '1' & WTFAC.EDIPA = '1' &          05375   
                       WTFAC.TRACO = '0' THEN DO;                       05376   
                       LIGNE1.ECHEA     = WTFAC.ECHEA;                  05377   
                       END;                                             05378   
                    IF NUCLI.COTAX= '1' THEN DO;                        05379   
                       LIGNE1.COTAX     = WTFAC.COTAX;                  05380   
                       END;                                             05381   
                    IF WTFAC.EDIPA= '2' THEN DO ;                       05382   
                       LIGNE2_VENET     = ' ';                          05383   
                       END;             /*   SUP. 09.10 VENETRED.EXPLO*/05384   
       A100E:                           /*   INIT. LIBELLES           */05385   
                                        /*   50 LIGNES CLOTURE MAXI   */05386   
                    /* ��� AJOUT LIBELLE EDITEUR   */                   05387   
          /* *      IF WTFAC.NUEDI ^= WS_NUEDI  THEN DO                 05388   
           * *         LIGNE_NUEDI.LIEDI  = WS_LIEDI                    05389   
           * *         TRIFA.LIGNE        = TRIFA.LIGNE + 1             05390   
           * *         TRIFA.IMP(TRIFA.LIGNE) = LIGNE                   05391   
           * *      END                                                 05392   
           * */                                                         05393   
                                                                        05394   
                    IF TRIFA.LIGNE      > 50 THEN TRIFA.LIGNE = 50;     05395   
                    LIBEL1.TITRE        = WTFAC.LIBTI;                  05396   
                    LIBEL1.AUTEUR       = WTFAC.LIBAU;                  05397   
                    IF WTFAC.LIBAU      = ' ' THEN DO;                  05398   
                       LIGNE1.LIBEL     = WTFAC.LIBTI;                  05399   
                       TRIFA.LIGNE      = TRIFA.LIGNE + 1;              05400   
                       TRIFA.IMP(TRIFA.LIGNE) = LIGNE;                  05401   
                       TRIFA.NUART(TRIFA.LIGNE)    = WTFAC.NUART ;      05402   
                       TRIFA.TYREF(TRIFA.LIGNE)    = WTFAC.TYREF ;      05403   
                       TRIFA.FRPOR(TRIFA.LIGNE)    = VENETRED.EXPLO;    05404   
                       TRIFA.EXPHA.MONTT(TRIFA.LIGNE) = WTFAC.NETLI ;   05405   
                       IF TOP_DEMA_FAC = 'O' THEN DO;                   05406   
                          TRIFA.LIBTI(TRIFA.LIGNE) = WTFAC.LIBTI ;      05407   
                          TRIFA.LIBAU(TRIFA.LIGNE) = WTFAC.LIBAU ;      05408   
                          TRIFA.NETTC(TRIFA.LIGNE) = WMONT       ;      05409   
                          TRIFA.FORLI(TRIFA.LIGNE) = WTFAC.FORLI ;      05410   
                          TRIFA.NETLI(TRIFA.LIGNE) = WTFAC.NETLI ;      05411   
                          END;                                          05412   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                05413   
                          TRIFA.LIBTI(TRIFA.LIGNE) = WTFAC.LIBTI ;      05414   
                          TRIFA.LIBAU(TRIFA.LIGNE) = WTFAC.LIBAU ;      05415   
                          TRIFA.NETTC(TRIFA.LIGNE) = WMONT       ;      05416   
                          TRIFA.FORLI(TRIFA.LIGNE) = WTFAC.FORLI ;      05417   
                          TRIFA.NETLI(TRIFA.LIGNE) = WTFAC.NETLI ;      05418   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                05419   
                       IF WTFAC.TYREF ^= '5'                            05420   
                        & WTFAC.EANNU ^= ' ' THEN DO;                   05421   
                          LIGNE         = ' ' ;                         05422   
                          LIGNE1.POLIC  = '00'X;                        05423   
                          LIGNE2_EANNU  = WTFAC.EANNU;                  05424   
                          TRIFA.LIGNE   = TRIFA.LIGNE + 1;              05425   
                          TRIFA.IMP(TRIFA.LIGNE) = LIGNE;               05426   
                          END;                                          05427   
                       GO TO A100G;                                     05428   
                       END;             /*   FIN TEST LIBAU BLANC     */05429   
                    IF LIBEL2.TITRE2= ' ' & LIBEL2.AUTOR2 = ' ' THEN DO;05430   
                                        /*   LIBELLE SUR UNE LIGNE    */05431   
                       LIBEL3.TITRE1    = LIBEL2.TITRE1;                05432   
                       LIBEL3.AUTOR1    = LIBEL2.AUTOR1;                05433   
                       LIGNE1.LIBEL     = ZLIBEL;                       05434   
                       TRIFA.LIGNE      = TRIFA.LIGNE + 1;              05435   
                       TRIFA.IMP(TRIFA.LIGNE) = LIGNE;                  05436   
                       TRIFA.NUART(TRIFA.LIGNE)    = WTFAC.NUART ;      05437   
                       TRIFA.TYREF(TRIFA.LIGNE)    = WTFAC.TYREF ;      05438   
                       TRIFA.FRPOR(TRIFA.LIGNE)    = VENETRED.EXPLO;    05439   
                       TRIFA.EXPHA.MONTT(TRIFA.LIGNE) = WTFAC.NETLI ;   05440   
                       IF TOP_DEMA_FAC = 'O' THEN DO;                   05441   
                          TRIFA.LIBTI(TRIFA.LIGNE) = WTFAC.LIBTI ;      05442   
                          TRIFA.LIBAU(TRIFA.LIGNE) = WTFAC.LIBAU ;      05443   
                          TRIFA.NETTC(TRIFA.LIGNE) = WMONT       ;      05444   
                          TRIFA.FORLI(TRIFA.LIGNE) = WTFAC.FORLI ;      05445   
                          TRIFA.NETLI(TRIFA.LIGNE) = WTFAC.NETLI ;      05446   
                          END;                                          05447   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                05448   
                          TRIFA.LIBTI(TRIFA.LIGNE) = WTFAC.LIBTI ;      05449   
                          TRIFA.LIBAU(TRIFA.LIGNE) = WTFAC.LIBAU ;      05450   
                          TRIFA.NETTC(TRIFA.LIGNE) = WMONT       ;      05451   
                          TRIFA.FORLI(TRIFA.LIGNE) = WTFAC.FORLI ;      05452   
                          TRIFA.NETLI(TRIFA.LIGNE) = WTFAC.NETLI ;      05453   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                05454   
                       IF WTFAC.TYREF ^= '5'                            05455   
                        & WTFAC.EANNU ^= ' ' THEN DO;                   05456   
                          LIGNE         = ' ' ;                         05457   
                          LIGNE1.POLIC  = '00'X;                        05458   
                          LIGNE2_EANNU  = WTFAC.EANNU;                  05459   
                          TRIFA.LIGNE   = TRIFA.LIGNE + 1;              05460   
                          TRIFA.IMP(TRIFA.LIGNE) = LIGNE;               05461   
                          END;                                          05462   
                       END;             ELSE DO;                        05463   
                                        /*   LIBELLE SUR DEUX LIGNES  */05464   
                       LIGNE1.LIBEL     = WTFAC.LIBTI;                  05465   
                       TRIFA.LIGNE      = TRIFA.LIGNE + 1;              05466   
                       TRIFA.IMP(TRIFA.LIGNE)      = LIGNE;             05467   
                       TRIFA.NUART(TRIFA.LIGNE)    = WTFAC.NUART ;      05468   
                       TRIFA.TYREF(TRIFA.LIGNE)    = WTFAC.TYREF ;      05469   
                       TRIFA.FRPOR(TRIFA.LIGNE)    = VENETRED.EXPLO;    05470   
                       TRIFA.EXPHA.MONTT(TRIFA.LIGNE) = WTFAC.NETLI ;   05471   
                       LIGNE            = ' ';                          05472   
                       LIGNE1.POLIC     = '00'X;                        05473   
                       LIGNE2_LIBAU     = WTFAC.LIBAU;                  05474   
                       LIGNE2_EANNU     = WTFAC.EANNU;                  05475   
                       TRIFA.LIGNE      = TRIFA.LIGNE + 1;              05476   
                       TRIFA.IMP(TRIFA.LIGNE) = LIGNE;                  05477   
                                         /* ON LAISSE TRIFA.NUART=BLAN*/05478   
                       IF TOP_DEMA_FAC = 'O' THEN DO;                   05479   
                          TRIFA.LIBTI(TRIFA.LIGNE) = WTFAC.LIBTI ;      05480   
                          TRIFA.LIBAU(TRIFA.LIGNE) = WTFAC.LIBAU ;      05481   
                          TRIFA.NETTC(TRIFA.LIGNE) = WMONT       ;      05482   
                          TRIFA.FORLI(TRIFA.LIGNE) = WTFAC.FORLI ;      05483   
                          TRIFA.NETLI(TRIFA.LIGNE) = WTFAC.NETLI ;      05484   
                          END;                                          05485   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                05486   
                          TRIFA.LIBTI(TRIFA.LIGNE) = WTFAC.LIBTI ;      05487   
                          TRIFA.LIBAU(TRIFA.LIGNE) = WTFAC.LIBAU ;      05488   
                          TRIFA.NETTC(TRIFA.LIGNE) = WMONT       ;      05489   
                          TRIFA.FORLI(TRIFA.LIGNE) = WTFAC.FORLI ;      05490   
                          TRIFA.NETLI(TRIFA.LIGNE) = WTFAC.NETLI ;      05491   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                05492   
                       END;             /*   FIN TEST SUR LIBELLE     */05493   
              GO TO A100G;                                              05494   
              END;                      /*   FIN TEST TRIFA 4         */05495   
0          IF SUM.LISUM = '1' THEN DO;  /*   LIGNES SUMMARIZABLES     */05496   
                                        /******************************/05497   
    IF WTFAC.TYREF      = '3' THEN DO;                                  05498   
       ZONCTL   = ' LISUM TYREF 3 NUART=' !! WTFAC.GS.NUART ;           05499   
       CALL MACMES3   (DESTI,'1',ZONCTL);                               05500   
    END;                                                                05501   
              IF COENR2 = '1' ! COENR2 = '4' !                          05502   
                 COENR2 = '6' THEN DO;  /*   NON COLIS                */05503   
                 IF COENR3 = '3' THEN DO;                               05504   
                    CALL REPOIDS;       /*   CALCUL DU POIDS          */05505   
                    CALL CALCUL;        /*   COMPOSANT ORDINAIRE SEUL */05506   
                    /*     BFA$ */                                      05507   
                    RESAI.QUANT         = RESAI.QUANT + XQUANT;         05508   
                    SUM.QUANT           = SUM.QUANT + XQUANT;           05509   
                    /*     BFA$ */                                      05510   
                    SUM.NETHT           = SUM.NETHT + WTFAC.NETLI;      05511   
                    SUM.TAXLI           = SUM.TAXLI + WTFAC.TAXLI;      05512   
                    SUM.FORHT           = SUM.FORHT + WTFAC.FORLI;      05513   
                    SUM.NBMVT           = SUM.NBMVT + 1 ;               05514   
                    IF WTFAC.TRACO  = '4' & WTFAC.EDIPA = '1' THEN      05515   
                    CALL CUM_NOMPOI ;                                   05516   
                    GO TO A100G;                                        05517   
                    END;                /*   FIN  ORDINAIRE           */05518   
                 END;                   /*   FIN  NON  COLIS          */05519   
              IF COENR2 = '2' ! COENR2 = '3' ! COENR2 = '5'             05520   
                 THEN DO;               /*   COLIS                    */05521   
                 IF COENR3 = '3' THEN DO;                               05522   
                                        /*   ENTETE COLIS HOMOGENE    */05523   
                    RESAI.QUANT         = RESAI.QUANT + XQUANT;         05524   
                    CALL CUECHEA;       /*   CUMUL QUANT. PAR ECHEA   */05525   
                    CALL REPOIDS;       /*   CALCUL DU POIDS          */05526   
                    COLIS.TETE          = '1';                          05527   
                    /*     BFA$ */                                      05528   
                    COLIS.QUANT         = XQUANT;                       05529   
                    COLIS.LIBTI         = WTFAC.LIBTI;                  05530   
                    COLIS.PINET         = WTFAC.PINET;                  05531   
                    COLIS.LIBAU         = WTFAC.LIBAU;                  05532   
                    COLIS.REFLI         = WTFAC.REFLI;                  05533   
                    COLIS.PUNHT         = WTFAC.PUNHT;                  05534   
                    COLIS.PRIBB         = WTFAC.PRIBB;                  05535   
                    COLIS.TYREF         = WTFAC.TYREF;                  05536   
                    COLIS.NUART         = NUARTNUM;                     05537   
                    COLIS.EANNU         = WTFAC.EANNU;                  05538   
                    IF WTFAC.TRACO  = '4' & WTFAC.EDIPA = '1' THEN      05539   
                    CALL CUM_NOMPOI ;                                   05540   
                    GO TO A100G;                                        05541   
                    END;                /*   FIN TETE COLIS HOMOGENE  */05542   
                 IF COENR3 = '5' THEN DO;                               05543   
                    XQUANT              = 0;                            05544   
                    CALL CALCUL;        /*   COMPOSANT ORDINAIRE      */05545   
                    COLIS.TETE          = '1';                          05546   
                    COLIS.NETHT         = COLIS.NETHT + WTFAC.NETLI;    05547   
                    COLIS.PIPUB         = COLIS.PIPUB +                 05548   
                                          ( WTFAC.QUANT * WTFAC.PRIFA );05549   
                    COLIS.TAXLI         = COLIS.TAXLI + WTFAC.TAXLI;    05550   
                    COLIS.FORHT         = COLIS.FORHT + WTFAC.FORLI;    05551   
                    GO TO A100G;                                        05552   
                    END;                /*   FIN  COLIS COMP ORDIN    */05553   
                 END;                   /*   FIN  TEST  COLIS         */05554   
              END ;                     /*   FIN TEST LISUM           */05555   
                                        /*   LIGNES NON SUMMARIZABLE  */05556   
0      A100I:                                                           05557   
 /* ==> DEBUT RECTIF 22 10 02 YDU/YHM ==============================> */05558   
 /* IF WTFAC.TYREF = '3' THEN DO;                                     */05559   
 /*    ZONCTL   = ' A100I TYREF 3 NUART=' !! WTFAC.GS.NUART ;         */05560   
 /*    CALL MACMES3   (DESTI,'1',ZONCTL);                             */05561   
 /* END;                                                              */05562   
 /* ====================================> FIN RECTIF 22 10 02 YDU/YHM */05563   
           CALL RECOENR;                /*   IDENTIFICAT. DU COENR    */05564   
           WNUART             = NUARTNUM;                               05565   
0      A100G:                           /*   TEST FACTURE PROFORMA    */05566   
           IF WTFAC.NATOP = '41' THEN GO TO A100DF;                     05567   
           IF WTFAC.TRIFA = '4' & WTFAC.TYREF = '5' THEN GO TO A100DF;  05568   
0          IF TAB.COEFF   = -1 THEN DO; /*   CAS DE LIGNE NEGATIVE    */05569   
                    WTFAC.NETLI         = WTFAC.NETLI * TAB.COEFF;      05570   
                    WTFAC.TAXLI         = WTFAC.TAXLI * TAB.COEFF;      05571   
                    WTFAC.FORLI         = WTFAC.FORLI * TAB.COEFF;      05572   
                    WTFAC.QUANT         = WTFAC.QUANT * TAB.COEFF;      05573   
                    /* BFA$ : DEBUT MODIF AJOUT NBTOM */                05574   
                    WTFAC.NBTOM         = WTFAC.NBTOM * TAB.COEFF;      05575   
                    /* BFA$ : FIN MODIF AJOUT NBTOM */                  05576   
                    END;                                                05577   
                                        /*   ECRITURE FICH. RESULTAT  */05578   
           /*--------------------------------------*/                   05579   
           /* � AJOUT LE 15 01 97   �$             */                   05580   
           /* �$AJOUT REFERENCE CLIENT CDE OFFICE  */                   05581   
           /*--------------------------------------*/                   05582   
           IF WS_RECO1_IDREFCO1    ^= ''                                05583   
              THEN DO;                                                  05584   
                   WTFAC.RECO1 = WS_RECO1_IDREFCO1;                     05585   
                   SVG_RECOM   = WTFAC.RECO1 !! WTFAC.MONTC ;           05586   
              END;                                                      05587   
                                        /* �FIN AJOUT 15 01 97   �$ */  05588   
                                                                        05589   
           WRESL              = WTFAC , BY NAME;                        05590   
           WRESL.LIBTI        = LIBTI_SVG;                              05591   
           WRESL.LIBAU        = LIBAU_SVG;                              05592   
           WRESL.RECO1        = SVG_RECOM;                              05593   
           WRESL.MONTC        = SUBSTR(SVG_RECOM,18,8);                 05594   
           SUBSTR(WRESL.RECO1,13,4)     = WTFAC.REPIE;                  05595   
           IF WTFAC.POFIS  = '4' ! WTFAC.POFIS = '6' ! WTFAC.POFIS = '8'05596   
              ! WTFAC.POFIS   = '9' THEN WRESL.TAXLI = 0 ;              05597   
           WRESL.RL.DOMOF     = WTCLI1.DOMOF;                           05598   
           WRESL.RL.CACLI     = WTCLI1.CACLI;                           05599   
           WRESL.RL.ARRON     = WTCLI1.ARRON;                           05600   
           WRESL.RL.BALAN     = '0'         ;                           05601   
           WRESL.RL.CAREM     = WTCLI1.CAREM;                           05602   
                                        /*  MODIF. GFC 22.03.86       */05603   
                                        /*  TRAST ==> FACTA           */05604   
                                        /*  CLISU ==> REF01           */05605   
                                        /*  CALIT ==> REF02           */05606   
                                        /*  CACLA ==> REF03           */05607   
           WRESL.RL.TRAST     = WTCLI1.FACTA;                           05608   
           WRESL.RL.CLISU     = WTCLI1.REF01;                           05609   
           WRESL.RL.CALIT     = WTCLI1.REF02;                           05610   
           WRESL.RL.CACLA     = WTCLI1.REF03;                           05611   
           WRESL.REFAD        = WTFAC.REFAD;                            05612   
           MACFA.NBRES        = MACFA.NBRES + 1;                        05613   
           WRITE FILE (FRESUL) FROM (WRESL);                            05614   
0          IF WTFAC.EDIPA = '9' THEN GO TO A100DF;                      05615   
0      A100H:                                                           05616   
           IF WTFAC.EDIPA = '2' THEN DO;/*   RECHERCHE IMPOSIT. ECHEAN*/05617   
                    IF WTFAC.IMPEC = '1' THEN                           05618   
                         FACT.IMPEC    = WTFAC.IMPEC;                   05619   
                    END;                                                05620   
           IF WTFAC.DEBOR = '1' THEN DO;/*   RECONN. DERNIER BORDEREAU*/05621   
                    IF WTFAC.ORPRO  = '1'  ! WTFAC.ORPRO = '2'  !       05622   
                     ( WTFAC.ORPRO  = '3'  &                            05623   
                      (WTFAC.NATOP  = '02' ! WTFAC.NATOP = '21' ))      05624   
                       THEN DO;         /*   PREFACTURATION           */05625   
                         LOREC.DEBOR   = WTFAC.DEBOR;                   05626   
                         LOREC.NUBOR   = WTFAC.NUBOR;                   05627   
                         LOREC.LOTIR   = WTFAC.LOTIR;                   05628   
                         LOREC.ZONTI   = WTFAC.ZONTI;                   05629   
                         LOREC.PREPA   = WTFAC.PREPA;                   05630   
                         LOREC.CABOT   = WTFAC.CABOT;                   05631   
                         LOREC.ZOGEO   = WTFAC.ZOGEO;                   05632   
                         LOREC.DIFOF   = WTFAC.DIFOF;                   05633   
                         LOREC.MOTRA   = WTFAC.MOTRA;                   05634   
                         LOREC.FRAET   = WTFAC.FRAET;                   05635   
                         LOREC.DEPAY   = WTFAC.DEPAY;                   05636   
                         LOREC.PRIOF   = SUBSTR(SVG_RECOM,1,1);         05637   
                         END;          /*   FIN TEST ORPRO 1,2        */05638   
                    END;               /*   FIN TEST DEBOR 1          */05639   
0      A100DF:                                                          05640   
0          IF IRAFAC =  10  THEN DO;    /*   TEST DE RUPTURE          */05641   
                    IF ZCOENR3 = '3' ! ZCOENR3 = '4' THEN DO;           05642   
                       IF ZCOENR2 = '2' ! ZCOENR2 = '3' !               05643   
                          ZCOENR2 = '5' THEN DO;                        05644   
                          IRAFAC  =  9 ;/*   SEPARATION DE DEUX COLIS */05645   
                          GO TO A090F;  /*   AYANT MEME NUART         */05646   
                          END;                                          05647   
                       END;                                             05648   
                    IF ZCOENR3 = '4' THEN DO;                           05649   
                       IF ZCOENR2 = '1' ! ZCOENR2 = '4' !               05650   
                          ZCOENR2 = '6' THEN DO;                        05651   
                          IRAFAC  =  9 ;/*   SEPARATION DE DEUX ATM   */05652   
                          GO TO A090F;  /*   AYANT MEME NUART CF DEMAT*/05653   
                          END;                                          05654   
                       END;                                             05655   
                    CALL SPLAFAC;       /*   APPEL SS PROG. LECTURE   */05656   
                    GO TO A100D;                                        05657   
                    END;                                                05658   
1                                       /*******************************05659   
                                        *    MODULE FINAL   NUART      *05660   
                                        *******************************/05661   
       A090F:                                                           05662   
           IF WTFAC.EDIPA = '9' THEN GO TO A090FF;                      05663   
           IF SUM.LISUM = '1' & COLIS.TETE = ' ' THEN GO TO A090FF;     05664   
                                        /*   GESTION ENTETE COLIS ATM */05665   
           IF TOP_DEMA_FAC = 'O' THEN DO;                               05666   
              IF SVG_DEMAT_COLIS.GS.NUFAC ^= '' THEN DO;                05667   
                 SVG_DEMAT_COLIS.NBCOM  = NBCOM_COLIS ;                 05668   
                 IF NBTAX_COLIS > 1                                     05669   
                    THEN SVG_DEMAT_COLIS.TYPRO = 'M' ;                  05670   
                    ELSE SVG_DEMAT_COLIS.TYPRO = 'C' ;                  05671   
                 WRITE FILE (FICDEMA) FROM (SVG_DEMAT_COLIS);           05672   
                 IF ^(SVG_DEMAT_COLIS.NETHT = 0.00 !                    05673   
                      SVG_DEMAT_COLIS.TXREM = 100.00 ) THEN DO;         05674   
                    DEMAT_QTTOT         = DEMAT_QTTOT +                 05675   
                                          SVG_DEMAT_COLIS.QTFAC ;       05676   
                    END;                                                05677   
                 CTR_LIG_DEMA           = CTR_LIG_DEMA + 1 ;            05678   
                 SVG_DEMAT_COLIS        = '' ;                          05679   
                 END;                                                   05680   
              IF SVG_DEMAT_ATM.GS.NUFAC ^= '' THEN DO;                  05681   
                 SVG_DEMAT_ATM.NBCOM    = NBCOM_ATM   ;                 05682   
                 WRITE FILE (FICDEMA) FROM (SVG_DEMAT_ATM);             05683   
                 IF ^(SVG_DEMAT_ATM.NETHT = 0.00 !                      05684   
                      SVG_DEMAT_ATM.TXREM = 100.00 ) THEN DO;           05685   
                    DEMAT_QTTOT         = DEMAT_QTTOT +                 05686   
                                          SVG_DEMAT_ATM.QTFAC ;         05687   
                    END;                                                05688   
                 CTR_LIG_DEMA           = CTR_LIG_DEMA + 1 ;            05689   
                 SVG_DEMAT_ATM          = '' ;                          05690   
                 END;                                                   05691   
              END;                                                      05692   
0 /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                05693   
              IF SVG_STO_D_COLIS.GS.NUFAC ^= '' THEN DO;                05694   
                 SVG_STO_D_COLIS.NBCOM  = NBCOM_COLIS_D ;               05695   
                 IF NBTAX_COLIS_D > 1                                   05696   
                    THEN SVG_STO_D_COLIS.TYPRO = 'M' ;                  05697   
                    ELSE SVG_STO_D_COLIS.TYPRO = 'C' ;                  05698   
              /* CTR_ENSEQ_D              = CTR_ENSEQ_D + 1             05699   
                 SVG_STO_D_COLIS.ID.ENSEQ = CTR_ENSEQ_D */              05700   
                 WRITE FILE (FICSTOD) FROM (SVG_STO_D_COLIS);           05701   
                 CTR_LIG_STOD           = CTR_LIG_STOD + 1 ;            05702   
                 IF ^(SVG_STO_D_COLIS.NETHT = 0.00 !                    05703   
                      SVG_STO_D_COLIS.TXREM = 100.00 ) THEN DO;         05704   
                    STO_D_QTTOT         = STO_D_QTTOT +                 05705   
                                          SVG_STO_D_COLIS.QTFAC ;       05706   
                    END;                                                05707   
                 SVG_STO_D_COLIS        = '' ;                          05708   
                 END;                                                   05709   
              IF SVG_STO_D_ATM.GS.NUFAC ^= '' THEN DO;                  05710   
                 SVG_STO_D_ATM.NBCOM    = NBCOM_ATM_D ;                 05711   
              /* CTR_ENSEQ_D            = CTR_ENSEQ_D + 1               05712   
                 SVG_STO_D_ATM.ID.ENSEQ = CTR_ENSEQ_D */                05713   
                 WRITE FILE (FICSTOD) FROM (SVG_STO_D_ATM);             05714   
                 CTR_LIG_STOD           = CTR_LIG_STOD + 1 ;            05715   
                 IF ^(SVG_STO_D_ATM.NETHT = 0.00 !                      05716   
                      SVG_STO_D_ATM.TXREM = 100.00 ) THEN DO;           05717   
                    STO_D_QTTOT         = STO_D_QTTOT +                 05718   
                                          SVG_STO_D_ATM.QTFAC ;         05719   
                    END;                                                05720   
                 SVG_STO_D_ATM          = '' ;                          05721   
                 END;                                                   05722   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                05723   
0          IF COENR2 = '2' ! COENR2 = '3' ! COENR2 = '5' THEN DO;       05724   
                                        /*   TEST  COLIS              */05725   
              IF COENR3 = '5' ! COENR3  = '7' THEN DO;                  05726   
                                        /*   ECRITURE TOTAL COLIS     */05727   
                    LIGNE               = ' ';                          05728   
                    LIGNE1.POLIC        = '00'X;                        05729   
                    IF COLIS.TETE = '1' THEN DO;                        05730   
                                        /*   EDITION SUMMAR. COLIS    */05731   
                       LIGNE1.NUART     = COLIS.NUART;                  05732   
                       LIGNE1.REFLI     = COLIS.REFLI;                  05733   
                       CALL MEF_REFLI;  /*   EDITION NATRE RET EDITEUR*/05734   
                       LIGNE1.QUANT     = COLIS.QUANT;                  05735   
                       LIGNE1.PIPUB     = COLIS.PIPUB;                  05736   
                       IF WTFAC.EDIPA = '2' &                           05737   
                        ( WTFAC.REGFA = '2' ! WTCLI1.TYFAC = '6' !      05738   
                        ( WTFAC.FRAET = '2' & WREPRI = '1' )) THEN DO;  05739   
                          PRIBBCHAR     = ' ';                          05740   
                          SVG_PRIBB     = COLIS.PRIBB;                  05741   
                          END;          ELSE DO;                        05742   
                          LIGNE1.PRIBB  = COLIS.PRIBB;                  05743   
                          END;                                          05744   
                       IF COLIS.PINET = '1' THEN DO;                    05745   
                          PRIBBCHAR     = (8)'*';                       05746   
                          SVG_PRIBB     = COLIS.PRIBB;                  05747   
                          END;                                          05748   
                       LIGNE1.PUNHT     = COLIS.PUNHT;                  05749   
                       LIGNE1.NETHT     = COLIS.NETHT;                  05750   
                       WTFAC.LIBAU      = COLIS.LIBAU;                  05751   
                       WTFAC.LIBTI      = COLIS.LIBTI;                  05752   
                       IF NUCLI.COTAX   = '1' THEN DO;                  05753   
                          LIGNE1.COTAX  = WTFAC.COTAX;                  05754   
                          END;                                          05755   
                       IF WTFAC.EDIPA = '1' & WTFAC.IMPEC = '1' &       05756   
                          WTFAC.TRACO = '0' THEN DO;                    05757   
                          LIGNE1.ECHEA  = WTFAC.ECHEA;                  05758   
                          END;                                          05759   
                       IF WTFAC.EDIPA = '2' THEN                        05760   
                          LIGNE2_VENET  = ' ' ;     /* SUPPR. 09.10   */05761   
                       CALL ECRLIGN;                                    05762   
                       IF WTCLI1.TYFAC  = '6' THEN DO;                  05763   
                          LIGNE1.PIPUB  = COLIS.PUNHT;                  05764   
                          END;                                          05765   
                       CALL DECODE_LIGNE ;/*  SUR 2 LIGNES PRIX A BLAN*/05766   
                                          /*  09.2007                 */05767   
                       CALL DECODE_LIGNE_D;                             05768   
                       CALL RECOENR;                                    05769   
                       IF TOP_DEMA_FAC = 'O' THEN DO;                   05770   
                          DEMAT_LIG.TYPRO = 'U' ;                       05771   
                          SVG_NUART       = COLIS.NUART ;               05772   
                          SVG_TYREF       = COLIS.TYREF ;               05773   
                          SVG_NUEDI       = '   ' ;                     05774   
                          SVG_NUDIV       = '  ' ;                      05775   
                          SVG_NUCOL       = '  ' ;                      05776   
                          DEMAT_LIG.QTPCO = 1 ;                         05777   
                          DEMAT_LIG.EAN13 = WTFAC.EANNU ;               05778   
                          NETTC           = COLIS.NETHT + COLIS.TAXLI;  05779   
                          DEMAT_LIG.MTREM = COLIS.FORHT - COLIS.NETHT;  05780   
                          IF (COLIS.FORHT - COLIS.NETHT) > 0            05781   
                             THEN DEMAT_LIG.SMTREM = '+' ;              05782   
                             ELSE DEMAT_LIG.SMTREM = '-' ;              05783   
                          DEMAT_LIG.NOAUT = COLIS.LIBAU ;               05784   
                          DEMAT_LIG.LIBTI = COLIS.LIBTI ;               05785   
                          TOP_DEMA_LEC    = 'O' ;                       05786   
                          TOP_DEMA_LIG    = 'O' ;                       05787   
                          CALL STEP_CHARGE      ;                       05788   
                          IF ^(DEMAT_LIG.NETHT = 0.00 !                 05789   
                               DEMAT_LIG.TXREM = 100.00 ) THEN DO;      05790   
                             DEMAT_QTTOT  = DEMAT_QTTOT +               05791   
                                            DEMAT_LIG.QTFAC ;           05792   
                             END;                                       05793   
                          END;                                          05794   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                05795   
                          STO_D_LIG.TYPRO = 'U' ;                       05796   
                          SVG_NUART       = COLIS.NUART ;               05797   
                          SVG_TYREF       = COLIS.TYREF ;               05798   
                          SVG_NUEDI       = '   ' ;                     05799   
                          SVG_NUDIV       = '  ' ;                      05800   
                          SVG_NUCOL       = '  ' ;                      05801   
                          STO_D_LIG.QTPCO = 1 ;                         05802   
                          STO_D_LIG.EAN13 = WTFAC.EANNU ;               05803   
                          NETTC           = COLIS.NETHT + COLIS.TAXLI;  05804   
                          STO_D_LIG.MTREM = COLIS.FORHT - COLIS.NETHT;  05805   
                          IF (COLIS.FORHT - COLIS.NETHT) > 0            05806   
                             THEN STO_D_LIG.SMTREM = '+' ;              05807   
                             ELSE STO_D_LIG.SMTREM = '-' ;              05808   
                          STO_D_LIG.NOAUT = COLIS.LIBAU ;               05809   
                          STO_D_LIG.LIBTI = COLIS.LIBTI ;               05810   
                          TOP_DEMA_LEC    = 'O' ;                       05811   
                          TOP_DEMA_LIG    = 'O' ;                       05812   
                          CALL STEP_CHARGE_D    ;                       05813   
                          IF ^(STO_D_LIG.NETHT = 0.00 !                 05814   
                               STO_D_LIG.TXREM = 100.00 ) THEN DO;      05815   
                             STO_D_QTTOT  = STO_D_QTTOT +               05816   
                                            STO_D_LIG.QTFAC ;           05817   
                             END;                                       05818   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                05819   
                       GO TO A090FF;                                    05820   
                       END;             /*   FIN EDITON COLIS SUMMAR. */05821   
                    END;                                                05822   
              END;                      /*   FIN  TEST  COLIS         */05823   
       A090FF:                                                          05824   
0          IF IRAFAC =  9  THEN DO;     /*   TEST DE RUPTURE          */05825   
                    CALL SPLAFAC;       /*   APPEL SS PROG. LECTURE   */05826   
                    GO TO A090D;                                        05827   
                    END;                                                05828   
1                                       /*******************************05829   
                                        *    MODULE FINAL   COND.VENTE *05830   
                                        *******************************/05831   
       A080F:                                                           05832   
0                                       /*   LIGNES SUMMARIZEES       */05833   
           IF WTFAC.EDIPA     = '9' THEN GO TO A080FF;                  05834   
           IF SUM.NBMVT       = 0 THEN GO TO A080FF;                    05835   
           LIGNE              = ' ';    /*   CONSTITUTION DE LA LIGNE */05836   
           LIGNE1.POLIC       = '00'X;                                  05837   
           LIGNE1.NETHT       = SUM.NETHT;                              05838   
           LIGNE1.PUNHT       = WTFAC.PUNHT;                            05839   
           IF WTFAC.TYREF = '3' THEN DO;/*   CAS TYREF 3              */05840   
              IF SUM.QUANT    > 1 THEN DO;                              05841   
                     LIGNE1.QUANT       = SUM.QUANT;                    05842   
                     END;     ELSE DO;                                  05843   
                     RESAI.QUANT        = RESAI.QUANT - SUM.QUANT;      05844   
                     XQUANT             = - SUM.QUANT;                  05845   
                     CALL CUECHEA;      /*   CUMUL QUANT. PAR ECHEA   */05846   
                     END;               /*   FIN TEST QUANT SUP. 1    */05847   
              END;            ELSE DO;                                  05848   
              LIGNE1.QUANT    = SUM.QUANT;                              05849   
              END;                      /*   FIN TEST TYREF 3         */05850   
           IF NUCLI.COTAX = '1' THEN DO;                                05851   
              LIGNE1.COTAX    = WTFAC.COTAX;                            05852   
              END;                                                      05853   
           IF WTFAC.EDIPA = '1' & WTFAC.IMPEC = '1' & WTFAC.TRACO = '0' 05854   
                    THEN LIGNE1.ECHEA = WTFAC.ECHEA;                    05855   
           IF COLIS.TETE      = '1' THEN DO;                            05856   
              LIGNE1.PIPUB    = COLIS.PIPUB;                            05857   
              END;                      ELSE DO;                        05858   
              LIGNE1.PIPUB    = WTFAC.PRIFA;                            05859   
              END;                                                      05860   
0          IF WTFAC.EDIPA = '2' THEN DO;                                05861   
              LIGNE2_VENET   = ' ';     /*   SUP. 09.10 VENETRED.EXPLO*/05862   
              IF WTFAC.REGFA = '2' ! WTCLI1.TYFAC = '6' !               05863   
               ( WTFAC.FRAET = '2' & WREPRI = '1' ) THEN DO;            05864   
                    PRIBBCHAR           = ' ';                          05865   
                    IF COLIS.TETE      = '1'                            05866   
                       THEN SVG_PRIBB  = COLIS.PRIBB;                   05867   
                       ELSE SVG_PRIBB  = WTFAC.PRIBB;                   05868   
                    END;                ELSE DO;                        05869   
                    IF COLIS.TETE      = '1'                            05870   
                       THEN DO ;                                        05871   
                       LIGNE1.PRIBB = COLIS.PRIBB;                      05872   
                       END;                                             05873   
                       ELSE DO ;                                        05874   
                       LIGNE1.PRIBB = WTFAC.PRIBB;                      05875   
                       END;                                             05876   
                    END;                /*   FIN TEST REGFA  TYCLI    */05877   
              END;                      ELSE DO;                        05878   
              IF COLIS.TETE  = '1' THEN DO;                             05879   
                 LIGNE1.PRIBB           = COLIS.PRIBB;                  05880   
                 END;                   ELSE DO;                        05881   
                 LIGNE1.PRIBB           = WTFAC.PRIBB;                  05882   
                 END;                                                   05883   
              END;                      /*   FIN TEST GIH             */05884   
           CALL ECRLIGN;                                                05885   
           IF SUM.NBMVT = 1 THEN DO;    /*   MVT SUMMARIZE UNIQUE     */05886   
              LIGNE1.NUART    = NUARTNUM;                               05887   
       A080FE:                                                          05888   
              IF TOP_DEMA_FAC = 'O' THEN DO;                            05889   
                 DEMAT_LIG.TYPRO = 'U' ;                                05890   
                 SVG_NUART       = WTFAC.NUART ;                        05891   
                 SVG_TYREF       = WTFAC.TYREF ;                        05892   
                 SVG_NUEDI       = WTFAC.NUEDI ;                        05893   
                 SVG_NUDIV       = WTFAC.NUDIV ;                        05894   
                 SVG_NUCOL       = WTFAC.NUCOL ;                        05895   
                 CALL DECODE_LIGNE ;                                    05896   
                 DEMAT_LIG.QTPCO = 1 ;                                  05897   
                 DEMAT_LIG.EAN13 = WTFAC.EANNU ;                        05898   
                 NETTC           = SUM.NETHT + SUM.TAXLI;               05899   
                 DEMAT_LIG.MTREM = SUM.FORHT - SUM.NETHT;               05900   
                 IF (SUM.FORHT - SUM.NETHT) > 0                         05901   
                    THEN DEMAT_LIG.SMTREM = '+' ;                       05902   
                    ELSE DEMAT_LIG.SMTREM = '-' ;                       05903   
                 DEMAT_LIG.GS.NULIG = DEMAT_LIG.GS.NULIG + 1;           05904   
                 DEMAT_LIG.ID.NULIG = DEMAT_LIG.ID.NULIG + 1;           05905   
                 SVG_NULIG          = DEMAT_LIG.ID.NULIG    ;           05906   
                 DEMAT_LIG.NOAUT = WTFAC.LIBAU  ;                       05907   
                 DEMAT_LIG.LIBTI = WTFAC.LIBTI  ;                       05908   
                 TOP_DEMA_LEC             = 'O' ;                       05909   
                 TOP_DEMA_LIG             = 'O' ;                       05910   
                 CALL STEP_CHARGE               ;                       05911   
                 IF ^(DEMAT_LIG.NETHT = 0.00 !                          05912   
                      DEMAT_LIG.TXREM = 100.00 ) THEN DO;               05913   
                    DEMAT_QTTOT           = DEMAT_QTTOT +               05914   
                                            DEMAT_LIG.QTFAC ;           05915   
                    END;                                                05916   
                 END;                                                   05917   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                05918   
                 STO_D_LIG.TYPRO = 'U' ;                                05919   
                 SVG_NUART       = WTFAC.NUART ;                        05920   
                 SVG_TYREF       = WTFAC.TYREF ;                        05921   
                 SVG_NUEDI       = WTFAC.NUEDI ;                        05922   
                 SVG_NUDIV       = WTFAC.NUDIV ;                        05923   
                 SVG_NUCOL       = WTFAC.NUCOL ;                        05924   
                 CALL DECODE_LIGNE_D ;                                  05925   
                 STO_D_LIG.QTPCO = 1 ;                                  05926   
                 STO_D_LIG.EAN13 = WTFAC.EANNU ;                        05927   
                 NETTC           = SUM.NETHT + SUM.TAXLI;               05928   
                 STO_D_LIG.MTREM = SUM.FORHT - SUM.NETHT;               05929   
                 IF (SUM.FORHT - SUM.NETHT) > 0                         05930   
                    THEN STO_D_LIG.SMTREM = '+' ;                       05931   
                    ELSE STO_D_LIG.SMTREM = '-' ;                       05932   
                 STO_D_LIG.GS.NULIG = STO_D_LIG.GS.NULIG + 1;           05933   
                 STO_D_LIG.NOAUT = WTFAC.LIBAU  ;                       05934   
                 STO_D_LIG.LIBTI = WTFAC.LIBTI  ;                       05935   
                 TOP_DEMA_LEC             = 'O' ;                       05936   
                 TOP_DEMA_LIG             = 'O' ;                       05937   
                 CALL STEP_CHARGE_D             ;                       05938   
                 IF ^(STO_D_LIG.NETHT = 0.00 !                          05939   
                      STO_D_LIG.TXREM = 100.00 ) THEN DO;               05940   
                    STO_D_QTTOT           = STO_D_QTTOT +               05941   
                                            STO_D_LIG.QTFAC ;           05942   
                    END;                                                05943   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                05944   
              EDIT_EAN        = WTFAC.EANNU;                            05945   
              CALL EDLIBTI;             /*   EDITION LIBTI LIBAU      */05946   
              GO TO A080FF;                                             05947   
              END;                      /*   FIN MVT SUMMARIZE UNIQUE */05948   
0                                       /*   MVTS SUMMARIZES MULTIPLES*/05949   
           IF SUM.LICOL = ' ' & SUM.LIDIV = ' ' THEN GO TO A080FE;      05950   
                                        /*   LIBEL COLLECTION EXISTE  */05951   
           LIBEL3.TITRE1      = SUM.LICOL;                              05952   
           LIBEL3.AUTOR1      = SUM.LIDIV;                              05953   
           LIGNE1.LIBEL       = ZLIBEL;                                 05954   
           IF WTFAC.EANNU ^= ' ' THEN DO;                               05955   
              IF FACT.LIGNE   > NLMAX_2 THEN CALL ENTCDL;               05956   
              END;                      ELSE DO;                        05957   
              IF FACT.LIGNE   > NLMAX_1 THEN CALL ENTCDL;               05958   
              END;                                                      05959   
           FACT.LIGNE         = FACT.LIGNE + 1;                         05960   
           STRING(ZSPOOLP_SVG)= LIGNE;                                  05961   
           IF ACCORD_OUI_NON = 'OUI' THEN CALL STOCKAGE_ACCORD;         05962   
           IF RECAP_BL       = 'OUI' THEN CALL STOCKAGE_BL    ;         05963   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            05964   
                    TOP_DEMA_ECR = 'O' ;                                05965   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            05966   
           CALL ECRITUR;                                                05967   
           IF TOP_DEMA_FAC = 'O' THEN DO;                               05968   
              DEMAT_LIG.TYPRO = 'U' ;                                   05969   
              SVG_NUART       = WTFAC.NUART ;                           05970   
              SVG_TYREF       = WTFAC.TYREF ;                           05971   
              SVG_NUEDI       = WTFAC.NUEDI ;                           05972   
              SVG_NUDIV       = WTFAC.NUDIV ;                           05973   
              SVG_NUCOL       = WTFAC.NUCOL ;                           05974   
              CALL DECODE_LIGNE ;                                       05975   
              DEMAT_LIG.QTPCO = 1 ;                                     05976   
              NETTC           = SUM.NETHT + SUM.TAXLI;                  05977   
              DEMAT_LIG.MTREM = SUM.FORHT - SUM.NETHT;                  05978   
              IF (SUM.FORHT - SUM.NETHT) > 0                            05979   
                 THEN DEMAT_LIG.SMTREM = '+' ;                          05980   
                 ELSE DEMAT_LIG.SMTREM = '-' ;                          05981   
              DEMAT_LIG.GS.NULIG = DEMAT_LIG.GS.NULIG + 1;              05982   
              DEMAT_LIG.ID.NULIG = DEMAT_LIG.ID.NULIG + 1;              05983   
              SVG_NULIG          = DEMAT_LIG.ID.NULIG    ;              05984   
              DEMAT_LIG.NOAUT = SUM.LIDIV ;                             05985   
              DEMAT_LIG.LIBTI = SUM.LICOL ;                             05986   
              TOP_DEMA_LEC                = 'O' ;                       05987   
              TOP_DEMA_LIG                = 'O' ;                       05988   
              CALL STEP_CHARGE                  ;                       05989   
              IF ^(DEMAT_LIG.NETHT = 0.00 !                             05990   
                   DEMAT_LIG.TXREM = 100.00 ) THEN DO;                  05991   
                 DEMAT_QTTOT  = DEMAT_QTTOT +                           05992   
                                DEMAT_LIG.QTFAC ;                       05993   
                 END;                                                   05994   
              END;                                                      05995   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                05996   
              STO_D_LIG.TYPRO = 'U' ;                                   05997   
              SVG_NUART       = WTFAC.NUART ;                           05998   
              SVG_TYREF       = WTFAC.TYREF ;                           05999   
              SVG_NUEDI       = WTFAC.NUEDI ;                           06000   
              SVG_NUDIV       = WTFAC.NUDIV ;                           06001   
              SVG_NUCOL       = WTFAC.NUCOL ;                           06002   
              CALL DECODE_LIGNE_D ;                                     06003   
              STO_D_LIG.QTPCO = 1 ;                                     06004   
              NETTC           = SUM.NETHT + SUM.TAXLI;                  06005   
              STO_D_LIG.MTREM = SUM.FORHT - SUM.NETHT;                  06006   
              IF (SUM.FORHT - SUM.NETHT) > 0                            06007   
                 THEN STO_D_LIG.SMTREM = '+' ;                          06008   
                 ELSE STO_D_LIG.SMTREM = '-' ;                          06009   
              STO_D_LIG.GS.NULIG = STO_D_LIG.GS.NULIG + 1;              06010   
              STO_D_LIG.NOAUT = SUM.LIDIV ;                             06011   
              STO_D_LIG.LIBTI = SUM.LICOL ;                             06012   
              TOP_DEMA_LEC                = 'O' ;                       06013   
              TOP_DEMA_LIG                = 'O' ;                       06014   
              CALL STEP_CHARGE_D                ;                       06015   
              IF ^(STO_D_LIG.NETHT = 0.00 !                             06016   
                   STO_D_LIG.TXREM = 100.00 ) THEN DO;                  06017   
                 STO_D_QTTOT  = STO_D_QTTOT +                           06018   
                                STO_D_LIG.QTFAC ;                       06019   
                 END;                                                   06020   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                06021   
0      A080FF:                                                          06022   
           IF IRAFAC =  8  THEN DO;     /*   TEST DE RUPTURE          */06023   
                    CALL SPLAFAC;       /*   APPEL SS PROG. LECTURE   */06024   
                    GO TO A080D;                                        06025   
                    END;                                                06026   
1                                       /*******************************06027   
                                        *    MODULE FINAL   COLLECTION *06028   
                                        *******************************/06029   
       A070F:                                                           06030   
0          IF IRAFAC =  7  THEN DO;     /*   TEST DE RUPTURE          */06031   
                    CALL SPLAFAC;       /*   APPEL SS PROG. LECTURE   */06032   
                    GO TO A070D;                                        06033   
                    END;                                                06034   
1                                       /*******************************06035   
                                        *    MODULE FINAL   RESAI      *06036   
                                        *******************************/06037   
       A060F:                                                           06038   
           LOREC.QUANT        = LOREC.QUANT + RESAI.QUANT;              06039   
                                        /*   EDIT. JOURNAL FACTURA.   */06040   
           IF WTFAC.DEPCO = '10' THEN DO;/*  CODE ETAT 470 SUCCES     */06041   
              WJOUR.ID.CODET = ' 470';                                  06042   
              WJOUR.GS.CODET = ' 470';                                  06043   
              WJOUF.ID.CODET = ' 470';                                  06044   
              WJOUF.GS.CODET = ' 470';                                  06045   
              END;           ELSE DO ;                                  06046   
              WJOUR.ID.CODET = ' 471';  /*   CODE ETAT  471 NORMAL    */06047   
              WJOUR.GS.CODET = ' 471';                                  06048   
              WJOUF.ID.CODET = ' 471';                                  06049   
              WJOUF.GS.CODET = ' 471';                                  06050   
              IF WTFAC.TRACO = '0' & WTFAC.DEPCO = '17'                 06051   
                                   & WTGCO.CECOM = '710' THEN DO;       06052   
                 WJOUR.ID.CODET = ' 475';/*   CODE ETAT  475 GHI      */06053   
                 WJOUR.GS.CODET = ' 475';                               06054   
                 WJOUF.ID.CODET = ' 475';                               06055   
                 WJOUF.GS.CODET = ' 475';                               06056   
                 END;                                                   06057   
              IF NUCLI_HMD = 'O' THEN DO;                               06058   
                 WJOUR.ID.CODET = ' 476';/*   CODE ETAT  476 HMD      */06059   
                 WJOUR.GS.CODET = ' 476';                               06060   
                 WJOUF.ID.CODET = ' 476';                               06061   
                 WJOUF.GS.CODET = ' 476';                               06062   
                 END;                                                   06063   
              END;                                                      06064   
           WJOUR.JR           = WTFAC.CO , BY NAME;                     06065   
           WJOUR.JR           = WTFAC.FA , BY NAME;                     06066   
           WJOUR.JR           = WTFAC.RF , BY NAME;                     06067   
           WJOUR.JR           = WTFAC.RS , BY NAME;                     06068   
           WJOUR.JR           = WTFAC.VA , BY NAME;                     06069   
           WJOUR.GS.QUANT     = RESAI.QUANT;                            06070   
           WJOUR.ID.EDIPA     = WTFAC.GS.EDIPA;                         06071   
           WJOUR.ID.MACOM     = WTFAC.GS.MACOM;                         06072   
           IF WTFAC.GS.MACOM  = '001'                                   06073   
              THEN WJOUR.ID.CADOR  = WTFAC.GS.CADOR;                    06074   
              ELSE WJOUR.ID.CADOR  = ' ';                               06075   
           IF WTFAC.GS.CATLI  = ' ' ! WTFAC.GS.CATLI = '5'              06076   
              THEN WJOUR.ID.LINOU  = '1';                               06077   
              ELSE WJOUR.ID.LINOU  = '2';                               06078   
           WJOUR.ID.GNAT1     = WTFAC.GS.GNAT1;                         06079   
           WJOUR.ID.GNATO     = WTFAC.GS.GNATO;                         06080   
           WJOUR.ID.TRACO     = WTFAC.GS.TRACO;                         06081   
           WJOUR.ID.TRIFA     = WTFACRED.ID.TRIFA;                      06082   
           WJOUR.ID.NORUN     = WTFACRED.ID.NORUN;                      06083   
           WJOUR.ID.LOREC     = WTFACRED.ID.LOREC;                      06084   
           WJOUR.ID.ANNEE     = WTFACRED.ID.ANNEE;                      06085   
           WJOUR.ID.RUN       = WTFACRED.ID.RUN  ;                      06086   
           WJOUR.ID.ORIGI     = WTFACRED.ID.ORIGI;                      06087   
           WJOUR.ID.NUMRO     = WTFACRED.ID.NUMRO;                      06088   
           WJOUR.ID.DAMAA     = SUBSTR(WTFACRED.ID.DAMIS,1,2);          06089   
           WJOUR.ID.DAMMM     = SUBSTR(WTFACRED.ID.DAMIS,3,2);          06090   
           WJOUR.ID.DAMJJ     = SUBSTR(WTFACRED.ID.DAMIS,5,2);          06091   
           WRITE FILE (FEDITI) FROM (WJOUR);                            06092   
                                                                        06093   
           IF WTFAC.DEPCO = '10' THEN DO;                               06094   
              WNBJSU          = WNBJSU + 1;                             06095   
              END;            ELSE DO;                                  06096   
              SELECT (WJOUR.ID.CODET);                                  06097   
                   WHEN (' 475')  DO;                                   06098   
                        WNBJGH       = WNBJGH + 1;                      06099   
                        END;                                            06100   
                   WHEN (' 476')  DO;                                   06101   
                        WNBJMD       = WNBJMD + 1; /* MVTS JOURNAL HMD*/06102   
                        END;                                            06103   
                   OTHERWISE      DO;                                   06104   
                        MACFA.NBJOU  = MACFA.NBJOU + 1;                 06105   
                   END;                                                 06106   
                 END;                                                   06107   
              END;                                                      06108   
0      A060FF:                                                          06109   
           IF IRAFAC =  6  THEN DO;     /*   TEST DE RUPTURE          */06110   
                    CALL SPLAFAC;       /*   APPEL SS PROG. LECTURE   */06111   
                    GO TO A060D;                                        06112   
                    END;                                                06113   
1                                       /*******************************06114   
                                        *    MODULE FINAL   DAMIS LOREC*06115   
                                        *******************************/06116   
       A050F:                                                           06117   
           FACT.POIDS         = FACT.POIDS + LOREC.POIDS;               06118   
           FACT.PDFAC         = FACT.PDFAC + LOREC.PDFAC;               06119   
           TTLOREC            = ' ';                                    06120   
           TTLOREC1.POLIC     = '00'X;                                  06121   
           FACT.QUANT         = FACT.QUANT + LOREC.QUANT;               06122   
           TTLOREC1.QUANT     = LOREC.QUANT;                            06123   
           LC_BORD.QUANT      = LOREC.QUANT;                            06124   
           IF WTFAC.EDIPA     = '9' THEN GO TO A050FF;                  06125   
           IF WTFAC.TRIFA     = '4' THEN GO TO A050FF;                  06126   
                                        /*   NON EDITION SI GIH       */06127   
           IF WTFAC.ORPRO     = '3' THEN GO TO A050FP;                  06128   
                                        /*   PB ORPRO 5 6 ET DEBOR 1  */06129   
           IF LOREC.DEBOR    ^= '1' THEN GO TO A050FP;                  06130   
                                        /*   BORDEREAU MAXI NON TROUVE*/06131   
           IF WTFAC.ORPRO = '1' THEN DO;/*   SI FOURNITURES RASSORT   */06132   
                    GO TO A050FP;       /*   NON ED. TTLOREC1 28.11.85*/06133   
                    END;                /*   FIN TEST ORPRO 1         */06134   
           IF WTFAC.ORPRO = '2' THEN DO;/*   SI FOURNITURES OFFICE    */06135   
                                        /*   NON ED. TTLOREC2 28.11.85*/06136   
                    END;                ELSE DO;                        06137   
                    GO TO A050FF;       /*   PB ORPRO 5 6 ET DEBOR 1  */06138   
                    END;                                                06139   
0      A050FP:                                                          06140   
           IF FACT.LIGNE       > NLMAX_2 THEN CALL ENTCDL;              06141   
           TTLOREC1.FIL2 = 'TOTAL ';                                    06142   
           IF LOREC.NUBOR ^= 0 THEN DO;                                 06143   
                    TTLOREC1.NUBOR = LOREC.NUBOR;                       06144   
                    LC_BORD.NUBOR  = LOREC.NUBOR;                       06145   
                    TTLOREC1.FIL3  = '  BORD ';                         06146   
                    TTLOREC1.MINI  = ' 1 ';                             06147   
                    TTLOREC1.FIL4  = 'A';                               06148   
                    LC_BORD.FIL03  = 'BORD 1 A ';                       06149   
                    IF LOREC.NUBOR = 1  THEN DO;                        06150   
                             TTLOREC1.FIL4  = ' ';                      06151   
                             TTLOREC1.NUBOR = 0 ;                       06152   
                             LC_BORD.FIL03  = 'BORD ';                  06153   
                             LC_BORD.NUBOR  = 0 ;                       06154   
                             END;       /*   FIN TEST NUBOR 1         */06155   
                    END;                /*   FIN TEST NUBOR 0         */06156   
           IF WTFAC.GNATO = '0F' THEN DO;                               06157   
                    IF WTFAC.FRANC ^= '0'                               06158   
                            THEN TTLOREC1.FRANC    = 'ENVOI FRANCO  ';  06159   
                    END;                /*   FIN  TEST  GNATO         */06160   
           STRING(ZSPOOLP_SVG) = TTLOREC;                               06161   
           FACT.LIGNE          = FACT.LIGNE + 1;                        06162   
    /*-- ------------------------------------------------- --*/         06163   
    /*-- AJOUT SMARTIN 23/12/2004 FACT. DEMATERIALISEES -- --*/         06164   
    /*-- ------------------------------------------------- --*/         06165   
           IF TOP_DEMA_FAC = 'O' THEN DO;                               06166   
              CTR_LIG_COM           = CTR_LIG_COM + 1 ;                 06167   
              IF CTR_LIG_COM < 51 THEN DO;                              06168   
                 DEMAT_COM.ID.ENSEQ = DEMAT_COM.ID.ENSEQ + 1 ;          06169   
                 DEMAT_COM.GS.TYPCO = 'SUR'                  ;          06170   
                 DEMAT_COM.GS.ZOCOM = TTLOREC1.FIL2 !! TTLOREC1.QUANT !!06171   
                                      TTLOREC1.FIL3 !! TTLOREC1.MINI  !!06172   
                                      TTLOREC1.FIL4 !! TTLOREC1.NUBOR ; 06173   
                 WRITE FILE(FICDEMA) FROM(DEMAT_COM)         ;          06174   
                 CTR_LIG_DEMA       = CTR_LIG_DEMA + 1       ;          06175   
                 END;               ELSE DO;                            06176   
                 LOG_COM.ZOCOM      = TTLOREC1.FIL2 !! TTLOREC1.QUANT !!06177   
                                      TTLOREC1.FIL3 !! TTLOREC1.MINI  !!06178   
                                      TTLOREC1.FIL4 !! TTLOREC1.NUBOR ; 06179   
                 WRITE FILE(FICLCOM) FROM(LOG_COM)           ;          06180   
                 NB_FICLCOM         = NB_FICLCOM + 1         ;          06181   
                 END                                         ;          06182   
              END;                                                      06183   
    /*-- ------------------------------------------------- --*/         06184   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                06185   
              CTR_STO_COM           = CTR_STO_COM + 1 ;                 06186   
              IF CTR_STO_COM < 51 THEN DO;                              06187   
                 STO_D_COM.GS.TYPCO = 'SUR'                  ;          06188   
                 STO_D_COM.GS.ZOCOM = TTLOREC1.FIL2 !! TTLOREC1.QUANT !!06189   
                                      TTLOREC1.FIL3 !! TTLOREC1.MINI  !!06190   
                                      TTLOREC1.FIL4 !! TTLOREC1.NUBOR ; 06191   
                 CTR_ENSEQ_D        = CTR_ENSEQ_D + 1 ;                 06192   
                 STO_D_COM.ID.ENSEQ = CTR_ENSEQ_D   ;                   06193   
                 WRITE FILE(FICSTOD) FROM(STO_D_COM)         ;          06194   
                 CTR_LIG_STOD       = CTR_LIG_STOD + 1       ;          06195   
                 END;                                                   06196   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                06197   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            06198   
                    TOP_DEMA_ECR = 'N' ;                                06199   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            06200   
           CALL ECRITUR;                                                06201   
0      A050FF:                                                          06202   
                                         /*   EDITION RECAP BL        */06203   
          DO I_BL_NUBOR = 0 TO 999 ;     /*   VIDAGE BL-TAB DS BL_LIG */06204   
             IF BL_TAB.NETTC (I_BL_NUBOR) ^= 0 THEN DO;                 06205   
                I_BL_LIG    = I_BL_LIG + 1 ;                            06206   
                IF I_BL_LIG > 3000 THEN DO;                             06207   
                   ZONCTL   = '*** ARRET DU TRAITEMENT ***' ;           06208   
                   CALL MACMES3 (DESTI,'4',ZONCTL);                     06209   
                   ZONCTL   = '    NUCLI=' !! WTFAC.GS.NUCLI !!         06210   
                              ' + 3000 LIGNES POUR RECAP BL ' ;         06211   
                   CALL MACMES3 (DESTI,'1',ZONCTL);                     06212   
                   SIGNAL ERROR;                                        06213   
                   END;                                                 06214   
                BL_LIG.NORUN(I_BL_LIG)   = WTFAC.GS.NORUN  ;            06215   
                BL_LIG.LOREC(I_BL_LIG)   = WTFAC.GS.LOREC  ;            06216   
                BL_LIG.NUBOR(I_BL_LIG)   = BL_TAB.NUBOR(I_BL_NUBOR);    06217   
                BL_LIG.NETHT(I_BL_LIG)   = BL_TAB.NETHT(I_BL_NUBOR);    06218   
                BL_LIG.NETTC(I_BL_LIG)   = BL_TAB.NETTC(I_BL_NUBOR);    06219   
                BL_LIG.TAXES(I_BL_LIG)   = BL_TAB.TAXES(I_BL_NUBOR);    06220   
                END;                                                    06221   
             END;                                                       06222   
-                                       /* AJOUT 22 10 02 YDU/YHM PCF */06223   
                                        /* GENERATION INDEX BL        */06224   
           IF PCF_FACTUR = 'O' & WTFAC.EDIPA ^= '9'                     06225   
     /*    & ^(TOP_DEMA_FAC = 'O' & MOD_DEMA  = 'D' )  */               06226   
                                        /*   PCF QUELQUE SOIT DEMAT   */06227   
              THEN DO ;                                                 06228   
              PIN_INDEX = '' ;                                          06229   
              PIN_NUCLI = WTFAC.GS.NUCLI ;                              06230   
              PIN_RUNFA = ENTET70.NORUN ;                               06231   
              PIN_NUFAC = ENTET70.REFFA ;                               06232   
              PIN_DAFACDIMA = '20' !! ENTET70.DAT10.AA ;                06233   
              PIN_DAFACDIMM = ENTET70.DAT10.MM ;                        06234   
              PIN_DAFACDIMJ = ENTET70.DAT10.JJ ;                        06235   
              PIN_NORUN  = WTFAC.GS.NORUN ;                             06236   
              WS1_IILOREXP = WTFAC.GS.LOREC ;                           06237   
              PIN_IILOREXP = WS1_IILOREXP ;                             06238   
              WRITE FILE (IDDPCFIN) FROM (PIN_INDEX) ;                  06239   
              NB_IDDPCFIN = NB_IDDPCFIN + 1;                            06240   
              IF ^(WTCLI1.CLIFA = ' ' ! WTCLI1.CLIFA = '000000')        06241   
               & WTCLI1.NBFAC   > 0                                     06242   
               & EDIT_FACTU     = 'O'                                   06243   
               & ^(WTFAC.GS.TRACO = '2' & WTFAC.GS.DEPCO = '16')        06244   
               & ^(WTFAC.GS.TRACO = '2' & WTFAC.GS.DEPCO = '12')        06245   
               & ^(WTCLI1.TYCOM   = '4' ! WTCLI1.TYCOM   = '6' )        06246   
                 THEN DO ;                                              06247   
                 PIN_NUCLI   = WTCLI1.CLIFA ;                           06248   
                 WRITE FILE (IDDPCFIN) FROM (PIN_INDEX) ;               06249   
                 NB_IDDPCFIN = NB_IDDPCFIN + 1;                         06250   
              END ;                                                     06251   
           END ;                                                        06252   
                                                                        06253   
           IF IRAFAC =  5  THEN DO;     /*   TEST DE RUPTURE          */06254   
                    CALL SPLAFAC;       /*   APPEL SS PROG. LECTURE   */06255   
                    GO TO A050D;                                        06256   
                    END;                                                06257   
1                                       /*******************************06258   
                                        *    MODULE FINAL   TRIFA      *06259   
                                        *******************************/06260   
       A040F:                                                           06261   
           IF WTFAC.EDIPA     = '9' THEN GO TO A040FF;                  06262   
           IF WTFAC.TRIFA     = '4' THEN DO;                            06263   
                                        /*   EDITION LIGNES DE CLOTURE*/06264   
              WMONT           = FACT.LIGNE + TRIFA.LIGNE + 1;           06265   
              IF WMONT        > NLMAX_1 THEN DO;                        06266   
                 CALL ENTCDL;                                           06267   
                 END;         ELSE DO;                                  06268   
                 ZSPOOLP_SVG  = '' ;    /*   ECRITURE 1 LIGNE A BLANC */06269   
                 ZSPOOLP_SVG.POLIC      = '00'X;                        06270   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            06271   
                    TOP_DEMA_ECR = 'N' ;                                06272   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            06273   
                 CALL ECRITUR;                                          06274   
                 FACT.LIGNE   = FACT.LIGNE + 1;                         06275   
                 END;                                                   06276   
              DO ITRIFA = 1 TO TRIFA.LIGNE;                             06277   
                 FACT.LIGNE   = FACT.LIGNE + 1;                         06278   
                 IF FACT.LIGNE > NLMAX_1 THEN CALL ENTCDL;              06279   
                 STRING(ZSPOOLP_SVG)    = TRIFA.IMP(ITRIFA);            06280   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            06281   
                    TOP_DEMA_ECR = 'N' ;                                06282   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            06283   
                 CALL ECRITUR;                                          06284   
                 IF TOP_DEMA_FAC = 'O' THEN DO;                         06285   
                    LIGNE           = TRIFA.IMP(ITRIFA);                06286   
                    IF LIGNE1.POLIC ^= '00'X THEN DO;                   06287   
                       DEMAT_LIG.TYPRO    = 'U' ;                       06288   
                       SVG_NUART          = WTFAC.NUART ;               06289   
                       SVG_TYREF          = WTFAC.TYREF ;               06290   
                       SVG_NUEDI          = WTFAC.NUEDI ;               06291   
                       SVG_NUDIV          = WTFAC.NUDIV ;               06292   
                       SVG_NUCOL          = WTFAC.NUCOL ;               06293   
                       CALL DECODE_LIGNE ;                              06294   
                       DEMAT_LIG.QTPCO    = 1 ;                         06295   
                       NETTC              = TRIFA.NETTC(ITRIFA) ;       06296   
                       DEMAT_LIG.MTREM    = TRIFA.FORLI(ITRIFA) -       06297   
                                            TRIFA.NETLI(ITRIFA) ;       06298   
                       IF (TRIFA.FORLI(ITRIFA) -                        06299   
                           TRIFA.NETLI(ITRIFA) ) >  0                   06300   
                          THEN DEMAT_LIG.SMTREM = '+' ;                 06301   
                          ELSE DEMAT_LIG.SMTREM = '-' ;                 06302   
                       DEMAT_LIG.GS.NULIG = DEMAT_LIG.GS.NULIG + 1 ;    06303   
                       DEMAT_LIG.ID.NULIG = DEMAT_LIG.ID.NULIG + 1 ;    06304   
                       SVG_NULIG          = DEMAT_LIG.ID.NULIG    ;     06305   
                       DEMAT_LIG.NOAUT    = TRIFA.LIBAU(ITRIFA) ;       06306   
                       DEMAT_LIG.LIBTI    = TRIFA.LIBTI(ITRIFA) ;       06307   
                       TOP_DEMA_LEC       = 'O' ;                       06308   
                       TOP_DEMA_LIG       = 'O' ;                       06309   
                       CALL STEP_CHARGE         ;                       06310   
                       IF ^(DEMAT_LIG.NETHT = 0.00 !                    06311   
                            DEMAT_LIG.TXREM = 100.00 ) THEN DO;         06312   
                          DEMAT_QTTOT     = DEMAT_QTTOT +               06313   
                                            DEMAT_LIG.QTFAC ;           06314   
                          END;                                          06315   
                       END;                                             06316   
                    END;                                                06317   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                06318   
                    LIGNE           = TRIFA.IMP(ITRIFA);                06319   
                    IF LIGNE1.POLIC ^= '00'X THEN DO;                   06320   
                       STO_D_LIG.TYPRO    = 'U' ;                       06321   
                       SVG_NUART          = WTFAC.NUART ;               06322   
                       SVG_TYREF          = WTFAC.TYREF ;               06323   
                       SVG_NUEDI          = WTFAC.NUEDI ;               06324   
                       SVG_NUDIV          = WTFAC.NUDIV ;               06325   
                       SVG_NUCOL          = WTFAC.NUCOL ;               06326   
                       CALL DECODE_LIGNE_D ;                            06327   
                       STO_D_LIG.QTPCO    = 1 ;                         06328   
                       NETTC              = TRIFA.NETTC(ITRIFA) ;       06329   
                       STO_D_LIG.MTREM    = TRIFA.FORLI(ITRIFA) -       06330   
                                            TRIFA.NETLI(ITRIFA) ;       06331   
                       IF (TRIFA.FORLI(ITRIFA) -                        06332   
                           TRIFA.NETLI(ITRIFA) ) >  0                   06333   
                          THEN STO_D_LIG.SMTREM = '+' ;                 06334   
                          ELSE STO_D_LIG.SMTREM = '-' ;                 06335   
                       STO_D_LIG.GS.NULIG = STO_D_LIG.GS.NULIG + 1 ;    06336   
                       STO_D_LIG.NOAUT    = TRIFA.LIBAU(ITRIFA) ;       06337   
                       STO_D_LIG.LIBTI    = TRIFA.LIBTI(ITRIFA) ;       06338   
                       TOP_DEMA_LEC       = 'O' ;                       06339   
                       TOP_DEMA_LIG       = 'O' ;                       06340   
                       CALL STEP_CHARGE_D       ;                       06341   
                       IF ^(STO_D_LIG.NETHT = 0.00 !                    06342   
                            STO_D_LIG.TXREM = 100.00 ) THEN DO;         06343   
                          STO_D_QTTOT     = STO_D_QTTOT +               06344   
                                            STO_D_LIG.QTFAC ;           06345   
                          END;                                          06346   
                       END;                                             06347   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                06348   
                 END;                   /*   FIN  BOUCLE  DO          */06349   
              END;                      /*   FIN EDIT. LIGNES CLOTURE */06350   
0      A040FF:                                                          06351   
           IF IRAFAC =  4  THEN DO;     /*   TEST DE RUPTURE          */06352   
                    CALL SPLAFAC;       /*   APPEL SS PROG. LECTURE   */06353   
                    GO TO A040D;                                        06354   
                    END;                                                06355   
1                                       /*******************************06356   
                                        *    MODULE FINAL   FACTURE    *06357   
                                        *******************************/06358   
       A030E:                                                           06359   
        /* PUT SKIP LIST ('ETIQ   A030E:')    */                        06360   
           /*************************************** */                  06361   
           /*   ECRITURE DES LIGNES FORHT ET NETHT  */                  06362   
           /*   PAR CODE ACCORD SUR LA FACTURE      */                  06363   
           /*   ECRITURE DANS FICHIER HISTO. ACCORD */                  06364   
           /*************************************** */                  06365   
                                                                        06366   
                                        /*   RECHERCHE INFO FOB    */   06367   
                                        /*   POUR EDITION MONTANT  */   06368   
           IF WTFAC.EDIPA    = '2'      /*   HORS PRO FORMA        */   06369   
            & WTFAC.GNATO   ^= '41' THEN DO;                            06370   
              W_FRAET = WTFAC.FRAET;                                    06371   
              W_DEPAY = WTFAC.DEPAY;                                    06372   
              W_SPENV = WTFAC.SPENV;                                    06373   
              W_ECFAC = WTFAC.ECFAC;                                    06374   
                                                                        06375   
              SPIPA          = '';        /*   TABLE TAUX FOB  */       06376   
              SPIPA.FONCT    = 'RP';                                    06377   
              SPIFI.FNAME    = 'SPI2TAB';                               06378   
              SPIPA.COTAB    = 'CDLTXFOB';                              06379   
              SPIPA.REFPO    = STRING(W_CLEFOB);                        06380   
              SPIPA.OPERA    = '='    ;                                 06381   
              CALL SPI2TBV(SPIPA,CDLTXFOB,SPIFI);                       06382   
              IF SPIPA.CORET = '00' THEN DO;                            06383   
                 SELECT (WTFAC.SPENV) ;                                 06384   
                    WHEN ('01') DO ;     /*   PORT PAYE - FRAIS PORT  */06385   
                       ASS_FOB       = FACT.NETHT - FACT.MTVEN(8) ;     06386   
                       END;                                             06387   
                    WHEN ('02') DO ;     /*   PORT DU  NETHT          */06388   
                       ASS_FOB       = FACT.NETHT ;                     06389   
                       END;                                             06390   
                    OTHERWISE DO ;                                      06391   
                       ASS_FOB       = FACT.NETHT ;                     06392   
                       ZONCTL        = 'ATTENTION ' !!                  06393   
                                       ' NUCLI=' !! WTFAC.NUCLI !!      06394   
                                       ' FACT.=' !! WNUFAC      !!      06395   
                                       ' SPENV=' !! WTFAC.SPENV !!      06396   
                                       ' DIFF 01,02 VALEUR FOB' !!      06397   
                                       ' FORCEE AU NETHT ' ;            06398   
                       CALL MACMES3 (DESTI,'1',ZONCTL);                 06399   
                       END;                                             06400   
                    END;                                                06401   
                 W_FOBFF     = (CDLTXFOB.TX1_TXFOB * ASS_FOB) ;         06402   
                 F15D4       = DIVIDE (W_FOBFF,CENT,15,4) ;             06403   
                 W_FOBFF     = ASS_FOB + F15D4 + 0.005;                 06404   
                 IF FACT.LIGNE + 2   > NLMAX THEN CALL ENTCDL;          06405   
                 LIGNE               = '';                              06406   
                 LIGNE1.POLIC        = '00'X;                           06407   
                 STRING(ZSPOOLP_SVG) = LIGNE;                           06408   
                 FACT.LIGNE          = FACT.LIGNE + 1;                  06409   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            06410   
                    TOP_DEMA_ECR = 'N' ;                                06411   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            06412   
                 CALL ECRITUR;                                          06413   
                 LIGNE               = '';                              06414   
                 LIGNE1.POLIC        = '00'X;                           06415   
                 LIGNE1.LIBEL        = 'VALEUR FOB';                    06416   
                 LIGNE1.NETHT        = W_FOBFF;                         06417   
                 STRING(ZSPOOLP_SVG) = LIGNE;                           06418   
                 FACT.LIGNE          = FACT.LIGNE + 1;                  06419   
                 CALL ECRITUR;                                          06420   
              END;                                                      06421   
           END;                                                         06422   
          IF EDIT_FACTU ^= 'N' THEN /* MODIF ANJARD 10/98 : RECALCULER*/06423   
             CALL RECALCUL_TVA_FAC; /* LA TVA A PARTIR DU PIED FACTURE*/06424   
                                                                        06425   
          IF ACCORD_OUI_NON = 'OUI' &                                   06426   
             WTFAC.EDIPA   ^= '9' THEN DO;                              06427   
            IF WS_ACC.AUT_NETHT ^= 0 THEN                               06428   
                               NB_LIGNE_ACC = NB_LIGNE_ACC + 1;         06429   
            NB_LIGNE_ACC = NB_LIGNE_ACC + 11; /* CONSTANTE LIGNE CADRE*/06430   
            IF FACT.LIGNE + NB_LIGNE_ACC > NLMAX_1 THEN CALL ENTCDL;    06431   
                                         /*   YDU 07.08 +11 ET NON +12*/06432   
            FACT.LIGNE    = FACT.LIGNE + 11;                            06433   
                                                                        06434   
         /* IF FACT.LIGNE + NB_LIGNE_ACC > NLMAX_1 THEN CALL ENTCDL */  06435   
            TOTAL14        = ' ';                                       06436   
         /* FINFAC3.FIL01  = ((175)'-')  YDV*/                          06437   
            IF WTFAC.EDIPA = '2'                                        06438   
               THEN FINFAC3.FIL01  = ((119)'-');                        06439   
               ELSE FINFAC3.FIL01  = ((119)'-');                        06440   
            STRING(ZSPOOLP_SVG) = TOTAL14;                              06441   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            06442   
                    TOP_DEMA_ECR = 'N' ;                                06443   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            06444   
            CALL ECRITUR;                           /* LIGNE TIRET */   06445   
            STRING(ZSPOOLP_SVG) = STRING(CDRE_ACC1);                    06446   
            CALL ECRITUR;                       /* HAUT ENTETE CADRE */ 06447   
            STRING(ZSPOOLP_SVG) = STRING(CDRE_ACC2);                    06448   
            CALL ECRITUR;                         /* N� FOUR... */      06449   
            STRING(ZSPOOLP_SVG) = STRING(CDRE_ACC4);                    06450   
            CALL ECRITUR;                         /* TRAIT VERTIC. */   06451   
            STRING(ZSPOOLP_SVG) = STRING(CDRE_ACC3);                    06452   
            CALL ECRITUR;                         /* BAS ENTETE CADRE */06453   
                                                                        06454   
              /* INITIALISATION LIGNE TOTAL GENERAL */                  06455   
            WS_ACC.TOT_FORTC =  WS_ACC.AUT_FORTC;                       06456   
            WS_ACC.TOT_FORHT =  WS_ACC.AUT_FORHT;                       06457   
            WS_ACC.TOT_NETTC =  WS_ACC.AUT_NETTC;                       06458   
            WS_ACC.TOT_NETHT =  WS_ACC.AUT_NETHT;                       06459   
                                                                        06460   
            /*-- FACT DEMAT SMARTIN 30/12/2004     --*/                 06461   
            IF TOP_DEMA_FAC = 'O'                                       06462   
              THEN DO ;                                                 06463   
              CTR_LIG_COM           = CTR_LIG_COM + 1 ;                 06464   
              IF CTR_LIG_COM < 51                                       06465   
                THEN DO ;                                               06466   
             /* DEMAT_COM.ID.NULIG  = DEMAT_COM.ID.NULIG + 1 */         06467   
                DEMAT_COM.ID.ENSEQ  = DEMAT_COM.ID.ENSEQ + 1 ;          06468   
                DEMAT_COM.GS.TYPCO  = 'SUR'                  ;          06469   
                DEMAT_COM.GS.ZOCOM  = ''                     ;          06470   
                DEMAT_COM.GS.ZOCOM  = STRING(LA_ENT)         ;          06471   
                WRITE FILE(FICDEMA) FROM(DEMAT_COM)          ;          06472   
                CTR_LIG_DEMA        = CTR_LIG_DEMA + 1       ;          06473   
                END                                          ;          06474   
                ELSE DO                                      ;          06475   
                LOG_COM.ZOCOM       = ''                     ;          06476   
                LOG_COM.ZOCOM       = STRING(LA_ENT)         ;          06477   
                WRITE FILE(FICLCOM) FROM(LOG_COM)            ;          06478   
                NB_FICLCOM          = NB_FICLCOM + 1         ;          06479   
                END                                          ;          06480   
            END ;                                                       06481   
            /*-- FACT DEMAT FIN     30/12/2004     --*/                 06482   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                06483   
              CTR_STO_COM           = CTR_STO_COM + 1 ;                 06484   
              IF CTR_STO_COM < 51                                       06485   
                THEN DO ;                                               06486   
                STO_D_COM.GS.TYPCO  = 'SUR'                  ;          06487   
                STO_D_COM.GS.ZOCOM  = ''                     ;          06488   
                STO_D_COM.GS.ZOCOM  = STRING(LA_ENT)         ;          06489   
                CTR_ENSEQ_D         = CTR_ENSEQ_D + 1 ;                 06490   
                STO_D_COM.ID.ENSEQ  = CTR_ENSEQ_D   ;                   06491   
                WRITE FILE(FICSTOD) FROM(STO_D_COM)          ;          06492   
                CTR_LIG_STOD        = CTR_LIG_STOD + 1       ;          06493   
                END                                          ;          06494   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                06495   
                                                                        06496   
              /* ECRITURE LIGNE PAR CODE ACCORD   */                    06497   
            DO I = 1 TO MAX_ACCORD                                      06498   
                        WHILE (ACC1.CODE(I) ^= '');                     06499   
              LIGNE = ' ';                                              06500   
              LIGNE_ACC.TIRET = '-';                                    06501   
              LIGNE_ACC.C_ACCORD = ACC1.CODE(I);                        06502   
              LIGNE_ACC.FORTC = ACC1.FORTC(I);                          06503   
              LIGNE_ACC.FORHT = ACC1.FORHT(I);                          06504   
              LIGNE_ACC.NETTC = ACC1.NETTC(I);                          06505   
              LIGNE_ACC.NETHT = ACC1.NETHT(I);                          06506   
                /* CUMUL LIGNE TOTAL GENERAL POUR EDITION */            06507   
              WS_ACC.TOT_FORTC =  WS_ACC.TOT_FORTC + ACC1.FORTC(I);     06508   
              WS_ACC.TOT_FORHT =  WS_ACC.TOT_FORHT + ACC1.FORHT(I);     06509   
              WS_ACC.TOT_NETTC =  WS_ACC.TOT_NETTC + ACC1.NETTC(I);     06510   
              WS_ACC.TOT_NETHT =  WS_ACC.TOT_NETHT + ACC1.NETHT(I);     06511   
                                                                        06512   
                /* GESTION DU LIBELLE ACCORD */                         06513   
              SPIPA.FONCT = 'RP';                                       06514   
              SPIPA.COTAB = 'CDLACCL';                                  06515   
              SPIPA.OPERA = '=';                                        06516   
              SPIPA.REFPO = ACC1.CODE(I);                               06517   
              CALL SPI2TBV (SPIPA,TLACCORD,SPIFI);                      06518   
              IF SPIPA.CORET ^= '00' THEN  LIGNE_ACC.LIBEL = '';        06519   
              ELSE LIGNE_ACC.LIBEL = TLACCORD.LIBACL;                   06520   
                                                                        06521   
              /* ECRITURE LIGNE ACCORD SUR FACTURE   */                 06522   
              IF FACT.LIGNE       > NLMAX_1 THEN CALL ENTCDL;           06523   
              FACT.LIGNE          = FACT.LIGNE + 1;                     06524   
              STRING(ZSPOOLP_SVG) = LIGNE ;                             06525   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            06526   
                    TOP_DEMA_ECR = 'N' ;                                06527   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            06528   
              CALL ECRITUR;                                             06529   
              STRING(ZSPOOLP_SVG) = STRING(CDRE_ACC4);/* TRAIT VERT.*/  06530   
              CALL ECRITUR;                                             06531   
                                                                        06532   
            /*-- FACT DEMAT SMARTIN 30/12/2004     --*/                 06533   
              IF TOP_DEMA_FAC   = 'O'                                   06534   
                THEN DO                               ;                 06535   
                  LA_DET.ACCORD     = ACC1.CODE(I)    ;                 06536   
                  LA_DET.LIBEL      = LIGNE_ACC.LIBEL ;                 06537   
                  LA_DET.FORTC      = ACC1.FORTC(I)   ;                 06538   
                  LA_DET.FORHT      = ACC1.FORHT(I)   ;                 06539   
                  LA_DET.NETTC      = ACC1.NETTC(I)   ;                 06540   
                  LA_DET.NETHT      = ACC1.NETHT(I)   ;                 06541   
                  CTR_LIG_COM       = CTR_LIG_COM + 1 ;                 06542   
                  IF CTR_LIG_COM < 51                                   06543   
                    THEN DO ;                                           06544   
                 /* DEMAT_COM.ID.NULIG  = DEMAT_COM.ID.NULIG + 1 */     06545   
                    DEMAT_COM.ID.ENSEQ  = DEMAT_COM.ID.ENSEQ + 1 ;      06546   
                    DEMAT_COM.GS.TYPCO  = 'SUR'                  ;      06547   
                    DEMAT_COM.GS.ZOCOM  = ''                     ;      06548   
                    DEMAT_COM.GS.ZOCOM  = STRING(LA_DET)         ;      06549   
                    WRITE FILE(FICDEMA) FROM(DEMAT_COM)          ;      06550   
                    CTR_LIG_DEMA        = CTR_LIG_DEMA + 1       ;      06551   
                  END                                            ;      06552   
                  ELSE DO                                        ;      06553   
                    LOG_COM.ZOCOM       = ''                     ;      06554   
                    LOG_COM.ZOCOM       = STRING(LA_DET)         ;      06555   
                    WRITE FILE(FICLCOM) FROM(LOG_COM)            ;      06556   
                    NB_FICLCOM          = NB_FICLCOM + 1         ;      06557   
                  END                                            ;      06558   
              END                                                ;      06559   
            /*-- FACT DEMAT FIN     30/12/2004     --*/                 06560   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                06561   
                  LA_DET.ACCORD     = ACC1.CODE(I)    ;                 06562   
                  LA_DET.LIBEL      = LIGNE_ACC.LIBEL ;                 06563   
                  LA_DET.FORTC      = ACC1.FORTC(I)   ;                 06564   
                  LA_DET.FORHT      = ACC1.FORHT(I)   ;                 06565   
                  LA_DET.NETTC      = ACC1.NETTC(I)   ;                 06566   
                  LA_DET.NETHT      = ACC1.NETHT(I)   ;                 06567   
                  CTR_STO_COM       = CTR_STO_COM + 1 ;                 06568   
                  IF CTR_STO_COM < 51                                   06569   
                    THEN DO ;                                           06570   
                    STO_D_COM.GS.TYPCO  = 'SUR'                  ;      06571   
                    STO_D_COM.GS.ZOCOM  = ''                     ;      06572   
                    STO_D_COM.GS.ZOCOM  = STRING(LA_DET)         ;      06573   
                    CTR_ENSEQ_D         = CTR_ENSEQ_D + 1        ;      06574   
                    STO_D_COM.ID.ENSEQ  = CTR_ENSEQ_D            ;      06575   
                    WRITE FILE(FICSTOD) FROM(STO_D_COM)          ;      06576   
                    CTR_LIG_STOD        = CTR_LIG_STOD + 1       ;      06577   
                  END                                            ;      06578   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                06579   
              /* ECRITURE TABLEAU ACCORD DANS LE FICHIER  ACCORD */     06580   
              FHACC.ACCOR =  ACC1.CODE(I);                              06581   
              FHACC.FORTC =  ACC1.FORTC(I);                             06582   
              FHACC.FORHT =  ACC1.FORHT(I);                             06583   
              FHACC.NETTC =  ACC1.NETTC(I);                             06584   
              FHACC.NETHT =  ACC1.NETHT(I);                             06585   
              WRITE FILE (FHISTO) FROM (FHACC);                         06586   
              NB_ACC_HISTO = NB_ACC_HISTO + 1;                          06587   
              END; /* FIN TANT QUE TABLEAU ACCORD NON VIDE */           06588   
                                                                        06589   
              /* ECRITURE LIGNE PRODUIT AUTRE  */                       06590   
            IF WS_ACC.AUT_NETHT ^= 0 THEN DO;                           06591   
              LIGNE = ' ';                                              06592   
              LIGNE_ACC.TIRET = '-';                                    06593   
              LIGNE_ACC.C_ACCORD   = '';                                06594   
              LIGNE_ACC.FORTC = WS_ACC.AUT_FORTC;                       06595   
              LIGNE_ACC.FORHT = WS_ACC.AUT_FORHT;                       06596   
              LIGNE_ACC.NETTC = WS_ACC.AUT_NETTC;                       06597   
              LIGNE_ACC.NETHT = WS_ACC.AUT_NETHT;                       06598   
              LIGNE_ACC.LIBEL = 'AUTRES';                               06599   
                                                                        06600   
              /* ECRITURE LIGNE PRODUIT AUTRE SUR FACTURE   */          06601   
              IF FACT.LIGNE       > NLMAX_1 THEN CALL ENTCDL;           06602   
              FACT.LIGNE          = FACT.LIGNE + 1;                     06603   
              STRING(ZSPOOLP_SVG) = LIGNE ;                             06604   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            06605   
                    TOP_DEMA_ECR = 'N' ;                                06606   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            06607   
              CALL ECRITUR;                                             06608   
              STRING(ZSPOOLP_SVG) = STRING(CDRE_ACC4);/* TRAIT VERT.*/  06609   
              CALL ECRITUR;                                             06610   
                                                                        06611   
            /*-- FACT DEMAT SMARTIN 30/12/2004     --*/                 06612   
              IF TOP_DEMA_FAC   = 'O'                                   06613   
                THEN DO                                  ;              06614   
                  LA_DET.ACCORD     = ''                 ;              06615   
                  LA_DET.LIBEL      = ''                 ;              06616   
                  LA_DET.LIBEL      = 'AUTRES '          ;              06617   
                  LA_DET.FORTC      = WS_ACC.AUT_FORTC   ;              06618   
                  LA_DET.FORHT      = WS_ACC.AUT_FORHT   ;              06619   
                  LA_DET.NETTC      = WS_ACC.AUT_NETTC   ;              06620   
                  LA_DET.NETHT      = WS_ACC.AUT_NETHT   ;              06621   
                  CTR_LIG_COM       = CTR_LIG_COM + 1    ;              06622   
                  IF CTR_LIG_COM < 51                                   06623   
                    THEN DO ;                                           06624   
                 /* DEMAT_COM.ID.NULIG  = DEMAT_COM.ID.NULIG + 1 */     06625   
                    DEMAT_COM.ID.ENSEQ  = DEMAT_COM.ID.ENSEQ + 1 ;      06626   
                    DEMAT_COM.GS.TYPCO  = 'SUR'                  ;      06627   
                    DEMAT_COM.GS.ZOCOM  = ''                     ;      06628   
                    DEMAT_COM.GS.ZOCOM  = STRING(LA_DET)         ;      06629   
                    WRITE FILE(FICDEMA) FROM(DEMAT_COM)          ;      06630   
                    CTR_LIG_DEMA        = CTR_LIG_DEMA + 1       ;      06631   
                  END                                            ;      06632   
                  ELSE DO                                        ;      06633   
                    LOG_COM.ZOCOM       = ''                     ;      06634   
                    LOG_COM.ZOCOM       = STRING(LA_DET)         ;      06635   
                    WRITE FILE(FICLCOM) FROM(LOG_COM)            ;      06636   
                    NB_FICLCOM          = NB_FICLCOM + 1         ;      06637   
                  END                                            ;      06638   
              END                                                ;      06639   
            /*-- FACT DEMAT FIN     30/12/2004     --*/                 06640   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                06641   
                  LA_DET.ACCORD     = ''                 ;              06642   
                  LA_DET.LIBEL      = ''                 ;              06643   
                  LA_DET.LIBEL      = 'AUTRES '          ;              06644   
                  LA_DET.FORTC      = WS_ACC.AUT_FORTC   ;              06645   
                  LA_DET.FORHT      = WS_ACC.AUT_FORHT   ;              06646   
                  LA_DET.NETTC      = WS_ACC.AUT_NETTC   ;              06647   
                  LA_DET.NETHT      = WS_ACC.AUT_NETHT   ;              06648   
                  CTR_STO_COM       = CTR_STO_COM + 1 ;                 06649   
                  IF CTR_STO_COM < 51                                   06650   
                    THEN DO ;                                           06651   
                    STO_D_COM.GS.TYPCO  = 'SUR'                  ;      06652   
                    STO_D_COM.GS.ZOCOM  = ''                     ;      06653   
                    STO_D_COM.GS.ZOCOM  = STRING(LA_DET)         ;      06654   
                    CTR_ENSEQ_D         = CTR_ENSEQ_D + 1        ;      06655   
                    STO_D_COM.ID.ENSEQ  = CTR_ENSEQ_D            ;      06656   
                    WRITE FILE(FICSTOD) FROM(STO_D_COM)          ;      06657   
                    CTR_LIG_STOD        = CTR_LIG_STOD + 1       ;      06658   
                  END                                            ;      06659   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                06660   
              /* ECRITURE DANS LE FICHIER HISTORIQUE ACCORD */          06661   
              FHACC.ACCOR =  'AUTRES';                                  06662   
              FHACC.FORTC =  WS_ACC.AUT_FORTC;                          06663   
              FHACC.FORHT =  WS_ACC.AUT_FORHT;                          06664   
              FHACC.NETTC =  WS_ACC.AUT_NETTC;                          06665   
              FHACC.NETHT =  WS_ACC.AUT_NETHT;                          06666   
              WRITE FILE (FHISTO) FROM (FHACC);                         06667   
              NB_ACC_HISTO = NB_ACC_HISTO + 1;                          06668   
              END; /* FIN SI PRODUIT AUTRE PRESENT */                   06669   
                                                                        06670   
                 /* ECRITURE LIGNE TOTAL GENERAL  */                    06671   
            /*-- FACT DEMAT SMARTIN 30/12/2004     --*/                 06672   
              IF TOP_DEMA_FAC   = 'O'                                   06673   
                THEN DO                                    ;            06674   
                  LA_DET.ACCORD     = ''                   ;            06675   
                  LA_DET.LIBEL      = ''                   ;            06676   
                  LA_DET.LIBEL      = 'TOT HORS FR EXPED'  ;            06677   
                  LA_DET.FORTC      = WS_ACC.TOT_FORTC     ;            06678   
                  LA_DET.FORHT      = WS_ACC.TOT_FORHT     ;            06679   
                  LA_DET.NETTC      = WS_ACC.TOT_NETTC     ;            06680   
                  LA_DET.NETHT      = WS_ACC.TOT_NETHT     ;            06681   
                  CTR_LIG_COM       = CTR_LIG_COM + 1      ;            06682   
                  IF CTR_LIG_COM < 51                                   06683   
                    THEN DO ;                                           06684   
                 /* DEMAT_COM.ID.NULIG  = DEMAT_COM.ID.NULIG + 1 */     06685   
                    DEMAT_COM.ID.ENSEQ  = DEMAT_COM.ID.ENSEQ + 1 ;      06686   
                    DEMAT_COM.GS.TYPCO  = 'SUR'                  ;      06687   
                    DEMAT_COM.GS.ZOCOM  = ''                     ;      06688   
                    DEMAT_COM.GS.ZOCOM  = STRING(LA_DET)         ;      06689   
                    WRITE FILE(FICDEMA) FROM(DEMAT_COM)          ;      06690   
                    CTR_LIG_DEMA        = CTR_LIG_DEMA + 1       ;      06691   
                  END                                            ;      06692   
                  ELSE DO                                        ;      06693   
                    LOG_COM.ZOCOM       = ''                     ;      06694   
                    LOG_COM.ZOCOM       = STRING(LA_DET)         ;      06695   
                    WRITE FILE(FICLCOM) FROM(LOG_COM)            ;      06696   
                    NB_FICLCOM          = NB_FICLCOM + 1         ;      06697   
                  END                                            ;      06698   
              END                                                ;      06699   
            /*-- FACT DEMAT FIN     30/12/2004     --*/                 06700   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                06701   
                  LA_DET.ACCORD     = ''                   ;            06702   
                  LA_DET.LIBEL      = ''                   ;            06703   
                  LA_DET.LIBEL      = 'TOT HORS FR EXPED'  ;            06704   
                  LA_DET.FORTC      = WS_ACC.TOT_FORTC     ;            06705   
                  LA_DET.FORHT      = WS_ACC.TOT_FORHT     ;            06706   
                  LA_DET.NETTC      = WS_ACC.TOT_NETTC     ;            06707   
                  LA_DET.NETHT      = WS_ACC.TOT_NETHT     ;            06708   
                  CTR_STO_COM       = CTR_STO_COM + 1 ;                 06709   
                  IF CTR_STO_COM < 51                                   06710   
                    THEN DO ;                                           06711   
                    STO_D_COM.GS.TYPCO  = 'SUR'                  ;      06712   
                    STO_D_COM.GS.ZOCOM  = ''                     ;      06713   
                    STO_D_COM.GS.ZOCOM  = STRING(LA_DET)         ;      06714   
                    CTR_ENSEQ_D         = CTR_ENSEQ_D + 1        ;      06715   
                    STO_D_COM.ID.ENSEQ  = CTR_ENSEQ_D            ;      06716   
                    WRITE FILE(FICSTOD) FROM(STO_D_COM)          ;      06717   
                    CTR_LIG_STOD        = CTR_LIG_STOD + 1       ;      06718   
                  END                                            ;      06719   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                06720   
              LIGNE= ' ';                                               06721   
              STRING(ZSPOOLP_SVG) = LIGNE ;                             06722   
              CALL ECRITUR;                                             06723   
              STRING(ZSPOOLP_SVG) = STRING(CDRE_ACC4);/* TRAIT VERT.*/  06724   
              CALL ECRITUR;                                             06725   
              LIGNE_ACC.FORTC = WS_ACC.TOT_FORTC;                       06726   
              LIGNE_ACC.FORHT = WS_ACC.TOT_FORHT;                       06727   
              LIGNE_ACC.NETTC = WS_ACC.TOT_NETTC;                       06728   
              LIGNE_ACC.NETHT = WS_ACC.TOT_NETHT;                       06729   
              LIGNE_ACC.LIBEL = 'TOTAL HORS FRAIS EXPEDITION';          06730   
              STRING(ZSPOOLP_SVG) = LIGNE ;                             06731   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            06732   
                    TOP_DEMA_ECR = 'N' ;                                06733   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            06734   
              CALL ECRITUR;                                             06735   
              STRING(ZSPOOLP_SVG) = STRING(CDRE_ACC4);/* TRAIT VERTI */ 06736   
              CALL ECRITUR;                                             06737   
              LIGNE ='';                                                06738   
              STRING(ZSPOOLP_SVG) = LIGNE ;      /* LIGNE BLANCHE */    06739   
              CALL ECRITUR;                                             06740   
              STRING(ZSPOOLP_SVG) = STRING(CDRE_ACC4);/* TRAIT VERT.*/  06741   
              CALL ECRITUR;                                             06742   
              STRING(ZSPOOLP_SVG) = STRING(CDRE_ACC5); /* INFORMA.. */  06743   
              CALL ECRITUR;                                             06744   
              STRING(ZSPOOLP_SVG) = STRING(CDRE_ACC4B);/* TRAIT VERT.*/ 06745   
              CALL ECRITUR;             /* SPECIAUX POUR INFORMAT..*/   06746   
              STRING(ZSPOOLP_SVG) = STRING(CDRE_ACC6); /* BAS CADRE */  06747   
              CALL ECRITUR;                                             06748   
            END; /* FIN SI ACCORD PASSE AVEC CLIENT */                  06749   
1                                        /*   EDITION RECAP BL        */06750   
          IF WTFAC.EDIPA   = '9' !                                      06751   
             RECAP_BL      = 'NON'  THEN DO;                            06752   
             GO TO A030F;                /*   NON EDITION RECAP BL    */06753   
             END;                                                       06754   
                                         /*   EDITION DU CADRE        */06755   
          IF (FACT.LIGNE + 9 + I_BL_LIG ) > NLMAX_1                     06756   
             THEN CALL ENTCDL;                                          06757   
0         IF WTFAC.NATOP  ^= '31'  THEN DO;                             06758   
          /*�1  PAS DE TABLEAU RECAP. POUR LES RETOURS EDITEUR          06759   
                AJOUT LIGNE DE  COMMENTAIRE CADRE7  13/07/04   */       06760   
             FACT.LIGNE             = FACT.LIGNE + 7;                   06761   
             IF FACT.LIGNE          > NLMAX_1 THEN CALL ENTCDL;         06762   
             STRING(ZSPOOLP_SVG)    = STRING(CADRE6_BL);                06763   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            06764   
                    TOP_DEMA_ECR = 'N' ;                                06765   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            06766   
             CALL ECRITUR;                                              06767   
             STRING(ZSPOOLP_SVG)    = STRING(CADRE1_BL);                06768   
             CALL ECRITUR;                                              06769   
             STRING(ZSPOOLP_SVG)    = STRING(CADRE5_BL);                06770   
             CALL ECRITUR;                                              06771   
             STRING(ZSPOOLP_SVG)    = STRING(CADRE2_BL);                06772   
             CALL ECRITUR;                                              06773   
             STRING(ZSPOOLP_SVG)    = STRING(CADRE3_BL);                06774   
             CALL ECRITUR;                                              06775   
0            DO IT = 1 TO I_BL_LIG ;        /*VIDAGE TABL. LIGNES BL*/  06776   
                IF FACT.LIGNE       > NLMAX_1 THEN DO;                  06777   
                   CALL ENTCDL;                                         06778   
                   /*DEB IDIL-281*/                                     06779   
              /*   FACT.LIGNE          = FACT.LIGNE + 8;*/              06780   
                   FACT.LIGNE          = FACT.LIGNE + 7;                06781   
                   /*FIN IDIL-281*/                                     06782   
                   STRING(ZSPOOLP_SVG) = STRING(CADRE6_BL);             06783   
                   CALL ECRITUR;                                        06784   
                   STRING(ZSPOOLP_SVG) = STRING(CADRE1_BL);             06785   
                   CALL ECRITUR;                                        06786   
                   STRING(ZSPOOLP_SVG) = STRING(CADRE5_BL);             06787   
                   CALL ECRITUR;                                        06788   
                   STRING(ZSPOOLP_SVG) = STRING(CADRE2_BL);             06789   
                   CALL ECRITUR;                                        06790   
                   STRING(ZSPOOLP_SVG) = STRING(CADRE3_BL);             06791   
                   CALL ECRITUR;                                        06792   
                   END;                                                 06793   
                FACT.LIGNE          = FACT.LIGNE + 1;                   06794   
                LIGNE               = '' ;                              06795   
                LIGNE_BL.SEPA1      = '/';                              06796   
                LIGNE_BL.SEPA2      = '/';                              06797   
                LIGNE_BL.NORUN      = BL_LIG.NORUN(IT) ;                06798   
                LIGNE_BL.LOREC      = BL_LIG.LOREC(IT) ;                06799   
                LIGNE_BL.NUBOR      = BL_LIG.NUBOR(IT) ;                06800   
                LIGNE_BL.NETTC      = BL_LIG.NETTC(IT) ;                06801   
                LIGNE_BL.NETHT      = BL_LIG.NETHT(IT) ;                06802   
                LIGNE_BL.TAXES      = BL_LIG.TAXES(IT) ;                06803   
                STRING(ZSPOOLP_SVG) = LIGNE ;                           06804   
                CALL ECRITUR;                                           06805   
                STRING(ZSPOOLP_SVG) = STRING(CADRE2_BL);                06806   
                CALL ECRITUR;                                           06807   
                END;                                                    06808   
0            IF BL_TAB.NETTC(1000) ^= 0 THEN DO;                        06809   
                                            /*   EDITION FRAIS PORT */  06810   
                IF FACT.LIGNE       > NLMAX_1 THEN CALL ENTCDL;         06811   
                FACT.LIGNE          = FACT.LIGNE + 1;                   06812   
                LIGNE               = '' ;                              06813   
                                            /*  FRAIS EXPED 04.07.03*/  06814   
                SUBSTR(LIGNE,30,20) = 'AUTRES FRAIS    ' ;              06815   
                LIGNE_BL.NETTC      = BL_TAB.NETTC(1000) ;              06816   
                LIGNE_BL.NETHT      = BL_TAB.NETHT(1000) ;              06817   
                LIGNE_BL.TAXES      = BL_TAB.TAXES(1000) ;              06818   
                STRING(ZSPOOLP_SVG) = LIGNE ;                           06819   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            06820   
                    TOP_DEMA_ECR = 'N' ;                                06821   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            06822   
                CALL ECRITUR;                                           06823   
                STRING(ZSPOOLP_SVG) = STRING(CADRE2_BL);                06824   
                CALL ECRITUR;                                           06825   
                END;                                                    06826   
             FACT.LIGNE             = FACT.LIGNE + 1;                   06827   
             STRING(ZSPOOLP_SVG)    = STRING(CADRE4_BL);                06828   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            06829   
                    TOP_DEMA_ECR = 'N' ;                                06830   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            06831   
             CALL ECRITUR;                                              06832   
                                    /*   YDU 07.08 SAUT- => +3 ET NON1*/06833   
             /*DEB IDIL-281*/                                           06834   
             IF FACT.LIGNE          >= NLMAX_1 THEN DO;                 06835   
                CALL ENTCDL;                                            06836   
             END;                                                       06837   
             /*FIN IDIL-281*/                                           06838   
             FACT.LIGNE             = FACT.LIGNE + 3;                   06839   
             STRING(ZSPOOLP_SVG)    = STRING(CADRE7_BL);                06840   
             CALL ECRITUR;                                              06841   
             END;                                                       06842   
       A030F:                                                           06843   
           /*----------------------------------------------*/           06844   
           /*-- GESTION DE LA TABLE REFERENCE LIGNE      --*/           06845   
           /*--  AJOUT DU 22/09/2004 SMARTIN             --*/           06846   
           /*----------------------------------------------*/           06847   
           IF TOP_REFLI = 'Y' &  EDIT_FACTU = 'O'                       06848   
           THEN DO ;                                                    06849   
           IF SUBSTR(ENTET70.NORUN,1,1) = '5' !                         06850   
              SUBSTR(ENTET70.NORUN,1,1) = '6'                           06851   
              THEN DO ;                                                 06852   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            06853   
                    TOP_DEMA_ECR = 'N' ;                                06854   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            06855   
               /*-- CALCUL DU NB REF-LI A EDITER */                     06856   
                 I_REFLI_SAVE = 0 ;                                     06857   
                 DO I_REFLI = 1 TO I_REFLI_MAX    ;                     06858   
                   IF REFLI_TAB.REFLI(I_REFLI) ^= ''                    06859   
                     THEN I_REFLI_SAVE = I_REFLI_SAVE + 1 ;             06860   
                     ELSE I_REFLI  = I_REFLI_MAX          ;             06861   
                 END ;                                                  06862   
               /*-- ---------------------------- */                     06863   
               NB_REF_LIG  = I_REFLI_SAVE / 3 ;                         06864   
               RESTE_REFLI = MOD(I_REFLI_SAVE,3) ;                      06865   
               IF RESTE_REFLI ^= 0                                      06866   
                 THEN NB_REF_LIG = NB_REF_LIG + 1 ;                     06867   
               IF (FACT.LIGNE + 9 + NB_REF_LIG) > NLMAX_1               06868   
                 THEN CALL ENTCDL ;                                     06869   
               FACT.LIGNE = FACT.LIGNE + 7 ;                            06870   
               STRING(ZSPOOLP_SVG) = STRING(CADRE1_RL) ;                06871   
               CALL ECRITUR ;                                           06872   
               STRING(ZSPOOLP_SVG) = STRING(CADRE2_RL) ;                06873   
               CALL ECRITUR ;                                           06874   
               STRING(ZSPOOLP_SVG) = STRING(CADRE3_RL) ;                06875   
               CALL ECRITUR ;                                           06876   
               STRING(ZSPOOLP_SVG) = STRING(CADRE4_RL) ;                06877   
               CALL ECRITUR ;                                           06878   
               I_REFLI_SAVE = 1 ;                                       06879   
               DO IT = 1 TO NB_REF_LIG ;                                06880   
                 IF FACT.LIGNE > NLMAX_1                                06881   
                   THEN DO ;                                            06882   
                    CALL ENTCDL ;                                       06883   
                    FACT.LIGNE = FACT.LIGNE + 8 ;                       06884   
                    CADRE2_RL.SAUT = '0' ;                              06885   
                    STRING(ZSPOOLP_SVG) = STRING(CADRE1_RL) ;           06886   
                    CALL ECRITUR ;                                      06887   
                    STRING(ZSPOOLP_SVG) = STRING(CADRE2_RL) ;           06888   
                    CALL ECRITUR ;                                      06889   
                    STRING(ZSPOOLP_SVG) = STRING(CADRE3_RL) ;           06890   
                    CALL ECRITUR ;                                      06891   
                    STRING(ZSPOOLP_SVG) = STRING(CADRE4_RL) ;           06892   
                    CALL ECRITUR ;                                      06893   
                 END ;                                                  06894   
                 CADRE2_RL.SAUT = ' ' ;                                 06895   
                 STRING(ZSPOOLP_SVG) = STRING(CADRE2B_RL) ;             06896   
                 CALL ECRITUR ;                                         06897   
                 FACT.LIGNE = FACT.LIGNE + 2 ;                          06898   
                 LIGNE      = ''             ;                          06899   
                 LIGNE_RL.AST1 = '  '        ;                          06900   
                 LIGNE_RL.AST3 = ' - '       ;                          06901   
                 LIGNE_RL.AST4 = ' - '       ;                          06902   
                   LIGNE_RL.REF01 = REFLI_TAB.REFLI(I_REFLI_SAVE);      06903   
                   LIGNE_RL.REF02 = REFLI_TAB.REFLI(I_REFLI_SAVE+1);    06904   
                   LIGNE_RL.REF03 = REFLI_TAB.REFLI(I_REFLI_SAVE+2);    06905   
                 STRING(ZSPOOLP_SVG) = LIGNE ;                          06906   
                 CALL ECRITUR ;                                         06907   
                 STRING(ZSPOOLP_SVG) = STRING(CADRE4_RL) ;              06908   
                 CALL ECRITUR ;                                         06909   
                 I_REFLI_SAVE = I_REFLI_SAVE + 3 ;                      06910   
               END ;                                                    06911   
               STRING(ZSPOOLP_SVG) = STRING(CADREF_RL);                 06912   
               CALL ECRITUR ;                                           06913   
           END ;                                                        06914   
           END ;                                                        06915   
           TOP_REFLI         = ''  ;                                    06916   
           REFLI_TAB(*)      = ''  ;                                    06917   
           NB_REF_LIG        = 0   ;                                    06918   
           I_REFLI           = 0   ;                                    06919   
           W_RUP_REFLI       = ''  ;                                    06920   
           I_REFLI_SAVE      = 0   ;                                    06921   
           RESTE_REFLI       = 0   ;                                    06922   
           SVG_DEMA_FAC      = TOP_DEMA_FAC ;                           06923   
           TOP_DEMA_FAC      = 'N' ;                                    06924   
           /*----------------------------------------------*/           06925   
           /*--  FIN AJOUT DU 22/09/2004 SMARTIN ----------*/           06926   
           /*----------------------------------------------*/           06927   
                                                                        06928   
           /*   MODIF FLC                */                             06929   
           /*   AJOUT DES LIGNES MONTANT */                             06930   
           /*   PAR ECHEANCE             */                             06931   
                                                                        06932   
           /*  PDEMFA RENSEIGNER DANS X000E :   */                      06933   
           DO INO = 0 TO FACT.ECHEAMAX;                                 06934   
              IF FACT.ECHEA(INO)   ^= ' '                               06935   
                THEN DO;                                                06936   
                   CODECH            = FACT.ECHEA(INO);                 06937   
                   NETTC             = FACT.MTECH(INO) ;                06938   
                   NETCAGR           = (0)        ;                     06939   
                   IF NETTC         ^= (0)                              06940   
                     THEN DO;                                           06941   
                      CALL STEP_CHARGE;                                 06942   
                      CALL CHARGEMENT_TAB;                              06943   
                     END;                                               06944   
                END;                                                    06945   
           END;                                                         06946   
           /* NE PAS AFFICHER POUR LES FACTURE PROFORMA   */            06947   
           /* ET LES TRACO NOT = 0 LES ECHEANCES PAR DATE */            06948   
           IF WTFAC.TRACO ^= '0' !                                      06949   
              WTFAC.GNATO = '41' !                                      06950   
              WTFAC.EDIPA = '9'                                         06951   
              THEN DO;                                                  06952   
                 /* INIT DE LA TABLE  ECHEANCES PAR DATE */             06953   
                 TABE.WS_DAECH(*) = '' ;                                06954   
                 TABE.WS_ECHEA(*) = '' ;                                06955   
                 TABE.WS_MTECH(*) = (0);                                06956   
              END;                                                      06957   
           ELSE                                                         06958   
              DO;                                                       06959   
                 CALL TRI_TAB;                                          06960   
                 CALL ECRITURE_TAB;                                     06961   
              END;                                                      06962   
           /*   FIN DE MODIF FLC         */                             06963   
           TOP_DEMA_FAC      = SVG_DEMA_FAC ;                           06964   
                                        /*   PIED JOURNAL FACTURATION */06965   
           WJOUF.JF           = WTFAC.CO , BY NAME ;                    06966   
           WJOUF.JF           = WTFAC.FA , BY NAME ;                    06967   
           WJOUF.JF           = WTFAC.RF , BY NAME ;                    06968   
           WJOUF.JF           = WTFAC.RS , BY NAME ;                    06969   
           WJOUF.JF           = WTFAC.VA , BY NAME ;                    06970   
           WJOUF.GS.RASOC     = WTCLI1.RASOC;                           06971   
           WJOUF.GS.CPCLI     = WTCLI1.CPCLI;                           06972   
           WJOUF.GS.LOBDI     = WTCLI1.LOBDI;                           06973   
           WJOUF.GS.PAYCL     = WTCLI1.PAYCL;                           06974   
           WJOUF.GS.FRAET     = WTCLI1.FRAET;                           06975   
           WJOUF.GS.MOFOR     = FACT.FORTHT;                            06976   
           WJOUF.GS.MONET     = FACT.NETHT;                             06977   
           WJOUF.GS.QUANT     = FACT.QUANT;                             06978   
           IF WTFAC.POFIS = '0' ! WTFAC.POFIS = '2' ! WTFAC.POFIS = '3' 06979   
            ! WTFAC.POFIS = '5' ! WTFAC.POFIS = '7'                     06980   
              THEN WJOUF.GS.MOTAX       = FACT.TAXES;                   06981   
              ELSE WJOUF.GS.MOTAX       = 0;                            06982   
           WJOUF.ID.EDIPA     = WTFAC.EDIPA;                            06983   
           WJOUF.ID.MACOM     = WTFAC.MACOM;                            06984   
           WJOUF.ID.TRACO     = WTFAC.TRACO;                            06985   
           WJOUF.ID.GNAT1     = WTFAC.GNAT1;                            06986   
           WJOUF.ID.GNATO     = WTFAC.GNATO;                            06987   
           IF WTFAC.MACOM = '001'                                       06988   
              THEN WJOUF.ID.CADOR       = WTFAC.CADOR;                  06989   
              ELSE WJOUF.ID.CADOR       = ' ';                          06990   
0                                       /*   IMPOSITION DU GNATO      */06991   
           WRESP.GNATO        = WTFAC.GNATO;                            06992   
0          IF (FINAN_FRAIS = 'O' & FINAN_EXIST = ' ' )                  06993   
            ! (FINAN_FRAIS = ' ' & FINAN_EXIST = 'O' )                  06994   
              THEN DO;                  /*   FACTURE HOMOGENE ?       */06995   
                 FINAN_FRAIS            = ' ';                          06996   
                 WANOL.TBANO(1)         = '2392';                       06997   
                 WANOE.TBANO(1)         = '2392';                       06998   
                 WANOL.LIMPO            = '*** FOURNITURES ET FRAIS'  !!06999   
                                          ' FINANCIER(ANNULE) FACT '  !!07000   
                                          WNUFAC;                       07001   
                 CALL ID470D;           /*   ANOMALIE UTILISATEUR     */07002   
              END;                                                      07003   
           WRESP.GEREF        = ' ';                                    07004   
           IF FINAN_FRAIS = 'O'         /*   FRAI.FINAN=>INTERET RETAR*/07005   
              THEN WRESP.GEREF          = 'I' ;                         07006   
0          IF (RFA_ENTETE  = 'O' & RFA_DETAIL  = ' ' )                  07007   
            ! (RFA_ENTETE  = ' ' & RFA_DETAIL  = 'O' )                  07008   
              THEN DO;                  /*   FACTURE HOMOGENE ?       */07009   
                 RFA_ENTETE             = ' ';                          07010   
                 WANOL.TBANO(1)         = '2393';                       07011   
                 WANOE.TBANO(1)         = '2393';                       07012   
                 WANOL.LIMPO            = '*** FOURNITURES ET SURRE'  !!07013   
                                          'MISE (ANNULE) FACT      '  !!07014   
                                          WNUFAC;                       07015   
                 CALL ID470D;           /*   ANOMALIE UTILISATEUR     */07016   
              END;                                                      07017   
           IF RFA_ENTETE  = 'O'         /*   REMISE FIN ANNEE         */07018   
              THEN WRESP.GEREF          = 'R' ;                         07019   
0          IF WTFAC.GNATO = '1R' THEN DO;                               07020   
              IF WTFAC.NATOP = '12' ! WTFAC.NATOP = '16' !              07021   
                 WTFAC.NATOP = '70' THEN DO;                            07022   
                       WRESP.GNATO      = '1C';                         07023   
                       GO TO A030FB;                                    07024   
                       END;             ELSE DO;                        07025   
                       WRESP.GNATO      = '14';                         07026   
                       GO TO A030FC;                                    07027   
                       END;             /*   FIN TEST NATOP 12,16,70  */07028   
              END;                      /*   FIN TEST GNATO 1R        */07029   
           IF WTFAC.GNATO = '3R' THEN DO;                               07030   
              IF WTFAC.NATOP = '32' THEN DO;                            07031   
                       WRESP.GNATO      = '32';                         07032   
                       GO TO A030FB;                                    07033   
                       END;             ELSE DO;                        07034   
                       WRESP.GNATO      = '33';                         07035   
                       GO TO A030FC;                                    07036   
                       END;             /*   FIN TEST NATOP 32        */07037   
              END;                      /*   FIN TEST GNATO 3R        */07038   
           IF WTFAC.GNATO = '5R' THEN DO;                               07039   
              IF WTFAC.NATOP = '52' ! WTFAC.NATOP = '54' THEN DO;       07040   
                       WRESP.GNATO      = '52';                         07041   
                       GO TO A030FB;                                    07042   
                       END;             ELSE DO;                        07043   
                       WRESP.GNATO      = '53';                         07044   
                       GO TO A030FC;                                    07045   
                       END;             /*   FIN TEST NATOP 52,54     */07046   
              END;                      /*   FIN TEST GNATO 1R        */07047   
           GO TO A030FC;                                                07048   
       A030FB:                                                          07049   
           WJOUF.GS.MOFOR     = - WJOUF.GS.MOFOR;                       07050   
           WJOUF.GS.MONET     = - WJOUF.GS.MONET;                       07051   
           WJOUF.GS.MOTAX     = - WJOUF.GS.MOTAX;                       07052   
           WJOUF.GS.QUANT     = - WJOUF.GS.QUANT;                       07053   
       A030FC:                                                          07054   
           IF WTFAC.DEPCO = '10' THEN DO;/*  CODE ETAT 470 SUCCES     */07055   
              WJOUR.ID.CODET = ' 470';                                  07056   
              WJOUR.GS.CODET = ' 470';                                  07057   
              WJOUF.ID.CODET = ' 470';                                  07058   
              WJOUF.GS.CODET = ' 470';                                  07059   
              END;           ELSE DO ;                                  07060   
              WJOUR.ID.CODET = ' 471';  /*   CODE ETAT  471 NORMAL    */07061   
              WJOUR.GS.CODET = ' 471';                                  07062   
              WJOUF.ID.CODET = ' 471';                                  07063   
              WJOUF.GS.CODET = ' 471';                                  07064   
              IF WTFAC.TRACO = '0' & WTFAC.DEPCO = '17'                 07065   
                                   & WTGCO.CECOM = '710' THEN DO;       07066   
                 WJOUR.ID.CODET = ' 475';/*   CODE ETAT  475 GHI      */07067   
                 WJOUR.GS.CODET = ' 475';                               07068   
                 WJOUF.ID.CODET = ' 475';                               07069   
                 WJOUF.GS.CODET = ' 475';                               07070   
                 END;                                                   07071   
              IF NUCLI_HMD = 'O' THEN DO;                               07072   
                 WJOUR.ID.CODET = ' 476';/*   CODE ETAT  476 HMD      */07073   
                 WJOUR.GS.CODET = ' 476';                               07074   
                 WJOUF.ID.CODET = ' 476';                               07075   
                 WJOUF.GS.CODET = ' 476';                               07076   
                 END;                                                   07077   
              END;                                                      07078   
           WRITE FILE (FEDITI) FROM (WJOUF);                            07079   
                                                                        07080   
           IF WTFAC.DEPCO = '10' THEN DO;                               07081   
              WNBJSU          = WNBJSU + 1;                             07082   
              END;            ELSE DO;                                  07083   
              SELECT (WJOUF.ID.CODET);                                  07084   
                     WHEN (' 475')  DO;                                 07085   
                          WNBJGH       = WNBJGH + 1;                    07086   
                          END;                                          07087   
                     WHEN (' 476')  DO;                                 07088   
                          WNBJMD       = WNBJMD + 1;                    07089   
                          END;                                          07090   
                     OTHERWISE      DO;                                 07091   
                          MACFA.NBJOU  = MACFA.NBJOU + 1;               07092   
                     END;                                               07093   
                 END;                                                   07094   
              END;                      /*   YOUPIE 01.09.87          */07095   
                                                                        07096   
           IF WTFAC.GNATO = '41' THEN GO TO A030FE;                     07097   
                                        /*   PIED RESULTATS FACTURAT. */07098   
                                                                        07099   
           WRESP.NUCLI        = WTFAC.NUCLI;                            07100   
           WRESP.DEPCO        = WTFAC.DEPCO;                            07101   
           WRESP.TRACO        = WTFAC.TRACO;                            07102   
           WRESP.MACOM        = WTFAC.MACOM;                            07103   
           WRESP.POFIS        = WTFAC.POFIS;                            07104   
           WRESP.TYCLI        = WTFAC.TYCLI;                            07105   
           WRESP.ECFAC        = WTFAC.ECFAC;                            07106   
           WRESP.STRET        = WTFAC.STRET;                            07107   
           WRESP.SPENV        = WTFAC.SPENV;                            07108   
                                        /*   CODE DATA BASE CLIENTS   */07109   
           WRESP.CLICO        = WTCLI1.CLICO;                           07110   
           WRESP.REMAR        = WTCLI1.REMAR;                           07111   
           WRESP.DEPAY        = WTCLI1.DEPAY;                           07112   
           WRESP.NOMCO        = WTCLI1.NOMCO;                           07113   
           WRESP.CATCO        = WTCLI1.CATCO;                           07114   
           WRESP.NATCO        = WTCLI1.NATCO;                           07115   
           WRESP.DEVIS        = WTCLI1.DEVIS;                           07116   
           WRESP.BALAN        = '0'         ;                           07117   
                                                                        07118   
       A030FE:                                                          07119   
                                                                        07120   
           IF WTFAC.EDIPA = '9' THEN DO;/*   NON EDITION FACTURE      */07121   
                CALL EDIECHE;                                           07122   
                                        /*ENVOI FOND  PAGE AVEC PIED */ 07123   
                                        /*YDV P0299   RECTIFIE YDU    */07124   
    /*          STRING (ZSPOOLP_SVG)  = STRING (PAG1_PAY)               07125   
                CALL ECRITUR_AS                                         07126   
                STRING (ZSPOOLP_SVG)  = STRING (PAG2_PAY)               07127   
                CALL ECRITUR_AS                                         07128   
                EDIT_FDPAG           = 'N'                              07129   
                CALL ENTCDL                                             07130   
    */                                                                  07131   
                GO TO A030FF;                                           07132   
                END;                    /*   FIN TEST EDIPA 9         */07133   
1                                       /*   LIB. INTERET RETARD 02.02*/07134   
           IF WTFAC.TRACO = '0' THEN DO;/*   SAUF EXPORT ET GHI       */07135   
              IF ^(UN_M = 20 ! UN_M = 60 ! UN_M = 70 ) THEN DO;         07136   
                 IF FACT.LIGNE + 4 > NLMAX_2 THEN CALL ENTCDL;          07137   
                 FACT.LIGNE    = FACT.LIGNE + 4;                        07138   
                 /*              '0' !! '00'X !! (27)' ' !!             07139   
                                 'PENALITES DE RETARD : TAUX DE REF' !! 07140   
                 YDU 30.05.03    'INANCEMENT DE LA BCE MAJORE DE 7 ' !! 07141   
                                 'POINTS EN POURCENTAGE.'               07142   
                 YDU 19.06.06  = '0' !! '00'X !! (27)' ' !!             07143   
                                 'PENALITES DE RETARD : TAUX DE REF' !! 07144   
                                 'INANCEMENT DE LA BCE MAJORE DE 4 ' !! 07145   
                                 'POINTS DE POURCENTAGE'                07146   
                 YDU 01.12.08  = '0' !! '00'X !! (08)' ' !!             07147   
                                 'PENALITES DE RETARD : TAUX DE REF' !! 07148   
                                 'INANCEMENT DE LA BCE MAJORE DE 5,' !! 07149   
                                 '5 POINTS DE POURCENTAGE'              07150   
                 YDU 08.04.11  = '0' !! '00'X !! (08)' ' !!             07151   
                                 'PENALITES DE RETARD : TAUX DE REF' !! 07152   
                                 'INANCEMENT DE LA BCE MAJORE DE 5,' !! 07153   
                                 '5 POINTS DE POURCENTAGE'              07154   
                 YDU 23.06.11  = '0' !! '00'X !! (08)' ' !!             07155   
                                 'PENALITES DE RETARD : TAUX DE REF' !! 07156   
                                 'INANCEMENT DE LA BCE MAJORE DE 8 ' !! 07157   
                                 'POINTS DE POURCENTAGE'                07158   
                 YDU 23.06.11  = ' ' !! '00'X !! (08)' ' !!             07159   
                                 'AVEC UN MINIMUM LEGAL FIXE A 3 FO' !! 07160   
                                 'IS LE TAUX D''INTERET LEGAL.'      */ 07161   
                 LIGNE         = '0' !! '00'X !! (08)' ' !!             07162   
                                 'PENALITES DE RETARD : INTERET AU ' !! 07163   
                                 'TAUX DE REF'                       !! 07164   
                                 'INANCEMENT DE LA BCE MAJORE DE 8 ' !! 07165   
                                 'POINTS DE POURCENTAGE' ;              07166   
                 STRING(ZSPOOLP_SVG) = LIGNE ;                          07167   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            07168   
                    TOP_DEMA_ECR = 'N' ;                                07169   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            07170   
                 CALL ECRITUR;                                          07171   
                 LIGNE         = ' ' !! '00'X !! (08)' ' !!             07172   
                                 'AVEC UN MINIMUM LEGAL FIXE A 3 FO' !! 07173   
                                 'IS LE TAUX D''INTERET LEGAL.' ;       07174   
                 STRING(ZSPOOLP_SVG) = LIGNE ;                          07175   
                 TOP_DEMA_ECR  = 'N' ;                                  07176   
                 CALL ECRITUR;                                          07177   
                 LIGNE         = ' ' !! '00'X !! (08)' ' !!             07178   
                                 'CE MONTANT EST COMPLETE D''UN FOR' !! 07179   
                                 'FAIT DE 40 EUROS POUR FRAIS DE '   !! 07180   
                                 'RECOUVREMENT.';                       07181   
                 STRING(ZSPOOLP_SVG) = LIGNE ;                          07182   
                 TOP_DEMA_ECR  = 'N' ;                                  07183   
                 CALL ECRITUR;                                          07184   
                 END;                                                   07185   
              END;                                                      07186   
1                                       /*   TRANSFERT PROPRIETE 11.06*/07187   
           IF WTFAC.TRACO = '0' THEN DO;                                07188   
              IF FACT.LIGNE + 2 > NLMAX_2 THEN CALL ENTCDL;             07189   
              FACT.LIGNE       = FACT.LIGNE + 3;                        07190   
              LIGNE            = '0' !! '00'X !! (08)' ' !!             07191   
                              'LE TRANSFERT DE PROPRIETE DE TOUS NO' !! 07192   
                              'S OUVRAGES ET PRODUITS N''INTERVIENT' !! 07193   
                              ' QU''APRES PAIEMENT INTEGRAL DU PRIX' ;  07194   
              STRING(ZSPOOLP_SVG) = LIGNE ;                             07195   
              TOP_DEMA_ECR     = 'N' ;                                  07196   
              CALL ECRITUR;                                             07197   
              END;                      ELSE DO;                        07198   
                                        /*   POUR ALIGNEMENT LIG A BL */07199   
              FACT.LIGNE       = FACT.LIGNE + 1;                        07200   
              END;                                                      07201   
0                                       /*   PROFORMA GIH        10.10*/07202   
           IF WTFAC.EDIPA = '2'                                         07203   
            & WTFAC.NATOP = '41' THEN DO;                               07204   
              IF FACT.LIGNE + 1 > NLMAX_2 THEN CALL ENTCDL;             07205   
              FACT.LIGNE       = FACT.LIGNE + 1;                        07206   
              LIGNE            = ' ' !! '00'X !! (08)' ' !!             07207   
                              'VALIDITE  60  JOURS ' ;                  07208   
              STRING(ZSPOOLP_SVG) = LIGNE ;                             07209   
              TOP_DEMA_ECR     = 'N' ;                                  07210   
              CALL ECRITUR;                                             07211   
              END;                                                      07212   
0                                       /*   TEXTE LIGNES LME    05.09*/07213   
           IF EDIT_CDLTELME = 'O' THEN DO;                              07214   
              IF (FACT.LIGNE + NB_CDLTELME + 1) > NLMAX_2 THEN DO;      07215   
                 CALL ENTCDL;                                           07216   
                 FACT.LIGNE    = FACT.LIGNE + 1;                        07217   
                 END;                   /*   YDU 11.2010              */07218   
              FACT.LIGNE       = FACT.LIGNE + NB_CDLTELME + 1;          07219   
              LIGNE            = '' ;                                   07220   
              SUBSTR(LIGNE,2,1)   = '00'X ;                             07221   
              STRING(ZSPOOLP_SVG) = LIGNE ;                             07222   
              TOP_DEMA_ECR     = 'N' ;                                  07223   
              CALL ECRITUR;                                             07224   
              DO I = 1 TO NB_CDLTELME;                                  07225   
                 LIGNE         = ' ' !! '00'X !!                        07226   
                                 TBL_CDLTELME.LIBE1(I) !!               07227   
                                 TBL_CDLTELME.LIBE2(I) !!               07228   
                                 TBL_CDLTELME.LIBE3(I) ;                07229   
                 STRING(ZSPOOLP_SVG) = LIGNE ;                          07230   
                 TOP_DEMA_ECR  = 'N' ;                                  07231   
                 CALL ECRITUR;                                          07232   
                 END;                                                   07233   
              END;                                                      07234   
           CALL FINFACT;                /*   EDITION PIED DE FACTURE  */07235   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            07236   
                                                                        07237   
           IF TOP_DEMA_FAC = 'O' THEN CALL TRAIT_ENREG_ENT ;            07238   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                07239   
           CALL TRAIT_STO_D_ENT ;                                       07240   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                07241   
                                                                        07242   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            07243   
           IF TOP_DEMA_FAC = 'O' &      /*   PAS DE SPOOL SI DEMAT D  */07244   
              MOD_DEMA     = 'D' THEN DO;                               07245   
              CALL PCF_DUPLI ;          /*   DUPLICATA PCF 11.06      */07246   
              END;                      ELSE DO;                        07247   
                                        /*   GESTION FACT. RECTO VERSO*/07248   
              FOLIO_PIC      = FACT.FOLIO;                              07249   
              SVG_FOLIO      = FACT.FOLIO;                              07250   
              IF VERIFY(FOLIO_N1,'02468') ^= 0 THEN DO;                 07251   
                 STRING (ZSPOOLP_SVG)   = STRING (PAG1_BLAN);           07252   
                 CALL ECRITUR_AS ;                                      07253   
                 STRING (ZSPOOLP_SVG)   = STRING (PAG2_BLAN);           07254   
                 CALL ECRITUR_AS ;                                      07255   
                 STRING(ZSPOOLP_SVG)    = '1' ;                         07256   
                 CALL ECRITUR_AS;                                       07257   
                 FACT.FOLIO             = FACT.FOLIO + 1;               07258   
                 STRING(ZSPOOLP_SVG)    = ' ' ;                         07259   
                 CALL ECRITUR_AS;                                       07260   
                 END;                   /*   FIN FACTURE IMPAIRE      */07261   
              CALL RELECTU;             /*   EDITION FACTURE MULTIPLE */07262   
              END;                                                      07263   
           NB_FICDEMA        = NB_FICDEMA + CTR_LIG_DEMA ;              07264   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                07265   
           NB_FICSTOD        = NB_FICSTOD + CTR_LIG_STOD ;              07266   
                                     /*   GESTION FACT. RECTO VERSO*/   07267   
           FOLIO_PIC                   = SVG_FOLIO;                     07268   
           IF VERIFY(FOLIO_N1,'02468') ^= 0 THEN DO;                    07269   
              STO_P_GEN.GS.INFO        = '' ;                           07270   
              STO_P_GEN_CH5A1          = PAG1_BLAN , BY NAME;           07271   
              STO_P_GEN.ID.ENSEQ       = STO_P_GEN.ID.ENSEQ + 1 ;       07272   
              WRITE FILE (FICSTOP) FROM (STO_P_GEN) ;                   07273   
              STO_P_GEN_CH5A2          = PAG2_BLAN , BY NAME;           07274   
              STO_P_GEN.ID.ENSEQ       = STO_P_GEN.ID.ENSEQ + 1 ;       07275   
              WRITE FILE (FICSTOP) FROM (STO_P_GEN) ;                   07276   
              STO_P_GEN.GS             = '' ;                           07277   
              STO_P_GEN.GS.SAUT        = '1' ;                          07278   
              STO_P_GEN.ID.ENSEQ       = STO_P_GEN.ID.ENSEQ + 1 ;       07279   
              WRITE FILE (FICSTOP) FROM (STO_P_GEN) ;                   07280   
              STO_P_GEN.GS.SAUT        = ' ' ;                          07281   
              STO_P_GEN.ID.ENSEQ       = STO_P_GEN.ID.ENSEQ + 1 ;       07282   
              WRITE FILE (FICSTOP) FROM (STO_P_GEN) ;                   07283   
              NB_FICSTOP               = NB_FICSTOP + 4;                07284   
              END;                   /*   FIN FACTURE IMPAIRE      */   07285   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                07286   
           IF WTFAC.EDIPA    = '2'      /*   EXPORT HORS PRO FORMA    */07287   
            & WTFAC.GNATO   ^= '41' THEN DO;                            07288   
              CALL EXPORT_INFOC;        /*   EXPORT INFOCENTRE HARR   */07289   
              END;                                                      07290   
0      A030FF:                                                          07291   
           IF IRAFAC =  3  THEN DO;     /*   TEST DE RUPTURE          */07292   
                    CALL SPLAFAC;       /*   APPEL SS PROG. LECTURE   */07293   
                    GO TO A030D;                                        07294   
                    END;                                                07295   
1                                       /*******************************07296   
                                        *    MODULE FINAL   NUCLI      *07297   
                                        *******************************/07298   
       A020F:                                                           07299   
0          IF IRAFAC =  2  THEN DO;     /*   TEST DE RUPTURE          */07300   
                    CALL SPLAFAC;       /*   APPEL SS PROG. LECTURE   */07301   
                    GO TO A020D;                                        07302   
                    END;                                                07303   
1                                       /*******************************07304   
                                        *    MODULE FINAL   CDL GIH    *07305   
                                        *******************************/07306   
       A010F:                                                           07307   
0          IF IRAFAC =  1  THEN DO;     /*   TEST DE RUPTURE          */07308   
                    CALL SPLAFAC;       /*   APPEL SS PROG. LECTURE   */07309   
                    GO TO A010D;                                        07310   
                    END;                                                07311   
1                                       /*******************************07312   
                                        *    FIN  DU  TRAITEMENT       *07313   
                                        *******************************/07314   
       A000F:                                                           07315   
                                                                        07316   
           CALL ID470E;                 /*   ENREG FF ETATS TEMOINS   */07317   
                                                                        07318   
0          ZCTL1.CPTR     = FACTU_SUP  ;/*   JOURNAL FACTURATI. SUCCES*/07319   
           ZCTL1.FIL2     = '   FACTURES GENEREES CLIFA-NUCLI  ';       07320   
           ZONCTL         = STRING(ZCTL1);                              07321   
           CALL MACMES3 (DESTI,'1',ZONCTL);                             07322   
0          ZCTL1.CPTR     = NB_ACC_HISTO; /* HISTORISATION DES ACCORDS*/07323   
           ZCTL1.FIL2     = '   MVTS ACCORD HISTORISES';                07324   
           ZONCTL         = STRING(ZCTL1);                              07325   
           CALL MACMES3 (DESTI,'1',ZONCTL);                             07326   
0          ZCTL1.CPTR = WS_ECRI_IDPIEDF5; /* HISTO. ECART TVA FACTURE */07327   
           ZCTL1.FIL2     = '   ECART TVA S/FACTURE   ';                07328   
           ZONCTL         = STRING(ZCTL1);                              07329   
           CALL MACMES3 (DESTI,'1',ZONCTL);                             07330   
0          ZCTL2.CPTR     = WS_NBMIC;     /* MICROFICHES OVER FLOW    */07331   
           ZCTL2.FIL2     = '   MICROFICHES - 2       ';                07332   
           ZONCTL         = STRING(ZCTL2);                              07333   
           CALL MACMES3 (DESTI,'1',ZONCTL);                             07334   
0          ZCTL2.CPTR     = WS_CANA4P;    /* CANADA PRO FORMA         */07335   
           ZCTL2.FIL2     = '   ECRITS CANADA PRO FORMA';               07336   
           ZONCTL         = STRING(ZCTL2);                              07337   
           CALL MACMES3 (DESTI,'1',ZONCTL);                             07338   
-                                       /* AJOUT 22 10 02 YDU/YHM PCF */07339   
0          ZCTL2.CPTR     = NB_IDDPCFEN ; /* ENTETE FACT. PCF         */07340   
           ZCTL2.FIL2     = '   ECRITS ENTETES FACT.PCF';               07341   
           ZONCTL         = STRING(ZCTL2);                              07342   
           CALL MACMES3 (DESTI,'1',ZONCTL);                             07343   
0          ZCTL2.CPTR     = NB_IDDPCFLI ; /* LIGNES FACT. PCF         */07344   
           ZCTL2.FIL2     = '   ECRITS LIGNES  FACT.PCF';               07345   
           ZONCTL         = STRING(ZCTL2);                              07346   
           CALL MACMES3 (DESTI,'1',ZONCTL);                             07347   
0          ZCTL2.CPTR     = NB_IDDPCFIN ; /* INDEX  FACT/BL PCF       */07348   
           ZCTL2.FIL2     = '   ECRITS INDEX FAC/BL PCF';               07349   
           ZONCTL         = STRING(ZCTL2);                              07350   
           CALL MACMES3 (DESTI,'1',ZONCTL);                             07351   
0          ZCTL2.CPTR     = NB_FICDEMA  ; /* LIGNES FACTURES DEMATER. */07352   
           ZCTL2.FIL2     = '   ECRITS FACTURES DEMAT. ';               07353   
           ZONCTL         = STRING(ZCTL2);                              07354   
           CALL MACMES3 (DESTI,'1',ZONCTL);                             07355   
0          ZCTL2.CPTR     = NB_FICLCOM  ; /* LIGNES DEMAT GROUP WISE  */07356   
           ZCTL2.FIL2     = '   ECRITS DEMAT DANS G.W. ';               07357   
           ZONCTL         = STRING(ZCTL2);                              07358   
           CALL MACMES3 (DESTI,'1',ZONCTL);                             07359   
0          ZCTL2.CPTR     = NB_EXPOHA;    /* EXPORT INFOCENTRE HARRY  */07360   
           ZCTL2.FIL2     = '   ECRITS EXPORT INFOCENTRE';              07361   
           ZONCTL         = STRING(ZCTL2);                              07362   
           CALL MACMES3 (DESTI,'1',ZONCTL);                             07363   
0 /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                07364   
0          ZCTL2.CPTR     = NB_FICSTOD  ; /* LIGNES STOK FAC DEMATER. */07365   
           ZCTL2.FIL2     = '   ECRITS F. STOCK DEMAT. ';               07366   
           ZONCTL         = STRING(ZCTL2);                              07367   
           CALL MACMES3 (DESTI,'1',ZONCTL);                             07368   
0          ZCTL2.CPTR     = NB_FICSTOP  ; /* LIGNES STOK FAC DEMATER. */07369   
           ZCTL2.FIL2     = '   ECRITS F. STOCK PAPIER ';               07370   
           ZONCTL         = STRING(ZCTL2);                              07371   
           CALL MACMES3 (DESTI,'1',ZONCTL);                             07372   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                07373   
0                                       /*   FERMETURES BANDES SPOOL  */07374   
           CALL SPOOLA32  (UN,SPOOL_C);                                 07375   
           CALL SPOOLA32  (DEUX,SPOOL_C);                               07376   
           CALL SPOOLA32  (TROIS,SPOOL_C);                              07377   
           CALL SPOOLA32  (QUATRE,SPOOL_C);                             07378   
           CALL SPOOLA32  (CINQ,SPOOL_C);                               07379   
           CALL SPOOLA32  (SIX,SPOOL_C);                                07380   
           CALL SPOOLA32  (SEPT,SPOOL_C);                               07381   
           CALL SPOOLA32  (HUIT,SPOOL_C);                               07382   
                                                                        07383   
0      /*  CALL HSTATIMS(PCBCLI) YDU 07.05   APPEL STATISTIQUES IMS   */07384   
       /*  CALL MACSPOO3(DESTI,MACFA) *//*   NBRES LIGNES SPOOL1,2,3  */07385   
0          ZONCTL         = ' ***** IDP470RA * FIN   *****';            07386   
           CALL MACMES3 (DESTI,'1',ZONCTL);                             07387   
           CALL MACFIN3 (DESTI,MACFA);                                  07388   
0                                       /*   FERMETURE DES FICHIERS   */07389   
 /**********************************************/                       07390   
 /* AJOUT LE 04 11 92 : FEXCLI POUR TVA CEE 93 */                       07391   
 /**********************************************/                       07392   
           CLOSE FILE(FFAC3A), FILE(FEDITI), FILE(FRESUL), FILE(FMICRO),07393   
                 FILE(FIPAGE),FILE(FEXCLI),FILE(FHISTO),FILE(CANADA4P), 07394   
                 FILE(IDREFCO1),FILE(IDPIEDF5),FILE(FIRENT),            07395   
                 FILE(EXPOHARR);                                        07396   
                                                                        07397   
 /******************************/                                       07398   
 /* AJOUT 22 10 02 YDU/YHM PCF */                                       07399   
 /******************************/                                       07400   
           CLOSE FILE(IDDPCFEN) , FILE(IDDPCFLI), FILE(IDDPCFIN);       07401   
  /*-- -------------------------------------------- --*/                07402   
  /*-- GESTION DES FACTURES DEMATERIALISEES   ----- --*/                07403   
  /*--   DEBUT AJOUT SMARTIN DU 17/12/2004    ----- --*/                07404   
           CLOSE FILE(FICDEMA)        ; /*   FICHIER FACT. DEMAT.     */07405   
           CLOSE FILE(FICLCOM)        ; /*   FICHIER FACT. DEMAT. LOG */07406   
  /*-- -------------------------------------------- --*/                07407   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                07408   
           CLOSE FILE(FICSTOD)        ; /*   FICHIER STOCK FACT. DEMAT*/07409   
           CLOSE FILE(FICSTOP)        ; /*   FICHIER STOCK FACT. PAPIE*/07410   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                07411   
                                                                        07412   
           CALL CHTBCL3;                   ;                            07413   
0          PASTK.CODGT    = 'C';        /*  FERMETURE  FICH.FACT.MULTI*/07414   
                                        /*  NON ECRITURE PAGE DE GARDE*/07415   
           IF W_ENTE_PORT = 'NON' THEN                                  07416   
           CALL ID470F;                 /*YDV E0299*/                   07417   
                                                                        07418   
1   PCF_DUPLI:      PROCEDURE;                                          07419   
-          /* AJOUT 22 10 02 YDU/YHM PCF                                07420   
                    *****************************************           07421   
                    *                                       *           07422   
                    *    SOUS PROGRAMME DE DUPLICATA        *           07423   
                    *    FACTURES POUR PCF                  *           07424   
                    *                                       *           07425   
                    *****************************************           07426   
           */                                                           07427   
0      PCF_DEB:                                                         07428   
           K             = 0 ;                                          07429   
           PASTK.CODGT   = 'D' ;                                        07430   
           PLI_LIGNE     = '' ;                                         07431   
           PLI_NUCLI     = WTFAC.GS.NUCLI ;                             07432   
           PLI_RUNFA     = ENTET70.NORUN ;                              07433   
           PLI_NUFAC     = ENTET70.REFFA ;                              07434   
           PLI_DAFACDIMA = '20' !! ENTET70.DAT10.AA ;                   07435   
           PLI_DAFACDIMM = ENTET70.DAT10.MM ;                           07436   
           PLI_DAFACDIMJ = ENTET70.DAT10.JJ ;                           07437   
                                                                        07438   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                07439   
           STO_P_GEN.ID.SYPRO = STO_P_SYPRO ;                           07440   
           STO_P_GEN.ID.AFFIL = STO_P_AFFIL ;                           07441   
           STO_P_GEN.ID.NUCLI = PLI_NUCLI ;                             07442   
           STO_P_GEN.ID.RUNFA = PLI_RUNFA ;                             07443   
           STO_P_GEN.ID.NUFAC = PLI_NUFAC ;                             07444   
           STO_P_GEN.ID.DAFAC = '20' !! ENTET70.DAT10.AA                07445   
                                     !! ENTET70.DAT10.MM                07446   
                                     !! ENTET70.DAT10.JJ ;              07447   
           STO_P_GEN.ID.ENSEQ = 0            ;                          07448   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                07449   
                                                                        07450   
0      PCF_LEC:                                                         07451   
           PASTK.CODLE = 'L' ;                                          07452   
           CALL ID470F ;                                                07453   
           IF PASTK.CODGT = 'F'                                         07454   
           THEN GO TO PCF_EOF ;                                         07455   
           PLECT = PWTMVT ;                                             07456   
                                                                        07457   
0                                    /* GESTION CODE POLICE           */07458   
           SELECT (WENTET4.POLIC) ;                                     07459   
              WHEN ('00'X)           /* NORMALE PETITE                */07460   
                 PLI_IDPOCASC = 0 ;                                     07461   
              WHEN ('04'X)           /* LIBELLE EN GRAS               */07462   
                 PLI_IDPOCASC = 4 ;                                     07463   
              WHEN ('02'X)           /* CADRE                         */07464   
                 PLI_IDPOCASC = 2 ;                                     07465   
              WHEN ('40'X)           /* EQUIVALENT A '00'             */07466   
                 PLI_IDPOCASC = 0 ;                                     07467   
              WHEN ('01'X)           /* GT12 ADRESSE                  */07468   
                 PLI_IDPOCASC = 1 ;                                     07469   
              WHEN ('05'X)           /* IDEM '04'X MAIS PLUS PETIT    */07470   
                 PLI_IDPOCASC = 5 ;                                     07471   
              WHEN ('60'X)           /* CADRE TOTALISATION            */07472   
                 PLI_IDPOCASC = 6 ;                                     07473   
              OTHERWISE                                                 07474   
              DO ;                                                      07475   
                 PLI_IDPOCASC = '' ;                                    07476   
                 PUT SKIP LIST                                          07477   
                     (' POLICE INCONNUE ',WENTET4.POLIC);               07478   
                                                                        07479   
              END ;                                                     07480   
           END ;                                                        07481   
                                                                        07482   
0                                    /* GESTION CODE SAUT             */07483   
           SAUT_LIG           = 1 ;                                     07484   
           SELECT (WENTET4.SAUT) ;                                      07485   
              WHEN ('1')                                                07486   
              DO ;                                                      07487   
                 K = K + 1 ;                                            07488   
                 PLI_IIPAGEFD = K ;                                     07489   
                 PLI_IILIGNFD = 1 ;                                     07490   
                 PLI_IIORLIFD = 0 ;                                     07491   
              END ;                                                     07492   
              WHEN ('+')                                                07493   
                 PLI_IIORLIFD = PLI_IIORLIFD + 1 ;                      07494   
              WHEN (' ')                                                07495   
              DO ;                                                      07496   
                 PLI_IILIGNFD = PLI_IILIGNFD + 1 ;                      07497   
                 PLI_IIORLIFD = 0 ;                                     07498   
              END ;                                                     07499   
              WHEN ('0')                                                07500   
              DO ;                                                      07501   
                 SAUT_LIG     = 2 ;                                     07502   
                 PLI_IIORLIFD = 0 ;                                     07503   
              END ;                                                     07504   
              WHEN ('-')                                                07505   
              DO ;                                                      07506   
                 SAUT_LIG     = 3 ;                                     07507   
                 PLI_IIORLIFD = 0 ;                                     07508   
              END ;                                                     07509   
              WHEN ('3')                                                07510   
              DO ;                                                      07511   
              /* PLI_IILIGNFD = 71 */                /* SAUT CANAL 3 */ 07512   
                 SAUT_LIG     = 71;                                     07513   
                 PLI_IIORLIFD = 0 ;                                     07514   
              END ;                                                     07515   
              WHEN ('5A'X)                                              07516   
              DO ;                                                      07517   
                 IF SUBSTR(WENTET4.FIL1,4,1)  = 'CA'X  THEN DO;         07518   
                    IF SUBSTR(WENTET4.FIL1,8,7) = 'VIERGE1'             07519   
                       THEN GO TO PCF_EOF;                              07520   
                       ELSE PLI_COFPAGSC = SUBSTR(WENTET4.FIL1,8,7);    07521   
                    END;                                                07522   
                 GO TO PCF_LEC ;                    /* PAS D'ECRITURE*/ 07523   
              END ;                                                     07524   
              OTHERWISE                                                 07525   
                 PUT SKIP LIST ('SAUT INCONNU ',WENTET4.SAUT);          07526   
           END ;                                                        07527   
                                                                        07528   
           STRING(PLI_TELIGNFD)= SUBSTR(WFACT,3,173) ;                  07529   
           IF PLI_COFPAGSC = 'FCTF61' !                                 07530   
              PLI_COFPAGSC = 'FCTE41' !                                 07531   
              PLI_COFPAGSC = 'FCTD41' !                                 07532   
              PLI_COFPAGSC = 'FCTG11' !                                 07533   
              PLI_COFPAGSC = 'FCTM31' !                                 07534   
              PLI_COFPAGSC = 'FCTH91'                                   07535   
           THEN ;                         /*   K = 0   RAZ N� DE PAGE */07536   
           ELSE DO ;                                                    07537   
     /*       IF STRING(PLI_TELIGNFD) ^= ''  JCJ PORTAIL                07538   
              THEN DO   */                                              07539   
                 IF SAUT_LIG ^= 1                                       07540   
                    THEN CALL PCF_SAUT_LIG;                             07541   
                 IF PCFLI_ECRIT = 'N' THEN DO;                          07542   
                                         /*   YDU 07.08 -1 LIGNE PCFLI*/07543   
                    PCFLI_ECRIT  = 'O';                                 07544   
                    PLI_IILIGNFD = PLI_IILIGNFD - 1;                    07545   
                    END;                 ELSE DO;                       07546   
                    IF PLI_COFPAGSC = 'VIERGE1' !                       07547   
                       PLI_COFPAGSC = 'O1VIERGE'                        07548   
                       THEN DO;         /*    PAS ENVOI ARCHIVAGE     */07549   
                       END;                ELSE DO;                     07550   
                       WRITE FILE (IDDPCFLI) FROM (PLI_LIGNE) ;         07551   
                       NB_IDDPCFLI  = NB_IDDPCFLI + 1;                  07552   
                       END;                                             07553   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                07554   
                    STO_P_WOR.IIPAGEFD = PLI_IIPAGEFD ;                 07555   
                    STO_P_WOR.IILIGNFD = PLI_IILIGNFD ;                 07556   
                    STO_P_WOR.COFPAGSC = PLI_COFPAGSC ;                 07557   
                    STO_P_WOR.IIORLIFD = PLI_IIORLIFD ;                 07558   
                    STO_P_WOR.IDPOCASC = PLI_IDPOCASC ;                 07559   
                    CALL MEF_FICSTOP;                                   07560   
                    STO_P_GEN.GS.INFO  = SUBSTR(WFACT,3,173) ;          07561   
                    STO_P_GEN.ID.ENSEQ = STO_P_GEN.ID.ENSEQ + 1 ;       07562   
                    FICSTOP_PREV_GEN   = STO_P_GEN ;                    07563   
                    WRITE FILE (FICSTOP) FROM (STO_P_GEN) ;             07564   
                    NB_FICSTOP         = NB_FICSTOP + 1;                07565   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                07566   
                    END;                                                07567   
                 IF PLI_IILIGNFD = 69    /*   LIGNE EN EURO           */07568   
                  & (PLI_COFPAGSC = 'FCTF63' ! PLI_COFPAGSC = 'FCTH93') 07569   
                  & SUBSTR(PLI_FIL50_2,39,8) = 'EN EUROS'               07570   
                    THEN DO;             /*   LIGNE SUIVANTE NON ECRIT*/07571   
                    PCFLI_ECRIT  = 'N';                                 07572   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                07573   
                    STO_P_WOR.IIPAGEFD = PLI_IIPAGEFD ;                 07574   
                    STO_P_WOR.IILIGNFD = PLI_IILIGNFD ;                 07575   
                    STO_P_WOR.COFPAGSC = PLI_COFPAGSC ;                 07576   
                    STO_P_WOR.IIORLIFD = PLI_IIORLIFD ;                 07577   
                    STO_P_WOR.IDPOCASC = PLI_IDPOCASC ;                 07578   
                    CALL MEF_FICSTOP;                                   07579   
                    STO_P_GEN.GS.INFO  = ''           ;                 07580   
                    STO_P_GEN.ID.ENSEQ = STO_P_GEN.ID.ENSEQ + 1 ;       07581   
                    FICSTOP_PREV_GEN   = STO_P_GEN ;                    07582   
                    WRITE FILE (FICSTOP) FROM (STO_P_GEN) ;             07583   
                    NB_FICSTOP         = NB_FICSTOP + 1;                07584   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                07585   
                    END;                                                07586   
     /*       END */                                                    07587   
           END;                                                         07588   
           GO TO PCF_LEC ;                                              07589   
                                                                        07590   
       PCF_EOF:                                                         07591   
           PEN_ENTET = '' ;                                             07592   
           PEN_NUCLI = WTFAC.GS.NUCLI ;                                 07593   
           PEN_RUNFA = ENTET70.NORUN ;                                  07594   
           PEN_NUFAC = ENTET70.REFFA ;                                  07595   
           PEN_DAFACDIMA = '20' !! ENTET70.DAT10.AA ;                   07596   
           PEN_DAFACDIMM = ENTET70.DAT10.MM ;                           07597   
           PEN_DAFACDIMJ = ENTET70.DAT10.JJ ;                           07598   
           PEN_COFPAGSC = PLI_COFPAGSC ; /*   DERNIER COFPAGSC FACT   */07599   
           PEN_MTCEUFIM = FACT.DEBIT ;                                  07600   
           SELECT (TTFAC3_P.LIBEL3);     /*   SIGNE DU MONTANT FACTURE*/07601   
              WHEN (' DEBIT')  DO;                                      07602   
                 END;                                                   07603   
              WHEN (' CREDIT') DO;                                      07604   
                 PEN_MTCEUFIM = - FACT.DEBIT ;                          07605   
                 END;                                                   07606   
              WHEN (' ') DO ;            /*   FACTURE OUVERTE EXPORT  */07607   
                 IF WTFAC.EDIPA = '2' & WTFAC.PEFAC = '9' THEN DO;      07608   
                    IF TTFAC131.FIL7 = 'CREDIT' THEN DO;                07609   
                       PEN_MTCEUFIM  = - FACT.DEBIT ;                   07610   
                       END;                                             07611   
                    END;                                                07612   
                 END;                                                   07613   
              OTHERWISE DO;                                             07614   
                 END;                                                   07615   
              END;                                                      07616   
           PEN_NBPAGFIM = PLI_IIPAGEFD ;                                07617   
           PEN_LIFACTUR = ENTET7_1.LIDOC !! ENTET7_1.LGNAT ;            07618   
           IF MOD_DEMA  = 'D'            /*   FACTURE DEMAT OU PAPIER */07619   
              THEN PEN_TYPFA   = 'D';                                   07620   
              ELSE PEN_TYPFA   = 'P';                                   07621   
           IF PEN_COFPAGSC = 'VIERGE1' ! PEN_COFPAGSC = 'O1VIERGE'      07622   
              THEN DO;                  /*    PAS ENVOI ARCHIVAGE     */07623   
              END;                      ELSE DO;                        07624   
              WRITE FILE (IDDPCFEN) FROM (PEN_ENTET) ;                  07625   
              NB_IDDPCFEN      = NB_IDDPCFEN + 1;                       07626   
              END;                                                      07627   
                                                                        07628   
  /* AJOUT 25 10 02 YDU/YHM PCF POUR FACTURE CLIFA                    */07629   
  /* DECONNECTION LE 28 10 02 => SELECTION INSUFFISANTE               */07630   
                                                                        07631   
           IF ^(WTCLI1.CLIFA = ' ' ! WTCLI1.CLIFA = '000000')           07632   
                               &                                        07633   
                WTCLI1.NBFAC > 0                                        07634   
                               &                                        07635   
                EDIT_FACTU   = 'O'                                      07636   
                               &                                        07637   
              ^(WTFAC.GS.TRACO = '2' & WTFAC.GS.DEPCO = '16')           07638   
                               &         /*   03.06.03 ECHANTILLONS   */07639   
              ^(WTFAC.GS.TRACO = '2' & WTFAC.GS.DEPCO = '12')           07640   
                               &         /*   03.06.03 CF CDELIVCA    */07641   
              ^(WTCLI1.TYCOM   = '4' ! WTCLI1.TYCOM   = '6' )           07642   
           THEN CALL PCF_DUPLI_CLIFA ;   /*   MEME REGLE POUR INDEX   */07643   
                                                                        07644   
    END PCF_DUPLI ;                                                     07645   
                                                                        07646   
1   PCF_DUPLI_CLIFA:      PROCEDURE;                                    07647   
-          /* AJOUT 22 10 02 YDU/YHM PCF                                07648   
                    *****************************************           07649   
                    *                                       *           07650   
                    *    SOUS PROGRAMME DE DUPLICATA        *           07651   
                    *    FACTURES POUR PCF                  *           07652   
                    *    INVERSION NUCLI CLIFA              *           07653   
                    *                                       *           07654   
                    *****************************************           07655   
           */                                                           07656   
0      PCF_DEB_CLIFA:                                                   07657   
           K             = 0 ;                                          07658   
           K_CLIFA       = 1 ;                                          07659   
           PASTK.CODGT   = 'D' ;                                        07660   
           PLI_LIGNE     = '' ;                                         07661   
           PLI_NUCLI     = WTCLI1.CLIFA ;                               07662   
           PLI_RUNFA     = ENTET70.NORUN ;                              07663   
           PLI_NUFAC     = ENTET70.REFFA ;                              07664   
           PLI_DAFACDIMA = '20' !! ENTET70.DAT10.AA ;                   07665   
           PLI_DAFACDIMM = ENTET70.DAT10.MM ;                           07666   
           PLI_DAFACDIMJ = ENTET70.DAT10.JJ ;                           07667   
                                                                        07668   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                07669   
           STO_P_GEN.ID.SYPRO = STO_P_SYPRO ;                           07670   
           STO_P_GEN.ID.AFFIL = STO_P_AFFIL ;                           07671   
           STO_P_GEN.ID.NUCLI = PLI_NUCLI ;                             07672   
           STO_P_GEN.ID.RUNFA = PLI_RUNFA ;                             07673   
           STO_P_GEN.ID.NUFAC = PLI_NUFAC ;                             07674   
           STO_P_GEN.ID.DAFAC = '20' !! ENTET70.DAT10.AA                07675   
                                     !! ENTET70.DAT10.MM                07676   
                                     !! ENTET70.DAT10.JJ ;              07677   
           STO_P_GEN.ID.ENSEQ = 0            ;                          07678   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                07679   
                                                                        07680   
0      PCF_LEC_CLIFA:                                                   07681   
           PASTK.CODLE = 'L' ;                                          07682   
           CALL ID470F ;                                                07683   
           IF PASTK.CODGT = 'F'                                         07684   
           THEN GO TO PCF_EOF_CLIFA ;                                   07685   
           PLECT = PWTMVT ;                                             07686   
           DFACT = WFACT  ;                                             07687   
                                                                        07688   
0                                    /* GESTION CODE POLICE           */07689   
           SELECT (DENTET4.POLIC) ;                                     07690   
              WHEN ('00'X)           /* NORMALE PETITE                */07691   
                 PLI_IDPOCASC = 0 ;                                     07692   
              WHEN ('04'X)           /* LIBELLE EN GRAS               */07693   
                 PLI_IDPOCASC = 4 ;                                     07694   
              WHEN ('02'X)           /* CADRE                         */07695   
                 PLI_IDPOCASC = 2 ;                                     07696   
              WHEN ('40'X)           /* EQUIVALENT A '00'             */07697   
                 PLI_IDPOCASC = 0 ;                                     07698   
              WHEN ('01'X)           /* GT12 ADRESSE                  */07699   
                 PLI_IDPOCASC = 1 ;                                     07700   
              WHEN ('05'X)           /* IDEM '04'X MAIS PLUS PETIT    */07701   
                 PLI_IDPOCASC = 5 ;                                     07702   
              WHEN ('60'X)           /* CADRE TOTALISATION            */07703   
                 PLI_IDPOCASC = 6 ;                                     07704   
              OTHERWISE                                                 07705   
              DO ;                                                      07706   
                 PLI_IDPOCASC = '' ;                                    07707   
                 PUT SKIP LIST                                          07708   
                     (' POLICE INCONNUE ',DENTET4.POLIC);               07709   
                                                                        07710   
              END ;                                                     07711   
           END ;                                                        07712   
                                                                        07713   
0                                    /* GESTION CODE SAUT             */07714   
           SAUT_LIG           = 1;                                      07715   
           SELECT (DENTET4.SAUT) ;                                      07716   
              WHEN ('1')                                                07717   
              DO ;                                                      07718   
                 K = K + 1 ;                                            07719   
                 PLI_IIPAGEFD = K ;                                     07720   
                 PLI_IILIGNFD = 1 ;                                     07721   
                 PLI_IIORLIFD = 0 ;                                     07722   
              END ;                                                     07723   
              WHEN ('+')                                                07724   
                 PLI_IIORLIFD = PLI_IIORLIFD + 1 ;                      07725   
              WHEN (' ')                                                07726   
              DO ;                                                      07727   
                 PLI_IILIGNFD = PLI_IILIGNFD + 1 ;                      07728   
                 PLI_IIORLIFD = 0 ;                                     07729   
              END ;                                                     07730   
              WHEN ('0')                                                07731   
              DO ;                                                      07732   
                 SAUT_LIG     = 2 ;                                     07733   
                 PLI_IIORLIFD = 0 ;                                     07734   
              END ;                                                     07735   
              WHEN ('-')                                                07736   
              DO ;                                                      07737   
                 SAUT_LIG     = 3 ;                                     07738   
                 PLI_IIORLIFD = 0 ;                                     07739   
              END ;                                                     07740   
              WHEN ('3')                                                07741   
              DO ;                                                      07742   
              /* PLI_IILIGNFD = 71 */                /* SAUT CANAL 3 */ 07743   
                 SAUT_LIG     = 71;                                     07744   
                 PLI_IIORLIFD = 0 ;                                     07745   
              END ;                                                     07746   
              WHEN ('5A'X)                                              07747   
              DO ;                                                      07748   
                 IF SUBSTR(DENTET4.FIL1,4,1)  = 'CA'X  THEN DO;         07749   
                    IF SUBSTR(DENTET4.FIL1,8,7) = 'VIERGE1'             07750   
                       THEN GO TO PCF_EOF_CLIFA;                        07751   
                       ELSE PLI_COFPAGSC = SUBSTR(DENTET4.FIL1,8,7) ;   07752   
                    END;                                                07753   
                 GO TO PCF_LEC_CLIFA;               /* PAS D'ECRITURE*/ 07754   
              END ;                                                     07755   
              OTHERWISE                                                 07756   
                 PUT SKIP LIST ('SAUT INCONNU ',DENTET4.SAUT);          07757   
           END ;                                                        07758   
           IF DENTET4.SAUT = '1'                                        07759   
           THEN K_CLIFA = 1;                                            07760   
           SELECT (K_CLIFA) ;           /*   INVERSION NUCLI CLIFA    */07761   
              WHEN ( 10 ) DO;           /*   RAISON SOCIALE           */07762   
                 SVG_ADRESSE            = DENTET8.RASOC1;               07763   
                 DENTET8.RASOC1         = DENTET8.RASOC2;               07764   
                 DENTET8.RASOC2         = SUBSTR(SVG_ADRESSE,1,26);     07765   
              END;                                                      07766   
              WHEN ( 11 ) DO;           /*   NOM CLIENT               */07767   
                 SVG_ADRESSE            = DENTET9.NOCLI1;               07768   
                 DENTET9.NOCLI1         = DENTET9.NOCLI2;               07769   
                 DENTET9.NOCLI2         = SUBSTR(SVG_ADRESSE,1,15);     07770   
              END;                                                      07771   
              WHEN ( 12 ) DO;           /*   ADRESSE                  */07772   
                 SVG_ADRESSE            = DENTET10.ADCLI1;              07773   
                 DENTET10.ADCLI1        = DENTET10.ADCLI2;              07774   
                 DENTET10.ADCLI2        = SUBSTR(SVG_ADRESSE,1,26);     07775   
              END;                                                      07776   
              WHEN ( 13 ) DO;           /*   LOCALITE                 */07777   
                 SVG_ADRESSE            = DENTET11.LORES1;              07778   
                 DENTET11.LORES1        = DENTET11.LORES2;              07779   
                 DENTET11.LORES2        = SUBSTR(SVG_ADRESSE,1,15);     07780   
              END;                                                      07781   
              WHEN ( 14 ) DO;           /*   CODE POSTAL              */07782   
                 SVG_ADRESSE            = DENTET12.CPCLI1;              07783   
                 DENTET12.CPCLI1        = DENTET12.CPCLI2;              07784   
                 DENTET12.CPCLI2        = SUBSTR(SVG_ADRESSE,1,5);      07785   
                 SVG_ADRESSE            = DENTET12.LOBDI1;              07786   
                 DENTET12.LOBDI1        = DENTET12.LOBDI2;              07787   
                 DENTET12.LOBDI2        = SUBSTR(SVG_ADRESSE,1,26);     07788   
              END;                                                      07789   
              WHEN ( 15 ) DO;           /*   PAYS                     */07790   
                 SVG_ADRESSE            = DENTET13.PAYCL1;              07791   
                 DENTET13.PAYCL1        = DENTET13.PAYCL2;              07792   
                 DENTET13.PAYCL2        = SUBSTR(SVG_ADRESSE,1,26);     07793   
              END;                                                      07794   
              OTHERWISE DO;                                             07795   
              END;                                                      07796   
           END;                         /*   FIN TEST SELECT          */07797   
           IF DENTET4.SAUT ^= '5A'X                                     07798   
           THEN DO ;                                                    07799   
              IF SUBSTR(DFACT,1,1) ^= '+'                               07800   
              THEN K_CLIFA = K_CLIFA + 1 ;                              07801   
           END ;                                                        07802   
           STRING(PLI_TELIGNFD)= SUBSTR(DFACT,3,173) ;                  07803   
           IF PLI_COFPAGSC = 'FCTF61' !                                 07804   
              PLI_COFPAGSC = 'FCTE41' !                                 07805   
              PLI_COFPAGSC = 'FCTD41' !                                 07806   
              PLI_COFPAGSC = 'FCTG11' !                                 07807   
              PLI_COFPAGSC = 'FCTM31' !                                 07808   
              PLI_COFPAGSC = 'FCTH91'                                   07809   
           THEN ;                         /*   K = 0   RAZ N� DE PAGE */07810   
           ELSE DO ;                                                    07811   
       /*     IF STRING(PLI_TELIGNFD) ^= ''    JCJ PORTAIL              07812   
              THEN DO   */                                              07813   
                 IF SAUT_LIG ^= 1                                       07814   
                    THEN CALL PCF_SAUT_LIG;                             07815   
                 IF PCFLI_ECRIT = 'N' THEN DO;                          07816   
                                         /*   YDU 07.08 -1 LIGNE PCFLI*/07817   
                    PCFLI_ECRIT  = 'O';                                 07818   
                    PLI_IILIGNFD = PLI_IILIGNFD - 1;                    07819   
                    END;                 ELSE DO;                       07820   
                    IF PLI_COFPAGSC = 'VIERGE1' !                       07821   
                       PLI_COFPAGSC = 'O1VIERGE'                        07822   
                       THEN DO;         /*    PAS ENVOI ARCHIVAGE     */07823   
                       END;                ELSE DO;                     07824   
                       WRITE FILE (IDDPCFLI) FROM (PLI_LIGNE) ;         07825   
                       NB_IDDPCFLI  = NB_IDDPCFLI + 1;                  07826   
                       END;                                             07827   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                07828   
                    STO_P_WOR.IIPAGEFD = PLI_IIPAGEFD ;                 07829   
                    STO_P_WOR.IILIGNFD = PLI_IILIGNFD ;                 07830   
                    STO_P_WOR.COFPAGSC = PLI_COFPAGSC ;                 07831   
                    STO_P_WOR.IIORLIFD = PLI_IIORLIFD ;                 07832   
                    STO_P_WOR.IDPOCASC = PLI_IDPOCASC ;                 07833   
                    CALL MEF_FICSTOP;                                   07834   
                    STO_P_GEN.GS.INFO  = SUBSTR(WFACT,3,173) ;          07835   
                    STO_P_GEN.ID.ENSEQ = STO_P_GEN.ID.ENSEQ + 1 ;       07836   
                    FICSTOP_PREV_GEN   = STO_P_GEN ;                    07837   
                    WRITE FILE (FICSTOP) FROM (STO_P_GEN) ;             07838   
                    NB_FICSTOP         = NB_FICSTOP + 1;                07839   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                07840   
                    END;                                                07841   
                 IF PLI_IILIGNFD = 69    /*   LIGNE EN EURO           */07842   
                  & (PLI_COFPAGSC = 'FCTF63' ! PLI_COFPAGSC = 'FCTH93') 07843   
                  & SUBSTR(PLI_FIL50_2,39,8) = 'EN EUROS'               07844   
                    THEN DO;             /*   LIGNE SUIVANTE NON ECRIT*/07845   
                    PCFLI_ECRIT  = 'N';                                 07846   
                    END;                                                07847   
       /*     END  */                                                   07848   
           END;                                                         07849   
           GO TO PCF_LEC_CLIFA;                                         07850   
                                                                        07851   
       PCF_EOF_CLIFA:                                                   07852   
           PEN_NUCLI    = WTCLI1.CLIFA ;                                07853   
           IF MOD_DEMA  = 'D'           /*    FACTURE DEMAT OU PAPIER */07854   
              THEN PEN_TYPFA   = 'D';                                   07855   
              ELSE PEN_TYPFA   = 'P';                                   07856   
           IF PEN_COFPAGSC = 'VIERGE1' ! PEN_COFPAGSC = 'O1VIERGE'      07857   
              THEN DO;                  /*    PAS ENVOI ARCHIVAGE     */07858   
              END;                      ELSE DO;                        07859   
              WRITE FILE (IDDPCFEN) FROM (PEN_ENTET) ;                  07860   
              NB_IDDPCFEN      = NB_IDDPCFEN + 1;                       07861   
              END;                                                      07862   
    END PCF_DUPLI_CLIFA ;                                               07863   
1   PCF_SAUT_LIG:      PROCEDURE;                                       07864   
-                                                                       07865   
                    /****************************************           07866   
                    *                                       *           07867   
                    *    GESTION DES SAUTS DE LIGNE         *           07868   
                    *    POUR LE PORTAIL CLIENTS            *           07869   
                    *                                       *           07870   
                    ****************************************/           07871   
0      PCF_SAUT_D:                                                      07872   
           IF PLIB_COFPAGSC = 'VIERGE1' !                               07873   
              PLIB_COFPAGSC = 'O1VIERGE'                                07874   
              THEN DO;                  /*    PAS ENVOI ARCHIVAGE     */07875   
              GO TO PCF_SAUT_F;                                         07876   
              END;                                                      07877   
           IF SAUT_LIG = 3 THEN DO;                                     07878   
              PLIB_LIGNE_R   = PLI_LIGNE_R ;                            07879   
              PLIB_TELIGNFD  = '';                                      07880   
              PLIB_IILIGNFD  = PLIB_IILIGNFD + 1 ;                      07881   
              WRITE FILE (IDDPCFLI) FROM (PLIB_LIGNE) ;                 07882   
              PLIB_IILIGNFD  = PLIB_IILIGNFD + 1 ;                      07883   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                07884   
                    STO_P_WOR.IIPAGEFD = PLIB_IIPAGEFD ;                07885   
                    STO_P_WOR.IILIGNFD = PLIB_IILIGNFD ;                07886   
                    STO_P_WOR.COFPAGSC = PLIB_COFPAGSC ;                07887   
                    STO_P_WOR.IIORLIFD = PLIB_IIORLIFD ;                07888   
                    STO_P_WOR.IDPOCASC = PLIB_IDPOCASC ;                07889   
                    CALL MEF_FICSTOP;                                   07890   
                    STO_P_GEN.GS.INFO  = ''            ;                07891   
                    STO_P_GEN.ID.ENSEQ = STO_P_GEN.ID.ENSEQ + 1 ;       07892   
                    FICSTOP_PREV_GEN   = STO_P_GEN ;                    07893   
                    WRITE FILE (FICSTOP) FROM (STO_P_GEN) ;             07894   
                    NB_FICSTOP         = NB_FICSTOP + 1;                07895   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                07896   
              WRITE FILE (IDDPCFLI) FROM (PLIB_LIGNE) ;                 07897   
              NB_IDDPCFLI    = NB_IDDPCFLI + 2;                         07898   
              PLI_IILIGNFD   = PLIB_IILIGNFD + 1;                       07899   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                07900   
                    STO_P_WOR.IIPAGEFD = PLIB_IIPAGEFD ;                07901   
                    STO_P_WOR.IILIGNFD = PLIB_IILIGNFD ;                07902   
                    STO_P_WOR.COFPAGSC = PLIB_COFPAGSC ;                07903   
                    STO_P_WOR.IIORLIFD = PLIB_IIORLIFD ;                07904   
                    STO_P_WOR.IDPOCASC = PLIB_IDPOCASC ;                07905   
                    CALL MEF_FICSTOP;                                   07906   
                    STO_P_GEN.GS.INFO  = ''            ;                07907   
                    STO_P_GEN.ID.ENSEQ = STO_P_GEN.ID.ENSEQ + 1 ;       07908   
                    FICSTOP_PREV_GEN   = STO_P_GEN ;                    07909   
                    WRITE FILE (FICSTOP) FROM (STO_P_GEN) ;             07910   
                    NB_FICSTOP         = NB_FICSTOP + 1;                07911   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                07912   
              END;                                                      07913   
           IF SAUT_LIG = 2 THEN DO;                                     07914   
              PLIB_LIGNE_R   = PLI_LIGNE_R ;                            07915   
              PLIB_TELIGNFD  = '';                                      07916   
              PLIB_IILIGNFD  = PLIB_IILIGNFD + 1 ;                      07917   
              WRITE FILE (IDDPCFLI) FROM (PLIB_LIGNE) ;                 07918   
              NB_IDDPCFLI    = NB_IDDPCFLI + 1;                         07919   
              PLI_IILIGNFD   = PLIB_IILIGNFD + 1;                       07920   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                07921   
                    STO_P_WOR.IIPAGEFD = PLIB_IIPAGEFD ;                07922   
                    STO_P_WOR.IILIGNFD = PLIB_IILIGNFD ;                07923   
                    STO_P_WOR.COFPAGSC = PLIB_COFPAGSC ;                07924   
                    STO_P_WOR.IIORLIFD = PLIB_IIORLIFD ;                07925   
                    STO_P_WOR.IDPOCASC = PLIB_IDPOCASC ;                07926   
                    CALL MEF_FICSTOP;                                   07927   
                    STO_P_GEN.GS.INFO  = ''            ;                07928   
                    STO_P_GEN.ID.ENSEQ = STO_P_GEN.ID.ENSEQ + 1 ;       07929   
                    FICSTOP_PREV_GEN   = STO_P_GEN ;                    07930   
                    WRITE FILE (FICSTOP) FROM (STO_P_GEN) ;             07931   
                    NB_FICSTOP         = NB_FICSTOP + 1;                07932   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                07933   
              END;                                                      07934   
           IF SAUT_LIG = 71 THEN DO;                                    07935   
              PLIB_LIGNE_R   = PLI_LIGNE_R ;                            07936   
              PLIB_TELIGNFD  = '';                                      07937   
              DO I = (PLIB_IILIGNFD + 1) TO 70;                         07938   
                 PLIB_IILIGNFD = PLIB_IILIGNFD + 1 ;                    07939   
                 WRITE FILE (IDDPCFLI) FROM (PLIB_LIGNE) ;              07940   
                 NB_IDDPCFLI   = NB_IDDPCFLI + 1;                       07941   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                07942   
                    STO_P_WOR.IIPAGEFD = PLIB_IIPAGEFD ;                07943   
                    STO_P_WOR.IILIGNFD = PLIB_IILIGNFD ;                07944   
                    STO_P_WOR.COFPAGSC = PLIB_COFPAGSC ;                07945   
                    STO_P_WOR.IIORLIFD = PLIB_IIORLIFD ;                07946   
                    STO_P_WOR.IDPOCASC = PLIB_IDPOCASC ;                07947   
                    CALL MEF_FICSTOP;                                   07948   
                    STO_P_GEN.GS.INFO  = ''            ;                07949   
                    STO_P_GEN.ID.ENSEQ = STO_P_GEN.ID.ENSEQ + 1 ;       07950   
                    FICSTOP_PREV_GEN   = STO_P_GEN ;                    07951   
                    WRITE FILE (FICSTOP) FROM (STO_P_GEN) ;             07952   
                    NB_FICSTOP         = NB_FICSTOP + 1;                07953   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                07954   
                 END;                                                   07955   
              PLI_IILIGNFD   = PLIB_IILIGNFD + 1;                       07956   
              END;                                                      07957   
0      PCF_SAUT_F:                                                      07958   
    END PCF_SAUT_LIG;                                                   07959   
                                                                        07960   
1   SPLAFAC:        PROCEDURE;                                          07961   
-          /*                                                           07962   
                    *****************************************           07963   
                    *                                       *           07964   
                    *    SOUS PROGRAMME DE LECTURE DU       *           07965   
                    *    FICHIER A FACTURER AVEC POSI-      *           07966   
                    *    TIONNEMENT DE L'INDICATEUR DE      *           07967   
                    *    RUPTURE IRAFAC                     *           07968   
                    *                                       *           07969   
                    *****************************************           07970   
           */                                                           07971   
0      B000D:                                                           07972   
           IF SWAFAC = '0' THEN DO;     /*   TEST DE 1ERE LECTURE     */07973   
                    SWAFAC = '1';                                       07974   
                    READ FILE (FFAC3A) INTO (ZENRWFAC);                 07975   
                    IF ZWTFAC.ORPRO = HIGH(1) THEN DO;                  07976   
                         IRAFAC     =  0 ;                              07977   
                         ENRWFAC    = ZENRWFAC;                         07978   
                         GO TO B000F;   /*   TEST EOF FICH A FACTURER */07979   
                         END;                                           07980   
                    END;                                                07981   
0                                       /*   TRANSFERT DS ZONE TRAVAIL*/07982   
           ENRWFAC  = ZENRWFAC;                                         07983   
0                                       /*   LECTURE FICH. A FACTURER */07984   
           READ FILE (FFAC3A) INTO (ZENRWFAC);                          07985   
0                                       /*   TEST FIN FICHIER         */07986   
           IF ZWTFAC.ORPRO  = HIGH(1) THEN DO;                          07987   
                    IRAFAC  =  0 ;                                      07988   
                    GO TO B000F;                                        07989   
                    END;                                                07990   
0                                       /*   TESTS DES RUPTURES       */07991   
0                                       /*   MODIF 07/99 AJOUT ZONES: */07992   
0                                       /*   FRAET DEPAY FRAE2 DEPA2  */07993   
                                        /******************************/07994   
0          IF RUPT1 ^= ZRUPT1 THEN DO;  /*   RUPTURE SUR              */07995   
                    IRAFAC =  1 ;       /*   EDIPA                    */07996   
                    GO TO B000F;                                        07997   
                    END;                                                07998   
0          IF RUPT2 ^= ZRUPT2 THEN DO;  /*   RUPTURE SUR AUTOM FRAET  */07999   
                    IRAFAC =  2 ;       /*   DEPAY CLIFA NCLI2 MACOM  */08000   
                    GO TO B000F;        /*   FACSP CADOR GNAT1 PEFAC  */08001   
                    END;                /*   TRANS FRAE2 DEPA2 NUCLI  */08002   
                                        /*   RGNAT TRACO DEPCO POFIS  */08003   
                                        /*   TYCLI                    */08004   
0          IF RUPT3 ^= ZRUPT3 THEN DO;  /*   RUPTURE SUR              */08005   
                    IRAFAC =  3 ;       /*   GNATO INFAC ECFAC NBFAC  */08006   
                    GO TO B000F;                                        08007   
                    END;                                                08008   
0          IF RUPT4 ^= ZRUPT4 THEN DO;  /*   RUPTURE SUR              */08009   
                    IRAFAC =  4 ;       /*   TRIFA                    */08010   
                    GO TO B000F;                                        08011   
                    END;                                                08012   
0          IF RUPT5 ^= ZRUPT5 THEN DO;  /*   RUPTURE SUR              */08013   
                    IRAFAC =  5 ;       /*   DAMIS NORUN LOREC        */08014   
                    GO TO B000F;                                        08015   
                    END;                                                08016   
0          IF RUPT6 ^= ZRUPT6 THEN DO;  /*   RUPTURE SUR              */08017   
                    IRAFAC =  6 ;       /*   RESAI                    */08018   
                    GO TO B000F;                                        08019   
                    END;                                                08020   
0          IF RUPT7 ^= ZRUPT7 THEN DO;  /*   RUPTURE SUR              */08021   
                    IRAFAC =  7 ;       /*   NUEDI LIDIV NUDIV        */08022   
                    GO TO B000F;        /*   GPSUX NUCOL              */08023   
                    END;                                                08024   
0          IF RUPT8 ^= ZRUPT8 THEN DO;  /*   RUPTURE SUR              */08025   
                    IRAFAC =  8 ;       /*   LISUM COTAX PRIFA RAPLI  */08026   
                    GO TO B000F;        /*   REMBA TYSUR              */08027   
                    END;                                                08028   
0          IF RUPT9 ^= ZRUPT9 THEN DO;  /*   RUPTURE SUR              */08029   
                    IRAFAC =  9 ;       /*   NUART                    */08030   
                    GO TO B000F;                                        08031   
                    END;                                                08032   
0          IRAFAC    =  10 ;            /*   RUPTURE RUNTR NUBOR CTRLI*/08033   
 /* PCA150825 CONTROLE CARACTERES SPECIAUX REFLI                        08034   
           KWUTI10_ZONE = ZWTFAC_REFLI ;                                08035   
           KWUTI10_IND  = 10 ;                                          08036   
           CALL KPUTI10 (KWUTI01) ;                                     08037   
           IF KWUTI01_CODE ^= 0 THEN PUT ('PB MODULE KPUTI10') ;        08038   
                                ELSE ZWTFAC_REFLI = KWUTI10_ZONE ;      08039   
                                                                      */08040   
0      B000F:                                                           08041   
           MACFA.NBLUS = MACFA.NBLUS + 1 ;                              08042   
           END SPLAFAC;                                                 08043   
           /* MODIFIE LE 4/5/2001 -- AJOUT RTN SYPROSP                */08044   
           /* VEFIFIER DANS CDLSYHMD SI SYSTEME PROSPECTION EST DANS  */08045   
           /* LA TABLE, SI OUI LE SPOOL A UTILISER SERA ALORS         */08046   
           /* LE SPOOL7                                               */08047   
1   SYPROSP:        PROCEDURE;                                          08048   
           SPIPA          = '';                                         08049   
           SPIPA.FONCT    = 'RP';                                       08050   
           SPIPA.COTAB    = 'CDLSYHMD';                                 08051   
           SPIPA.OPERA    = '=';                                        08052   
           SPIPA.REFPO    = WTCLI1.SYPRO ;                              08053   
           NUCLI_HMD      = 'N' ;                                       08054   
           CALL SPI2TBV (SPIPA,CDLSYHMD,SPIFI);                         08055   
           IF SPIPA.CORET = '00' THEN DO;                               08056   
              NUCLI_HMD   = 'O' ;        /*   UN_M = 70 SUPPR 24-10-01*/08057   
              WTMIC.EDIPA = '4';                                        08058   
              END;                                                      08059   
           END SYPROSP;                                                 08060   
1   REPOIDS:        PROCEDURE;                                          08061   
0          /*                                                           08062   
                    **************************************              08063   
                    *                                    *              08064   
                    *    SOUS PROGRAMME DE CALCUL DU     *              08065   
                    *    POIDS POUR LE GIH               *              08066   
                    *                                    *              08067   
                    **************************************              08068   
           */                                                           08069   
0      C000D:                                                           08070   
           IF WTFAC.EDIPA ^= '2' THEN GO TO C000F;                      08071   
0          SELECT (WTFAC.GNATO) ;                                       08072   
              WHEN ('0D','0F','1C','14') DO;                            08073   
                    LOREC.POIDS   = LOREC.POIDS + WTFAC.POILU;          08074   
                    LOREC.PDFAC   = LOREC.PDFAC + WTFAC.POILU;          08075   
                    END;                                                08076   
              WHEN ('41') DO;                                           08077   
                    /*     BFA$   ( WTFAC.QUANT * POIDFRED.POIDSF)*/    08078   
                    POIDS_GIH     = POIDS_GIH   +                       08079   
                                  ( WTFAC.NBTOM * POIDFRED.POIDSF) ;    08080   
                    END;                                                08081   
              OTHERWISE DO;                                             08082   
                    END;                                                08083   
              END;                /*   FIN TEST SELECT GNATO          */08084   
0      C000F:                                                           08085   
           END REPOIDS;                                                 08086   
1   ENTCDL:         PROCEDURE;                                          08087   
0          /*                                                           08088   
                    **************************************              08089   
                    *                                    *              08090   
                    *    SOUS PROGRAMME D'ECRITURE DE    *              08091   
                    *    L'ENTETE DE LA FACTURE : CDL    *              08092   
                    *    CE MODULE FAIT APPEL � L'ANCIEN.*              08093   
                    *    PROC ECRITURE (MICROFICHE FITRA *              08094   
                    *    ET AIDE LE TABLEAU TABLE-PAGE   *              08095   
                    **************************************              08096   
           */                                                           08097   
0      E000D:                                                           08098   
                                                                        08099   
           FACT.FOLIO            = FACT.FOLIO + 1;                      08100   
           FACT.LIGNE            = 0;                                   08101   
           INDEX_FACEXP.NUPAG    = FACT.FOLIO;                          08102   
           INDEX_FACEXP.EXEMP    = FACT.EXEMP;                          08103   
                                             /*YDV P0299*/              08104   
           IF EDIT_FDPAG         = 'O' THEN DO ;                        08105   
             /* MODIF L.ANJARD 06/99 : AFFICHER PAGEDEF/FORMDEF */      08106   
             /* POUR TOUTES LES PAGES POUR EDITION SOUS CTRDL/D */      08107   
             /* EDIT_FDPAG           = 'N'                      */      08108   
                STRING (ZSPOOLP_SVG)  = STRING (PAG1_PPG);              08109   
                CALL ECRITUR_AS ;                                       08110   
                STRING (ZSPOOLP_SVG)  = STRING (PAG2_PPG);              08111   
                CALL ECRITUR_AS ;                                       08112   
           END;                                                         08113   
           ENTET4.FOLIO          = FACT.FOLIO ;                         08114   
           STRING(ZSPOOLP_SVG)   = STRING(ENTET1);                      08115   
           CALL ECRITUR_AS;                                             08116   
           STRING(ZSPOOLP_SVG)   = STRING(ENTET2);                      08117   
           CALL ECRITUR_AS;                                             08118   
           STRING(ZSPOOLP_SVG)   = STRING(ENTET3);                      08119   
           CALL ECRITUR_AS;                                             08120   
                                           /***************************/08121   
0          IF WTFAC.EDIPA = '2' THEN DO;   /*   CAS  DU  GIH          */08122   
                                           /***************************/08123   
                 ENTET4.FIL3     = 'D . C . ';                          08124   
                 ENTET4.EXEMP    = 1;                                   08125   
                 STRING(ZSPOOLP_SVG)  = STRING(ENTET4);                 08126   
                 IF ^( WTFAC.GS.TRACO = '2' & WTFAC.GS.DEPCO = '16' )   08127   
                    & EDIT_FACTU = 'O'                                  08128   
                    & ^(TOP_DEMA_FAC = 'O' & MOD_DEMA = 'D' ) THEN DO;  08129   
                     IF FINAN_FRAIS = 'O' THEN DO;                      08130   
                        SUBSTR(ZSPOOLP_SVG.ZIMP,176,17)   = INDEX_FACTU;08131   
                        CALL SPOOLA32(CINQ,ZSPOOLP_SVG);                08132   
                        END;               ELSE DO;                     08133   
                        IF UN_M = 70   THEN                             08134   
                          SUBSTR(ZSPOOLP_SVG.ZIMP,176,17) = INDEX_FACTU;08135   
                        IF UN_M = 20   THEN                             08136   
                          SUBSTR(ZSPOOLP_SVG.ZIMP,166,39) =INDEX_FACEXX;08137   
                        CALL SPOOLA32(UN_M,ZSPOOLP_SVG);                08138   
                        END;                                            08139   
                     END;                                               08140   
                 PASTK.CODLE     = 'E';                                 08141   
                 ENTET4.FIL3     = ' ';                                 08142   
                 STRING(ZSPOOLP_SVG)    = STRING(ENTET4);               08143   
 /*********************************************************************/08144   
 /* AJOUT LE 04 11 92 : ACCES AU FICHIER CLIENTS AUXILIAIRE EXPORT    */08145   
 /* POUR RECUPERER LE N� IDENTIFICATION ACQUEREUR CEE POUR LE CLIENT  */08146   
 /* TRAITE                                                            */08147   
 /* SI TROUVE : ALORS AFFICHAGE LIBELLE + N� IDENTIFICATION           */08148   
 /* SINON     : RIEN                                                  */08149   
 /*********************************************************************/08150   
                 WK_TROUV = 'O' ;                                       08151   
                 READ FILE(FEXCLI) INTO(ZEXCLI) KEY(NUCLINUM) ;         08152   
                                                                        08153   
                 IF WK_TROUV = 'O' THEN DO;                             08154   
 TROUVE:                                                                08155   
                         IF WEXCLI.CEECLI ^= ' '                        08156   
                            THEN DO;                                    08157   
                                 ENTET7.LIBCEE = 'NO CEE : ';           08158   
                                 ENTET7.IDCLI  = WEXCLI.CEECLI ;        08159   
                            END;                                        08160   
                            ELSE DO;                                    08161   
                                 ENTET7.LIBCEE = ' ';                   08162   
                                 ENTET7.IDCLI = ' ';                    08163   
                            END;                                        08164   
                 END;                                                   08165   
                 ELSE DO;                                               08166   
 NTROUVE:                                                               08167   
                         ENTET7.LIBCEE = ' ';                           08168   
                         ENTET7.IDCLI  = ' ' ;                          08169   
                         WK_TROUV = 'O' ;                               08170   
                 END;                                                   08171   
                                                                        08172   
 /*************************/                                            08173   
 /* FIN AJOUT LE 04 11 92 */                                            08174   
 /*************************/                                            08175   
                                        /*   POUR MICROFICHES         */08176   
                 IF ^(TOP_DEMA_FAC = 'O' & MOD_DEMA = 'D' ) THEN DO;    08177   
                    WS_NULIG       = WS_NULIG + 1;                      08178   
                    IF WS_NULIG < 99999 THEN DO;                        08179   
                       WTMIC.NULIG = WTMIC.NULIG + 1;                   08180   
                       END;      ELSE DO;                               08181   
                       WTMIC.NULIG = 99999 ;                            08182   
                       END;                                             08183   
                    WS_NBMIC     = WS_NBMIC + 1;                        08184   
                    WTMIC.INFO   = STRING(ZSPOOLP_SVG);                 08185   
                    WRITE FILE (FMICRO) FROM (WTMIC);                   08186   
                    END;                                                08187   
                 PASTK.PWTMVT    = PZIMP;                               08188   
                 IF W_ENTE_PORT  = 'NON' THEN                           08189   
                 CALL ID470F;             /*YDV E0299*/                 08190   
                 IF WTFAC.PEFAC  = '9'                                  08191   
                    THEN ENTET70.FOLIO = 0;                             08192   
                    ELSE FOLIO_70GIH   = FACT.FOLIO;                    08193   
                 GO TO H000B;                                           08194   
             END;                   /*   FIN  GIH                 */    08195   
1                                                                       08196   
 /*******************************************************************/  08197   
 /* RECHERCHE N0 INTRA-COMMUNAUTAIRE CLIENT POUR EDDL FRANCE/EXPORT */  08198   
 /* IDENTIFIANT E.D.D.L. :     DEPCO = 10      AJOUT LE 15 01 97 �$ */  08199   
 /*                                                                 */  08200   
 /*******************************************************************/  08201   
  /*  IF WTFAC.DEPCO = '10' &   WS_SVG_NUFAC ^= WNUFAC   */             08202   
      IF WTFAC.DEPCO = '10'                                             08203   
         THEN DO;                                                       08204   
     /*        WS_SVG_NUFAC  = WNUFAC    */                             08205   
               ENTET7.LIBCEE = ' ';                                     08206   
               ENTET7.IDCLI  = ' ' ;                                    08207   
               WK_TROUV      = 'O' ;                                    08208   
               READ FILE(FEXCLI) INTO(ZEXCLI) KEY(NUCLINUM) ;           08209   
               IF WK_TROUV = 'O'                                        08210   
                  THEN DO;                                              08211   
                 /*    PUT SKIP LIST ('EXPORT CLI: ' !! NUCLINUM !!     08212   
                       ' NO CEE : ' !!  WEXCLI.CEECLI  !!               08213   
                       ' NUFAC  : ' !!  WS_SVG_NUFAC )    */            08214   
                                                                        08215   
                       IF WEXCLI.CEECLI ^= ' '                          08216   
                          THEN DO;                                      08217   
                               ENTET7.LIBCEE = 'NO CEE : ';             08218   
                               ENTET7.IDCLI  = WEXCLI.CEECLI ;          08219   
                          END;                                          08220   
                  END;                                                  08221   
         END;                                                           08222   
                                                                        08223   
 /*************************/                                            08224   
 /* FIN AJOUT LE 04 11 92 */                                            08225   
 /*************************/                                            08226   
0          IF FACT.RETOUR = '1' THEN DO;/*   SI  AUTORISATION  RETOUR */08227   
                                        /*   IMPOSITION D'UN LIBELLE  */08228   
                    ENTET7_1.LIDOC = 'AUTORISAT. DE RETOUR';            08229   
                    ENTET4.EXEMP   = 0;                                 08230   
                    ENTET7_1.LGNAT = ' ';                               08231   
                    STRING(ZSPOOLP_SVG)   = STRING(ENTET4) ;            08232   
0                   ZSPOOLP        = ZSPOOLP_SVG;/*POUR MICROFICHES   */08233   
                    IF ^( WTFAC.GS.TRACO = '2' & WTFAC.GS.DEPCO = '16') 08234   
                      & EDIT_FACTU = 'O'                                08235   
                      & ^(TOP_DEMA_FAC = 'O' & MOD_DEMA = 'D') THEN DO; 08236   
                        IF UN_M = 10 ! FINAN_FRAIS = 'O' !              08237   
                           UN_M = 70   THEN                             08238   
                           SUBSTR(ZSPOOLP.ZIMP,176,17) = INDEX_FACTU ;  08239   
                        IF UN_M = 20   THEN                             08240   
                           SUBSTR(ZSPOOLP.ZIMP,166,39) = INDEX_FACEXX;  08241   
                        IF FINAN_FRAIS = 'O' THEN DO;                   08242   
                           CALL SPOOLA32(CINQ,ZSPOOL);                  08243   
                           END;            ELSE DO;                     08244   
                           CALL SPOOLA32(UN_M,ZSPOOL);                  08245   
                           END;                                         08246   
                        END;                                            08247   
                    PASTK.CODLE    = 'E';                               08248   
                    PASTK.PWTMVT   = PZIMP;                             08249   
                                         /* NON ECRITURE PAGE DE GARDE*/08250   
                    IF ^(W_ENTE_PORT = 'OUI' &                          08251   
                         WTFAC.EDIPA = '2' ) THEN                       08252   
                         CALL ID470F;    /*YDV E0299*/                  08253   
                                                                        08254   
                    ENTET4.EXEMP   = 1;                                 08255   
                    STRING(ZSPOOLP_SVG) = STRING(ENTET4);               08256   
                    IF ^(TOP_DEMA_FAC = 'O' & MOD_DEMA = 'D' ) THEN DO; 08257   
                       WS_NULIG       = WS_NULIG + 1;                   08258   
                       IF WS_NULIG < 99999 THEN DO;                     08259   
                          WTMIC.NULIG = WTMIC.NULIG + 1;                08260   
                          END;        ELSE DO;                          08261   
                          WTMIC.NULIG = 99999 ;                         08262   
                          END;                                          08263   
                       WS_NBMIC    = WS_NBMIC + 1;                      08264   
                       WTMIC.INFO  = STRING(ZSPOOLP_SVG);               08265   
                       WRITE FILE (FMICRO) FROM (WTMIC);                08266   
                       END;                                             08267   
0                   STRING(ZSPOOLP_SVG) = STRING(ENTET5);               08268   
                    ZSPOOLP_SVG.ZSAUT   = ' ' ;                         08269   
                    ZSPOOLP_SVG.POLIC   = '00'X;                        08270   
                    CALL ECRITUR_AS;                                    08271   
0                   ENTET4.EXEMP   = 0;                                 08272   
                    STRING(ZSPOOLP_SVG)  = STRING(ENTET7) ;             08273   
                    IF ^( WTFAC.GS.TRACO = '2' & WTFAC.GS.DEPCO = '16') 08274   
                       & EDIT_FACTU = 'O'                               08275   
                       & ^(TOP_DEMA_FAC = 'O' & MOD_DEMA = 'D') THEN DO;08276   
                        IF UN_M = 10 ! FINAN_FRAIS = 'O' !              08277   
                           UN_M = 70   THEN                             08278   
                          SUBSTR(ZSPOOLP_SVG.ZIMP,176,17) = INDEX_FACTU;08279   
                        IF UN_M = 20   THEN                             08280   
                          SUBSTR(ZSPOOLP_SVG.ZIMP,166,39) =INDEX_FACEXX;08281   
                        IF FINAN_FRAIS = 'O' THEN DO;                   08282   
                           CALL SPOOLA32(CINQ,ZSPOOLP_SVG);             08283   
                           END;            ELSE DO;                     08284   
                           CALL SPOOLA32(UN_M,ZSPOOLP_SVG);             08285   
                           END;                                         08286   
0                       CALL MEF_LIDOC;/*   CALCUL LG TITRE DOCUMENT  */08287   
                        STRING(ZSPOOLP_SVG)  = STRING(ENTET7_1_EDI) ;   08288   
                        IF UN_M = 10 ! FINAN_FRAIS = 'O' !              08289   
                           UN_M = 70   THEN                             08290   
                          SUBSTR(ZSPOOLP_SVG.ZIMP,176,17) = INDEX_FACTU;08291   
                        IF UN_M = 20   THEN                             08292   
                          SUBSTR(ZSPOOLP_SVG.ZIMP,166,39) =INDEX_FACEXX;08293   
                        IF FINAN_FRAIS = 'O' THEN DO;                   08294   
                           CALL SPOOLA32(CINQ,ZSPOOLP_SVG);             08295   
                           END;            ELSE DO;                     08296   
                           CALL SPOOLA32(UN_M,ZSPOOLP_SVG);             08297   
                           END;                                         08298   
                        END;                                            08299   
                                           /*   POUR MICROFICHES      */08300   
0                   PASTK.CODLE    = 'E';                               08301   
                    ENTET7_1.LIDOC = FACT.LIDOC;                        08302   
                    ENTET7_1.LGNAT = FACT.LGNAT;                        08303   
                    NUFACCHAR      = ' ';                               08304   
                    ENTET7.ENVEL   = ' ';                               08305   
                    STRING(ZSPOOLP_SVG) = STRING(ENTET7) ;              08306   
                    IF ^(TOP_DEMA_FAC = 'O' & MOD_DEMA  = 'D') THEN DO; 08307   
                       WTMIC.INFO     = STRING(ZSPOOLP_SVG);            08308   
                       WS_NULIG       = WS_NULIG + 1;                   08309   
                       IF WS_NULIG < 99999 THEN DO;                     08310   
                          WTMIC.NULIG = WTMIC.NULIG + 1;                08311   
                          END;        ELSE DO;                          08312   
                          WTMIC.NULIG = 99999 ;                         08313   
                          END;                                          08314   
                       WS_NBMIC       = WS_NBMIC + 1;                   08315   
                       WRITE FILE (FMICRO) FROM (WTMIC);                08316   
                       END;                                             08317   
                    PASTK.PWTMVT   = PZIMP;                             08318   
                                         /* NON ECRITURE PAGE DE GARDE*/08319   
                    IF ^(W_ENTE_PORT = 'OUI' &                          08320   
                         WTFAC.EDIPA = '2' ) THEN                       08321   
                    CALL ID470F;             /*YDV E0299*/              08322   
                                                                        08323   
                                         /* GROSSE POLICE TITRE DOCUME*/08324   
                    CALL MEF_LIDOC;      /*   GESTION LG TITRE DOCUMEN*/08325   
                                         /*   POUR MICROFICHES        */08326   
0                   PASTK.CODLE    = 'E';                               08327   
                    STRING(ZSPOOLP_SVG)  = STRING(ENTET7_1_EDI);        08328   
                    IF ^(TOP_DEMA_FAC = 'O' & MOD_DEMA  = 'D') THEN DO; 08329   
                       WTMIC.INFO     = STRING(ZSPOOLP_SVG);            08330   
                       WS_NULIG       = WS_NULIG + 1;                   08331   
                       IF WS_NULIG < 99999 THEN DO;                     08332   
                          WTMIC.NULIG = WTMIC.NULIG + 1;                08333   
                          END;        ELSE DO;                          08334   
                          WTMIC.NULIG = 99999 ;                         08335   
                          END;                                          08336   
                       WS_NBMIC    = WS_NBMIC + 1;                      08337   
                       WRITE FILE (FMICRO) FROM (WTMIC);                08338   
                       END;                                             08339   
                    PASTK.PWTMVT   = PZIMP;                             08340   
                                         /* NON ECRITURE PAGE DE GARDE*/08341   
                    IF ^(W_ENTE_PORT = 'OUI' &                          08342   
                         WTFAC.EDIPA = '2' )                            08343   
                         THEN CALL ID470F;                              08344   
0                   GO TO H000E;                                        08345   
                    END;                /*   FIN TEST AUTOR. RETOUR   */08346   
0          ENTET4.EXEMP        = 1;     /*   PAS AUTORISAT. RETOUR    */08347   
           STRING(ZSPOOLP_SVG) = STRING(ENTET4) ;                       08348   
           CALL ECRITUR_AS;                                             08349   
0      H000B:                                                           08350   
0          STRING(ZSPOOLP_SVG) = STRING(ENTET5);                        08351   
           ZSPOOLP_SVG.ZSAUT   = ' ' ;                                  08352   
           ZSPOOLP_SVG.POLIC   = '00'X;                                 08353   
           CALL ECRITUR_AS;                                             08354   
0          ENTET7_1.LIDOC      = FACT.LIDOC;                            08355   
           ENTET7_1.LGNAT      = FACT.LGNAT;                            08356   
           STRING(ZSPOOLP_SVG) = STRING(ENTET7) ;                       08357   
           IF NUFACCHAR ^= ' ' THEN DO;/*    1ER IDENTIF FACTURE      */08358   
                 ZSPOOLP        = ZSPOOLP_SVG;                          08359   
                 IF ^( WTFAC.GS.TRACO = '2' & WTFAC.GS.DEPCO = '16' )   08360   
                    & EDIT_FACTU = 'O'                                  08361   
                    & ^(TOP_DEMA_FAC = 'O' & MOD_DEMA = 'D') THEN DO ;  08362   
                     IF UN_M = 10 ! FINAN_FRAIS = 'O' !                 08363   
                        UN_M = 70   THEN                                08364   
                        SUBSTR(ZSPOOLP_SVG.ZIMP,176,17) = INDEX_FACTU ; 08365   
                     IF UN_M = 20   THEN                                08366   
                        SUBSTR(ZSPOOLP_SVG.ZIMP,166,39) = INDEX_FACEXX; 08367   
                     IF FINAN_FRAIS = 'O' THEN DO;                      08368   
                        CALL SPOOLA32(CINQ,ZSPOOLP_SVG);                08369   
                        END;               ELSE DO;                     08370   
                        CALL SPOOLA32(UN_M,ZSPOOLP_SVG);                08371   
                        END;                                            08372   
                     END;                                               08373   
                                        /*   POUR MICROFICHES         */08374   
                 IF ^(TOP_DEMA_FAC = 'O' & MOD_DEMA  = 'D') THEN DO;    08375   
                    WS_NULIG       = WS_NULIG + 1;                      08376   
                    IF WS_NULIG < 99999 THEN DO;                        08377   
                       WTMIC.NULIG = WTMIC.NULIG + 1;                   08378   
                       END;        ELSE DO;                             08379   
                       WTMIC.NULIG = 99999 ;                            08380   
                       END;                                             08381   
                    WS_NBMIC    = WS_NBMIC + 1;                         08382   
                    WTMIC.INFO  = STRING(ZSPOOL) ;                      08383   
                    WRITE FILE (FMICRO) FROM (WTMIC);                   08384   
                    END;                                                08385   
0                NUFACCHAR      = ' ';                                  08386   
                 ENTET7.ENVEL   = ' ';                                  08387   
                 IF FACT.MULFAC = '1' THEN DO;                          08388   
                    STRING(ZSPOOLP_SVG) = STRING(ENTET7);               08389   
                    PASTK.CODLE         = 'E';                          08390   
                    PASTK.PWTMVT        = PZIMP ;                       08391   
                                         /* NON ECRITURE PAGE DE GARDE*/08392   
                    IF ^(W_ENTE_PORT = 'OUI' &                          08393   
                         WTFAC.EDIPA = '2' ) THEN                       08394   
                    CALL ID470F;         /*YDV E0299*/                  08395   
                    END;                                                08396   
                                         /*  GROSSE POLICE TITRE DOCUM*/08397   
                 CALL MEF_LIDOC;         /*   GESTION LG TITRE DOCUMEN*/08398   
                 STRING(ZSPOOLP_SVG) = STRING(ENTET7_1_EDI) ;           08399   
                 ZSPOOLP        = ZSPOOLP_SVG;                          08400   
                 IF ^( WTFAC.GS.TRACO = '2' & WTFAC.GS.DEPCO = '16' )   08401   
                    & EDIT_FACTU = 'O'                                  08402   
                    & ^(TOP_DEMA_FAC = 'O' & MOD_DEMA = 'D') THEN DO;   08403   
                     IF UN_M = 10 ! FINAN_FRAIS = 'O' !                 08404   
                        UN_M = 70   THEN                                08405   
                        SUBSTR(ZSPOOLP_SVG.ZIMP,176,17) = INDEX_FACTU ; 08406   
                     IF UN_M = 20   THEN                                08407   
                        SUBSTR(ZSPOOLP_SVG.ZIMP,166,39) = INDEX_FACEXX; 08408   
                     IF FINAN_FRAIS = 'O' THEN DO;                      08409   
                        CALL SPOOLA32(CINQ,ZSPOOLP_SVG);                08410   
                        END;               ELSE DO;                     08411   
                        CALL SPOOLA32(UN_M,ZSPOOLP_SVG);                08412   
                        END;                                            08413   
                     END;                                               08414   
                                        /*   POUR MICROFICHES         */08415   
                 IF ^(TOP_DEMA_FAC = 'O' & MOD_DEMA  = 'D') THEN DO;    08416   
                    WS_NULIG       = WS_NULIG + 1;                      08417   
                    IF WS_NULIG < 99999 THEN DO;                        08418   
                       WTMIC.NULIG = WTMIC.NULIG + 1;                   08419   
                       END;        ELSE DO;                             08420   
                       WTMIC.NULIG = 99999 ;                            08421   
                       END;                                             08422   
                    WS_NBMIC    = WS_NBMIC + 1;                         08423   
                    WTMIC.INFO  = STRING(ZSPOOL) ;                      08424   
                    WRITE FILE (FMICRO) FROM (WTMIC);                   08425   
                    END;                                                08426   
0                NUFACCHAR      = ' ';                                  08427   
                 ENTET7.ENVEL   = ' ';                                  08428   
                 IF FACT.MULFAC = '1' THEN DO;                          08429   
                    STRING(ZSPOOLP_SVG) = STRING(ENTET7_1_EDI);         08430   
                    PASTK.CODLE         = 'E';                          08431   
                    PASTK.PWTMVT        = PZIMP ;                       08432   
                                         /* NON ECRITURE PAGE DE GARDE*/08433   
                    IF ^(W_ENTE_PORT = 'OUI' &                          08434   
                         WTFAC.EDIPA = '2' )                            08435   
                         THEN CALL ID470F;                              08436   
                    END;                                                08437   
                 END;           ELSE DO;/*   FIN TEST 1E PAGE 1E FACT.*/08438   
                 STRING(ZSPOOLP_SVG)    = STRING(ENTET7) ;              08439   
                 CALL ECRITUR_AS;                                       08440   
                 CALL MEF_LIDOC;        /*   GESTION LG TITRE DOCUMEN */08441   
                                        /*   GROSSE POLICE TITRE DOCUM*/08442   
                 STRING(ZSPOOLP_SVG)    = STRING(ENTET7_1_EDI) ;        08443   
                 CALL ECRITUR_AS;                                       08444   
                 END;                                                   08445   
0      H000E:                                                           08446   
0          STRING(ZSPOOLP_SVG) = STRING(ENTET65);                       08447   
           CALL ECRITUR_AS;                                             08448   
0          STRING(ZSPOOLP_SVG) = STRING(ENTET70);                       08449   
           CALL ECRITUR_AS;                                             08450   
0          ZSPOOLP_SVG         = '' ;                                   08451   
           ZSPOOLP_SVG.ZSAUT   = ' ' ;                                  08452   
           ZSPOOLP_SVG.POLIC   = '00'X;                                 08453   
           CALL ECRITUR_AS;                                             08454   
                                                /*SI FOLIO = 1 FRANCE   08455   
                                                      ET TRACO DIFF 4   08456   
                                                     FOLIO = 0 EXPORT*/ 08457   
   /*    IF ( WTFAC.EDIPA ^= '2' & FACT.FOLIO = 1 &                     08458   
              WTFAC.TRACO ^= '4' ) !                                    08459   
            ( WTFAC.EDIPA  = '2' & FACT.FOLIO = 0 )                     08460   
           THEN DO  */                               /*YDV E0299*/      08461   
0          STRING(ZSPOOLP_SVG) = STRING(ENTET8) ;                       08462   
           ZSPOOLP_SVG.POLIC   = '01'X ;                                08463   
           CALL ECRITUR_AS;                                             08464   
           STRING(ZSPOOLP_SVG) = STRING(ENTET9) ;                       08465   
           ZSPOOLP_SVG.POLIC   = '01'X ;                                08466   
           CALL ECRITUR_AS;                                             08467   
           STRING(ZSPOOLP_SVG) = STRING(ENTET10) ;                      08468   
           ZSPOOLP_SVG.POLIC   = '01'X ;                                08469   
           CALL ECRITUR_AS;                                             08470   
           STRING(ZSPOOLP_SVG) = STRING(ENTET11) ;                      08471   
           ZSPOOLP_SVG.POLIC   = '01'X ;                                08472   
           CALL ECRITUR_AS;                                             08473   
           STRING(ZSPOOLP_SVG) = STRING(ENTET12) ;                      08474   
           ZSPOOLP_SVG.POLIC   = '01'X ;                                08475   
           CALL ECRITUR_AS;                                             08476   
           STRING(ZSPOOLP_SVG) = STRING(ENTET13) ;                      08477   
           ZSPOOLP_SVG.POLIC   = '01'X ;                                08478   
           CALL ECRITUR_AS;                                             08479   
    /*   END  */                                                        08480   
                                                                        08481   
                                                                        08482   
0          ZSPOOLP_SVG         = '' ;                                   08483   
           ZSPOOLP_SVG.POLIC   = '00'X ;                                08484   
           CALL ECRITUR_AS;                                             08485   
0          IF WTFAC.EDIPA = '2' THEN J = 1;/*SUPPRIMER SAUT CANAL     */08486   
                                ELSE J = 4;/*SUPPRIMER SAUT CANAL     */08487   
           DO I = 1 TO J;               /*   SUPPRIMER SAUT CANAL     */08488   
                 ZSPOOLP_SVG            = '' ;                          08489   
                 ZSPOOLP_SVG.POLIC      = '00'X;                        08490   
                 CALL ECRITUR_AS;                                       08491   
                 END;                   /*   SUPPRIMER SAUT CANAL     */08492   
0      E000G:                                                           08493   
           IF WTFAC.EDIPA = '2' THEN DO;                                08494   
              ENTET14.LIBEL2     = ' '; ENTET15.LIBEL2     = ' ';       08495   
              ENTET14.LIBEL3     = ' '; ENTET15.LIBEL4     = ' ';       08496   
              ENTET14.LIBEL4     = ' '; ENTET15.LIBEL5     = ' ';       08497   
              ENTET14.LIBEL5     = ' ';                                 08498   
              ENTET14.LIBEL1     = ' ';                                 08499   
            IF W_ENTE_PORT = 'NON' THEN DO;/*NON ECRIT SI 1ERE PAGE*/   08500   
              IF WTFAC.POFIS = '4' ! WTFAC.POFIS = '8' THEN DO;         08501   
                 ENTET14.LIBEL1  = ' ';                                 08502   
                 END;            ELSE DO;                               08503   
                 ENTET14.LIBEL1  = 'T';                                 08504   
                 END;                                                   08505   
              IF WTFAC.REGFA  = '1' THEN DO;                            08506   
                 ENTET15.LIBEL5  = '  PRIX ';                           08507   
                 ENTET14.LIBEL5  = ' PUBLIC';                           08508   
                 END;                   /*   FIN  TEST CLIENT ETRANG. */08509   
              IF WTFAC.REGFA  = '2' THEN DO;                            08510   
                 ENTET15.LIBEL5  = '  PRIX ';                           08511   
                 ENTET14.LIBEL5  = ' EXPORT';                           08512   
                 END;                   /*   FIN  TEST CLIENT BELGE   */08513   
              IF WTCLI1.TYFAC = '5' THEN DO;                            08514   
                 ENTET14.LIBEL2  = ' SUR.SI*';                          08515   
                 ENTET15.LIBEL2  = ' REMISE ';                          08516   
                 GO TO E000H;                                           08517   
                 END;                   /*   FIN  TEST  TYFAC 5       */08518   
              IF WTCLI1.TYFAC = '6' THEN DO;                            08519   
                 ENTET14.LIBEL5  = 'PX.NET';                            08520   
                 ENTET15.LIBEL5  = ' ';                                 08521   
                 GO TO E000H;                                           08522   
                 END;                   /*   FIN  TEST  TYFAC 6       */08523   
              IF WTCLI1.TYFAC = '7' THEN DO;                            08524   
                                        /*   TEST CLIENT ETRANGER     */08525   
                 ENTET14.LIBEL2  = ' SUR.SI*';                          08526   
                 ENTET15.LIBEL2  = ' REMISE ';                          08527   
                 ENTET14.LIBEL3  = ' PX.NET';                           08528   
                 END;                   /*   FIN  TEST  TYFAC 7       */08529   
       E000H:                                                           08530   
0             IF WTFAC.REGFA = '2' ! WTCLI1.TYFAC = '6' !               08531   
                 (WTFAC.FRAET = '2' & WREPRI = '1' )                    08532   
                 THEN DO ;                                              08533   
                 ENTET14.LIBEL4   = ' ';                                08534   
                 END;                                                   08535   
                 ELSE DO ;                                              08536   
                 ENTET14.LIBEL4   = 'PRIX TC';                          08537   
                 END;                                                   08538   
             END;                      /*    FIN TEST PORTRAIT*/        08539   
0             STRING(ZSPOOLP_SVG)       = STRING(ENTET15);              08540   
              CALL ECRITUR_AS;                                          08541   
0             STRING(ZSPOOLP_SVG)       = STRING(ENTET14);              08542   
              CALL ECRITUR_AS;                                          08543   
0             ZSPOOLP_SVG               = ''  ;                         08544   
              ZSPOOLP_SVG.POLIC         = '00'X ;                       08545   
              CALL ECRITUR_AS;                                          08546   
              END;                                                      08547   
0      E000F:                                                           08548   
                                          /*YDV P0299*/                 08549   
           IF I_TP  >   0 THEN DO ;       /*VIDAGE TABLEAU*/            08550   
            CALL VIDAGE_PAGE ;                                          08551   
           END;                                                         08552   
           END ENTCDL;                                                  08553   
1   ECRITUR_AS:        PROCEDURE;              /*YDV P0299*/            08554   
0          /*                                                           08555   
                    ****************************************            08556   
                    *                                      *            08557   
                    *    BUT DE CE SOUS PROGRAMME          *            08558   
                    *                                      *            08559   
                    *       - PAS DE TRAITEMENT SI DEMA    *            08560   
                    *       - EDITION LIGNE MICROFICHE     *            08561   
                    *       - SI AUTORISATION DE RETOUR    *            08562   
                    *         EDITION AUTORISAT. RETOUR    *            08563   
                    *              SUR LA BANDE SPOOL      *            08564   
                    *         EDITION DE LA FACTURE SUR    *            08565   
                    *              FICHIER DISQUE FTRAV    *            08566   
                    *       - SI NON AUTORISAT.  RETOUR    *            08567   
                    *         EDITION DE LA FACTURE SUR    *            08568   
                    *              LA BANDE SPOOL          *            08569   
                    *         EDITION DE LA FACTURE SUR    *            08570   
                    *              FICHIER DISQUE FITRA    *            08571   
                    *              SI FACTURE MULTIPLE     *            08572   
                    *                                      *            08573   
                    ****************************************            08574   
           */                                                           08575   
0      F000D:                                                           08576   
           ZSPOOLP   = ZSPOOLP_SVG;                                     08577   
                                        /*   NON EDIT. SI DEMAT PROD  */08578   
           IF TOP_DEMA_FAC = 'O' & MOD_DEMA = 'D' THEN DO;              08579   
              PASTK.PWTMVT   = PZIMP ;                                  08580   
              GO TO F000G;                                              08581   
              END;                                                      08582   
           IF PIEDFA = '0' THEN GO TO F000E;                            08583   
           IF (WTFAC.GS.TRACO = '2' & WTFAC.GS.DEPCO = '16')            08584   
              ! EDIT_FACTU = 'N'                                        08585   
              THEN GO TO F000E;         /*   NON EDI. FACT.BB 01.06.83*/08586   
                                        /*   NON EDIT. PIED SI RETOUR */08587   
           IF UN_M = 10 ! FINAN_FRAIS = 'O' !                           08588   
              UN_M = 70   THEN                                          08589   
              SUBSTR(ZSPOOLP.ZIMP,176,17) = INDEX_FACTU ;               08590   
           IF UN_M = 20   THEN                                          08591   
              SUBSTR(ZSPOOLP.ZIMP,166,39) = INDEX_FACEXX;               08592   
           IF FINAN_FRAIS = 'O' THEN DO;                                08593   
              CALL SPOOLA32(CINQ,ZSPOOL);                               08594   
              END;                      ELSE DO;                        08595   
              CALL SPOOLA32(UN_M,ZSPOOL);/*  FACTURE FORMAT A4        */08596   
              END;                                                      08597   
0      F000E:                                                           08598   
           PASTK.PWTMVT      = PZIMP ;                                  08599   
           WTMIC.INFO        = STRING(ZSPOOLP_SVG);                     08600   
           WS_NULIG          = WS_NULIG + 1;                            08601   
           IF WS_NULIG < 99999 THEN DO;                                 08602   
              WTMIC.NULIG    = WTMIC.NULIG + 1;                         08603   
              END;               ELSE DO;                               08604   
              WTMIC.NULIG    = 99999 ;                                  08605   
              END;                                                      08606   
           WS_NBMIC          = WS_NBMIC + 1;                            08607   
           WRITE FILE (FMICRO) FROM (WTMIC);                            08608   
0      F000G:                                                           08609   
0          IF FACT.MULFAC = '1' THEN DO;/*   TEST FACTURE MULTIPLE    */08610   
                                        /*   FACTURE CLIFA NUCLI      */08611   
                    PASTK.CODLE         = 'E';                          08612   
                                                                        08613   
                                         /* NON ECRITURE PAGE DE GARDE*/08614   
                    IF ^(W_ENTE_PORT = 'OUI' &                          08615   
                         WTFAC.EDIPA = '2' ) THEN                       08616   
                    CALL ID470F;        /*YDV E0299*/                   08617   
                                        /*   ECRIT. SUR DISQUE FAC.MUL*/08618   
           END;                                                         08619   
0      F000F:                                                           08620   
           END ECRITUR_AS ;                                             08621   
                                                                        08622   
1   RELECTU:        PROCEDURE;                                          08623   
0          /*                                                           08624   
                    *************************************               08625   
                    *                                   *               08626   
                    *    SOUS PROGRAMME DE RELECTURE    *               08627   
                    *    DU FICHIER DISQUE FITRA        *               08628   
                    *    POUR L'EDITION DES FACTURES    *               08629   
                    *    MULTIPLES                      *               08630   
                    *                                   *               08631   
                    *************************************               08632   
           */                                                           08633   
0      G000D:                                                           08634   
                                                                        08635   
                                        /* AJOUT 22 10 02 YDU/YHM PCF */08636   
           IF PCF_FACTUR = 'O'                                          08637   
           THEN CALL PCF_DUPLI ;        /* DUPLICATA PCF              */08638   
                                                                        08639   
           IF WTCLIB = ' '                                              08640   
              THEN WTCLI2.NBFAC = 0 ;                                   08641   
0                                       /*   3 EXEMPL. CARBONE DU GIH */08642   
           NB_EXEMP   = 1 ;             /*   SUPPRIME 11.02.03        */08643   
           WS_NUPAG   = 0 ;             /*   POUR INDEX EXPORT SPOOL2 */08644   
           IF UN_M = 70                 /*   SPOOL7 EXPORT AUTOMATIQUE*/08645   
              THEN WIPAG.EXPOR    = 'O' ;                               08646   
              ELSE WIPAG.EXPOR    = 'N' ;                               08647   
           IF WTFAC.EDIPA = '1' THEN DO;/*   AUTOR RETOUR SI CDL      */08648   
              IF FACT.RETOUR   = '1' THEN DO;                           08649   
                    J          = 1;     /*   AUTO RETOU.ECR. BDE SPOOL*/08650   
                    FACT.EXEMP = 0;     /*   AUCUNE FACTURE ECRITE    */08651   
                    GO TO G010A;                                        08652   
                    END;                /*   FIN TEST RETOUR 1        */08653   
              END;                      /*   FIN TEST EDIPA  1        */08654   
0          IF FACT.MULFAC = '1' THEN DO;/*   FACTURE MULTIPLE         */08655   
                    J          = 2;     /*   PAS D'AUTOR. DE RETOUR   */08656   
                    FACT.EXEMP = 1;     /*   1 FACTUR.ECRITE SUR SPOOL*/08657   
                    GO TO G010A;                                        08658   
                    END;                                                08659   
           GO TO G000F;                                                 08660   
1      G010A:                           /*   RELECTURE FICHIER DISQUE */08661   
                                        /******************************/08662   
0          DO I_EXEMP = 1 TO NB_EXEMP;  /*   ANCIEN EXEMPL CARBONE GIH*/08663   
0             DO I = J TO NFACTNUM;     /*   ITERATION SUR NBRE FACTUR*/08664   
                    K          = 1;                                     08665   
                    WS_NUPAG   = 0 ;    /*   POUR INDEX EXPORT SPOOL2 */08666   
                    PASTK.CODGT= 'D';   /*   POS. DEBUT DISQUE        */08667   
                    FACT.EXEMP = FACT.EXEMP + 1;                        08668   
                    IF FACT.EXEMP > 2 & UN_M = 70                       08669   
                       THEN UN_M  = 20 ;/*   SPOOL7 EXEMPLAIRE 1 ET 2 */08670   
                    INDEX_FACEXP.EXEMP  = FACT.EXEMP;                   08671   
       G010B:                                                           08672   
                    PASTK.CODLE= 'L';                                   08673   
                    CALL ID470F;                                        08674   
                    IF PASTK.CODGT  = 'F' THEN GO TO G010C;             08675   
                    PLECT      = PWTMVT;                                08676   
                                        /*   FORMAT A4 FACTURE        */08677   
                    IF WENTET4.SAUT     = '1' THEN K = 1;               08678   
                    IF K = 4  THEN   WENTET4.EXEMP = FACT.EXEMP;        08679   
                    IF SUBSTR(WFACT,1,1) = '5A'X                        08680   
                     & SUBSTR(WFACT,6,1) = 'CC'X THEN DO;               08681   
                       WS_NUPAG          = WS_NUPAG + 1 ;               08682   
                       END;             /*   FIN GEST. NUM PAGE INDEX */08683   
                    INDEX_FACEXP.NUPAG  = WS_NUPAG;                     08684   
                    STRING(ZSPOOL)      = WFACT;                        08685   
                    IF ^( WTFAC.GS.TRACO = '2' & WTFAC.GS.DEPCO = '16' )08686   
                       & EDIT_FACTU = 'O' THEN DO;                      08687   
                        IF UN_M = 10 ! FINAN_FRAIS = 'O' !              08688   
                           UN_M = 70   THEN                             08689   
                           SUBSTR(ZSPOOLP.ZIMP,176,17) = INDEX_FACTU ;  08690   
                        IF UN_M = 20   THEN                             08691   
                           SUBSTR(ZSPOOLP.ZIMP,166,39) = INDEX_FACEXX;  08692   
                        IF FINAN_FRAIS = 'O' THEN DO;                   08693   
                           CALL SPOOLA32(CINQ,ZSPOOL);                  08694   
                           END;         ELSE DO;                        08695   
                           CALL SPOOLA32(UN_M,ZSPOOL);                  08696   
                           END;                                         08697   
                        END;                                            08698   
                    K          = K + 1;                                 08699   
                    GO TO G010B;                                        08700   
       G010C:       END;                /*   FIN  BOUCLE DO SUR NBFAC */08701   
              END;                      /*   FIN  BOUCLE DO NB_EXEMPL.*/08702   
1      G000F:                                                           08703   
0                                       /*   GENERATION INDEX PAGE FAC*/08704   
                                        /******************************/08705   
0          WIPAG.AUTOM            = WTFACRED.AUTOM ;                    08706   
           EXPORT_LIGFAC          = 0   ;                               08707   
           IF UN_M = 30                 /*   CAS COLIS SOUFFRANCE     */08708   
              THEN    WIPAG.AUTOM = 'M' ;                               08709   
           WIPAG.CLIFA            = WTFACRED.CLIFA ;                    08710   
           WIPAG.NUCLI            = WTFAC.NUCLI    ;                    08711   
           WIPAG.NUFAC            = WNUFAC         ;                    08712   
           IF WTFAC.EDIPA = '2' THEN DO;                                08713   
              WIPAG.NBFAC         = NB_EXEMP * NFACTNUM ;               08714   
              IF WIPAG.NBFAC > 2                                        08715   
                 THEN WIPAG.NBFAC = 2 ;                                 08716   
              END;                ELSE DO;                              08717   
              WIPAG.NBFAC         = (NB_EXEMP * NFACTNUM) ;             08718   
              END;                                                      08719   
           IF FACT.RETOUR = '1'   /*   SI AUTORISATION DE RETOUR      */08720   
              THEN WIPAG.NBFAC    = WIPAG.NBFAC + 1;                    08721   
           WIPAG.FOLIO            = FACT.FOLIO     ;                    08722   
           WIPAG.NBPAG            = WIPAG.NBFAC * WIPAG.FOLIO ;         08723   
                                  /* PAGE DE GARDE  FOLIO = 0         */08724   
           IF WTFAC.EDIPA = '2' THEN DO;                                08725   
              IF EDIT_PAGGA  = 'O' THEN DO;                             08726   
                 WIPAG.NBPAG = WIPAG.NBPAG + 1 ;   /*YDV  E0299*/       08727   
                 END;                                                   08728   
              WIPAG.AUTOM = 'A' ;                                       08729   
              END;                                                      08730   
                                                                        08731   
           IF FINAN_FRAIS = 'O'   /*   SI FRAIS FINANCIER             */08732   
              THEN WIPAG.FRAFI    = 'O' ;                               08733   
              ELSE WIPAG.FRAFI    = ' ' ;                               08734   
           WRITE FILE (FIPAGE) FROM (WIPAG);                            08735   
           NBIPA                  = NBIPA + 1;                          08736   
0          IF WTCLI1.CLIFA = ' ' ! WTCLI1.CLIFA = '000000' THEN DO;     08737   
              GO TO G000FF;                                             08738   
              END;                      ELSE DO;                        08739   
              IF WTCLI1.NBFAC ^= 0 & UN_M = 10                          08740   
                 THEN FACTU_SUP         = FACTU_SUP + 1  ;              08741   
              END;                                                      08742   
1                                       /*   CLIFA EXISTE ==> FACTURE */08743   
                                        /*   SUPLEMENTAIRE + MICROFIC.*/08744   
                                        /*   ECRIT. SUR SPOOL4 POUR NE*/08745   
                                        /*   PAS CASSER SEQUENCE CLIFA*/08746   
           FACT.EXEMP         = 0;                                      08747   
           INDEX_FACTU2       = WTFAC.NUCLI !! WTFACRED.CLIFA !!        08748   
                                ENTET70.REFFA ;                         08749   
           IF WTFAC.EDIPA = '2' THEN DO;                                08750   
              INDEX_FACTU2    = WTFAC.NUCLI !! WTCLI1.CLIFA   !!        08751   
                                ENTET70.REFFA ;                         08752   
              END;                                                      08753   
0          DO I = 1 TO WTCLI1.NBFAC ;   /*   SUR NBFAC NUCLI          */08754   
              K               = 1;                                      08755   
              WS_NUPAG        = 0;                                      08756   
              NB_FONDP        = 0;      /*   NBRE DE FOND DE PAGE LUS */08757   
              PASTK.CODGT     = 'D';    /*   POS. DEBUT DISQUE        */08758   
              FACT.EXEMP      = FACT.EXEMP + 1;                         08759   
              IF FEXPO_AUTO = 'O'                                       08760   
                 THEN UN_M        = 70 ;/*   SPOOL7 EXEMPLAIRE 1 ET 2 */08761   
              IF FACT.EXEMP > 2 & UN_M = 70                             08762   
                 THEN UN_M        = 20 ;/*   SPOOL7 EXEMPLAIRE 1 ET 2 */08763   
              INDEX_FACEXP.EXEMP  = FACT.EXEMP;                         08764   
       G010D_2:                                                         08765   
              PASTK.CODLE     = 'L';                                    08766   
              CALL ID470F;                                              08767   
              IF PASTK.CODGT  = 'F' THEN GO TO G010E_2;                 08768   
              PLECT           = PWTMVT;                                 08769   
              SVG_WFACT       = WFACT ;                                 08770   
              IF SUBSTR(WFACT,1,1) = '5A'X                              08771   
               & SUBSTR(WFACT,6,1) = 'CC'X THEN DO;                     08772   
                 WS_NUPAG          = WS_NUPAG + 1 ;                     08773   
                 END;                   /*   FIN GEST. NUM PAGE INDEX */08774   
              INDEX_FACEXP.NUPAG   = WS_NUPAG;                          08775   
              IF SUBSTR(WFACT,1,1) = '5A'X THEN DO;                     08776   
                 NB_FONDP     = NB_FONDP + 1;                           08777   
                 END;                                                   08778   
                                        /*   FORMAT A4 FACTURE        */08779   
              IF WENTET4.SAUT = '1' THEN K = 1;                         08780   
0                                       /*   PAG.PORTRAIT NB_FONDP < 3*/08781   
0                                       /*   ET EDIPA ^= 2            */08782   
                                        /*   SI EXPORT 1 SEULE PAGE   */08783   
                                        /*   ET TRACO ^= 4            */08784   
                                        /*   GARDE PAS AUTRE PORTRAIT */08785   
                 SELECT (K) ;           /*   INVERSION NUCLI CLIFA    */08786   
                    WHEN ( 4 ) DO;                                      08787   
                       WENTET4.EXEMP    = FACT.EXEMP;                   08788   
                       END;                                             08789   
                    WHEN ( 10 ) DO;     /*   RAISON SOCIALE           */08790   
                       SVG_ADRESSE      = WENTET8.RASOC1;               08791   
                       WENTET8.RASOC1   = WENTET8.RASOC2;               08792   
                       WENTET8.RASOC2   = SUBSTR(SVG_ADRESSE,1,26);     08793   
                       END;                                             08794   
                    WHEN ( 11 ) DO;     /*   NOM CLIENT               */08795   
                       SVG_ADRESSE      = WENTET9.NOCLI1;               08796   
                       WENTET9.NOCLI1   = WENTET9.NOCLI2;               08797   
                       WENTET9.NOCLI2   = SUBSTR(SVG_ADRESSE,1,15);     08798   
                       END;                                             08799   
                    WHEN ( 12 ) DO;     /*   ADRESSE                  */08800   
                       SVG_ADRESSE      = WENTET10.ADCLI1;              08801   
                       WENTET10.ADCLI1  = WENTET10.ADCLI2;              08802   
                       WENTET10.ADCLI2  = SUBSTR(SVG_ADRESSE,1,26);     08803   
                       END;                                             08804   
                    WHEN ( 13 ) DO;     /*   LOCALITE                 */08805   
                       SVG_ADRESSE      = WENTET11.LORES1;              08806   
                       WENTET11.LORES1  = WENTET11.LORES2;              08807   
                       WENTET11.LORES2  = SUBSTR(SVG_ADRESSE,1,15);     08808   
                       END;                                             08809   
                    WHEN ( 14 ) DO;     /*   CODE POSTAL              */08810   
                       SVG_ADRESSE      = WENTET12.CPCLI1;              08811   
                       WENTET12.CPCLI1  = WENTET12.CPCLI2;              08812   
                       WENTET12.CPCLI2  = SUBSTR(SVG_ADRESSE,1,5);      08813   
                       SVG_ADRESSE      = WENTET12.LOBDI1;              08814   
                       WENTET12.LOBDI1  = WENTET12.LOBDI2;              08815   
                       WENTET12.LOBDI2  = SUBSTR(SVG_ADRESSE,1,26);     08816   
                       END;                                             08817   
                    WHEN ( 15 ) DO;     /*   PAYS                     */08818   
                       SVG_ADRESSE      = WENTET13.PAYCL1;              08819   
                       WENTET13.PAYCL1  = WENTET13.PAYCL2;              08820   
                       WENTET13.PAYCL2  = SUBSTR(SVG_ADRESSE,1,26);     08821   
                       END;                                             08822   
                    OTHERWISE DO;                                       08823   
                       END;                                             08824   
                    END;                /*   FIN TEST SELECT          */08825   
                                        /*   FIN TEST 1ERE PAGE PORTRA*/08826   
0                                       /*   GESTION N0 FACTURE N0 SEQ*/08827   
0             STRING(ZSPOOL)  = WFACT;                                  08828   
              IF ^( WTFAC.GS.TRACO = '2' & WTFAC.GS.DEPCO = '16' )      08829   
                 & EDIT_FACTU = 'O' THEN DO;                            08830   
                   IF UN_M = 10 ! FINAN_FRAIS = 'O' THEN DO;            08831   
                      SUBSTR(ZSPOOLP.ZIMP,176,17) = INDEX_FACTU2 ;      08832   
                      IF FINAN_FRAIS = 'O' THEN DO;                     08833   
                         CALL SPOOLA32(CINQ,ZSPOOL);                    08834   
                         END;               ELSE DO;                    08835   
                         CALL SPOOLA32(QUATRE,ZSPOOL);                  08836   
                         END;                                           08837   
                      END;              ELSE DO;                        08838   
                      SELECT (UN_M) ;                                   08839   
                        WHEN (70) DO;   /*   DUPLI FACT EXPORT CLIFA  */08840   
                                        /*   NUCLI CF SEQUENCE EDITION*/08841   
                          EXPORT_LIGFAC = EXPORT_LIGFAC + 1;            08842   
                          SUBSTR(ZSPOOLP.ZIMP,176,17) = INDEX_FACTU2 ;  08843   
                          SUBSTR(ZSPOOLP.ZIMP,168,8) = EXPORT_LIGFAC_X; 08844   
                          CALL SPOOLA32(HUIT,ZSPOOL);                   08845   
                          END;                                          08846   
                        WHEN (20) DO;                                   08847   
                          SUBSTR(ZSPOOLP.ZIMP,166,39) = INDEX_FACEXX;   08848   
                          CALL SPOOLA32(UN_M,ZSPOOL);                   08849   
                          END;                                          08850   
                        OTHERWISE DO;                                   08851   
                          CALL SPOOLA32(UN_M,ZSPOOL);                   08852   
                          END;                                          08853   
                        END;            /*   FIN TEST SELECT          */08854   
                      END;                                              08855   
                                        /*   GENERATION MICROFICHE    */08856   
                   IF I = 1 THEN DO;    /*   1 SEUL EXEMPLAIRE        */08857   
                      IF ^(TOP_DEMA_FAC = 'O' & MOD_DEMA= 'D') THEN DO; 08858   
                         WTMIC.INFO     = WFACT ;                       08859   
                         WS_NULIG       = WS_NULIG + 1;                 08860   
                         IF WS_NULIG < 99999 THEN DO;                   08861   
                            WTMIC.NULIG = WTMIC.NULIG + 1;              08862   
                            END;        ELSE DO;                        08863   
                            WTMIC.NULIG = 99999 ;                       08864   
                            END;                                        08865   
                         WRITE FILE (FMICRO) FROM (WTMIC);              08866   
                         MACFA.NBMIC    = MACFA.NBMIC + 1;              08867   
                         END;                                           08868   
                      END;                                              08869   
                   END;                                                 08870   
              WFACT               = SVG_WFACT ;                         08871   
              IF SUBSTR(WFACT,1,1) ^= '5A'X THEN DO;                    08872   
                 IF SUBSTR(WFACT,1,1) = '+'                             08873   
                    THEN ;              /*   LIGNE EN SURIMPRE NON CPT*/08874   
                    ELSE K            = K + 1;                          08875   
                 END;                   /*   PAS DE FOND DE PAGE      */08876   
              GO TO G010D_2;                                            08877   
       G010E_2:                         /*   FIN  BOUCLE DO SUR NBFAC */08878   
              END;                                                      08879   
0          IF WTCLI1.NBFAC ^= 0 THEN DO;/*   GENERATION INDEX PAGE FAC*/08880   
              WIPAG.AUTOM         = WTFACRED.AUTOM ;                    08881   
              IF UN_M = 30              /*   CAS COLIS SOUFFRANCE     */08882   
                 THEN WIPAG.AUTOM = 'M' ;                               08883   
              WIPAG.CLIFA         = WTFAC.NUCLI    ;                    08884   
              WIPAG.NUCLI         = WTFACRED.CLIFA ;                    08885   
              IF WTFAC.EDIPA = '2'                                      08886   
                 THEN WIPAG.NUCLI = WTCLI1.CLIFA   ;                    08887   
              WIPAG.NUFAC         = WNUFAC         ;                    08888   
              WIPAG.NBFAC         = WTCLI1.NBFAC   ;                    08889   
              WIPAG.FOLIO         = FACT.FOLIO     ;                    08890   
              IF WTFAC.EDIPA = '2' THEN DO;                             08891   
                                        /*   EXISTE PAS PAGE DE GARDE */08892   
                 WIPAG.AUTOM      = 'A';                                08893   
                 IF WIPAG.NBFAC > 2                                     08894   
                    THEN WIPAG.NBFAC = 2 ;                              08895   
                 END;                                                   08896   
              WIPAG.NBPAG         = WIPAG.NBFAC * WIPAG.FOLIO ;         08897   
                                                                        08898   
              IF FINAN_FRAIS = 'O' /*  SI FRAIS FINANCIER             */08899   
                 THEN WIPAG.FRAFI = 'O' ;                               08900   
                 ELSE WIPAG.FRAFI = ' ' ;                               08901   
              WRITE FILE (FIPAGE) FROM (WIPAG);                         08902   
              NBIPA               = NBIPA + 1;                          08903   
              END;                                                      08904   
0      G000FF:                                                          08905   
           END RELECTU;                                                 08906   
1   ANTICIP:        PROCEDURE;                                          08907   
-          /*                                                           08908   
                    *****************************************           08909   
                    *                                       *           08910   
                    *    SOUS PROGRAMME DE CALCUL           *           08911   
                    *    D ANTICIPATION D ECHEANCE          *           08912   
                    *                                       *           08913   
                    *****************************************           08914   
           */                                                           08915   
0      H000D:                                                           08916   
           IF WTFAC.TRACO ^= '0' THEN GO TO H000F;                      08917   
           IF WTFAC.ORPRO  = '1' ! WTFAC.ORPRO = '2' THEN GO TO H000E;  08918   
                                                     ELSE GO TO H000F;  08919   
0      H000E:                                                           08920   
                                        /*   PREFACTURATION RASSORT   */08921   
           IF WTFAC.IMPEC ^= '1' THEN DO;                               08922   
                    WDAT2.AA            = WTFAC.DANTI.AA;               08923   
                    WDAT2.MM            = WTFAC.DANTI.MM;               08924   
  /* Y2K-OK-Y2KOK  Y2KCOMP  ++++++++++++++++++++++++++++++++++++++*/    08925   
           Y2K_DECENNIE = '' ;                                          08926   
           Y2K_POSDE(1) = 1  ;                                          08927   
           Y2K_ARGUM1 = DAT1              ;                             08928   
           Y2K_ARGUM2 = DAT2              ;                             08929   
           CALL Y2KCOMP1 ;      /*          Y2K_RESULT1           */    08930   
                    IF Y2K_RESULT1 < 0 THEN DO;                         08931   
  /*                IF DAT1 < DAT2 THEN DO                        */    08932   
  /*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/    08933   
                       CLE2             = WTFAC.ECHEA;                  08934   
                       CALL ID470B(TBECHEA.NUTAB);                      08935   
                       IF WECHAN ^= ' ' THEN DO;                        08936   
                                             WTFAC.ECHEA = WECHAN;      08937   
                                             WTFAC.IMPEC = '1';         08938   
                                             END;                       08939   
                       END;             /*   FIN COMPARAISON  DATES   */08940   
                    END;                /*   FIN TEST IMPEC 1         */08941   
0      H000F:                                                           08942   
           END ANTICIP;                                                 08943   
1   ECRLIGN:        PROCEDURE;                                          08944   
-          /*                                                           08945   
                    *****************************************           08946   
                    *                                       *           08947   
                    *    SOUS PROGRAMME D'EDITION           *           08948   
                    *    DES ZONES REMISES SURREMISES       *           08949   
                    *                                       *           08950   
                    *****************************************           08951   
           */                                                           08952   
0      I000D:                                                           08953   
           IF WTCLI1.TYFAC = '5' THEN DO ;                              08954   
                    PUNHTCHAR           = ' ';                          08955   
                    END;                                                08956   
           IF WTCLI1.TYFAC = '6' THEN DO;                               08957   
                    LIGNE1.PIPUB        = WTFAC.PUNHT;                  08958   
                    PUNHTCHAR           = ' ';                          08959   
                    GO TO I000F;                                        08960   
                    END;                /*   FIN CLIENT ETRANGER      */08961   
           IF WTFAC.TYSUR = '0' THEN DO;/*   PAS DE SURREMISE         */08962   
                    IF WTFAC.REMBA ^= 0 THEN DO;                        08963   
                       LIGNE1.REMIS     = WTFAC.REMBA;                  08964   
                       END;                                             08965   
                    GO TO I000F;                                        08966   
                    END;                                                08967   
           IF WTFAC.TYSUR = '1' !       /*   13 - 12                  */08968   
              WTFAC.TYSUR = '3' THEN DO;/*   SEUIL BUTOIR NON ATTEINT */08969   
                    LIGNE1.ASTER        = ' *';                         08970   
                    LIGNE1.REMIS        = WTFAC.SRIMP;                  08971   
                    IF WTFAC.REMBA      = 0 THEN GO TO I000F;           08972   
                    LIGNE1.REMIS        = WTFAC.RAPLI ;                 08973   
                                        /*   ET NON SRIMP + REMBA     */08974   
                    GO TO I000F;                                        08975   
                    END;                                                08976   
           IF WTFAC.TYSUR = '2' !       /*   PALIER                   */08977   
              WTFAC.TYSUR = '8' !       /*   SEUIL BUTOIR ATTEINT     */08978   
              WTFAC.TYSUR = '9' THEN DO;/*   REMISE MANUELLE          */08979   
                    LIGNE1.ASTER        = ' *';                         08980   
                    LIGNE1.REMIS        = WTFAC.SRIMP;                  08981   
                    END;                                                08982   
0      I000F:                                                           08983   
           END ECRLIGN;                                                 08984   
                                                                        08985   
1   ECRITUR:        PROCEDURE;                   /*YDV P0299*/          08986   
-                                                                       08987   
           /*       *****************************************           08988   
                    * CE NOUVEAU MODULE NE FAIT QUE LE      *           08989   
                    * CHARGEMENT DE LA LIGNE DANS UN TABLEAU*           08990   
                    * L'ANCIENNE PROC A �T� RENOMME EN      *           08991   
                    * ECRITUR_AS                            *           08992   
                    * PAS DE TRAITEMENT SI DEMAT PROD       *           08993   
                    *****************************************           08994   
           */                                                           08995   
      J000D:                                                            08996   
           /* AVANT 10/2006 :                NON EDIT. SI DEMAT PROD  */08997   
           /* 24/10/2006 :  ON ENVOIE SYST�MATIQUEMENT TOUTES LES     */08998   
           /*               FACTURES DEMAT SOUS FORME DE DUPLICATA    */08999   
           /*               VERS LE PCF (MISE EN COMMENTAIRE DE LA    */09000   
           /*               LIGNE CI-DESSOUS)                         */09001   
      /*   IF TOP_DEMA_FAC = 'O' & MOD_DEMA = 'D'      YDU  06.07       09002   
              THEN GO TO J000F;  */                                     09003   
           I_TP  = I_TP  +  1 ;                                         09004   
           IF I_TP  >  250 THEN DO ;                                    09005   
              ZONCTL  = 'TABLE_PAGE INDICE > 250 FACT N= ' !! WNUFAC;   09006   
              CALL MACMES3 (DESTI,'1',ZONCTL) ;                         09007   
              GOTO J000F;                                               09008   
           END;                                                         09009   
           IF I_TP  > (NLMAX + 60) THEN DO;/*   CAS LIGNES SURIMPRESSI*/09010   
              ZONCTL  = 'TABLE_PAGE INDICE > NLMAX FACT N= ' !! WNUFAC; 09011   
              CALL MACMES3 (DESTI,'1',ZONCTL) ;                         09012   
              ZONCTL  = '    NUCLI ' !! WTFAC.NUCLI !! ' YYYY ' ;       09013   
              CALL MACMES3 (DESTI,'1',ZONCTL) ;                         09014   
              GOTO J000F;                                               09015   
           END;                                                         09016   
           TABLE_PAGE.TPLIG (I_TP) =  STRING(ZSPOOLP_SVG) ;             09017   
      J000F:                                                            09018   
    END ECRITUR;                                                        09019   
                                                                        09020   
1   VIDAGE_PAGE:    PROCEDURE ;         /*YDV P0299*/                   09021   
0          /*                                                           09022   
                    *************************************               09023   
                    *CETTE PROCEDURE A POUR FONCTION    *               09024   
                    * DE VIDER LE TABLEAU LIGNES        *               09025   
                    *APPEL PROC ECRITUR_AS POUR GERER   *               09026   
                    *                      -FITRA       *               09027   
                    *                      -MICROFICHES *               09028   
                    * QUELQUE SOIT LA PAGE TRAITEE      *               09029   
                    *************************************               09030   
           */                                                           09031   
           DO J_TP = 1  TO I_TP ;                                       09032   
           STRING( ZSPOOLP_SVG)   =  TABLE_PAGE.TPLIG (J_TP) ;          09033   
              CALL ECRITUR_AS;                                          09034   
           END;                                                         09035   
           TABLE_PAGE      =  '' ;                                      09036   
    END VIDAGE_PAGE;                                                    09037   
                                                                        09038   
1   LECTDBC:        PROCEDURE;                                          09039   
0          /*                                                           09040   
                    *************************************               09041   
                    *                                   *               09042   
                    *    SOUS PROGRAMME D'ACCES A LA    *               09043   
                    *    DATA BASE CLIENT A PARTIR      *               09044   
                    *    D'UN NUMERO DE CLIENT NUCLI    *               09045   
                    *                                   *               09046   
                    *************************************               09047   
           */                                                           09048   
0      K000D:                                                           09049   
           NUCLI.TROUV  = '1';                                          09050   
           WTCLIA       = '' ;                                          09051   
           WTCLIB       = '' ;                                          09052   
           WTCLIC       = '' ;                                          09053   
                                        /*   1ER ACCES DBC SUR NUCLI  */09054   
           CALL PLITDLI(N04,GU,PCBCLI,WTCLIA,SSCLI);                    09055   
           IF PCBCLI.SC ^= '  ' THEN DO;/*   TEST ACCES CORRECT DL1   */09056   
              IF PCBCLI.SC ^= 'GE' THEN DO;                             09057   
                    ZONCTL        = 'ANODB=K000D     ';                 09058   
                    CALL MACMES3 (DESTI,'4',ZONCTL,PCBCLI);             09059   
                    ZONCTL        = '              NUCLI ' !! SSCLI.VAL;09060   
                    CALL MACMES3 (DESTI,'1',ZONCTL);                    09061   
                    SIGNAL ERROR;                                       09062   
                    END;               /*    ARRET ERREUR  DL1        */09063   
              NUCLI.TROUV          = '0';                               09064   
              GO TO K000F;                                              09065   
              END;                     /*    FIN  TEST  STATUS CODE   */09066   
                                       /*    WTMIC.POREC=WTCLI1.GEF06 */09067   
                                       /*    SI MACOM=001,BLANC SINON */09068   
0          CALL LECGECO;                /*   ACCES SEGMENT GECO       */09069   
                                                                        09070   
                                        /* MODIF. DU    01.04.97      */09071   
           IF  WTFAC.TRACO = '0'  & WTFAC.DEPCO = '17'                  09072   
                                  & WTFAC.EDIPA = '2'                   09073   
                                  & WTGCO.CECOM = '710'                 09074   
               THEN  WTMIC.POREC             = 'G';                     09075   
               ELSE  WTMIC.POREC             = '' ;                     09076   
                                                                        09077   
                                                                        09078   
                                                                        09079   
0          IF TOP_DEMA_CLI = 'O'    &                                   09080   
              TCDLFDEM.CNUDC ^= ' ' THEN DO;                            09081   
              SPIPA          = '';  /*   TABLE DES ADRESSES CNUDC*/     09082   
              SPIPA.FONCT    = 'RP';                                    09083   
              SPIPA.COTAB    = 'CDLADRES';                              09084   
              SPIPA.OPERA    = '=';                                     09085   
              SPIPA.REFPO    = TCDLFDEM.CNUDC;                          09086   
              CALL SPI2TBV (SPIPA,TCDLADRE,SPIFI);                      09087   
              IF SPIPA.CORET ^= '00' THEN DO;                           09088   
                 TCDLADRE       = '' ;                                  09089   
                 END;                    ELSE DO;                       09090   
                 WL_CLLIV.NUCLI = TCDLADRE.CNUDC;                       09091   
                 WL_CLLIV.RASOC = TCDLADRE.RASOC;                       09092   
                 WL_CLLIV.NOCLI = TCDLADRE.NOCLI;                       09093   
                 WL_CLLIV.ADCLI = TCDLADRE.ADCLI;                       09094   
                 WL_CLLIV.LORES = TCDLADRE.LORES;                       09095   
                 WL_CLLIV.LOBDI = TCDLADRE.LOBDI;                       09096   
                 WL_CLLIV.CPCLI = TCDLADRE.CPCLI;                       09097   
                 WL_CLLIV.CPAYS = TCDLADRE.CPAYS;                       09098   
                 WL_CLLIV.SIRFA = TCDLADRE.SIREN;                       09099   
                 WL_CLLIV.MAGTV = TCDLADRE.MAGTV;                       09100   
                 END;                                                   09101   
              END;                                                      09102   
           IF WTFAC.FRAET  = '2' !                                      09103   
              WTFAC.EDIPA  = '2' THEN DO;                               09104   
              CLE4         = WTFAC.FRAET !! WTFAC.DEPAY ;               09105   
              CALL ID470B (TBDEPAY.NUTAB);                              09106   
              END;                       ELSE DO;                       09107   
              WPYDOU       = 'FR'   ;                                   09108   
              END;                                                      09109   
           WF_CLFAC.NOCLI  = WL_CLLIV.NOCLI     ;                       09110   
           WF_CLFAC.RASOC  = WL_CLLIV.RASOC     ;                       09111   
           WF_CLFAC.ADCLI  = WL_CLLIV.ADCLI     ;                       09112   
           WF_CLFAC.LORES  = WL_CLLIV.LORES     ;                       09113   
           WF_CLFAC.LOBDI  = WL_CLLIV.LOBDI     ;                       09114   
           WF_CLFAC.CPCLI  = WL_CLLIV.CPCLI     ;                       09115   
           WF_CLFAC.CPAYS  = WL_CLLIV.CPAYS     ;                       09116   
           WF_CLFAC.SIRFA  = WL_CLLIV.SIRFA     ;                       09117   
           /* PJA 201311 : PB NUMERO DE TVA INTRACOMMUNAUTAIRE */       09118   
           WF_CLFAC.MAGTV  = WL_CLLIV.MAGTV;                            09119   
0          IF TOP_DEMA_CLI = 'O'    &                                   09120   
              TCDLFDEM.CNUD5 ^= ' ' THEN DO;                            09121   
              SPIPA          = '';  /*   TABLE DES ADRESSES CNUD5*/     09122   
              SPIPA.FONCT    = 'RP';                                    09123   
              SPIPA.COTAB    = 'CDLADRES';                              09124   
              SPIPA.OPERA    = '=';                                     09125   
              SPIPA.REFPO    = TCDLFDEM.CNUD5;                          09126   
              CALL SPI2TBV (SPIPA,TCDLADRE,SPIFI);                      09127   
              IF SPIPA.CORET ^= '00' THEN DO;                           09128   
                 TCDLADRE       = '' ;                                  09129   
                 END;                    ELSE DO;                       09130   
                 WF_CLFAC       = TCDLADRE , BY NAME;                   09131   
                 WL_CLLIV.SIRFA = TCDLADRE.SIREN ;                      09132   
                 WF_CLFAC.SIRFA = TCDLADRE.SIREN ;                      09133   
                 /* PJA 201311 : PB NUMERO DE TVA INTRACOMMUNAUTAIRE */ 09134   
                 WL_CLLIV.MAGTV = TCDLADRE.MAGTV ;                      09135   
                 WF_CLFAC.MAGTV = TCDLADRE.MAGTV ;                      09136   
                 END;                                                   09137   
              END;                                                      09138   
                                                                        09139   
0          IF WTCLI1.CLIFA = ' ' ! WTCLI1.CLIFA = '000000' THEN DO;     09140   
       K000O:                                                           09141   
                    ENTET8.RASOC1    = ' ';                             09142   
                    ENTET8.RASOC2    =TRANSLATE(WTCLI1.RASOC,'  ','�');09143   
                    ENTET9.NOCLI1    = ' ';                             09144   
                    ENTET9.NOCLI2    =TRANSLATE(WTCLI1.NOCLI,'  ','�');09145   
                    ENTET10.ADCLI1   = ' ';                             09146   
                    ENTET10.ADCLI2   =TRANSLATE(WTCLI1.ADCLI,'  ','�');09147   
                    ENTET11.LORES1   = ' ';                             09148   
                    ENTET11.LORES2   =TRANSLATE(WTCLI1.LORES,'  ','�');09149   
                    ENTET12.CPCLI1   = ' ';                             09150   
                    ENTET12.LOBDI1   = ' ';                             09151   
                    ENTET12.CPCLI2   = WTCLI1.CPCLI;                    09152   
                    ENTET12.LOBDI2   =TRANSLATE(WTCLI1.LOBDI,'  ','�');09153   
                    ENTET13.PAYCL1   = ' ';                             09154   
                    ENTET13.PAYCL2   =TRANSLATE(WTCLI1.PAYCL,'  ','�');09155   
     /*-- ------------------------------------------- --*/              09156   
     /*-- AJOUT SMARTIN 22/12/2004 FACT DEMATERIALISEES */              09157   
     /*-- ------------------------------------------- --*/              09158   
                    IF WTFAC.FRAET = '2' !                              09159   
                       WTFAC.EDIPA = '2' THEN DO;                       09160   
                       CLE4          = WTFAC.FRAET !! WTFAC.DEPAY ;     09161   
                       CALL ID470B (TBDEPAY.NUTAB);                     09162   
                       END;             ELSE DO;                        09163   
                       WREPRI        = ' ' ;                            09164   
                       WDISAU        = ' ' ;                            09165   
                       WPYDOU        = 'FR';                            09166   
                       END;                                             09167   
                                                                        09168   
     /*-- ------------------------------------------- --*/              09169   
                    END;             ELSE DO;                           09170   
                    ENTET8.RASOC1    =TRANSLATE(WTCLI1.RASOC,'  ','�');09171   
                    ENTET9.NOCLI1    =TRANSLATE(WTCLI1.NOCLI,'  ','�');09172   
                    ENTET10.ADCLI1   =TRANSLATE(WTCLI1.ADCLI,'  ','�');09173   
                    ENTET11.LORES1   =TRANSLATE(WTCLI1.LORES,'  ','�');09174   
                    ENTET12.CPCLI1   = WTCLI1.CPCLI;                    09175   
                    ENTET12.LOBDI1   =TRANSLATE(WTCLI1.LOBDI,'  ','�');09176   
                    ENTET13.PAYCL1   =TRANSLATE(WTCLI1.PAYCL,'  ','�');09177   
     /*-- ------------------------------------------- --*/              09178   
     /*-- AJOUT SMARTIN 22/12/2004 FACT DEMATERIALISEES */              09179   
     /*-- ------------------------------------------- --*/              09180   
                    IF WTFAC.FRAET   = '2' !                            09181   
                       WTFAC.EDIPA   = '2' THEN DO;                     09182   
                       CLE4          = WTFAC.FRAET !! WTFAC.DEPAY ;     09183   
                       CALL ID470B (TBDEPAY.NUTAB);                     09184   
                       END;             ELSE DO;                        09185   
                       WPYDOU        = 'FR'   ;                         09186   
                       END;                                             09187   
                                                                        09188   
     /*-- ------------------------------------------- --*/              09189   
0      K000P:                           /*   2EME ACCES DBC SUR CLIFA */09190   
                    SSCLI.VAL         = WTCLI1.CLIFA;                   09191   
                    CALL PLITDLI(N04,GU,PCBCLI,WTCLIB,SSCLI);           09192   
                    IF PCBCLI.SC  ^= '  ' THEN DO;                      09193   
                       IF PCBCLI.SC^= 'GE' THEN DO;                     09194   
                          ZONCTL  = 'ANODB=K000P            ';          09195   
                          CALL MACMES3 (DESTI,'4',ZONCTL,PCBCLI);       09196   
                          ZONCTL  = '              NUCLI ' !! SSCLI.VAL;09197   
                          CALL MACMES3 (DESTI,'1',ZONCTL);              09198   
                          SIGNAL ERROR;                                 09199   
                          END;          /*   ARRET ERREUR  DL1        */09200   
                       WANOL.TBANO(1)      = '2012';                    09201   
                       WANOE.TBANO(1)      = '2012';                    09202   
                       WANOL.LIMPO         = '***** CLIFA ' !!          09203   
                                             WTCLI1.CLIFA   !!          09204   
                                             ' INCONNU DS DB CLIENTS' !!09205   
                                             ' NUCLI ' !! WTCLI1.NUCLI; 09206   
                       CALL ID470D;     /*   MOUVEMENTS REJETES       */09207   
                       WTCLI1.CLIFA        = ' ' ;                      09208   
                       GO TO K000O;                                     09209   
                       END;             /*   FIN  TEST  STATUS CODE   */09210   
                    ENTET8.RASOC2    =TRANSLATE(WTCLI2.RASOC,'  ','�');09211   
                    ENTET9.NOCLI2    =TRANSLATE(WTCLI2.NOCLI,'  ','�');09212   
                    ENTET10.ADCLI2   =TRANSLATE(WTCLI2.ADCLI,'  ','�');09213   
                    ENTET11.LORES2   =TRANSLATE(WTCLI2.LORES,'  ','�');09214   
                    ENTET12.CPCLI2   = WTCLI2.CPCLI;                    09215   
                    ENTET12.LOBDI2   =TRANSLATE(WTCLI2.LOBDI,'  ','�');09216   
                    ENTET13.PAYCL2   =TRANSLATE(WTCLI2.PAYCL,'  ','�');09217   
     /*-- ------------------------------------------- --*/              09218   
     /*-- AJOUT SMARTIN 22/12/2004 FACT DEMATERIALISEES */              09219   
     /*-- ------------------------------------------- --*/              09220   
                    IF WTCLI2.FRAET  = '2' THEN DO;                     09221   
                       CLE4          = WTCLI2.FRAET !! WTCLI2.DEPAY ;   09222   
                       CALL ID470B (TBDEPAY.NUTAB);                     09223   
                       END;             ELSE DO;                        09224   
                       WPYDOU        = 'FR'   ;                         09225   
                       END;                                             09226   
                    IF WTCLI2.EXGCO  = '1' THEN DO;                     09227   
                                        /*   ACCES SEGMENT GECO CLIFA */09228   
                       CALL PLITDLI(N05,GU,PCBCLI,WTGCOB,SSCLI,SSGCO);  09229   
                       IF PCBCLI.SC ^= '  ' THEN DO;                    09230   
                          IF PCBCLI.SC ^= 'GE' THEN DO;                 09231   
                             ZONCTL = 'ANODB=K000P+    ';               09232   
                             CALL MACMES3 (DESTI,'4',ZONCTL,PCBCLI);    09233   
                             ZONCTL = 'CLIFA GECO ' !! SSCLI.VAL;       09234   
                             CALL MACMES3 (DESTI,'1',ZONCTL);           09235   
                             END;       ELSE DO;                        09236   
                             ZONCTL = ' SEGMENT GECO INCONNU ' ;        09237   
                             CALL MACMES3 (DESTI,'4',ZONCTL,PCBCLI);    09238   
                             ZONCTL = 'CLIFA GECO ' !! SSCLI.VAL;       09239   
                             CALL MACMES3 (DESTI,'4',ZONCTL);           09240   
                             END;      /*    FIN SEG. GECO NON TROUVE */09241   
                          END;         /*    FIN  TEST  STATUS CODE   */09242   
                       END;            /*    FIN  TEST  EXGCO         */09243   
                                                                        09244   
     /*-- ------------------------------------------- --*/              09245   
                    END;                /*   FIN  TEST  CLIFA         */09246   
           IF WTCLI1.CLICO = ' ' THEN GO TO K000F;                      09247   
0      K000Q:                           /*   3EME ACCES DBC SUR CLICO */09248   
0                                       /*   SI CLICO NON = BLANC     */09249   
           SSCLI.VAL       = WTCLI1.CLICO;                              09250   
           CALL PLITDLI(N04,GU,PCBCLI,WTCLIC,SSCLI);                    09251   
           IF PCBCLI.SC   ^= '  ' THEN DO;                              09252   
                 IF PCBCLI.SC       ^= 'GE' THEN DO;                    09253   
                       ZONCTL        = 'ANODB=K000Q              ';     09254   
                       CALL MACMES3 (DESTI,'4',ZONCTL,PCBCLI);          09255   
                       ZONCTL     = '              NUCLI ' !! SSCLI.VAL;09256   
                       CALL MACMES3 (DESTI,'1',ZONCTL);                 09257   
                       SIGNAL ERROR;                                    09258   
                       END;             /*   ARRET ERREUR DL1         */09259   
                 WANOL.TBANO(1)      = '2013';                          09260   
                 WANOE.TBANO(1)      = '2013';                          09261   
                 WANOL.LIMPO         = '***** CLICO ' !! WTCLI1.CLICO !!09262   
                                       ' INCONNU DS DB CLIENTS ' !!     09263   
                                       'NUCLI ' !! WTCLI1.NUCLI ;       09264   
                 CALL ID470D;           /*   MOUVEMENTS REJETES       */09265   
                 GO TO K000F;                                           09266   
                 END;                   /*   FIN  TEST  STATUS CODE   */09267   
0      K000F:                                                           09268   
           END LECTDBC;                                                 09269   
1   RENCRDL:        PROCEDURE;                                          09270   
0          /*                                                           09271   
                    ************************************                09272   
                    *                                  *                09273   
                    *    RECHERCHE DICHOTOMIQUE DES    *                09274   
                    *    ADRESSES COMMERCIALES DANS    *                09275   
                    *    LA TABLE DES NCRDL            *                09276   
                    *                                  *                09277   
                    ************************************                09278   
           */                                                           09279   
0                                                                       09280   
       M000D:                                                           09281   
           CLE3            = WTFAC.MACOM;                               09282   
0          IF WTFAC.DEPCO = '10'        /*   YOUPIE 01.09.87 TBFASUC  */09283   
              THEN CALL ID470B(TBFASUC.NUTAB);                          09284   
              ELSE CALL ID470B(TBACRDL.NUTAB);                          09285   
0          ENTET1.NOCRD    = WNOCRD;                                    09286   
           ENTET2.ADCRD    = WADCRD;                                    09287   
           ENTET3.VICRD    = WVICRD;                                    09288   
           ENTET4.RCCRD    = WRCCRD;                                    09289   
0      M000F:                                                           09290   
           END RENCRDL;                                                 09291   
1   LECGECO:        PROCEDURE;                                          09292   
0          /*                                                           09293   
                    *************************************               09294   
                    *                                   *               09295   
                    *    SOUS PROGRAMME D'ACCES A LA    *               09296   
                    *    DATA BASE CLIENT A PARTIR      *               09297   
                    *    D'UN NUMERO DE CLIENT NUCLI    *               09298   
                    *    POUR LE SEGMENT GECO 04.03.85  *               09299   
                    *                                   *               09300   
                    *************************************               09301   
           */                                                           09302   
0      N000D:                                                           09303   
0          IF WTCLI1.EXGCO ^= '1' THEN DO;                              09304   
              WRESP.CECOM         = '001' ;                             09305   
              WRESL.CECOM         = '001' ;                             09306   
              WTGCO.CECOM         = ' '   ;                             09307   
              WTGCO.TYREL         = ' '   ;                             09308   
              WTGCO.SIREN         = ' '   ;                             09309   
              WTGCO.MOREG         = ' '   ;                             09310   
              GO TO N000F;                                              09311   
              END;                      /*   FIN TEST EXIST. SEG GECO */09312   
-                                       /*   ACCES DBC SUR NUCLI GECO */09313   
           CALL PLITDLI(N05,GU,PCBCLI,WTGCOA,SSCLI,SSGCO);              09314   
0          IF PCBCLI.SC ^= '  ' THEN DO;/*   TEST ACCES CORRECT DL1   */09315   
              IF PCBCLI.SC ^= 'GE' THEN DO;                             09316   
                    ZONCTL        = 'ANODB=N000D     ';                 09317   
                    CALL MACMES3 (DESTI,'4',ZONCTL,PCBCLI);             09318   
                    ZONCTL        = '              NUCLI GECO '         09319   
                                    !! SSCLI.VAL;                       09320   
                    CALL MACMES3 (DESTI,'1',ZONCTL);                    09321   
                    SIGNAL ERROR;                                       09322   
                    END;                ELSE DO;                        09323   
                    ZONCTL        = ' SEGMENT GECO INCONNU ' ;          09324   
                    CALL MACMES3 (DESTI,'4',ZONCTL,PCBCLI);             09325   
                    ZONCTL        = '              NUCLI GECO '         09326   
                                    !! SSCLI.VAL;                       09327   
                    CALL MACMES3 (DESTI,'4',ZONCTL);                    09328   
                    WRESP.CECOM         = '001' ;                       09329   
                    WRESL.CECOM         = '001' ;                       09330   
                    GO TO N000F;                                        09331   
                    END;               /*    FIN SEG. GECO NON TROUVE */09332   
              END;                     /*    FIN  TEST  STATUS CODE   */09333   
0          WRESP.CECOM    = WTGCO.CECOM ;                               09334   
           WRESL.CECOM    = WTGCO.CECOM ;                               09335   
0      N000F:                                                           09336   
           END LECGECO;                                                 09337   
1   VENT_COTAX:     PROCEDURE;                                          09338   
0          /*                                                           09339   
                    ***********************************                 09340   
                    *                                 *                 09341   
                    *    MODULE D'EDITION DE LA       *                 09342   
                    *    VENTILATION PAR CODE TAXE    *                 09343   
                    *    DU PIED  DE  FACTURE         *                 09344   
                    *                                 *                 09345   
                    ***********************************                 09346   
           */                                                           09347   
0      Q000D:                                                           09348   
           TTFAC20.POLIC          = '00'X ;  /*YDV*/                    09349   
           TTFAC20.LIBEL1         = '  TAUX   ';                        09350   
           TTFAC20.LIBEL2         = '    NET T.C. ';                    09351   
           TTFAC20.LIBEL3         = '       TAXES ';                    09352   
           TTFAC20.LIBEL4         = '    NET H.T. ';                    09353   
           J                 = 0;                                       09354   
0          DO I = 0 TO 9;               /*   ITERATION SUR LES COTAX  */09355   
                IF FACT.COTAX(I) ^= ' ' THEN DO;                        09356   
                    J                  = J + 1;                         09357   
                    IF J > 8 THEN DO;   /*   EDITION DE 8 COTAX MAXI  */09358   
                         I             = 9;                             09359   
                                        /*   APPEL FIC. AUTO CONTROLE */09360   
                         ZONCTL        = '                * CODE TAXE ' 09361   
                                         !! '> 8 ' !! ' FACTURE ' !!    09362   
                                         WNUFAC ;                       09363   
                         CALL MACMES3 (DESTI,'1',ZONCTL);               09364   
                         END;                                           09365   
0                   IF J = 1 THEN DO;   /*   EDITION DU 1ER COTAX     */09366   
                         TTFAC4.COTAX    = FACT.COTAX(I);               09367   
                         TTFAC4.FIL1     = '-';                         09368   
                         TTFAC4.TOLEG    = FACT.TOLEG(I);               09369   
                         TTFAC4.NETTC    = FACT.NET_TC(I);              09370   
                         TTFAC4.NETHT    = FACT.NET_HT(I);              09371   
                         IF FACT.DETAXE(I) ^= 0 THEN DO;                09372   
                           TTFAC4.DETAX = FACT.DETAXE(I);               09373   
                           END;                                         09374   
                           /*-- FACT DEMAT SMARTIN 29/12/2004 --*/      09375   
                           IF TOP_DEMA_FAC = 'O'                        09376   
                             THEN DO ;                                  09377   
                             DEMAT_PIE.ID.NULIG = SVG_NULIG ;           09378   
                             DEMAT_PIE.ID.NULIG =                       09379   
                             DEMAT_PIE.ID.NULIG + 1   ;                 09380   
                             DEMAT_PIE.ID.ENSEQ =                       09381   
                             DEMAT_PIE.ID.ENSEQ + 1   ;                 09382   
                             ATOLEG  = ''                  ;            09383   
                             SUBSTR(ATOLEG,6,2) =                       09384   
                             SUBSTR(FACT.TOLEG(I),5,2) ;                09385   
                             SUBSTR(ATOLEG,3,3) =                       09386   
                             SUBSTR(FACT.TOLEG(I),1,3) ;                09387   
                             ATOLEG = TRANSLATE(ATOLEG,'0',' ') ;       09388   
                             P_TOLEG = ADDR(ATOLEG)        ;            09389   
                             DEMAT_PIE.GS.TXTVA = NTOLEG   ;            09390   
                             DEMAT_PIE.GS.SMONHT = '+'           ;      09391   
                             DEMAT_PIE.GS.MONHT = FACT.NET_HT(I) ;      09392   
                             DEMAT_PIE.GS.SMTTVA = '+'           ;      09393   
                             DEMAT_PIE.GS.MTTVA = FACT.DETAXE(I) ;      09394   
                             DEMAT_PIE.GS.SMTTTC = '+'           ;      09395   
                             DEMAT_PIE.GS.MTTTC = FACT.NET_TC(I) ;      09396   
                             DEMAT_PIE.GS.QTTOT = DEMAT_QTTOT    ;      09397   
                             IF DEMAT_PIE.MONHT = 0                     09398   
                              & DEMAT_PIE.MTTVA = 0                     09399   
                              & DEMAT_PIE.MTTTC = 0                     09400   
                              & FACT.COTAX(I)   = '0' THEN DO;          09401   
                                         /*   04-04-12 CHGT TAUX 7,00 */09402   
                                END;            ELSE DO;                09403   
                                WRITE FILE(FICDEMA) FROM(DEMAT_PIE) ;   09404   
                                CTR_LIG_DEMA    = CTR_LIG_DEMA + 1;     09405   
                                DEMAT_QTTOT     = 0              ;      09406   
                                END;                                    09407   
                           END ;                                        09408   
                           /*-- FACT DEMAT FIN     29/12/2004 --*/      09409   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                09410   
                             ATOLEG  = ''                  ;            09411   
                             SUBSTR(ATOLEG,6,2) =                       09412   
                             SUBSTR(FACT.TOLEG(I),5,2) ;                09413   
                             SUBSTR(ATOLEG,3,3) =                       09414   
                             SUBSTR(FACT.TOLEG(I),1,3) ;                09415   
                             ATOLEG = TRANSLATE(ATOLEG,'0',' ') ;       09416   
                             P_TOLEG = ADDR(ATOLEG)        ;            09417   
                             STO_D_PIE.GS.TXTVA = NTOLEG   ;            09418   
                             STO_D_PIE.GS.SMONHT = '+'           ;      09419   
                             STO_D_PIE.GS.MONHT = FACT.NET_HT(I) ;      09420   
                             STO_D_PIE.GS.SMTTVA = '+'           ;      09421   
                             STO_D_PIE.GS.MTTVA = FACT.DETAXE(I) ;      09422   
                             STO_D_PIE.GS.SMTTTC = '+'           ;      09423   
                             STO_D_PIE.GS.MTTTC = FACT.NET_TC(I) ;      09424   
                             STO_D_PIE.GS.QTTOT = STO_D_QTTOT    ;      09425   
                             IF STO_D_PIE.MONHT = 0                     09426   
                              & STO_D_PIE.MTTVA = 0                     09427   
                              & STO_D_PIE.MTTTC = 0                     09428   
                              & FACT.COTAX(I)   = '0' THEN DO;          09429   
                                         /*   04-04-12 CHGT TAUX 7,00 */09430   
                                END;            ELSE DO;                09431   
                                CTR_ENSEQ_D        = CTR_ENSEQ_D + 1;   09432   
                                STO_D_PIE.ID.ENSEQ = CTR_ENSEQ_D ;      09433   
                                WRITE FILE(FICSTOD) FROM(STO_D_PIE) ;   09434   
                                CTR_LIG_STOD    = CTR_LIG_STOD + 1;     09435   
                                STO_D_QTTOT     = 0              ;      09436   
                                END;                                    09437   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                09438   
                         END;                                           09439   
                    IF J = 2 THEN DO;   /*   EDITION DU 2EME COTAX    */09440   
                         TTFAC5.COTAX    = FACT.COTAX(I);               09441   
                         TTFAC5.FIL1     = '-';                         09442   
                         TTFAC5.TOLEG    = FACT.TOLEG(I);               09443   
                         TTFAC5.NETTC    = FACT.NET_TC(I);              09444   
                         TTFAC5.DETAX    = FACT.DETAXE(I);              09445   
                         TTFAC5.NETHT    = FACT.NET_HT(I);              09446   
                           /*-- FACT DEMAT SMARTIN 29/12/2004 --*/      09447   
                           IF TOP_DEMA_FAC = 'O'                        09448   
                             THEN DO ;                                  09449   
                             DEMAT_PIE.ID.NULIG =                       09450   
                             DEMAT_PIE.ID.NULIG + 1   ;                 09451   
                             DEMAT_PIE.ID.ENSEQ =                       09452   
                             DEMAT_PIE.ID.ENSEQ + 1   ;                 09453   
                             ATOLEG  = ''                  ;            09454   
                             SUBSTR(ATOLEG,6,2) =                       09455   
                             SUBSTR(FACT.TOLEG(I),5,2) ;                09456   
                             SUBSTR(ATOLEG,3,3) =                       09457   
                             SUBSTR(FACT.TOLEG(I),1,3) ;                09458   
                             ATOLEG = TRANSLATE(ATOLEG,'0',' ') ;       09459   
                             P_TOLEG = ADDR(ATOLEG)        ;            09460   
                             DEMAT_PIE.GS.TXTVA = NTOLEG   ;            09461   
                             DEMAT_PIE.GS.SMONHT = '+'           ;      09462   
                             DEMAT_PIE.GS.MONHT = FACT.NET_HT(I) ;      09463   
                             DEMAT_PIE.GS.SMTTVA = '+'           ;      09464   
                             DEMAT_PIE.GS.MTTVA = FACT.DETAXE(I) ;      09465   
                             DEMAT_PIE.GS.SMTTTC = '+'           ;      09466   
                             DEMAT_PIE.GS.MTTTC = FACT.NET_TC(I) ;      09467   
                             DEMAT_PIE.GS.QTTOT = DEMAT_QTTOT    ;      09468   
                             WRITE FILE(FICDEMA) FROM(DEMAT_PIE)  ;     09469   
                             CTR_LIG_DEMA       = CTR_LIG_DEMA + 1;     09470   
                             DEMAT_QTTOT        = 0              ;      09471   
                           END ;                                        09472   
                           /*-- FACT DEMAT FIN     29/12/2004 --*/      09473   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                09474   
                             ATOLEG  = ''                  ;            09475   
                             SUBSTR(ATOLEG,6,2) =                       09476   
                             SUBSTR(FACT.TOLEG(I),5,2) ;                09477   
                             SUBSTR(ATOLEG,3,3) =                       09478   
                             SUBSTR(FACT.TOLEG(I),1,3) ;                09479   
                             ATOLEG = TRANSLATE(ATOLEG,'0',' ') ;       09480   
                             P_TOLEG = ADDR(ATOLEG)        ;            09481   
                             STO_D_PIE.GS.TXTVA = NTOLEG   ;            09482   
                             STO_D_PIE.GS.SMONHT = '+'           ;      09483   
                             STO_D_PIE.GS.MONHT = FACT.NET_HT(I) ;      09484   
                             STO_D_PIE.GS.SMTTVA = '+'           ;      09485   
                             STO_D_PIE.GS.MTTVA = FACT.DETAXE(I) ;      09486   
                             STO_D_PIE.GS.SMTTTC = '+'           ;      09487   
                             STO_D_PIE.GS.MTTTC = FACT.NET_TC(I) ;      09488   
                             STO_D_PIE.GS.QTTOT = STO_D_QTTOT    ;      09489   
                             CTR_ENSEQ_D        = CTR_ENSEQ_D + 1;      09490   
                             STO_D_PIE.ID.ENSEQ = CTR_ENSEQ_D ;         09491   
                             WRITE FILE(FICSTOD) FROM(STO_D_PIE)  ;     09492   
                             CTR_LIG_STOD       = CTR_LIG_STOD + 1;     09493   
                             STO_D_QTTOT        = 0              ;      09494   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                09495   
                         END;                                           09496   
                    IF J = 3 THEN DO;   /*   EDITION DU 3EME COTAX    */09497   
                         TTFAC6.COTAX    = FACT.COTAX(I);               09498   
                         TTFAC6.FIL1     = '-';                         09499   
                         TTFAC6.TOLEG    = FACT.TOLEG(I);               09500   
                         TTFAC6.NETTC    = FACT.NET_TC(I);              09501   
                         TTFAC6.DETAX    = FACT.DETAXE(I);              09502   
                         TTFAC6.NETHT    = FACT.NET_HT(I);              09503   
                           /*-- FACT DEMAT SMARTIN 29/12/2004 --*/      09504   
                           IF TOP_DEMA_FAC = 'O'                        09505   
                             THEN DO ;                                  09506   
                             DEMAT_PIE.ID.NULIG =                       09507   
                             DEMAT_PIE.ID.NULIG + 1   ;                 09508   
                             DEMAT_PIE.ID.ENSEQ =                       09509   
                             DEMAT_PIE.ID.ENSEQ + 1   ;                 09510   
                             ATOLEG  = ''                  ;            09511   
                             SUBSTR(ATOLEG,6,2) =                       09512   
                             SUBSTR(FACT.TOLEG(I),5,2) ;                09513   
                             SUBSTR(ATOLEG,3,3) =                       09514   
                             SUBSTR(FACT.TOLEG(I),1,3) ;                09515   
                             ATOLEG = TRANSLATE(ATOLEG,'0',' ') ;       09516   
                             P_TOLEG = ADDR(ATOLEG)        ;            09517   
                             DEMAT_PIE.GS.TXTVA = NTOLEG   ;            09518   
                             DEMAT_PIE.GS.SMONHT = '+'           ;      09519   
                             DEMAT_PIE.GS.MONHT = FACT.NET_HT(I) ;      09520   
                             DEMAT_PIE.GS.SMTTVA = '+'           ;      09521   
                             DEMAT_PIE.GS.MTTVA = FACT.DETAXE(I) ;      09522   
                             DEMAT_PIE.GS.SMTTTC = '+'           ;      09523   
                             DEMAT_PIE.GS.MTTTC = FACT.NET_TC(I) ;      09524   
                             DEMAT_PIE.GS.QTTOT = DEMAT_QTTOT    ;      09525   
                             DEMAT_QTTOT        = 0              ;      09526   
                             WRITE FILE(FICDEMA) FROM(DEMAT_PIE)  ;     09527   
                             CTR_LIG_DEMA       = CTR_LIG_DEMA + 1;     09528   
                           END ;                                        09529   
                           /*-- FACT DEMAT FIN     29/12/2004 --*/      09530   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                09531   
                             ATOLEG  = ''                  ;            09532   
                             SUBSTR(ATOLEG,6,2) =                       09533   
                             SUBSTR(FACT.TOLEG(I),5,2) ;                09534   
                             SUBSTR(ATOLEG,3,3) =                       09535   
                             SUBSTR(FACT.TOLEG(I),1,3) ;                09536   
                             ATOLEG = TRANSLATE(ATOLEG,'0',' ') ;       09537   
                             P_TOLEG = ADDR(ATOLEG)        ;            09538   
                             STO_D_PIE.GS.TXTVA = NTOLEG   ;            09539   
                             STO_D_PIE.GS.SMONHT = '+'           ;      09540   
                             STO_D_PIE.GS.MONHT = FACT.NET_HT(I) ;      09541   
                             STO_D_PIE.GS.SMTTVA = '+'           ;      09542   
                             STO_D_PIE.GS.MTTVA = FACT.DETAXE(I) ;      09543   
                             STO_D_PIE.GS.SMTTTC = '+'           ;      09544   
                             STO_D_PIE.GS.MTTTC = FACT.NET_TC(I) ;      09545   
                             STO_D_PIE.GS.QTTOT = STO_D_QTTOT    ;      09546   
                             STO_D_QTTOT        = 0              ;      09547   
                             CTR_ENSEQ_D        = CTR_ENSEQ_D + 1;      09548   
                             STO_D_PIE.ID.ENSEQ = CTR_ENSEQ_D ;         09549   
                             WRITE FILE(FICSTOD) FROM(STO_D_PIE)  ;     09550   
                             CTR_LIG_STOD       = CTR_LIG_STOD + 1;     09551   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                09552   
                         END;                                           09553   
                    IF J = 4 THEN DO;   /*   EDITION DU 4EME COTAX    */09554   
                         TTFAC7.COTAX    = FACT.COTAX(I);               09555   
                         TTFAC7.FIL1     = '-';                         09556   
                         TTFAC7.TOLEG    = FACT.TOLEG(I);               09557   
                         TTFAC7.NETTC    = FACT.NET_TC(I);              09558   
                         TTFAC7.DETAX    = FACT.DETAXE(I);              09559   
                         TTFAC7.NETHT    = FACT.NET_HT(I);              09560   
                           /*-- FACT DEMAT SMARTIN 29/12/2004 --*/      09561   
                           IF TOP_DEMA_FAC = 'O'                        09562   
                             THEN DO ;                                  09563   
                             DEMAT_PIE.ID.NULIG =                       09564   
                             DEMAT_PIE.ID.NULIG + 1   ;                 09565   
                             DEMAT_PIE.ID.ENSEQ =                       09566   
                             DEMAT_PIE.ID.ENSEQ + 1   ;                 09567   
                             ATOLEG  = ''                  ;            09568   
                             SUBSTR(ATOLEG,6,2) =                       09569   
                             SUBSTR(FACT.TOLEG(I),5,2) ;                09570   
                             SUBSTR(ATOLEG,3,3) =                       09571   
                             SUBSTR(FACT.TOLEG(I),1,3) ;                09572   
                             ATOLEG = TRANSLATE(ATOLEG,'0',' ') ;       09573   
                             P_TOLEG = ADDR(ATOLEG)        ;            09574   
                             DEMAT_PIE.GS.TXTVA = NTOLEG   ;            09575   
                             DEMAT_PIE.GS.SMONHT = '+'           ;      09576   
                             DEMAT_PIE.GS.MONHT = FACT.NET_HT(I) ;      09577   
                             DEMAT_PIE.GS.SMTTVA = '+'           ;      09578   
                             DEMAT_PIE.GS.MTTVA = FACT.DETAXE(I) ;      09579   
                             DEMAT_PIE.GS.SMTTTC = '+'           ;      09580   
                             DEMAT_PIE.GS.MTTTC = FACT.NET_TC(I) ;      09581   
                             DEMAT_PIE.GS.QTTOT = DEMAT_QTTOT    ;      09582   
                             DEMAT_QTTOT        = 0              ;      09583   
                             WRITE FILE(FICDEMA) FROM(DEMAT_PIE)  ;     09584   
                             CTR_LIG_DEMA       = CTR_LIG_DEMA + 1;     09585   
                           END ;                                        09586   
                           /*-- FACT DEMAT FIN     29/12/2004 --*/      09587   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                09588   
                             ATOLEG  = ''                  ;            09589   
                             SUBSTR(ATOLEG,6,2) =                       09590   
                             SUBSTR(FACT.TOLEG(I),5,2) ;                09591   
                             SUBSTR(ATOLEG,3,3) =                       09592   
                             SUBSTR(FACT.TOLEG(I),1,3) ;                09593   
                             ATOLEG = TRANSLATE(ATOLEG,'0',' ') ;       09594   
                             P_TOLEG = ADDR(ATOLEG)        ;            09595   
                             STO_D_PIE.GS.TXTVA = NTOLEG   ;            09596   
                             STO_D_PIE.GS.SMONHT = '+'           ;      09597   
                             STO_D_PIE.GS.MONHT = FACT.NET_HT(I) ;      09598   
                             STO_D_PIE.GS.SMTTVA = '+'           ;      09599   
                             STO_D_PIE.GS.MTTVA = FACT.DETAXE(I) ;      09600   
                             STO_D_PIE.GS.SMTTTC = '+'           ;      09601   
                             STO_D_PIE.GS.MTTTC = FACT.NET_TC(I) ;      09602   
                             STO_D_PIE.GS.QTTOT = STO_D_QTTOT    ;      09603   
                             STO_D_QTTOT        = 0              ;      09604   
                             CTR_ENSEQ_D        = CTR_ENSEQ_D + 1;      09605   
                             STO_D_PIE.ID.ENSEQ = CTR_ENSEQ_D ;         09606   
                             WRITE FILE(FICSTOD) FROM(STO_D_PIE)  ;     09607   
                             CTR_LIG_STOD       = CTR_LIG_STOD + 1;     09608   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                09609   
                         END;                                           09610   
                    IF J = 5 THEN DO;   /*   EDITION DU 5EME COTAX    */09611   
                         TTFAC8.COTAX    = FACT.COTAX(I);               09612   
                         TTFAC8.FIL1     = '-';                         09613   
                         TTFAC8.TOLEG    = FACT.TOLEG(I);               09614   
                         TTFAC8.NETTC    = FACT.NET_TC(I);              09615   
                         TTFAC8.DETAX    = FACT.DETAXE(I);              09616   
                         TTFAC8.NETHT    = FACT.NET_HT(I);              09617   
                           /*-- FACT DEMAT SMARTIN 29/12/2004 --*/      09618   
                           IF TOP_DEMA_FAC = 'O'                        09619   
                             THEN DO ;                                  09620   
                             DEMAT_PIE.ID.NULIG =                       09621   
                             DEMAT_PIE.ID.NULIG + 1   ;                 09622   
                             DEMAT_PIE.ID.ENSEQ =                       09623   
                             DEMAT_PIE.ID.ENSEQ + 1   ;                 09624   
                             ATOLEG  = ''                  ;            09625   
                             SUBSTR(ATOLEG,6,2) =                       09626   
                             SUBSTR(FACT.TOLEG(I),5,2) ;                09627   
                             SUBSTR(ATOLEG,3,3) =                       09628   
                             SUBSTR(FACT.TOLEG(I),1,3) ;                09629   
                             ATOLEG = TRANSLATE(ATOLEG,'0',' ') ;       09630   
                             P_TOLEG = ADDR(ATOLEG)        ;            09631   
                             DEMAT_PIE.GS.TXTVA = NTOLEG   ;            09632   
                             DEMAT_PIE.GS.SMONHT = '+'           ;      09633   
                             DEMAT_PIE.GS.MONHT = FACT.NET_HT(I) ;      09634   
                             DEMAT_PIE.GS.SMTTVA = '+'           ;      09635   
                             DEMAT_PIE.GS.MTTVA = FACT.DETAXE(I) ;      09636   
                             DEMAT_PIE.GS.SMTTTC = '+'           ;      09637   
                             DEMAT_PIE.GS.MTTTC = FACT.NET_TC(I) ;      09638   
                             DEMAT_PIE.GS.QTTOT = DEMAT_QTTOT    ;      09639   
                             DEMAT_QTTOT        = 0              ;      09640   
                             WRITE FILE(FICDEMA) FROM(DEMAT_PIE)  ;     09641   
                             CTR_LIG_DEMA       = CTR_LIG_DEMA + 1;     09642   
                           END ;                                        09643   
                           /*-- FACT DEMAT FIN     29/12/2004 --*/      09644   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                09645   
                             ATOLEG  = ''                  ;            09646   
                             SUBSTR(ATOLEG,6,2) =                       09647   
                             SUBSTR(FACT.TOLEG(I),5,2) ;                09648   
                             SUBSTR(ATOLEG,3,3) =                       09649   
                             SUBSTR(FACT.TOLEG(I),1,3) ;                09650   
                             ATOLEG = TRANSLATE(ATOLEG,'0',' ') ;       09651   
                             P_TOLEG = ADDR(ATOLEG)        ;            09652   
                             STO_D_PIE.GS.TXTVA = NTOLEG   ;            09653   
                             STO_D_PIE.GS.SMONHT = '+'           ;      09654   
                             STO_D_PIE.GS.MONHT = FACT.NET_HT(I) ;      09655   
                             STO_D_PIE.GS.SMTTVA = '+'           ;      09656   
                             STO_D_PIE.GS.MTTVA = FACT.DETAXE(I) ;      09657   
                             STO_D_PIE.GS.SMTTTC = '+'           ;      09658   
                             STO_D_PIE.GS.MTTTC = FACT.NET_TC(I) ;      09659   
                             STO_D_PIE.GS.QTTOT = STO_D_QTTOT    ;      09660   
                             STO_D_QTTOT        = 0              ;      09661   
                             CTR_ENSEQ_D        = CTR_ENSEQ_D + 1;      09662   
                             STO_D_PIE.ID.ENSEQ = CTR_ENSEQ_D ;         09663   
                             WRITE FILE(FICSTOD) FROM(STO_D_PIE)  ;     09664   
                             CTR_LIG_STOD       = CTR_LIG_STOD + 1;     09665   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                09666   
                         END;                                           09667   
                    IF J = 6 THEN DO;   /*   EDITION DU 6EME COTAX    */09668   
                         TTFAC9.COTAX    = FACT.COTAX(I);               09669   
                         TTFAC9.FIL1     = '-';                         09670   
                         TTFAC9.TOLEG    = FACT.TOLEG(I);               09671   
                         TTFAC9.NETTC    = FACT.NET_TC(I);              09672   
                         TTFAC9.DETAX    = FACT.DETAXE(I);              09673   
                         TTFAC9.NETHT    = FACT.NET_HT(I);              09674   
                           /*-- FACT DEMAT SMARTIN 29/12/2004 --*/      09675   
                           IF TOP_DEMA_FAC = 'O'                        09676   
                             THEN DO ;                                  09677   
                             DEMAT_PIE.ID.NULIG =                       09678   
                             DEMAT_PIE.ID.NULIG + 1   ;                 09679   
                             DEMAT_PIE.ID.ENSEQ =                       09680   
                             DEMAT_PIE.ID.ENSEQ + 1   ;                 09681   
                             ATOLEG  = ''                  ;            09682   
                             SUBSTR(ATOLEG,6,2) =                       09683   
                             SUBSTR(FACT.TOLEG(I),5,2) ;                09684   
                             SUBSTR(ATOLEG,3,3) =                       09685   
                             SUBSTR(FACT.TOLEG(I),1,3) ;                09686   
                             ATOLEG = TRANSLATE(ATOLEG,'0',' ') ;       09687   
                             P_TOLEG = ADDR(ATOLEG)        ;            09688   
                             DEMAT_PIE.GS.TXTVA = NTOLEG   ;            09689   
                             DEMAT_PIE.GS.SMONHT = '+'           ;      09690   
                             DEMAT_PIE.GS.MONHT = FACT.NET_HT(I) ;      09691   
                             DEMAT_PIE.GS.SMTTVA = '+'           ;      09692   
                             DEMAT_PIE.GS.MTTVA = FACT.DETAXE(I) ;      09693   
                             DEMAT_PIE.GS.SMTTTC = '+'           ;      09694   
                             DEMAT_PIE.GS.MTTTC = FACT.NET_TC(I) ;      09695   
                             DEMAT_PIE.GS.QTTOT = DEMAT_QTTOT    ;      09696   
                             DEMAT_QTTOT        = 0              ;      09697   
                             WRITE FILE(FICDEMA) FROM(DEMAT_PIE)  ;     09698   
                             CTR_LIG_DEMA       = CTR_LIG_DEMA + 1;     09699   
                           END ;                                        09700   
                           /*-- FACT DEMAT FIN     29/12/2004 --*/      09701   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                09702   
                             ATOLEG  = ''                  ;            09703   
                             SUBSTR(ATOLEG,6,2) =                       09704   
                             SUBSTR(FACT.TOLEG(I),5,2) ;                09705   
                             SUBSTR(ATOLEG,3,3) =                       09706   
                             SUBSTR(FACT.TOLEG(I),1,3) ;                09707   
                             ATOLEG = TRANSLATE(ATOLEG,'0',' ') ;       09708   
                             P_TOLEG = ADDR(ATOLEG)        ;            09709   
                             STO_D_PIE.GS.TXTVA = NTOLEG   ;            09710   
                             STO_D_PIE.GS.SMONHT = '+'           ;      09711   
                             STO_D_PIE.GS.MONHT = FACT.NET_HT(I) ;      09712   
                             STO_D_PIE.GS.SMTTVA = '+'           ;      09713   
                             STO_D_PIE.GS.MTTVA = FACT.DETAXE(I) ;      09714   
                             STO_D_PIE.GS.SMTTTC = '+'           ;      09715   
                             STO_D_PIE.GS.MTTTC = FACT.NET_TC(I) ;      09716   
                             STO_D_PIE.GS.QTTOT = STO_D_QTTOT    ;      09717   
                             STO_D_QTTOT        = 0              ;      09718   
                             CTR_ENSEQ_D        = CTR_ENSEQ_D + 1;      09719   
                             STO_D_PIE.ID.ENSEQ = CTR_ENSEQ_D ;         09720   
                             WRITE FILE(FICSTOD) FROM(STO_D_PIE)  ;     09721   
                             CTR_LIG_STOD       = CTR_LIG_STOD + 1;     09722   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                09723   
                         END;                                           09724   
                    IF J = 7 THEN DO;   /*   EDITION DU 7EME COTAX    */09725   
                         TTFAC10.COTAX  = FACT.COTAX(I);                09726   
                         TTFAC10.FIL1   = '-';                          09727   
                         TTFAC10.TOLEG  = FACT.TOLEG(I);                09728   
                         TTFAC10.NETTC  = FACT.NET_TC(I);               09729   
                         TTFAC10.DETAX  = FACT.DETAXE(I);               09730   
                         TTFAC10.NETHT  = FACT.NET_HT(I);               09731   
                           /*-- FACT DEMAT SMARTIN 29/12/2004 --*/      09732   
                           IF TOP_DEMA_FAC = 'O'                        09733   
                             THEN DO ;                                  09734   
                             DEMAT_PIE.ID.NULIG =                       09735   
                             DEMAT_PIE.ID.NULIG + 1   ;                 09736   
                             DEMAT_PIE.ID.ENSEQ =                       09737   
                             DEMAT_PIE.ID.ENSEQ + 1   ;                 09738   
                             ATOLEG  = ''                  ;            09739   
                             SUBSTR(ATOLEG,6,2) =                       09740   
                             SUBSTR(FACT.TOLEG(I),5,2) ;                09741   
                             SUBSTR(ATOLEG,3,3) =                       09742   
                             SUBSTR(FACT.TOLEG(I),1,3) ;                09743   
                             ATOLEG = TRANSLATE(ATOLEG,'0',' ') ;       09744   
                             P_TOLEG = ADDR(ATOLEG)        ;            09745   
                             DEMAT_PIE.GS.TXTVA = NTOLEG   ;            09746   
                             DEMAT_PIE.GS.SMONHT = '+'           ;      09747   
                             DEMAT_PIE.GS.MONHT = FACT.NET_HT(I) ;      09748   
                             DEMAT_PIE.GS.SMTTVA = '+'           ;      09749   
                             DEMAT_PIE.GS.MTTVA = FACT.DETAXE(I) ;      09750   
                             DEMAT_PIE.GS.SMTTTC = '+'           ;      09751   
                             DEMAT_PIE.GS.MTTTC = FACT.NET_TC(I) ;      09752   
                             DEMAT_PIE.GS.QTTOT = DEMAT_QTTOT    ;      09753   
                             DEMAT_QTTOT        = 0              ;      09754   
                             WRITE FILE(FICDEMA) FROM(DEMAT_PIE)  ;     09755   
                             CTR_LIG_DEMA       = CTR_LIG_DEMA + 1;     09756   
                           END ;                                        09757   
                           /*-- FACT DEMAT FIN     29/12/2004 --*/      09758   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                09759   
                             ATOLEG  = ''                  ;            09760   
                             SUBSTR(ATOLEG,6,2) =                       09761   
                             SUBSTR(FACT.TOLEG(I),5,2) ;                09762   
                             SUBSTR(ATOLEG,3,3) =                       09763   
                             SUBSTR(FACT.TOLEG(I),1,3) ;                09764   
                             ATOLEG = TRANSLATE(ATOLEG,'0',' ') ;       09765   
                             P_TOLEG = ADDR(ATOLEG)        ;            09766   
                             STO_D_PIE.GS.TXTVA = NTOLEG   ;            09767   
                             STO_D_PIE.GS.SMONHT = '+'           ;      09768   
                             STO_D_PIE.GS.MONHT = FACT.NET_HT(I) ;      09769   
                             STO_D_PIE.GS.SMTTVA = '+'           ;      09770   
                             STO_D_PIE.GS.MTTVA = FACT.DETAXE(I) ;      09771   
                             STO_D_PIE.GS.SMTTTC = '+'           ;      09772   
                             STO_D_PIE.GS.MTTTC = FACT.NET_TC(I) ;      09773   
                             STO_D_PIE.GS.QTTOT = STO_D_QTTOT    ;      09774   
                             STO_D_QTTOT        = 0              ;      09775   
                             CTR_ENSEQ_D        = CTR_ENSEQ_D + 1;      09776   
                             STO_D_PIE.ID.ENSEQ = CTR_ENSEQ_D ;         09777   
                             WRITE FILE(FICSTOD) FROM(STO_D_PIE)  ;     09778   
                             CTR_LIG_STOD       = CTR_LIG_STOD + 1;     09779   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                09780   
                         END;                                           09781   
                    IF J = 8 THEN DO;   /*   EDITION DU 8EME COTAX    */09782   
                         TTFAC11.COTAX  = FACT.COTAX(I);                09783   
                         TTFAC11.FIL1   = '-';                          09784   
                         TTFAC11.TOLEG  = FACT.TOLEG(I);                09785   
                         TTFAC11.NETTC  = FACT.NET_TC(I);               09786   
                         TTFAC11.DETAX  = FACT.DETAXE(I);               09787   
                         TTFAC11.NETHT  = FACT.NET_HT(I);               09788   
                           /*-- FACT DEMAT SMARTIN 29/12/2004 --*/      09789   
                           IF TOP_DEMA_FAC = 'O'                        09790   
                             THEN DO ;                                  09791   
                             DEMAT_PIE.ID.NULIG =                       09792   
                             DEMAT_PIE.ID.NULIG + 1   ;                 09793   
                             DEMAT_PIE.ID.ENSEQ =                       09794   
                             DEMAT_PIE.ID.ENSEQ + 1   ;                 09795   
                             ATOLEG  = ''                  ;            09796   
                             SUBSTR(ATOLEG,6,2) =                       09797   
                             SUBSTR(FACT.TOLEG(I),5,2) ;                09798   
                             SUBSTR(ATOLEG,3,3) =                       09799   
                             SUBSTR(FACT.TOLEG(I),1,3) ;                09800   
                             ATOLEG = TRANSLATE(ATOLEG,'0',' ') ;       09801   
                             P_TOLEG = ADDR(ATOLEG)        ;            09802   
                             DEMAT_PIE.GS.TXTVA = NTOLEG   ;            09803   
                             DEMAT_PIE.GS.SMONHT = '+'           ;      09804   
                             DEMAT_PIE.GS.MONHT = FACT.NET_HT(I) ;      09805   
                             DEMAT_PIE.GS.SMTTVA = '+'           ;      09806   
                             DEMAT_PIE.GS.MTTVA = FACT.DETAXE(I) ;      09807   
                             DEMAT_PIE.GS.SMTTTC = '+'           ;      09808   
                             DEMAT_PIE.GS.MTTTC = FACT.NET_TC(I) ;      09809   
                             DEMAT_PIE.GS.QTTOT = DEMAT_QTTOT    ;      09810   
                             DEMAT_QTTOT        = 0              ;      09811   
                             WRITE FILE(FICDEMA) FROM(DEMAT_PIE)  ;     09812   
                             CTR_LIG_DEMA       = CTR_LIG_DEMA + 1;     09813   
                           END ;                                        09814   
                           /*-- FACT DEMAT FIN     29/12/2004 --*/      09815   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                09816   
                             ATOLEG  = ''                  ;            09817   
                             SUBSTR(ATOLEG,6,2) =                       09818   
                             SUBSTR(FACT.TOLEG(I),5,2) ;                09819   
                             SUBSTR(ATOLEG,3,3) =                       09820   
                             SUBSTR(FACT.TOLEG(I),1,3) ;                09821   
                             ATOLEG = TRANSLATE(ATOLEG,'0',' ') ;       09822   
                             P_TOLEG = ADDR(ATOLEG)        ;            09823   
                             STO_D_PIE.GS.TXTVA = NTOLEG   ;            09824   
                             STO_D_PIE.GS.SMONHT = '+'           ;      09825   
                             STO_D_PIE.GS.MONHT = FACT.NET_HT(I) ;      09826   
                             STO_D_PIE.GS.SMTTVA = '+'           ;      09827   
                             STO_D_PIE.GS.MTTVA = FACT.DETAXE(I) ;      09828   
                             STO_D_PIE.GS.SMTTTC = '+'           ;      09829   
                             STO_D_PIE.GS.MTTTC = FACT.NET_TC(I) ;      09830   
                             STO_D_PIE.GS.QTTOT = STO_D_QTTOT    ;      09831   
                             STO_D_QTTOT        = 0              ;      09832   
                             CTR_ENSEQ_D        = CTR_ENSEQ_D + 1;      09833   
                             STO_D_PIE.ID.ENSEQ = CTR_ENSEQ_D ;         09834   
                             WRITE FILE(FICSTOD) FROM(STO_D_PIE)  ;     09835   
                             CTR_LIG_STOD       = CTR_LIG_STOD + 1;     09836   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                09837   
                         END;                                           09838   
                END;     /* FIN SI COTAX NE ' ' */                      09839   
           END;                /*   FIN  BOUCLE  DO          */         09840   
                                                                        09841   
           TTFAC12.COTAX       = 'C';                                   09842   
           TTFAC12.FIL1        = 'O';                                   09843   
           TTFAC12.TOLEG       = 'NTROLES';                             09844   
           TTFAC12.DETAX       = FACT.TAXES;                            09845   
           TTFAC12.NETHT       = FACT.NETHT;                            09846   
           TTFAC12.NETTC       = FACT.DEBIT;                            09847   
0     /*   IF FRAIS_HT ^= 0 & WTFAC.EDIPA = '2' THEN DO  */ /*0299*/    09848   
              TTFAC12.LIBEL    = '   FRAIS HT';                         09849   
              TTFAC12.MENVTE   = FRAIS_HT     ;                         09850   
     /*       END  */                                                   09851   
0      Q000F:                                                           09852   
           END VENT_COTAX;                                              09853   
                                                                        09854   
1    RECALCUL_TVA_FAC:     PROCEDURE;                                   09855   
0          /*                                                           09856   
                    ****************************************            09857   
                    * RECALCULER LA TVA DE LA FACTURE      *            09858   
                    * PAR RAPPORT AU PIED (TABLEAU FACT)   *            09859   
                    * ET NON PLUS LIGNE (MODULE CALCUL)    *            09860   
                    * L'ECART DE TVA EST IMPUTE SUR        *            09861   
                    * LES DIFFERENTS CALCULS EFFECTUES AU  *            09862   
                    * NIVEAU LIGNE (SAUF GHI)              *            09863   
                    * UNE ECRIT.CPTABLE SERA EFFECTUEE DS  *            09864   
                    * MERCURE (CF ECRITURE_ECART_TVA)      *            09865   
                    ****************************************            09866   
           */                                                           09867   
           TAXES_AS = FACT.TAXES;  /* SAUVER L'ANCIENNE TVA FACTURE */  09868   
           FACT.TAXES = 0;                                              09869   
           DO I = 0 TO 9;                                               09870   
              IF FACT.COTAX(I) ^= ' ' THEN DO;                          09871   
                 /* UNIQMT QD LE CALCUL EST RECALCU. NIVEAU FACTURE */  09872   
                IF FACT.NET_TC(I) >= (FACT.NET_HT(I) + FACT.DETAXE(I))  09873   
                THEN DO;                                                09874   
                   WS_ZON06  = TRANSLATE(FACT.TOLEG(I),'0 ',' ') ;      09875   
                   WS_TOLEG_ENT  = WS_ZONE_ENT;                         09876   
                   WS_TOLEG_DEC  = WS_ZONE_DEC;                         09877   
                   FACT.DETAXE(I)=((FACT.NET_HT(I) * WS_TOLEG_NUM)/100) 09878   
                                      + 0.005;                          09879   
                   FACT.NET_TC(I) = FACT.NET_HT(I) + FACT.DETAXE(I);    09880   
                END;                                                    09881   
                FACT.TAXES = FACT.TAXES + FACT.DETAXE(I);               09882   
              END;                                                      09883   
           END;     /* FIN BOUCLE DO */                                 09884   
                                                                        09885   
          /* GHI : NE RIEN FAIRE SI RECALCUL TVA/FATURE IMPOSSIBLE */   09886   
           IF FACT.TAXES = 0 THEN FACT.TAXES = TAXES_AS;                09887   
                                                                        09888   
           ECART_TVA = FACT.TAXES - TAXES_AS;                           09889   
           J = FACT.ECHEAMAX;                                           09890   
           IF ECART_TVA ^= 0 THEN DO;                                   09891   
              DEBIT_AS = FACT.DEBIT;                                    09892   
              FACT.DEBIT = FACT.DEBIT + ECART_TVA;                      09893   
              J = FACT.ECHEAMAX;                                        09894   
              DO I = 0 TO 99;            /*   RECH 1ER POSTE NON NUL  */09895   
                 IF FACT.ECHEA(I) ^= ' '                                09896   
                  & FACT.TAXLI(I) ^= 0 THEN DO;                         09897   
                    J        = I ;                                      09898   
                    I        = 99;                                      09899   
                    END;                                                09900   
                 END;                                                   09901   
              FACT.MTECH(J)  = FACT.MTECH(J)  + ECART_TVA;              09902   
              FACT.TAXLI(J)  = FACT.TAXLI(J)  + ECART_TVA;              09903   
              SVG_I          = 1;                                       09904   
              DO I = 0 TO 9;             /*   RECH 1ER POST NON 0 NETC*/09905   
                 IF FACT.NETC(J,I) ^= 0 THEN DO;                        09906   
                    SVG_I    = I;                                       09907   
                    I        = 9;                                       09908   
                    END;                                                09909   
                 END;                                                   09910   
              DO I = 0 TO 9;             /*   RECH 1ER POST NON 0 MTAX*/09911   
                 IF FACT.MTAX(J,I) ^= 0 THEN DO;                        09912   
                    SVG_I    = I;                                       09913   
                    I        = 9;                                       09914   
                    END;                                                09915   
                 END;                                                   09916   
              FACT.NETC(J,SVG_I) = FACT.NETC(J,SVG_I) + ECART_TVA;      09917   
              FACT.MTAX(J,SVG_I) = FACT.MTAX(J,SVG_I) + ECART_TVA;      09918   
              IF FACT.RASSOR >= FACT.MENVTE THEN                        09919   
                 FACT.RASSOR = FACT.RASSOR  + ECART_TVA;                09920   
              ELSE                                                      09921   
                 FACT.MENVTE = FACT.MENVTE  + ECART_TVA;                09922   
              IF ACCORD_OUI_NON = 'OUI' THEN DO;                        09923   
                 IF ACC1.NETTC(1) ^= 0 THEN DO;                         09924   
                   /* TENIR CPTE DU SIGNE DETERMINE  POUR FHISTO */     09925   
                    IF ACC1.NETTC(1) >= 0 THEN                          09926   
                       ACC1.NETTC(1) = ACC1.NETTC(1) + ECART_TVA;       09927   
                    ELSE ACC1.NETTC(1) = ACC1.NETTC(1) - ECART_TVA;     09928   
                 END;                                                   09929   
                 ELSE  DO;                                              09930   
                    /* TENIR CPTE DU SIGNE DETERMINE  POUR FHISTO */    09931   
                    IF WS_ACC.AUT_NETTC >= 0 THEN                       09932   
                       WS_ACC.AUT_NETTC = WS_ACC.AUT_NETTC + ECART_TVA; 09933   
                    ELSE WS_ACC.AUT_NETTC = WS_ACC.AUT_NETTC ;          09934   
                 END;                                                   09935   
              END;  /* FIN CUMULS ACCORD IMPACTES */                    09936   
              CALL  ECRITURE_ECART_TVA;                                 09937   
           END;  /* FIN ECART TVA A IMPUTER S/LIGNES MERCURE */         09938   
                                                                        09939   
     END RECALCUL_TVA_FAC;                                              09940   
                                                                        09941   
1    ECRITURE_ECART_TVA:    PROCEDURE;                                  09942   
0          /*                                                           09943   
                    ****************************************            09944   
                    * ECRIRE DANS FICHIER IDPIEDF5         *            09945   
                    * ECART  DE TVA PAR NORUN/NUCLI/NUFAC  *            09946   
                    * POUR  REGUL COMPTABLE DANS MERCURE   *            09947   
                    ****************************************            09948   
           */                                                           09949   
             PI5_PIEDF = '';                                            09950   
             PI5_NORUN = WTFAC.NORUN;                                   09951   
             PI5_GNATO = WTFAC.GS.GNATO; /* POUR CALCUL SIGNE */        09952   
             PI5_NUCLI = NUCLINUM;                                      09953   
             PI5_NUFAC = WNUFAC;                                        09954   
           /* MONTANT TTC FACTURE CALCUL LIGNE */                       09955   
             PI5_MTCFA = DEBIT_AS;                                      09956   
           /* MONTANT TTC FACTURE CALCUL TAUX/PIED FACTURE */           09957   
             PI5_MTCF1 = FACT.DEBIT;                                    09958   
           /* MONTANT DES TAXES AS : CALCUL NIVEAU LIGNE */             09959   
             PI5_TAXES = TAXES_AS;                                      09960   
           /* MONTANT DES TAXES NS : CALCUL NIVEAU PIED FACTURE */      09961   
             PI5_MTAX  = FACT.TAXES;                                    09962   
           /* ECART TVA S/MODE CALCUL */                                09963   
             PI5_ECTVA = ECART_TVA;                                     09964   
             PI5_TRACO = WTFAC.TRACO;                                   09965   
             PI5_JJCOM = ENTET70.DAT10.JJ;                              09966   
             PI5_MMCOM = ENTET70.DAT10.MM;                              09967   
             PI5_AACOM = ENTET70.DAT10.AA;                              09968   
             IF ENTET70.DAT10.AA > '50'                                 09969   
                THEN PI5_SSCOM = '19' ;                                 09970   
                ELSE PI5_SSCOM = '20' ;                                 09971   
0            SELECT (UN_M) ;                                            09972   
                WHEN (10,30,40,50) DO;   /*POUR LA FRANCE*/             09973   
                  PI5_COEN7 = 'FRANCE ' ;                               09974   
                  END;                                                  09975   
                WHEN (20,70) DO ;        /*POUR L EXPORT HACHETTE*/     09976   
                  PI5_COEN7 = 'EXPORT ' ;                               09977   
                  END;                                                  09978   
                WHEN (60) DO ;           /*POUR L EXPORT GHI*/          09979   
                  PI5_COEN7 = 'GHI    ' ;                               09980   
                  END;                                                  09981   
                OTHERWISE DO;            /*    AUTRES       */          09982   
                  END;                                                  09983   
                END;                                                    09984   
                                                                        09985   
0            IF WTFAC.DEPCO = '10' THEN DO ; /*    FRANCE EDDL      */  09986   
                PI5_COEN7 = 'EDDL   ' ;                                 09987   
                END;                                                    09988   
             IF NUCLI_HMD = 'O' THEN DO; /*   POUR MULTIMED HMD       */09989   
                PI5_COEN7 = 'HMD    ' ;                                 09990   
                END;                                                    09991   
                                                                        09992   
             WRITE FILE (IDPIEDF5)   FROM (FD_IDPIEDF5);                09993   
             WS_ECRI_IDPIEDF5 = WS_ECRI_IDPIEDF5 + 1   ;                09994   
     END ECRITURE_ECART_TVA;                                            09995   
                                                                        09996   
1   MASQUE:         PROCEDURE;                                          09997   
0          /*                                                           09998   
                    ************************************                09999   
                    *                                  *                10000   
                    *    REMISE A BLANC DES COLONNES   *                10001   
                    *    NETTC POUR POFIS 6 ET 9 ET    *                10002   
                    *    DE LA COLONNE DETAXE POUR     *                10003   
                    *    POFIS 9 DS LA VENTILATION     *                10004   
                    *    PAR CODE TAXE    23.04.80     *                10005   
                    *                                  *                10006   
                    ************************************                10007   
           */                                                           10008   
0      R000D:                           /*   MISE A BLANC COLON. NETTC*/10009   
           TTFAC20.LIBEL2        = ' ';                                 10010   
           TTFAC20.LIBEL3        = '       DETAXE';                     10011   
           TTFAC4A.NETTC         = ' ';  TTFAC5A.NETTC      = ' ';      10012   
           TTFAC6A.NETTC         = ' ';  TTFAC7A.NETTC      = ' ';      10013   
           TTFAC8A.NETTC         = ' ';  TTFAC9A.NETTC      = ' ';      10014   
           TTFAC10A.NETTC        = ' ';  TTFAC11A.NETTC     = ' ';      10015   
           TTFAC12A.NETTC        = ' ';                                 10016   
           IF WTFAC.POFIS   = '6' THEN GO TO R000F;                     10017   
           TTFAC20.LIBEL3        = ' ';                                 10018   
           TTFAC4A.DETAX         = ' ';   TTFAC5A.DETAX      = ' ';     10019   
           TTFAC6A.DETAX         = ' ';   TTFAC7A.DETAX      = ' ';     10020   
           TTFAC8A.DETAX         = ' ';   TTFAC9A.DETAX      = ' ';     10021   
           TTFAC10A.DETAX        = ' ';   TTFAC11A.DETAX     = ' ';     10022   
           TTFAC12A.DETAX        = ' ';                                 10023   
0      R000F:                                                           10024   
           END MASQUE;                                                  10025   
1   EDIVENE:        PROCEDURE;                                          10026   
0          /*                                                           10027   
                    ***********************************                 10028   
                    *                                 *                 10029   
                    *    MODULE D'EDITION DE LA       *                 10030   
                    *    VENTILATION PAR VENET        *                 10031   
                    *    DU PIED DE LA FACTURE        *                 10032   
                    *    NON EDITE  09-2010           *                 10033   
                    *                                 *                 10034   
                    ***********************************                 10035   
           */                                                           10036   
0      S000D:                                                           10037   
           DO I = 0  TO 7 ;                                             10038   
              SELECT (I) ;                                              10039   
                 WHEN (0)   P_LVENET= ADDR(TOTAL5);                     10040   
                 WHEN (1)   P_LVENET= ADDR(TOTAL6);                     10041   
                 WHEN (2)   P_LVENET= ADDR(TOTAL7);                     10042   
                 WHEN (3)   P_LVENET= ADDR(TOTAL8);                     10043   
                 WHEN (4)   P_LVENET= ADDR(TOTAL9);                     10044   
                 WHEN (5)   P_LVENET= ADDR(TOTAL10);                    10045   
                 WHEN (6)   P_LVENET= ADDR(TOTAL11);                    10046   
                 WHEN (7)   P_LVENET= ADDR(TOTAL12);                    10047   
                 OTHERWISE ;                                            10048   
              END;                                                      10049   
              WEXPLO            = I ;                                   10050   
              LIGNE_VENET.EXPLO = WEXPLO;                               10051   
              LIGNE_VENET.FIL7  = '-';                                  10052   
                                                                        10053   
              IF FACT.VENET(I) = '' THEN DO;                            10054   
                 WNOANO        = '1';                                   10055   
                 IPIC          = I;                                     10056   
                 CLE2          = WTFAC.ECFAC !! ICHAR;                  10057   
                 CALL ID470B(TBVENET.NUTAB);                            10058   
                 WNOANO        = ' ';                                   10059   
                 IF WLVENE = '' THEN DO;                                10060   
                    LIGNE_VENET.EXPLO = '';                             10061   
                    LIGNE_VENET.FIL7  = '';                             10062   
                 END;                                                   10063   
                 LIGNE_VENET.LVENE = WLVENE;                            10064   
               END;                                                     10065   
               ELSE DO ;                                                10066   
               LIGNE_VENET.LVENE = FACT.LVENE(I);                       10067   
               LIGNE_VENET.MTVEN = FACT.MTVEN(I);                       10068   
               END;                                                     10069   
           END;                                                         10070   
                 /* CAS DES FRAIS DE PORT */                            10071   
               IF FACT.MTVEN(8) ^= 0 THEN DO ;                          10072   
                LIGNE_VENET.MTVEN  = FACT.MTVEN(8);                     10073   
               END;                                                     10074   
           END EDIVENE;                                                 10075   
1   CUECHEA:        PROCEDURE;                                          10076   
0          /*                                                           10077   
                    **************************************              10078   
                    *                                    *              10079   
                    *    SOUS PGM DE VENTILATION DE      *              10080   
                    *    LA QUANTITE PAR ECHEANCE        *              10081   
                    *                                    *              10082   
                    **************************************              10083   
           */                                                           10084   
0      T000D:                                                           10085   
           IF VERIFY (WTFAC.ECHEA,NUMERIC) ^= 0 THEN DO;                10086   
                    ZONCTL        = '                * ECHEA NON NUM' !!10087   
                                    'ERIQUE ' !! WTFAC.ECHEA !!         10088   
                                    '   FACT. NO. ' !! WNUFAC ;         10089   
                    CALL MACMES3 (DESTI,'1',ZONCTL);                    10090   
                    WTFAC.ECHEA   = '00';                               10091   
                    END;                                                10092   
           IF WTFAC.EDIPA = '2' THEN DO;                                10093   
                    J                   = FACT.ECHGIH;                  10094   
                    FACT.ECHEA(J)       = FACT.ECHGIH;                  10095   
                    END;                ELSE DO;                        10096   
                    IF ECHEANUM > FACT.ECHEAMAX                         10097   
                       THEN FACT.ECHEAMAX = ECHEANUM;                   10098   
                    J                   = ECHEANUM;                     10099   
                    FACT.ECHEA(J)       = ECHEANUM;                     10100   
                    END;                                                10101   
0          IF FACT.WECHEA ^= WTFAC.ECHEA THEN DO;                       10102   
                    FACT.WECHEA         = WTFAC.ECHEA;                  10103   
                    CLE2                = WTFAC.ECHEA;                  10104   
                    CALL ID470B(TBECHEA.NUTAB);                         10105   
                    FACT.LECHE(J)       = WLECHE;                       10106   
                    END;                /*   FIN INIT. LIBELLE ECHEA  */10107   
           FACT.QTELI(J)     = FACT.QTELI(J)  + XQUANT;                 10108   
0      T000F:                                                           10109   
           END CUECHEA;                                                 10110   
1   EDIECHE:        PROCEDURE;                                          10111   
0          /*                                                           10112   
                    ***********************************                 10113   
                    *                                 *                 10114   
                    *    MODULE D'EDITION DE LA       *                 10115   
                    *    VENTILATION PAR ECHEANCE     *                 10116   
                    *    DU BAS DE LA FACTURE ET      *                 10117   
                    *    DU FICHIER RESULTATS DE      *                 10118   
                    *    FACTURATION  : PIED          *                 10119   
                    *                                 *                 10120   
                    ***********************************                 10121   
           */                                                           10122   
0      U000D:                                                           10123   
           J                 = 0;                                       10124   
           TAB.COEFF         = 1;                                       10125   
           IF WTFAC.GNATO = '0D' THEN DO;                               10126   
                                       /*   FACTURES GIH NEGATIVES ?  */10127   
                    IF FACT.DEBIT   < 0 THEN DO;                        10128   
                       WANOE.TBANO(1)  = '2395';                        10129   
                       WANOL.TBANO(1)  = '2395';                        10130   
                       WANOL.LIMPO     = '***** FACTURE ' !! WNUFAC !!  10131   
                                         ' NET A PAYER NEGATIF ';       10132   
                       CALL ID470D;    /*   ANOMALIE UTILISATEUR      */10133   
                       WRESP.GNATO     = '1C';                          10134   
                       TAB.COEFF       = -1 ;                           10135   
                       END;            ELSE DO;                         10136   
                       WRESP.GNATO     = '0F';                          10137   
                       END;            /*   FIN TEST FACTURE NEGATIVE */10138   
                    END;               /*   FIN TEST GNATO  0D        */10139   
0          IF WTFAC.EDIPA = '2' THEN DO;/*   CAS  DU  GIH             */10140   
                    IF WTFAC.NATOP = '41' THEN GO TO U000H;             10141   
                    I                  = FACT.ECHGIH;                   10142   
                    IF FACT.IMPEC = '1' THEN WRESP.ECHEA = FACT.ECHGIH; 10143   
                                        ELSE WRESP.ECHEA = ' ';         10144   
                    WRESP.POIDS        = FACT.POIDS;                    10145   
                    WRESP.QUANT        = FACT.QTELI(I) * TAB.COEFF;     10146   
                    WRESP.FORHT        = FACT.FORLI(I) * TAB.COEFF;     10147   
                    WRESP.NETTC        = FACT.MTECH(I) * TAB.COEFF;     10148   
                    WRESP.TAXES        = FACT.TAXLI(I) * TAB.COEFF;     10149   
                    L                  = 0;                             10150   
                    DO K = 0 TO 9;      /*   ITERATION SUR LES ECHEA  */10151   
                       IF FACT.COTA(I,K) = ' ' THEN GO TO U000A;        10152   
                       L               = L + 1;                         10153   
                       WRESP.COTAX(L)  = FACT.COTA(I,K) ;               10154   
                       WRESP.NETC(L)   = FACT.NETC(I,K) * TAB.COEFF;    10155   
                       WRESP.MTAX(L)   = FACT.MTAX(I,K) * TAB.COEFF;    10156   
       U000A:          END;             /*   FIN  BOUCLE  DO          */10157   
                    WRESP.NBTAX        = L;                             10158   
0      U000B:                                                           10159   
             IF WRESP.ECHEA        = '        '                         10160   
              THEN DO                                                   10161   
               WRESP.ECHEA        = ECHEANUM;                           10162   
             END;                                                       10163   
                                                                        10164   
             WRESP.DAECH = '        ' ;                                 10165   
             DO IKH = 1 TO 100 WHILE (TABX.WX_DAECH(IKH) ^= '' )  ;     10166   
               IF WRESP.ECHEA = TABX.WX_ECHEA(IKH)                      10167   
                THEN DO;                                                10168   
                IF VERIFY (TABX.WX_DAECH(IKH),NUMERIC) = 0 THEN DO;     10169   
                   IF SUBSTR(TABX.WX_DAECH(1),1,2) > '80'               10170   
                   THEN SUBSTR(WRESP.DAECH,1,2) = '19';                 10171   
                   ELSE SUBSTR(WRESP.DAECH,1,2) = '20';                 10172   
                     WRESP.DAECH = SUBSTR(WRESP.DAECH,1,2) !!           10173   
                                       TABX.WX_DAECH(IKH);              10174   
                   END;                                                 10175   
                ELSE IF WRESP.ECHEA = ' '                               10176   
                  THEN WRESP.DAECH = '        ';                        10177   
               END;                                                     10178   
             END;                                                       10179   
             WRITE FILE (FRESUL) FROM (WRESP);                          10180   
                    MACFA.NBRES        = MACFA.NBRES + 1;               10181   
0      U000H:                                                           10182   
                    IF WTFAC.PEFAC = '9' THEN GO TO U000F;              10183   
                                        /*   FACTURE OUVERTE          */10184   
                    TTFAC3.LIBEL1      = 'ECHEANCE ';                   10185   
                    CLE2               = FACT.ECHGIH;                   10186   
                    CALL ID470B(TBECHEA.NUTAB);                         10187   
                    TTFAC3.LECHE       = WLECHE;                        10188   
                    GO TO U000F;                                        10189   
                    END;                /*   FIN CAS  DU  GIH         */10190   
0                                       /*   CAS  DU  CDL             */10191   
           DO I = 0 TO FACT.ECHEAMAX;   /*   ITERATION SUR LES ECHEAN */10192   
                    IF FACT.ECHEA(I)   = ' ' THEN GO TO U000G;          10193   
                    J                  = J + 1;                         10194   
                    IF J > 8 THEN DO;   /*   EDITION DE 8 ECHEA MAXI  */10195   
                                        /*   APPEL FIC. AUTO CONTROLE */10196   
                         ZONCTL        = '                * CODE ECHEA' 10197   
                                         !! ' SUP. A 8   FACTURE ' !!   10198   
                                         WNUFAC ;                       10199   
                         CALL MACMES3 (DESTI,'1',ZONCTL);               10200   
                         END;                                           10201   
                    IF WTFAC.NATOP     = '41' THEN GO TO U000I;         10202   
                    L                  = 0;                             10203   
0                   DO K = 0 TO 9;      /*   RECHERCHE DES COTAX      */10204   
                         IF FACT.COTA(I,K) = ' ' THEN GO TO U000C;      10205   
                         L             = L + 1;                         10206   
                         WRESP.COTAX(L)= FACT.COTA(I,K) ;               10207   
                         WRESP.NETC(L) = FACT.NETC(I,K) * TAB.COEFF;    10208   
                         WRESP.MTAX(L) = FACT.MTAX(I,K) * TAB.COEFF;    10209   
       U000C:            END;           /*   FIN BOUCLE DO COTAX      */10210   
                    WRESP.NBTAX        = L;                             10211   
                    WRESP.POIDS        = 0;                             10212   
                    WRESP.ECHEA        = FACT.ECHEA(I);                 10213   
                    WRESP.QUANT        = FACT.QTELI(I) * TAB.COEFF;     10214   
                    WRESP.FORHT        = FACT.FORLI(I) * TAB.COEFF;     10215   
                    WRESP.NETTC        = FACT.MTECH(I) * TAB.COEFF;     10216   
                    WRESP.TAXES        = FACT.TAXLI(I) * TAB.COEFF;     10217   
0      U000E:                                                           10218   
             IF WRESP.ECHEA        = '        '                         10219   
              THEN DO                                                   10220   
               WRESP.ECHEA        = ECHEANUM;                           10221   
             END;                                                       10222   
                                                                        10223   
             WRESP.DAECH = '        ' ;                                 10224   
             DO IKH = 1 TO 100 WHILE (TABX.WX_DAECH(IKH) ^= '' )  ;     10225   
               IF WRESP.ECHEA = TABX.WX_ECHEA(IKH)                      10226   
                THEN DO;                                                10227   
                IF VERIFY (TABX.WX_DAECH(IKH),NUMERIC) = 0 THEN DO;     10228   
                   IF SUBSTR(TABX.WX_DAECH(IKH),1,2) > '80'             10229   
                   THEN SUBSTR(WRESP.DAECH,1,2) = '19';                 10230   
                   ELSE SUBSTR(WRESP.DAECH,1,2) = '20';                 10231   
                     WRESP.DAECH = SUBSTR(WRESP.DAECH,1,2) !!           10232   
                                       TABX.WX_DAECH(IKH);              10233   
                   END;                                                 10234   
                ELSE IF WRESP.ECHEA = ' '                               10235   
                  THEN WRESP.DAECH = '        ';                        10236   
               END;                                                     10237   
             END;                                                       10238   
             WRITE FILE (FRESUL) FROM (WRESP);                          10239   
             MACFA.NBRES        = MACFA.NBRES + 1;                      10240   
0      U000I:                                                           10241   
                    IF WTFAC.TRACO  = '4' & WTFAC.EDIPA = '1'           10242   
                                    THEN CALL EDIT_NOMENC ;             10243   
                    IF WTFAC.TRACO ^= '0' THEN GO TO U000G;             10244   
                    IF WTFAC.DEPCO = '17' THEN GO TO U000G;             10245   
                                                                        10246   
                                        /*   EDIT. PAR ECHEANCES      */10247   
                                        /*   ANCIENNE VERSION N EST   */10248   
                                        /* PLUS OPERATIONNELLE        */10249   
                                        /* MODIF JNM DU 09.11.93      */10250   
                                        /* =========================  */10251   
0                   GO TO U000G ;                                       10252   
                                                                        10253   
0                   IF J = 1 THEN DO;   /*   EDITION DU 1ER ECHEA     */10254   
                         TTFAC4.ECHEA   = FACT.ECHEA(I);                10255   
                         TTFAC4.FIL7    = '-';                          10256   
                         TTFAC4.LECHE   = FACT.LECHE(I);                10257   
                         TTFAC4.MTECH   = FACT.MTECH(I) ;               10258   
                         GO TO U000G;                                   10259   
                         END;                                           10260   
                    IF J = 2 THEN DO;   /*   EDITION DU 2EME ECHEA    */10261   
                         TTFAC5.ECHEA   = FACT.ECHEA(I);                10262   
                         TTFAC5.FIL7    = '-';                          10263   
                         TTFAC5.LECHE   = FACT.LECHE(I);                10264   
                         TTFAC5.MTECH   = FACT.MTECH(I) ;               10265   
                         GO TO U000G;                                   10266   
                         END;                                           10267   
                    IF J = 3 THEN DO;   /*   EDITION DU 3EME ECHEA    */10268   
                         TTFAC6.ECHEA   = FACT.ECHEA(I);                10269   
                         TTFAC6.FIL7    = '-';                          10270   
                         TTFAC6.LECHE   = FACT.LECHE(I);                10271   
                         TTFAC6.MTECH   = FACT.MTECH(I) ;               10272   
                         GO TO U000G;                                   10273   
                         END;                                           10274   
                    IF J = 4 THEN DO;   /*   EDITION DU 4EME ECHEA    */10275   
                         TTFAC7.ECHEA   = FACT.ECHEA(I);                10276   
                         TTFAC7.FIL7    = '-';                          10277   
                         TTFAC7.LECHE   = FACT.LECHE(I);                10278   
                         TTFAC7.MTECH   = FACT.MTECH(I) ;               10279   
                         GO TO U000G;                                   10280   
                         END;                                           10281   
                    IF J = 5 THEN DO;   /*   EDITION DU 5EME ECHEA    */10282   
                         TTFAC8.ECHEA   = FACT.ECHEA(I);                10283   
                         TTFAC8.FIL7    = '-';                          10284   
                         TTFAC8.LECHE   = FACT.LECHE(I);                10285   
                         TTFAC8.MTECH   = FACT.MTECH(I) ;               10286   
                         GO TO U000G;                                   10287   
                         END;                                           10288   
                    IF J = 6 THEN DO;   /*   EDITION DU 6EME ECHEA    */10289   
                         TTFAC9.ECHEA   = FACT.ECHEA(I);                10290   
                         TTFAC9.FIL7    = '-';                          10291   
                         TTFAC9.LECHE   = FACT.LECHE(I);                10292   
                         TTFAC9.MTECH   = FACT.MTECH(I) ;               10293   
                         GO TO U000G;                                   10294   
                         END;                                           10295   
                    IF J = 7 THEN DO;   /*   EDITION DU 7EME ECHEA    */10296   
                         TTFAC10.ECHEA  = FACT.ECHEA(I);                10297   
                         TTFAC10.FIL7   = '-';                          10298   
                         TTFAC10.LECHE  = FACT.LECHE(I);                10299   
                         TTFAC10.MTECH  = FACT.MTECH(I) ;               10300   
                         GO TO U000G;                                   10301   
                         END;                                           10302   
                    IF J = 8 THEN DO;   /*   EDITION DU 8EME ECHEA    */10303   
                         TTFAC11.ECHEA  = FACT.ECHEA(I);                10304   
                         TTFAC11.FIL7   = '-';                          10305   
                         TTFAC11.LECHE  = FACT.LECHE(I);                10306   
                         TTFAC11.MTECH  = FACT.MTECH(I) ;               10307   
                         END;                                           10308   
       U000G:       END;                /*   FIN  BOUCLE  DO  ECHEA   */10309   
                                                                        10310   
                                        /*   EDIT. PAR ECHEANCES      */10311   
                                        /*   NOUVELLE VERSION         */10312   
                                        /*   MODIF JNM DU 09.11.93    */10313   
                                        /* =========================  */10314   
                                                                        10315   
                    IF WTFAC.TRACO ^= '0' THEN GO TO U000F;             10316   
                    IF WTFAC.DEPCO = '17' THEN GO TO U000F;             10317   
                         IF TABZ.WZ_DAECH(1) ^= '' THEN DO ;            10318   
                         EDTDAT         = TABZ.WZ_DAECH(1)  ;           10319   
                         AN_ZEDAT       = AN_WEDAT          ;           10320   
                         MO_ZEDAT       = MO_WEDAT          ;           10321   
                         JR_ZEDAT       = JR_WEDAT          ;           10322   
                         Q1_WEDAT       = '/'               ;           10323   
                         Q2_WEDAT       = '/'               ;           10324   
                         TTFAC4.ECHEA   = '' ;                          10325   
                         TTFAC4.FIL7    = ' ';                          10326   
                         TTFAC4.LECHE   = ZEDDAT  ;                     10327   
                         TTFAC4.MTECH   = TABZ.WZ_MTECH(1)   ;          10328   
                         END ;                                          10329   
                                                                        10330   
                         IF TABZ.WZ_DAECH(2) ^= '' THEN DO ;            10331   
                         EDTDAT         = TABZ.WZ_DAECH(2)  ;           10332   
                         AN_ZEDAT       = AN_WEDAT          ;           10333   
                         MO_ZEDAT       = MO_WEDAT          ;           10334   
                         JR_ZEDAT       = JR_WEDAT          ;           10335   
                         Q1_WEDAT       = '/'               ;           10336   
                         Q2_WEDAT       = '/'               ;           10337   
                         TTFAC5.ECHEA   = '' ;                          10338   
                         TTFAC5.FIL7    = ' ';                          10339   
                         TTFAC5.LECHE   = ZEDDAT  ;                     10340   
                         TTFAC5.MTECH   = TABZ.WZ_MTECH(2)   ;          10341   
                         END ;                                          10342   
                                                                        10343   
                         IF TABZ.WZ_DAECH(3) ^= '' THEN DO ;            10344   
                         EDTDAT         = TABZ.WZ_DAECH(3)  ;           10345   
                         AN_ZEDAT       = AN_WEDAT          ;           10346   
                         MO_ZEDAT       = MO_WEDAT          ;           10347   
                         JR_ZEDAT       = JR_WEDAT          ;           10348   
                         Q1_WEDAT       = '/'               ;           10349   
                         Q2_WEDAT       = '/'               ;           10350   
                         TTFAC6.ECHEA   = '' ;                          10351   
                         TTFAC6.FIL7    = ' ';                          10352   
                         TTFAC6.LECHE   = ZEDDAT  ;                     10353   
                         TTFAC6.MTECH   = TABZ.WZ_MTECH(3)   ;          10354   
                         END ;                                          10355   
                                                                        10356   
                         IF TABZ.WZ_DAECH(4) ^= '' THEN DO ;            10357   
                         EDTDAT         = TABZ.WZ_DAECH(4)  ;           10358   
                         AN_ZEDAT       = AN_WEDAT          ;           10359   
                         MO_ZEDAT       = MO_WEDAT          ;           10360   
                         JR_ZEDAT       = JR_WEDAT          ;           10361   
                         Q1_WEDAT       = '/'               ;           10362   
                         Q2_WEDAT       = '/'               ;           10363   
                         TTFAC7.ECHEA   = '' ;                          10364   
                         TTFAC7.FIL7    = ' ';                          10365   
                         TTFAC7.LECHE   = ZEDDAT  ;                     10366   
                         TTFAC7.MTECH   = TABZ.WZ_MTECH(4)   ;          10367   
                         END ;                                          10368   
                                                                        10369   
                         IF TABZ.WZ_DAECH(5) ^= '' THEN DO ;            10370   
                         EDTDAT         = TABZ.WZ_DAECH(5)  ;           10371   
                         AN_ZEDAT       = AN_WEDAT          ;           10372   
                         MO_ZEDAT       = MO_WEDAT          ;           10373   
                         JR_ZEDAT       = JR_WEDAT          ;           10374   
                         Q1_WEDAT       = '/'               ;           10375   
                         Q2_WEDAT       = '/'               ;           10376   
                         TTFAC8.ECHEA   = '' ;                          10377   
                         TTFAC8.FIL7    = ' ';                          10378   
                         TTFAC8.LECHE   = ZEDDAT  ;                     10379   
                         TTFAC8.MTECH   = TABZ.WZ_MTECH(5)   ;          10380   
                         END ;                                          10381   
                                                                        10382   
                         IF TABZ.WZ_DAECH(6) ^= '' THEN DO ;            10383   
                         EDTDAT         = TABZ.WZ_DAECH(6)  ;           10384   
                         AN_ZEDAT       = AN_WEDAT          ;           10385   
                         MO_ZEDAT       = MO_WEDAT          ;           10386   
                         JR_ZEDAT       = JR_WEDAT          ;           10387   
                         Q1_WEDAT       = '/'               ;           10388   
                         Q2_WEDAT       = '/'               ;           10389   
                         TTFAC9.ECHEA   = '' ;                          10390   
                         TTFAC9.FIL7    = ' ';                          10391   
                         TTFAC9.LECHE   = ZEDDAT  ;                     10392   
                         TTFAC9.MTECH   = TABZ.WZ_MTECH(6)   ;          10393   
                         END ;                                          10394   
                                                                        10395   
                         IF TABZ.WZ_DAECH(7) ^= '' THEN DO ;            10396   
                         EDTDAT         = TABZ.WZ_DAECH(7)  ;           10397   
                         AN_ZEDAT       = AN_WEDAT          ;           10398   
                         MO_ZEDAT       = MO_WEDAT          ;           10399   
                         JR_ZEDAT       = JR_WEDAT          ;           10400   
                         Q1_WEDAT       = '/'               ;           10401   
                         Q2_WEDAT       = '/'               ;           10402   
                         TTFAC10.ECHEA  = '' ;                          10403   
                         TTFAC10.FIL7   = ' ';                          10404   
                         TTFAC10.LECHE  = ZEDDAT  ;                     10405   
                         TTFAC10.MTECH  = TABZ.WZ_MTECH(7)   ;          10406   
                         END ;                                          10407   
                                                                        10408   
                         IF TABZ.WZ_DAECH(8) ^= '' THEN DO ;            10409   
                         EDTDAT         = TABZ.WZ_DAECH(8)  ;           10410   
                         AN_ZEDAT       = AN_WEDAT          ;           10411   
                         MO_ZEDAT       = MO_WEDAT          ;           10412   
                         JR_ZEDAT       = JR_WEDAT          ;           10413   
                         Q1_WEDAT       = '/'               ;           10414   
                         Q2_WEDAT       = '/'               ;           10415   
                         TTFAC11.ECHEA  = '' ;                          10416   
                         TTFAC11.FIL7   = ' ';                          10417   
                         TTFAC11.LECHE  = ZEDDAT  ;                     10418   
                         TTFAC11.MTECH  = TABZ.WZ_MTECH(8)   ;          10419   
                         END ;                                          10420   
0      U000F:                                                           10421   
           END EDIECHE;                                                 10422   
                                                                        10423   
0          /*                                                           10424   
                    ***************************************             10425   
                    * EDITION DES LIGNES CUMULS PAR       *             10426   
                    * NOMENCLATURE PRODUITS POUR LES      *             10427   
                    * TRACO = 4 ET EDIPA = 1              *             10428   
                    ***************************************             10429   
           */                                                           10430   
1   EDIT_NOMENC :   PROCEDURE;                                          10431   
              TTFAC20.FIL4         =  'NOM' ;                           10432   
              TTFAC20.FIL5         =  'ENCLATURE PRODUIT  POIDS(K' ;    10433   
       SUBSTR(TTFAC20.FIL6,1,2)    =  'G)' ;                            10434   
                  IL = 0      ;                                         10435   
                  DO IK = 0 TO 9 ;                                      10436   
                    IF NOM_POI(IK) = 0 THEN GO TO FIN_DO ;              10437   
                    IL = IL + 1 ;                                       10438   
                         IF IL = 1 THEN DO;                             10439   
                         TTFAC4.ECHEA   = NOM_EC(IK);                   10440   
                         TTFAC4.FIL7    = ' ';                          10441   
                         CLE1           = NOM_EC(IK) ;                  10442   
                         CALL ID470B(TBECFAC.NUTAB);                    10443   
                         TTFAC4.LECHE   = WLECFA ;                      10444   
                         TTFAC4.MTECH   = NOM_POI(IK) ;                 10445   
                         END;                                           10446   
                         IF IL = 2 THEN DO;                             10447   
                         TTFAC5.ECHEA   = NOM_EC(IK);                   10448   
                         TTFAC5.FIL7    = ' ';                          10449   
                         CLE1           = NOM_EC(IK) ;                  10450   
                         CALL ID470B(TBECFAC.NUTAB);                    10451   
                         TTFAC5.LECHE   = WLECFA ;                      10452   
                         TTFAC5.MTECH   = NOM_POI(IK) ;                 10453   
                         END;                                           10454   
                         IF IL = 3 THEN DO;                             10455   
                         TTFAC6.ECHEA   = NOM_EC(IK);                   10456   
                         TTFAC6.FIL7    = ' ';                          10457   
                         CLE1           = NOM_EC(IK) ;                  10458   
                         CALL ID470B(TBECFAC.NUTAB);                    10459   
                         TTFAC6.LECHE   = WLECFA ;                      10460   
                         TTFAC6.MTECH   = NOM_POI(IK) ;                 10461   
                         END;                                           10462   
                         IF IL = 4 THEN DO;                             10463   
                         TTFAC7.ECHEA   = NOM_EC(IK);                   10464   
                         TTFAC7.FIL7    = ' ';                          10465   
                         CLE1           = NOM_EC(IK) ;                  10466   
                         CALL ID470B(TBECFAC.NUTAB);                    10467   
                         TTFAC7.LECHE   = WLECFA ;                      10468   
                         TTFAC7.MTECH   = NOM_POI(IK) ;                 10469   
                         END;                                           10470   
                         IF IL = 5 THEN DO;                             10471   
                         TTFAC8.ECHEA   = NOM_EC(IK);                   10472   
                         TTFAC8.FIL7    = ' ';                          10473   
                         CLE1           = NOM_EC(IK) ;                  10474   
                         CALL ID470B(TBECFAC.NUTAB);                    10475   
                         TTFAC8.LECHE   = WLECFA ;                      10476   
                         TTFAC8.MTECH   = NOM_POI(IK) ;                 10477   
                         END;                                           10478   
                         IF IL = 6 THEN DO;                             10479   
                         TTFAC9.ECHEA   = NOM_EC(IK);                   10480   
                         TTFAC9.FIL7    = ' ';                          10481   
                         CLE1           = NOM_EC(IK) ;                  10482   
                         CALL ID470B(TBECFAC.NUTAB);                    10483   
                         TTFAC9.LECHE   = WLECFA ;                      10484   
                         TTFAC9.MTECH   = NOM_POI(IK) ;                 10485   
                         END;                                           10486   
                         IF IL = 7 THEN DO;                             10487   
                         TTFAC10.ECHEA   = NOM_EC(IK);                  10488   
                         TTFAC10.FIL7    = ' ';                         10489   
                         CLE1           = NOM_EC(IK) ;                  10490   
                         CALL ID470B(TBECFAC.NUTAB);                    10491   
                         TTFAC10.LECHE   = WLECFA ;                     10492   
                         TTFAC10.MTECH   = NOM_POI(IK) ;                10493   
                         END;                                           10494   
                         IF IL = 8 THEN DO;                             10495   
                         TTFAC11.ECHEA   = NOM_EC(IK);                  10496   
                         TTFAC11.FIL7    = ' ';                         10497   
                         CLE1           = NOM_EC(IK) ;                  10498   
                         CALL ID470B(TBECFAC.NUTAB);                    10499   
                         TTFAC11.LECHE   = WLECFA ;                     10500   
                         TTFAC11.MTECH   = NOM_POI(IK) ;                10501   
                         END;                                           10502   
         FIN_DO :                                                       10503   
                  END;                                                  10504   
           END EDIT_NOMENC ;                                            10505   
                                                                        10506   
1   FINFACT:        PROCEDURE;                                          10507   
0          /*                                                           10508   
                    ***************************************             10509   
                    *                                     *             10510   
                    *    BUT DE CE MODULE                 *             10511   
                    *      - EDITER LE PIED DE FACTURE    *             10512   
                    *        VENTILATIONS PAR CODE TAXE   *             10513   
                    *        VENTILATIONS PAR ECHEANCE    *             10514   
                    *                                     *             10515   
                    ***************************************             10516   
           */                                                           10517   
0      V000D:                                                           10518   
           TOTAL0         = ' ';       TOTAL1        = ' ';             10519   
           TOTAL2         = ' ';       TOTAL3        = ' ';             10520   
           TOTAL4         = ' ';       TOTAL5        = ' ';             10521   
           TOTAL6         = ' ';       TOTAL7        = ' ';             10522   
           TOTAL8         = ' ';       TOTAL9        = ' ';             10523   
           TOTAL10        = ' ';       TOTAL11       = ' ';             10524   
           TOTAL12        = ' ';                                        10525   
           TOTAL14        = ' ';                                        10526   
           TTFAC0.SAUT    = '3';       TTFAC2.SAUT   = ' ';             10527   
           TTFAC0.POLIC   = '00'X;     TTFAC1.POLIC  = '00'X;           10528   
           TTFAC2.POLIC   = '00'X;     TTFAC3.POLIC  = '00'X;           10529   
           TTFAC4.POLIC   = '00'X;     TTFAC5.POLIC  = '00'X;           10530   
           TTFAC6.POLIC   = '00'X;     TTFAC7.POLIC  = '00'X;           10531   
           TTFAC8.POLIC   = '00'X;     TTFAC9.POLIC  = '00'X;           10532   
           TTFAC10.POLIC  = '00'X;     TTFAC11.POLIC = '00'X;           10533   
           TTFAC12.POLIC  = '00'X;     TTFAC133.POLIC= '00'X;           10534   
                                         /*   SUP SAUT CANAL 3 SI FRAN*/10535   
0          IF ^(UN_M = 20 ! UN_M = 60 ! UN_M = 70 ) THEN DO;            10536   
              TTFAC0.SAUT                            = ' ';             10537   
                                         /*   EDITER L'ENTETE         */10538   
         /*DEB IDIL-281*/                                               10539   
         /*   IF FACT.LIGNE > NLMAX_AS THEN DO ; */                     10540   
              IF FACT.LIGNE >= NLMAX_AS THEN DO ;                       10541   
         /*FIN IDIL-281*/                                               10542   
                 CALL ENTCDL ;                                          10543   
                 FACT.LIGNE                          = 1 ;              10544   
              END;                                                      10545   
              IF FACT.LIGNE ^= NLMAX_AS THEN DO;                        10546   
                 DO I = FACT.LIGNE TO (NLMAX_AS - 1);                   10547   
                    LIGNE                            = '';              10548   
                    STRING(ZSPOOLP_SVG)              = LIGNE;           10549   
                    TOP_DEMA_ECR                     = 'N';             10550   
                    CALL ECRITUR;                                       10551   
                    END;                                                10552   
                 END;                                                   10553   
              LIGNE       = '0' !! '00'X !! (88)' ' !! 'EN EUROS' ;     10554   
              STRING(ZSPOOLP_SVG)                    = LIGNE ;          10555   
              TOP_DEMA_ECR                           = 'N' ;            10556   
              CALL ECRITUR;                                             10557   
              LIGNE       = '' ;                                        10558   
              STRING(ZSPOOLP_SVG)                    = LIGNE ;          10559   
              TOP_DEMA_ECR                           = 'N' ;            10560   
              CALL ECRITUR;                                             10561   
              LIGNE       = '' ;                                        10562   
              STRING(ZSPOOLP_SVG)                    = LIGNE ;          10563   
              TOP_DEMA_ECR                           = 'N' ;            10564   
              CALL ECRITUR;                                             10565   
              END;                                                      10566   
0      V000A:                                                           10567   
           IF WTFAC.EDIPA = '2' THEN DO;/*   FACTURE GIH              */10568   
0             IF IRAFAC =0 ! IRAFAC = 1 /*   DERNIERE FACTURE EDITEE  */10569   
                    THEN SUBSTR(TOTAL12,083,3) = '***';                 10570   
          /*  CALL EDIVENE                   VENTILATION PAR VENET      10571   
                                             SUPPRESSION 09-2010      */10572   
              IF WTFAC.PEFAC = '9' THEN DO;                             10573   
                    CALL FACTOUV;       /*   FACTURE OUVERTE GIH      */10574   
                    GO TO V000L;                                        10575   
                    END;                /*   FIN FACTURE OUVERTE GIH  */10576   
              END;                      /*   FIN FACTURE GIH          */10577   
                                        /*   VENTILA. PAR COTAX       */10578   
                                        /******************************/10579   
           IF WTFAC.POFIS = '0' ! WTFAC.POFIS = '2' !                   10580   
              WTFAC.POFIS = '3' ! WTFAC.POFIS = '5' !                   10581   
              WTFAC.POFIS = '7' THEN DO;                                10582   
                    FACT.DEBIT   = FACT.NETHT + FACT.TAXES;             10583   
                    TTFAC0.LIBEL = 'NET  HORS  TAXES';                  10584   
                    TTFAC0.NETHT = FACT.NETHT;                          10585   
                    TTFAC1.LIBEL = 'INCIDENCE  TAXES';                  10586   
                    TTFAC1.TAXES = FACT.TAXES;                          10587   
                    CALL VENT_COTAX;    /*   VENTILA. PAR COTAX       */10588   
                    IF WTFAC.POFIS = '0' ! WTFAC.POFIS = '2'            10589   
                       THEN GO TO V000I;                                10590   
                    TTFAC1.FIL3  = ' ';/*   22.08.86 SUPPRES. COMPTE  */10591   
                                       /*   TENU TAUX BASE IMPOSABLE  */10592   
                    GO TO V000I;                                        10593   
                    END;                                                10594   
0      V000B:                                                           10595   
           FACT.DEBIT     = FACT.NETHT;                                 10596   
           IF WTFAC.POFIS = '4' ! WTFAC.POFIS = '8' THEN GO TO V000I;   10597   
0      V000C:                           /*   REMISE EXCEPTIONNEL. 6%  */10598   
                                        /*   POFIS 4 SUPPR. 03.04.80  */10599   
0      V000E:                                                           10600   
           IF WTFAC.POFIS = '6' ! WTFAC.POFIS = '9' THEN DO;            10601   
              CALL VENT_COTAX;          /*   VENTILA. PAR COTAX       */10602   
              CALL MASQUE ;                                             10603   
              IF WTFAC.TRACO = '4' &    /*   DETAXE EXISTE ET EDITE   */10604   
                 WTFAC.POFIS = '6' &    /*   MAIS NON PRIS EN COMPTE  */10605   
                 FACT.TAXES ^= 0 THEN DO;                               10606   
                 TTFAC9.LIBEL  = '      TOTAL';                         10607   
                 TTFAC9.MENVTE = FACT.NETHT + FACT.TAXES;               10608   
                 END;                                                   10609   
              GO TO V000I;                                              10610   
              END;                                                      10611   
0      V000G:                           /*   APPEL FIC. AUTO CONTROLE */10612   
           ZONCTL              = '                * POFIS INCONNUE ' !! 10613   
                                 WTFAC.POFIS !! ' FORCEE A 0   FACT ' !!10614   
                                 WNUFAC ;                               10615   
           CALL MACMES3 (DESTI,'1',ZONCTL);                             10616   
           WTFAC.POFIS         = '0';                                   10617   
           GO TO V000A;                                                 10618   
0      V000I:                                                           10619   
           TTFAC1.QUANT        = FACT.QUANT;                            10620   
           TTFAC3.DEBIT        = FACT.DEBIT;                            10621   
                                                                        10622   
           IF WTFAC.EDIPA = '1'  THEN DO;                               10623   
                    TTFAC11.LIBEL      = 'MT. FORT HT';                 10624   
                    TTFAC11.MENVTE     = FACT.FORTHT;                   10625   
                    END;               /*   FIN CAS CDL               */10626   
           IF WTFAC.GNATO = '41' THEN DO;                               10627   
                                       /*   FACTURE PROFORMA          */10628   
              TTFAC3.LIBEL2    = 'TOTAL P';                             10629   
              TTFAC3.LIBEL3    = 'ROFORMA';                             10630   
              GO TO V000Q;                                              10631   
              END;                      /*   FIN TEST PROFORMA        */10632   
0                                       /*   NATURE DE LA FACTURE     */10633   
           TTFAC3.LIBEL2       = 'A VOTRE';                             10634   
           IF TAB.LIBEL = 'C' THEN DO;                                  10635   
              TTFAC3.LIBEL3    = ' CREDIT';                             10636   
              END;                                                      10637   
           IF TAB.LIBEL = 'D' THEN DO;                                  10638   
              TTFAC3.LIBEL3    = ' DEBIT ';                             10639   
              END;                                                      10640   
0          IF WTFAC.GNATO = '0D' THEN DO;                               10641   
              IF FACT.DEBIT < 0 THEN DO;                                10642   
                 TTFAC3.LIBEL3 = ' CREDIT';                             10643   
                 END;                                                   10644   
              GO TO V000Q;                                              10645   
              END;                                                      10646   
0          IF WTFAC.GNATO    = '1R' THEN DO;                            10647   
              IF WTFAC.NATOP = '12' ! WTFAC.NATOP = '16' !              10648   
                 WTFAC.NATOP = '70' THEN DO;                            10649   
                 TTFAC3.LIBEL3 = ' CREDIT';                             10650   
                 END;                                                   10651   
              GO TO V000Q;                                              10652   
              END;                      /*   FIN TEST GNATO 1R        */10653   
0          IF WTFAC.GNATO    = '3R' THEN DO;                            10654   
              IF WTFAC.NATOP = '32' THEN DO;                            10655   
                 TTFAC3.LIBEL3 = ' DEBIT ';                             10656   
                 END;                                                   10657   
              GO TO V000Q;                                              10658   
              END;                      /*   FIN TEST GNATO 3R        */10659   
0          IF WTFAC.GNATO    = '5R' THEN DO;                            10660   
              IF WTFAC.NATOP = '52' ! WTFAC.NATOP = '54' THEN DO;       10661   
                 TTFAC3.LIBEL3 = ' DEBIT ';                             10662   
                 END;                                                   10663   
              END;                      /*   FIN TEST GNATO 5R        */10664   
       V000Q:                           /*   TEST FOURNITURES ET      */10665   
                                        /*   RECTIF. FOURNITURES      */10666   
           IF WTFAC.EDIPA = '2' THEN GO TO V000J;                       10667   
           IF WTFAC.GNATO = '0D' ! WTFAC.GNATO = '0F' !                 10668   
              WTFAC.GNATO = '1C' ! WTFAC.GNATO = '14' THEN DO;          10669   
                    TTFAC6.LIBEL    = 'MISE EN VTE';                    10670   
                    TTFAC6.MENVTE   = FACT.MENVTE;                      10671   
                    TTFAC7.LIBEL    = '    RASSORT';                    10672   
                    TTFAC7.MENVTE   = FACT.RASSOR;                      10673   
                    TTFAC8.LIBEL    = '      FRAIS';                    10674   
                    TTFAC8.MENVTE   = FRAIS       ;                     10675   
                    END;                                                10676   
0      V000J:                                                           10677   
           IF WTFAC.TRACO = '0' THEN DO;                                10678   
              IF WTFAC.DEPCO = '17' THEN DO;                            10679   
                                        /*   EDITION DU POIDS SI GIH  */10680   
                    IF FACT.POIDS ^= 0 THEN DO;                         10681   
                         TTFAC1.POIDS = FACT.PDFAC;                     10682   
                         END;                                           10683   
                    IF WTFAC.GNATO = '41' THEN DO;                      10684   
                         TTFAC1.POIDS = POIDS_GIH ;                     10685   
                         END;                                           10686   
                    GO TO V000L;                                        10687   
                    END;                /*   FIN TEST  DEPCO          */10688   
              TTFAC20.FIL5         =  'SYNTHESE PAR DATE ECHEANCE' ;    10689   
              TTFAC20.FIL6         =  ' ' ;                             10690   
              END;                      /*   FIN TEST  TRACO          */10691   
       V000L:                           /*   VENTIL. PAR ECHEANCES    */10692   
           J     = 0;                                                   10693   
           WMONT = 0;                                                   10694   
           WMONT_HT = 0;                                                10695   
           CALL EDIECHE;                                                10696   
0      V000O:                           /*   EDITION BAS DE FACTURE   */10697   
                                                                        10698   
                                        /*YDV P0299*/                   10699   
                                        /* PAS ASSEZ DE PLACE           10700   
                                           EDITER L'ENTETE            */10701   
           /*DEB IDIL-281*/                                             10702   
       /*  IF (FACT.LIGNE     > NLMAX_AS )  THEN DO ; */                10703   
           IF (FACT.LIGNE     >= NLMAX_AS )  THEN DO ;                  10704   
              CALL ENTCDL ;                                             10705   
           END;                                                         10706   
           /*FIN IDIL-281*/                                             10707   
                                        /*ENVOI FOND PAGE AVEC PIED*/   10708   
           INDEX_FACEXP.NUPAG   = FACT.FOLIO + 1    ;                   10709   
           STRING (ZSPOOLP_SVG) = STRING (PAG1_PAY) ;                   10710   
           CALL ECRITUR_AS ;                                            10711   
           STRING (ZSPOOLP_SVG) = STRING (PAG2_PAY) ;                   10712   
           CALL ECRITUR_AS ;                                            10713   
           EDIT_FDPAG           =  'N' ;                                10714   
           CALL ENTCDL;                                                 10715   
                                                                        10716   
           IF FACT.RETOUR  = '1' & WTFAC.EDIPA = '1' THEN PIEDFA = '0'; 10717   
                                        /*   NON EDIT. PIED SI RETOUR */10718   
                                                                        10719   
                                                                        10720   
0             STRING(ZSPOOLP_SVG) = TOTAL0;  CALL ECRITUR_AS;           10721   
              STRING(ZSPOOLP_SVG) = TOTAL1;  CALL ECRITUR_AS;           10722   
              STRING(ZSPOOLP_SVG) = ''  ;                               10723   
              ZSPOOLP_SVG.POLIC   = '00'X ;    CALL ECRITUR_AS;         10724   
              TTFAC20.SAUT        = ' ' ;                               10725   
              TTFAC20.POLIC       = '00'X;        /*YDV*/               10726   
              STRING(ZSPOOLP_SVG) = TOTAL2;  CALL ECRITUR_AS;           10727   
              TTFAC20.FIL4        =  '   ' ;                            10728   
              TTFAC20.FIL6        =  '' ;                               10729   
          /*  TTFAC3_P.DEBIT      = TTFAC3.DEBIT    YDV*/               10730   
0             TTFAC3_P.DEBIT      = FACT.DEBIT    ;                     10731   
              TTFAC3_P.LIBEL2     = TTFAC3.LIBEL2 ;                     10732   
              TTFAC3_P.LIBEL3     = TTFAC3.LIBEL3 ;                     10733   
              TTFAC3.DEBIT        = 0  ;                                10734   
              TTFAC3.LIBEL2       = ' ';                                10735   
              TTFAC3.LIBEL3       = ' ';                                10736   
              STRING(ZSPOOLP_SVG) = TOTAL3;  CALL ECRITUR_AS;           10737   
              STRING(ZSPOOLP_SVG) = STRING(TTFAC3_P);                   10738   
                                             CALL ECRITUR_AS;           10739   
0             STRING(ZSPOOLP_SVG) = TOTAL4;  CALL ECRITUR_AS;           10740   
              STRING(ZSPOOLP_SVG) = TOTAL5;  CALL ECRITUR_AS;           10741   
              STRING(ZSPOOLP_SVG) = TOTAL6;  CALL ECRITUR_AS;           10742   
              STRING(ZSPOOLP_SVG) = TOTAL7;  CALL ECRITUR_AS;           10743   
              STRING(ZSPOOLP_SVG) = TOTAL8;  CALL ECRITUR_AS;           10744   
              STRING(ZSPOOLP_SVG) = TOTAL9;  CALL ECRITUR_AS;           10745   
              STRING(ZSPOOLP_SVG) = TOTAL10; CALL ECRITUR_AS;           10746   
              STRING(ZSPOOLP_SVG) = TOTAL11; CALL ECRITUR_AS;           10747   
              STRING(ZSPOOLP_SVG) = TOTAL12; CALL ECRITUR_AS;           10748   
0      V000F:                                                           10749   
           PIEDFA            = '1';                                     10750   
           END FINFACT;                                                 10751   
1   EDLIBTI:        PROCEDURE;                                          10752   
0          /*                                                           10753   
                    ***************************************             10754   
                    *                                     *             10755   
                    *    BUT DE CE MODULE                 *             10756   
                    *      - EDITER LIBTI LIBAU SUR       *             10757   
                    *        UNE OU DEUX LIGNES           *             10758   
                    *      - GESTION CODE EAN SUR LA      *             10759   
                    *        2I�ME LIGNE SI EXISTE        *             10760   
                    *                                     *             10761   
                    ***************************************             10762   
           */                                                           10763   
0      W000D:                                                           10764   
           LIBEL1.TITRE   = WTFAC.LIBTI;                                10765   
           LIBEL1.AUTEUR  = WTFAC.LIBAU;                                10766   
           IF WTFAC.LIBAU = ' ' THEN DO;/*   LIBEL AUTEUR A BLANC     */10767   
                    IF EDIT_EAN ^= ' ' THEN DO;                         10768   
                       IF FACT.LIGNE    > NLMAX_2 THEN CALL ENTCDL;     10769   
                       END;             ELSE DO;                        10770   
                       IF FACT.LIGNE    > NLMAX_1 THEN CALL ENTCDL;     10771   
                       END;                                             10772   
                    LIGNE1.LIBEL        = WTFAC.LIBTI;                  10773   
                    STRING(ZSPOOLP_SVG) = LIGNE ;                       10774   
                    FACT.LIGNE          = FACT.LIGNE + 1;               10775   
                    IF ACCORD_OUI_NON = 'OUI' THEN                      10776   
                                        CALL STOCKAGE_ACCORD;           10777   
                    IF RECAP_BL       = 'OUI' THEN                      10778   
                                        CALL STOCKAGE_BL    ;           10779   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            10780   
                    TOP_DEMA_ECR = 'O' ;                                10781   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            10782   
                    CALL ECRITUR;                                       10783   
                    IF EDIT_EAN ^= ' ' THEN CALL LIGNE_EAN;             10784   
                    GO TO W000F;                                        10785   
                    END;                /*   FIN TEST AUTEUR A BLANC  */10786   
           IF LIBEL2.TITRE2   = ' ' & LIBEL2.AUTOR2 = ' ' THEN DO;      10787   
                                        /*   LIBELLE SUR UNE LIGNE    */10788   
                    LIBEL3.TITRE1       = LIBEL2.TITRE1;                10789   
                    LIBEL3.AUTOR1       = LIBEL2.AUTOR1;                10790   
                    LIGNE1.LIBEL        = ZLIBEL;                       10791   
                    IF EDIT_EAN ^= ' ' THEN DO;                         10792   
                       IF FACT.LIGNE    > NLMAX_2 THEN CALL ENTCDL;     10793   
                       END;             ELSE DO;                        10794   
                       IF FACT.LIGNE    > NLMAX_1 THEN CALL ENTCDL;     10795   
                       END;                                             10796   
                    STRING(ZSPOOLP_SVG) = LIGNE ;                       10797   
                    FACT.LIGNE          = FACT.LIGNE + 1;               10798   
                    IF ACCORD_OUI_NON = 'OUI' THEN                      10799   
                                        CALL STOCKAGE_ACCORD;           10800   
                    IF RECAP_BL       = 'OUI' THEN                      10801   
                                        CALL STOCKAGE_BL    ;           10802   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            10803   
                    TOP_DEMA_ECR = 'O' ;                                10804   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            10805   
                    CALL ECRITUR;                                       10806   
                    IF EDIT_EAN ^= ' ' THEN CALL LIGNE_EAN;             10807   
                    GO TO W000F;                                        10808   
                    END;                ELSE DO;                        10809   
                                        /*   LIBELLE SUR DEUX LIGNES  */10810   
                    LIGNE1.LIBEL        = WTFAC.LIBTI;                  10811   
                    IF FACT.LIGNE       > NLMAX_2 THEN CALL ENTCDL;     10812   
                    FACT.LIGNE          = FACT.LIGNE + 2;               10813   
                    STRING(ZSPOOLP_SVG) = LIGNE ;                       10814   
                    IF ACCORD_OUI_NON = 'OUI' THEN                      10815   
                                        CALL STOCKAGE_ACCORD;           10816   
                    IF RECAP_BL       = 'OUI' THEN                      10817   
                                        CALL STOCKAGE_BL    ;           10818   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            10819   
                    TOP_DEMA_ECR = 'N' ;                                10820   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            10821   
                    CALL ECRITUR;                                       10822   
                    LIGNE               = ' ';                          10823   
                    LIGNE1.POLIC        = '00'X;                        10824   
                    LIGNE2_LIBAU        = WTFAC.LIBAU;                  10825   
                    LIGNE2_EANNU        = EDIT_EAN   ;                  10826   
                    STRING(ZSPOOLP_SVG) = LIGNE ;                       10827   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            10828   
                    TOP_DEMA_ECR = 'O' ;                                10829   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            10830   
                    CALL ECRITUR;                                       10831   
                    END;                /*   FIN TEST SUR LIBELLE     */10832   
0      W000F:                                                           10833   
           END EDLIBTI;                                                 10834   
1   CALCUL:         PROCEDURE;                                          10835   
0          /*                                                           10836   
                    *****************************************           10837   
                    *                                       *           10838   
                    *    MODULE DE CALCUL DES DIFFERENTS    *           10839   
                    *    RESULTATS NECESSAIRES A LA         *           10840   
                    *    CONSTITUTION DE LA FACTURE         *           10841   
                    *                                       *           10842   
                    *****************************************           10843   
           */                                                           10844   
0      X000D:                                                           10845   
           TRANSP_DEMAT      = 'N'        ;                             10846   
           TRANSP_DEMAT_D    = 'N'        ;                             10847   
           EMBALL_DEMAT      = 'N'        ;                             10848   
           EMBALL_DEMAT_D    = 'N'        ;                             10849   
           FACT.WTAXES       = WTFAC.TAXLI;                             10850   
           IF WTFAC.POFIS = '4' ! WTFAC.POFIS = '8' !                   10851   
              WTFAC.POFIS = '6' ! WTFAC.POFIS = '9' THEN                10852   
              FACT.WTAXES    = 0;                                       10853   
           WMONT             = WTFAC.NETLI + FACT.WTAXES;               10854   
           WMONT_HT          = WTFAC.NETLI              ;               10855   
           RESAI.MTFOR       = RESAI.MTFOR + WTFAC.FORLI;               10856   
           RESAI.MTNET       = RESAI.MTNET + WTFAC.NETLI;               10857   
           RESAI.MTTAX       = RESAI.MTTAX + FACT.WTAXES;               10858   
           IF WTFAC.TYREF = '3' THEN DO; /*   FRAIS EMBALLAGE         */10859   
              SPIPA             = '';                                   10860   
              SPIPA.FONCT       = 'RP';                                 10861   
              SPIPA.OPERA       = '= ';                                 10862   
              SPIFI.FNAME       = 'SPI2TAB';                            10863   
              SPIPA.COTAB       = 'CDLNUART';                           10864   
              SPIPA.REFPO       = WTFAC.NUART;                          10865   
              CALL SPI2TBV(SPIPA,TCDLNUAR,SPIFI);                       10866   
              IF SPIPA.CORET = '00' &                                   10867   
                 TCDLNUAR.IARTI = 'EMB' THEN DO;                        10868   
                 SVG_MTEMB_HT   = SVG_MTEMB_HT  + WMONT_HT;             10869   
                 SVG_MTEMB_TTC  = SVG_MTEMB_TTC + WMONT;                10870   
                 EMBALL_DEMAT   = 'O'  ;                                10871   
                 EMBALL_DEMAT_D = 'O'  ;                                10872   
                 END;                                                   10873   
              END;                                                      10874   
0          IF WTFAC.EDIPA = '1' THEN DO;/*   TOTAUX PIED DE FACTURE   */10875   
              IF WTFAC.GNATO = '0D' ! WTFAC.GNATO = '0F' !              10876   
                 WTFAC.GNATO = '1C' ! WTFAC.GNATO = '14' !              10877   
                 WTFAC.GNATO = '1R' THEN DO;                            10878   
                 IF WTFAC.TYREF ^= '3' THEN DO;                         10879   
                    IF WTFAC.CATLI = ' ' ! WTFAC.CATLI = '2' THEN DO;   10880   
                       FACT.RASSOR      = FACT.RASSOR + WMONT;          10881   
                       END;             ELSE DO;                        10882   
                       FACT.MENVTE      = FACT.MENVTE + WMONT;          10883   
                       END;                                             10884   
                    END;                ELSE DO;                        10885   
                    FRAIS               = FRAIS + WMONT      ;          10886   
                    FRAIS_HT            = FRAIS_HT + WMONT_HT ;         10887   
                    TRANSP_DEMAT        = 'O'  ;                        10888   
                    TRANSP_DEMAT_D      = 'O'  ;                        10889   
                    END;                /*   FIN  TEST  TYREF 28.11.85*/10890   
                 END;                   /*   FIN  TEST  GNATO         */10891   
              END;                      /*   FIN  TEST  EDIPA         */10892   
 /* PCA150804                                                         */10893   
           IF  WTFAC.DEPCO = '17'                                       10894   
           &   WTFAC.TYREF = '3'                                        10895   
           &   SPIPA.CORET = '00'                                       10896   
           &   TCDLNUAR.IARTI = 'EMB'                                   10897   
           THEN DO;                                                     10898   
               FRAIS          = FRAIS + WMONT      ;                    10899   
               FRAIS_HT       = FRAIS_HT + WMONT_HT ;                   10900   
 /*            TRANSP_DEMAT   = 'O'  ;                                  10901   
               TRANSP_DEMAT_D = 'O'  ;                                  10902   
               SVG_MTEMB_HT   = SVG_MTEMB_HT  - WMONT_HT;               10903   
               SVG_MTEMB_TTC  = SVG_MTEMB_TTC - WMONT;                  10904   
               EMBALL_DEMAT   = 'N'  ;                                  10905   
               EMBALL_DEMAT_D = 'N'  ; */                               10906   
           END;                                                         10907   
 /* PCA150804                                                         */10908   
           FACT.NETHT        = FACT.NETHT  + WTFAC.NETLI;               10909   
           FACT.TAXES        = FACT.TAXES  + WTFAC.TAXLI;               10910   
           FACT.DEBIT        = FACT.DEBIT  + WMONT ;                    10911   
           FACT.FORTHT       = FACT.FORTHT + WTFAC.FORLI;               10912   
0                                       /*   VENTILATIONS             */10913   
                                        /******************************/10914   
0      X000A:                           /*   PAR CODE TAXE            */10915   
           IF VERIFY (WTFAC.COTAX,NUMERIC) ^= 0 THEN DO;                10916   
                    ZONCTL        = '                * COTAX NON NUM' !!10917   
                                    'ERIQUE ' !! WTFAC.COTAX !!         10918   
                                    '   FACT. N0. ' !! WNUFAC ;         10919   
                    CALL MACMES3 (DESTI,'1',ZONCTL);                    10920   
                    WTFAC.COTAX   = '0';                                10921   
0                   END;                                                10922   
           I                 = COTAXNUM;                                10923   
           IF WTFAC.POFIS    = '4' ! WTFAC.POFIS = '8' THEN GO TO X000B;10924   
           IF FACT.WCOTAX   ^= WTFAC.COTAX THEN DO;                     10925   
                    FACT.WCOTAX   = WTFAC.COTAX;                        10926   
                    FACT.COTAX(I) = WTFAC.COTAX;                        10927   
                    CLE1          = COTAXNUM;                           10928   
                    WPOFIS        = WTFAC.POFIS;                        10929   
                    CALL ID470B(TBCOTAX.NUTAB);                         10930   
                    FACT.TOLEG(I) = WTOLEG;                             10931   
                    END;                /*   FIN INIT. LIBEL COTAX    */10932   
           IF TRANSP_DEMAT = 'O' THEN DO;                               10933   
              TXTVT_DEMAT         = SUBSTR(WTOLEG,1,3) !!               10934   
                                    SUBSTR(WTOLEG,5,2) ;                10935   
              TXTVT_DEMAT         = TRANSLATE(TXTVT_DEMAT,'0',' ');     10936   
              DEMAT_ENT.TXTVT     = TXTVTN_DEMAT       ;                10937   
              END;                                                      10938   
           IF TRANSP_DEMAT_D = 'O' THEN DO;                             10939   
              TXTVT_DEMAT         = SUBSTR(WTOLEG,1,3) !!               10940   
                                    SUBSTR(WTOLEG,5,2) ;                10941   
              TXTVT_DEMAT         = TRANSLATE(TXTVT_DEMAT,'0',' ');     10942   
              STO_D_ENT.TXTVT     = TXTVTN_DEMAT       ;                10943   
              END;                                                      10944   
           IF EMBALL_DEMAT = 'O' THEN DO;                               10945   
              TXTVE_DEMAT         = SUBSTR(WTOLEG,1,3) !!               10946   
                                    SUBSTR(WTOLEG,5,2) ;                10947   
              TXTVE_DEMAT         = TRANSLATE(TXTVE_DEMAT,'0',' ');     10948   
              DEMAT_ENT.TXTVE     = TXTVEN_DEMAT       ;                10949   
              END;                                                      10950   
           IF EMBALL_DEMAT_D = 'O' THEN DO;                             10951   
              TXTVE_DEMAT         = SUBSTR(WTOLEG,1,3) !!               10952   
                                    SUBSTR(WTOLEG,5,2) ;                10953   
              TXTVE_DEMAT         = TRANSLATE(TXTVE_DEMAT,'0',' ');     10954   
              STO_D_ENT.TXTVE     = TXTVEN_DEMAT       ;                10955   
              END;                                                      10956   
           FACT.NET_TC(I)    = FACT.NET_TC(I)  + WMONT;                 10957   
           FACT.DETAXE(I)    = FACT.DETAXE(I)  + WTFAC.TAXLI;           10958   
           FACT.NET_HT(I)    = FACT.NET_HT(I)  + WTFAC.NETLI;           10959   
0      X000B:                           /*   PAR  CODE ECHEANCE       */10960   
           IF WTFAC.TRIFA = '4' & WTFAC.TYREF = '5' THEN GO TO X000F;   10961   
           CALL CUECHEA;                /*   CUMUL QUANT. PAR ECHEA   */10962   
0      X000E:                                                           10963   
            /*  MODIF FLC                 */                            10964   
          /*PUT SKIP LIST ('*** DAT10.AA ' !! ENTET70.DAT10.AA); */     10965   
          /*PUT SKIP LIST ('*** DAT10.MM ' !! ENTET70.DAT10.MM); */     10966   
          /*PUT SKIP LIST ('*** DAT10.JJ ' !! ENTET70.DAT10.JJ); */     10967   
           IF ENTET70.DAT10.AA ^= ' ' &                                 10968   
              ENTET70.DAT10.MM ^= ' ' &                                 10969   
              ENTET70.DAT10.JJ ^= ' '                                   10970   
              THEN DO;                                                  10971   
                 PDEMFA = ENTET70.DAT10.AA!!                            10972   
                          ENTET70.DAT10.MM!!                            10973   
                          ENTET70.DAT10.JJ;                             10974   
              END;                                                      10975   
        /*  FIN MODIF FLC                      */                       10976   
           FACT.MTECH(J)     = FACT.MTECH(J)  + WMONT;                  10977   
           FACT.FORLI(J)     = FACT.FORLI(J)  + WTFAC.FORLI;            10978   
           FACT.TAXLI(J)     = FACT.TAXLI(J)  + FACT.WTAXES;            10979   
           FACT.NETC(J,I)    = FACT.NETC(J,I) + WMONT;                  10980   
           FACT.MTAX(J,I)    = FACT.MTAX(J,I) + FACT.WTAXES;            10981   
           FACT.COTA(J,I)    = WTFAC.COTAX;                             10982   
0      X000C:                           /*   PAR  CODE VENTILATION    */10983   
           IF WTFAC.EDIPA = '2' THEN DO;/*   FACTURE GIH              */10984   
              IF VERIFY (WTFAC.ECFAC,NUMERIC) ^= 0 THEN DO;             10985   
                    ZONCTL        = '                * ECFAC NON NUM' !!10986   
                                    'ERIQUE ' !! WTFAC.ECFAC !!         10987   
                                    '   FACT. NO. ' !! WNUFAC;          10988   
                    CALL MACMES3 (DESTI,'1',ZONCTL);                    10989   
                    WTFAC.ECFAC   = '0';                                10990   
                    END;                                                10991   
              IF VERIFY (VENETRED.EXPLO,NUMVENE) ^= 0 THEN DO;          10992   
                    ZONCTL        = '                * VENET NON NUM' !!10993   
                                    'ERIQUE ' !! WTFAC.VENET !!         10994   
                                    '   FACT. NO. ' !! WNUFAC ;         10995   
                    CALL MACMES3 (DESTI,'1',ZONCTL);                    10996   
                    VENETRED.EXPLO = '0';                               10997   
                    END;                                                10998   
              CLE2             = WTFAC.ECFAC !! VENETRED.EXPLO;         10999   
              I                = EXPLONUM;                              11000   
              IF FACT.WVENET  ^= CLE2 THEN DO;                          11001   
                 FACT.WVENET   = CLE2;                                  11002   
                 CALL ID470B(TBVENET.NUTAB);                            11003   
                 FACT.LVENE(I) = WLVENE;                                11004   
                 FACT.VENET(I) = CLE2;                                  11005   
                 END;                   /*   FIN INIT. LIBELLE VENET  */11006   
              FACT.MTVEN(I)    = FACT.MTVEN(I) + WMONT;                 11007   
              END;                      /*   FIN FACTURE GIH          */11008   
0      X000F:                                                           11009   
           END CALCUL;                                                  11010   
1   FACTOUV:        PROCEDURE;                                          11011   
0          /*                                                           11012   
                    ****************************************            11013   
                    *                                      *            11014   
                    *    MODULE D'EDITION DE LA FACTURE    *            11015   
                    *    PROVISOIREMENT OUVERTE DU GIH     *            11016   
                    *                                      *            11017   
                    ****************************************            11018   
           */                                                           11019   
0      Y000D:                           /*   INIT. 1ERE LIGNE         */11020   
           IF FACT.LIGNE > NLMAX_5 THEN CALL ENTCDL;                    11021   
           TOTAL13            = ' ';                                    11022   
           TTFAC133.POLIC     = '00'X;                                  11023   
           STRING(ZSPOOLP_SVG)= TOTAL13;                                11024   
           TTFAC131.LIBEL     = '---';                                  11025   
           FACT.LIGNE         = FACT.LIGNE + 1;                         11026   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            11027   
                    TOP_DEMA_ECR = 'N' ;                                11028   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            11029   
           CALL ECRITUR;                                                11030   
                                        /*  POFIS 4 SUPPR. 03.04.80   */11031   
0          IF WTFAC.POFIS = '0' ! WTFAC.POFIS = '2' !                   11032   
              WTFAC.POFIS = '3' ! WTFAC.POFIS = '5' !                   11033   
              WTFAC.POFIS = '7' THEN DO;                                11034   
                    CALL VENT_COTAX;    /*   VENTILA. PAR COTAX       */11035   
                    TOTAL13             = ' ';                          11036   
                    TTFAC133.POLIC      = '00'X;                        11037   
                    TTFAC133.FIL3       = 'NET  HORS  TAXES';           11038   
                    TTFAC133.MT         = FACT.NETHT;                   11039   
                    STRING(ZSPOOLP_SVG) = TOTAL13;                      11040   
                    FACT.LIGNE          = FACT.LIGNE + 2;               11041   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            11042   
                    TOP_DEMA_ECR = 'N' ;                                11043   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            11044   
                    CALL ECRITUR;                                       11045   
                    TOTAL13             = ' ';                          11046   
                    TTFAC133.POLIC      = '00'X;                        11047   
                    TTFAC133.FIL3       = 'INCIDENCE  TAXES';           11048   
                    TTFAC133.MT         = FACT.TAXES;                   11049   
                    TTFAC131.LIBEL      = 'TTC';                        11050   
                    STRING(ZSPOOLP_SVG) = TOTAL13;                      11051   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            11052   
                    TOP_DEMA_ECR = 'N' ;                                11053   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            11054   
                    CALL ECRITUR;                                       11055   
                    GO TO Y000E;                                        11056   
                    END;                                                11057   
           IF WTFAC.POFIS = '6' ! WTFAC.POFIS = '9' THEN DO;            11058   
                    CALL VENT_COTAX;    /*   VENTILA. PAR COTAX       */11059   
                    CALL MASQUE ;                                       11060   
                    END;                /*   FIN TEST POFIS 6 9       */11061   
0      Y000E:                           /*   INIT. LIGNE REPORT       */11062   
                                        /*   NATURE DE LA FACTURE     */11063   
0          IF WTFAC.GNATO = '41' THEN DO;                               11064   
                                       /*   FACTURE PROFORMA          */11065   
              TTFAC131.FIL7    = 'PROFORMA';                            11066   
              GO TO Y000G;                                              11067   
              END;                      /*   FIN TEST PROFORMA        */11068   
           IF TAB.LIBEL = 'C' THEN TTFAC131.FIL7 = 'CREDIT';            11069   
           IF TAB.LIBEL = 'D' THEN TTFAC131.FIL7 = 'DEBIT ';            11070   
0          IF WTFAC.GNATO = '0D' THEN DO;                               11071   
              IF FACT.DEBIT < 0 THEN TTFAC131.FIL7 = 'CREDIT';          11072   
              GO TO Y000G;                                              11073   
              END;                                                      11074   
0          IF WTFAC.GNATO    = '1R' THEN DO;                            11075   
              IF WTFAC.NATOP = '12' ! WTFAC.NATOP = '16' !              11076   
                 WTFAC.NATOP = '70' THEN                                11077   
                    TTFAC131.FIL7 = 'CREDIT';                           11078   
              GO TO Y000G;                                              11079   
              END;                      /*   FIN TEST GNATO 1R        */11080   
0          IF WTFAC.GNATO    = '3R' THEN DO;                            11081   
              IF WTFAC.NATOP = '32' THEN                                11082   
                    TTFAC131.FIL7 = 'DEBIT ';                           11083   
              GO TO Y000G;                                              11084   
              END;                      /*   FIN TEST GNATO 3R        */11085   
0          IF WTFAC.GNATO    = '5R' THEN DO;                            11086   
              IF WTFAC.NATOP = '52' ! WTFAC.NATOP = '54' THEN           11087   
                    TTFAC131.FIL7 = 'DEBIT ';                           11088   
              END;                      /*   FIN TEST GNATO 5R        */11089   
0      Y000G:                                                           11090   
           TTFAC131.MTFAC     = FACT.DEBIT;                             11091   
           FACT.LIGNE         = FACT.LIGNE + 2;                         11092   
           STRING(ZSPOOLP_SVG)= STRING(TTFAC131);                       11093   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            11094   
                    TOP_DEMA_ECR = 'N' ;                                11095   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            11096   
           CALL ECRITUR;                                                11097   
           STRING(ZSPOOLP_SVG)= STRING(TTFAC132);                       11098   
           CALL ECRITUR;                                                11099   
0      Y000F:                                                           11100   
0          END FACTOUV;                                                 11101   
1   RECOENR:        PROCEDURE;                                          11102   
0          /*                                                           11103   
                    ************************************                11104   
                    *                                  *                11105   
                    *    SOUS PROGRAMME DE RECONNAIS-  *                11106   
                    *    SANCE DE L'ENREGISTREMENT     *                11107   
                    *    PAR SON COENR                 *                11108   
                    *                                  *                11109   
                    ************************************                11110   
           */                                                           11111   
0      Z000D:                                                           11112   
           IF COLIS.TETE  = '1' THEN DO;                                11113   
              EDIT_EAN    = WTFAC.EANNU;                                11114   
              GO TO Z000G;                                              11115   
              END;                                                      11116   
           LIGNE1.PIPUB   = WTFAC.PRIFA;                                11117   
0          IF WTFAC.PINET = '1' THEN DO;                                11118   
              PRIBBCHAR                 = '********' ;                  11119   
              SVG_PRIBB                 = WTFAC.PRIBB ;                 11120   
              END;                      ELSE DO;                        11121   
              LIGNE1.PRIBB              = WTFAC.PRIBB ;                 11122   
              END;                                                      11123   
           IF WTFAC.EDIPA = '2' &                                       11124   
              ( WTFAC.REGFA = '2' ! WTCLI1.TYFAC = '6' !                11125   
              ( WTFAC.FRAET = '2' & WREPRI = '1' ))    THEN DO;         11126   
              PRIBBCHAR                 = ' ';                          11127   
              SVG_PRIBB                 = WTFAC.PRIBB ;                 11128   
              END;                                                      11129   
           IF WTFAC.TYREF = '3' ! WTFAC.TYREF = '5' THEN DO;            11130   
              PRIBBCHAR                 = ' ';                          11131   
              SVG_PRIBB                 = WTFAC.PRIBB ;                 11132   
              END;                                                      11133   
0          IF COENR2     = '1' ! COENR2 = '4' ! COENR2 = '6' THEN DO;   11134   
              IF COENR3  = '3' THEN DO; /*   NON  COLIS               */11135   
                                        /******************************/11136   
                    EDIT_EAN            = WTFAC.EANNU;                  11137   
                    CALL REPOIDS;       /*   CALCUL DU POIDS          */11138   
                    IF WNUART = NUARTNUM THEN DO;                       11139   
                       EDIT_EAN         = ' ' ;                         11140   
                       GO TO Z000C;                                     11141   
                       END;                                             11142   
       Z000B:                           /*   ART. A NUART DIFFERENT   */11143   
                    LIGNE1.NUART        = NUARTNUM;                     11144   
       Z000C:                           /*   ARTICLE ORDINAIRE        */11145   
                    LIGNE1.REFLI        = WTFAC.REFLI;                  11146   
                    CALL MEF_REFLI;     /*   EDITION NATRE RET EDITEUR*/11147   
                    LIGNE1.NETHT        = WTFAC.NETLI;                  11148   
                    IF WTFAC.TRACO  = '4' & WTFAC.EDIPA = '1' THEN      11149   
                    CALL CUM_NOMPOI ;                                   11150   
                    IF WTFAC.TYREF      = '3' THEN DO;                  11151   
                       IF WTFAC.QUANT   >  1  THEN DO;                  11152   
                          /* BFA$ : DEBUT MODIF REMPL QUANT PAR NBTOM */11153   
                          /*LIGNE1.QUANT = WTFAC.QUANT;*/               11154   
                          LIGNE1.QUANT = WTFAC.NBTOM;                   11155   
                          /* BFA$ : FIN MODIF REMPL QUANT PAR NBTOM */  11156   
                          LIGNE1.PIPUB = WTFAC.PRIFA;                   11157   
                          END;          ELSE DO;                        11158   
                          XQUANT        = 0;                            11159   
                          END;          /*   FIN  TEST  QUANT SUP. 1  */11160   
                       END;             ELSE DO;                        11161   
                       /* BFA$ : DEBUT MODIF REMPL QUANT PAR NBTOM */   11162   
                       /*LIGNE1.QUANT     = WTFAC.QUANT;*/              11163   
                       LIGNE1.QUANT     = WTFAC.NBTOM;                  11164   
                       /* BFA$ : FIN MODIF REMPL QUANT PAR NBTOM */     11165   
                       LIGNE1.PUNHT     = WTFAC.PUNHT;                  11166   
                       CALL ECRLIGN;                                    11167   
                       END;             /*   FIN TEST TYREF 3         */11168   
                    IF WTFAC.TYREF      = '5' THEN DO;                  11169   
                       LIGNE            = ' ' ;                         11170   
                       LIGNE1.POLIC     = '00'X ;                       11171   
                       LIGNE1.NUART     = NUARTNUM;                     11172   
                       LIGNE1.REFLI     = WTFAC.REFLI;                  11173   
                       CALL MEF_REFLI;  /*   EDITION NATRE RET EDITEUR*/11174   
                       LIGNE1.NETHT     = WTFAC.NETLI;                  11175   
                       /* BFA$ : DEBUT MODIF REMPL QUANT PAR NBTOM */   11176   
                       /*LIGNE1.QUANT     = WTFAC.QUANT;*/              11177   
                       LIGNE1.QUANT     = WTFAC.NBTOM;                  11178   
                       /* BFA$ : FIN MODIF REMPL QUANT PAR NBTOM */     11179   
                       CALL CALCUL;     /*   VENTIL. COTAX ECHEA VENET*/11180   
                       RESAI.QUANT      = RESAI.QUANT + XQUANT;         11181   
                       IF TOP_DEMA_FAC  = 'O' THEN DO;                  11182   
                          DEMAT_LIG.TYPRO = 'U' ;                       11183   
                          SVG_NUART       = WTFAC.NUART ;               11184   
                          SVG_TYREF       = WTFAC.TYREF ;               11185   
                          SVG_NUEDI       = WTFAC.NUEDI ;               11186   
                          SVG_NUDIV       = WTFAC.NUDIV ;               11187   
                          SVG_NUCOL       = WTFAC.NUCOL ;               11188   
                          CALL DECODE_LIGNE ;                           11189   
                          DEMAT_LIG.QTPCO = 1 ;                         11190   
                          DEMAT_LIG.EAN13 = WTFAC.EANNU ;               11191   
                          NETTC           = WMONT ;                     11192   
                          TOP_DEMA_LIG    = 'O'   ;                     11193   
                          TOP_DEMA_LEC    = 'O'   ;                     11194   
                          SVG_LIBEL       = LIGNE1_DEC.LIBEL ;          11195   
                          LIGNE1_DEC.LIBEL= WTFAC.LIBTI ;               11196   
                          DEMAT_LIG.LIBTI = WTFAC.LIBTI ;               11197   
                          CALL STEP_CHARGE ;                            11198   
                          IF ^(DEMAT_LIG.NETHT = 0.00 !                 11199   
                               DEMAT_LIG.TXREM = 100.00 ) THEN DO;      11200   
                             DEMAT_QTTOT  = DEMAT_QTTOT +               11201   
                                            DEMAT_LIG.QTFAC ;           11202   
                             END;                                       11203   
                          LIGNE1_DEC.LIBEL= SVG_LIBEL   ;               11204   
                          END;                                          11205   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                11206   
                          STO_D_LIG.TYPRO = 'U' ;                       11207   
                          SVG_NUART       = WTFAC.NUART ;               11208   
                          SVG_TYREF       = WTFAC.TYREF ;               11209   
                          SVG_NUEDI       = WTFAC.NUEDI ;               11210   
                          SVG_NUDIV       = WTFAC.NUDIV ;               11211   
                          SVG_NUCOL       = WTFAC.NUCOL ;               11212   
                          CALL DECODE_LIGNE_D ;                         11213   
                          STO_D_LIG.QTPCO = 1 ;                         11214   
                          STO_D_LIG.EAN13 = WTFAC.EANNU ;               11215   
                          NETTC           = WMONT ;                     11216   
                          TOP_DEMA_LIG    = 'O'   ;                     11217   
                          TOP_DEMA_LEC    = 'O'   ;                     11218   
                          SVG_LIBEL       = LIGNE1_DEC.LIBEL ;          11219   
                          LIGNE1_DEC.LIBEL= WTFAC.LIBTI ;               11220   
                          STO_D_LIG.LIBTI = WTFAC.LIBTI ;               11221   
                          CALL STEP_CHARGE_D;                           11222   
                          IF ^(STO_D_LIG.NETHT = 0.00 !                 11223   
                               STO_D_LIG.TXREM = 100.00 ) THEN DO;      11224   
                             STO_D_QTTOT  = STO_D_QTTOT +               11225   
                                            STO_D_LIG.QTFAC ;           11226   
                             END;                                       11227   
                          LIGNE1_DEC.LIBEL= SVG_LIBEL   ;               11228   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                11229   
                       GO TO Z000G;                                     11230   
                       END;             /*   FIN TEST TYREF 5         */11231   
                    CALL CALCUL;        /*   VENTIL. COTAX ECHEA VENET*/11232   
                    RESAI.QUANT    = RESAI.QUANT + XQUANT;              11233   
                    IF WTFAC.IMPEC = '1' & WTFAC.EDIPA = '1' &          11234   
                       WTFAC.TRACO = '0' THEN DO;                       11235   
                       LIGNE1.ECHEA     = WTFAC.ECHEA;                  11236   
                       END;                                             11237   
                    IF NUCLI.COTAX= '1' THEN DO;                        11238   
                       LIGNE1.COTAX     = WTFAC.COTAX;                  11239   
                       END;                                             11240   
                    IF WTFAC.EDIPA= '2' THEN DO;                        11241   
                       LIGNE2_VENET     = ' ';  /*   SUPPR 09.10      */11242   
                       END;                                             11243   
                    IF TOP_DEMA_FAC     = 'O' THEN DO;                  11244   
                       DEMAT_LIG.TYPRO  = 'U' ;                         11245   
                       SVG_NUART        = WTFAC.NUART ;                 11246   
                       SVG_TYREF        = WTFAC.TYREF ;                 11247   
                       SVG_NUEDI        = WTFAC.NUEDI ;                 11248   
                       SVG_NUDIV        = WTFAC.NUDIV ;                 11249   
                       SVG_NUCOL        = WTFAC.NUCOL ;                 11250   
                       CALL DECODE_LIGNE ;                              11251   
                       DEMAT_LIG.QTPCO  = 1 ;                           11252   
                       DEMAT_LIG.EAN13  = WTFAC.EANNU ;                 11253   
                       NETTC            = WMONT ;                       11254   
                       TOP_DEMA_LIG     = 'O'   ;                       11255   
                       TOP_DEMA_LEC     = 'O'   ;                       11256   
                       SVG_LIBEL        = LIGNE1_DEC.LIBEL ;            11257   
                       LIGNE1_DEC.LIBEL = WTFAC.LIBTI ;                 11258   
                       DEMAT_LIG.LIBTI  = WTFAC.LIBTI ;                 11259   
                       CALL STEP_CHARGE ;                               11260   
                       IF ^(DEMAT_LIG.NETHT = 0.00 !                    11261   
                            DEMAT_LIG.TXREM = 100.00 ) THEN DO;         11262   
                          DEMAT_QTTOT   = DEMAT_QTTOT +                 11263   
                                          DEMAT_LIG.QTFAC ;             11264   
                          END;                                          11265   
                       LIGNE1_DEC.LIBEL = SVG_LIBEL   ;                 11266   
                       END;                                             11267   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                11268   
                       STO_D_LIG.TYPRO  = 'U' ;                         11269   
                       SVG_NUART        = WTFAC.NUART ;                 11270   
                       SVG_TYREF        = WTFAC.TYREF ;                 11271   
                       SVG_NUEDI        = WTFAC.NUEDI ;                 11272   
                       SVG_NUDIV        = WTFAC.NUDIV ;                 11273   
                       SVG_NUCOL        = WTFAC.NUCOL ;                 11274   
                       CALL DECODE_LIGNE_D ;                            11275   
                       STO_D_LIG.QTPCO  = 1 ;                           11276   
                       STO_D_LIG.EAN13  = WTFAC.EANNU ;                 11277   
                       NETTC            = WMONT ;                       11278   
                       TOP_DEMA_LIG     = 'O'   ;                       11279   
                       TOP_DEMA_LEC     = 'O'   ;                       11280   
                       SVG_LIBEL        = LIGNE1_DEC.LIBEL ;            11281   
                       LIGNE1_DEC.LIBEL = WTFAC.LIBTI ;                 11282   
                       STO_D_LIG.LIBTI  = WTFAC.LIBTI ;                 11283   
                       CALL STEP_CHARGE_D;                              11284   
                       IF ^(STO_D_LIG.NETHT = 0.00 !                    11285   
                            STO_D_LIG.TXREM = 100.00 ) THEN DO;         11286   
                          STO_D_QTTOT   = STO_D_QTTOT +                 11287   
                                          STO_D_LIG.QTFAC ;             11288   
                          END;                                          11289   
                       LIGNE1_DEC.LIBEL = SVG_LIBEL   ;                 11290   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                11291   
                    GO TO Z000G;                                        11292   
                    END;                /*   FIN ARTICLE ORDINAIRE    */11293   
              IF COENR3 = '4' THEN DO;  /*   ENTETE ATM SIMPLE        */11294   
                    EDIT_EAN            = WTFAC.EANNU;                  11295   
                                        /*   NON EDITE SI GIH         */11296   
                    CALL REPOIDS;       /*   CALCUL DU POIDS          */11297   
                    IF WTFAC.TRACO  = '4' & WTFAC.EDIPA = '1' THEN      11298   
                    CALL CUM_NOMPOI ;                                   11299   
                    COLIS.ATMGIH        = '1';                          11300   
                    RESAI.QUANT         = RESAI.QUANT + XQUANT;         11301   
                    CALL CUECHEA;       /*   CUMUL QUANT. PAR ECHEA   */11302   
                    IF WTFAC.EDIPA      = '2' THEN GO TO Z000F;         11303   
                    LIGNE1.NUART        = NUARTNUM;                     11304   
                    LIGNE1.REFLI        = WTFAC.REFLI;                  11305   
                    CALL MEF_REFLI;     /*   EDITION NATRE RET EDITEUR*/11306   
                    /* BFA$ : DEBUT MODIF REMPLACER QUANT PAR NBTOM */  11307   
                    /*LIGNE1.QUANT        = WTFAC.QUANT;*/              11308   
                    LIGNE1.QUANT        = WTFAC.NBTOM;                  11309   
                    /* BFA$ : FIN MODIF REMPLACER QUANT PAR NBTOM */    11310   
                    IF TOP_DEMA_FAC     = 'O' THEN DO;                  11311   
                       DEMAT_LIG.TYPRO  = 'A' ;                         11312   
                       NBCOM_ATM        = 0     ;                       11313   
                       SVG_NUART        = WTFAC.NUART ;                 11314   
                       SVG_TYREF        = WTFAC.TYREF ;                 11315   
                       SVG_NUEDI        = WTFAC.NUEDI ;                 11316   
                       SVG_NUDIV        = WTFAC.NUDIV ;                 11317   
                       SVG_NUCOL        = WTFAC.NUCOL ;                 11318   
                       CALL DECODE_LIGNE ;                              11319   
                       DEMAT_LIG.QTPCO  = 1 ;                           11320   
                       DEMAT_LIG.EAN13  = WTFAC.EANNU ;                 11321   
                       NETTC            = WMONT ;                       11322   
                       DEMAT_LIG.DTECH  = '00000000';                   11323   
                       DEMAT_LIG.MTECH  = 0        ;                    11324   
                       DEMAT_LIG.SMTECH = '+'      ;                    11325   
                       DEMAT_LIG.ENSEQ  = DEMAT_LIG.ENSEQ + 1 ;         11326   
                       DEMAT_LIG.LIBTI  = WTFAC.LIBTI ;                 11327   
                       SVG_DEMAT_ATM    = DEMAT_LIG, BY NAME  ;         11328   
                       END;                                             11329   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                11330   
                       STO_D_LIG.TYPRO  = 'A' ;                         11331   
                       NBCOM_ATM_D      = 0     ;                       11332   
                       SVG_NUART        = WTFAC.NUART ;                 11333   
                       SVG_TYREF        = WTFAC.TYREF ;                 11334   
                       SVG_NUEDI        = WTFAC.NUEDI ;                 11335   
                       SVG_NUDIV        = WTFAC.NUDIV ;                 11336   
                       SVG_NUCOL        = WTFAC.NUCOL ;                 11337   
                       CALL DECODE_LIGNE_D ;                            11338   
                       STO_D_LIG.QTPCO  = 1 ;                           11339   
                       STO_D_LIG.EAN13  = WTFAC.EANNU ;                 11340   
                       NETTC            = WMONT ;                       11341   
                       STO_D_LIG.DTECH  = '00000000';                   11342   
                       STO_D_LIG.MTECH  = 0        ;                    11343   
                       STO_D_LIG.SMTECH = '+'      ;                    11344   
                       STO_D_LIG.LIBTI  = WTFAC.LIBTI ;                 11345   
                       CTR_ENSEQ_D      = CTR_ENSEQ_D + 1 ;             11346   
                       STO_D_LIG.ID.ENSEQ = CTR_ENSEQ_D   ;             11347   
                       SVG_STO_D_ATM    = STO_D_LIG, BY NAME  ;         11348   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                11349   
                    GO TO Z000G;                                        11350   
                    END;                /*   FIN ENTETE ATM SIMPLE    */11351   
              IF COENR3 = '7' THEN DO;  /*   COMPOSANT ATM SIMPLE     */11352   
                                        /*   TRAITE COMME 113 SI GIH  */11353   
                    XQUANT              = 0;                            11354   
                    IF WTFAC.EDIPA      = '2' THEN DO;                  11355   
                       IF COLIS.ATMGIH  = '1' THEN DO;                  11356   
                          COLIS.ATMGIH  = ' ';                          11357   
                          GO TO Z000B;                                  11358   
                          END;          /*   FIN EDIT. 1ER COMP. GIH  */11359   
                       LIGNE2_NUART     = '* ATM *';                    11360   
                       EDIT_EAN         = ' '      ;                    11361   
                       GO TO Z000C;                                     11362   
                       END;             /*   FIN TEST GIH             */11363   
                    CALL CALCUL;                                        11364   
                    LIGNE1.PUNHT        = WTFAC.PUNHT;                  11365   
                    LIGNE1.NETHT        = WTFAC.NETLI;                  11366   
                    LIGNE1.LIBEL        = SUBSTR(WTFAC.LIBTI,34,12);    11367   
                    CALL ECRLIGN;                                       11368   
                    IF WTFAC.IMPEC      = '1' & WTFAC.EDIPA = '1' &     11369   
                       WTFAC.TRACO      = '0' THEN DO;                  11370   
                       LIGNE1.ECHEA     = WTFAC.ECHEA;                  11371   
                       END;                                             11372   
                    IF NUCLI.COTAX = '1' THEN DO;                       11373   
                       LIGNE1.COTAX     = WTFAC.COTAX;                  11374   
                       END;                                             11375   
                    IF WTFAC.EDIPA      = '9' THEN GO TO Z000F;         11376   
                    IF FACT.LIGNE       > NLMAX_1 THEN CALL ENTCDL;     11377   
                    FACT.LIGNE          = FACT.LIGNE + 1;               11378   
                    STRING(ZSPOOLP_SVG) = LIGNE;                        11379   
                    IF ACCORD_OUI_NON = 'OUI' THEN CALL STOCKAGE_ACCORD;11380   
                    IF RECAP_BL       = 'OUI' THEN CALL STOCKAGE_BL    ;11381   
                    CALL ECRITUR;                                       11382   
                    IF TOP_DEMA_FAC     = 'O' THEN DO;                  11383   
                       NBCOM_ATM        = NBCOM_ATM + 1 ;               11384   
                       DEMAT_LIG.TYPRO  = 'U' ;                         11385   
                       SVG_NUART        = WTFAC.NUART ;                 11386   
                       SVG_TYREF        = WTFAC.TYREF ;                 11387   
                       SVG_NUEDI        = WTFAC.NUEDI ;                 11388   
                       SVG_NUDIV        = WTFAC.NUDIV ;                 11389   
                       SVG_NUCOL        = WTFAC.NUCOL ;                 11390   
                       CALL DECODE_LIGNE ;                              11391   
                       DEMAT_LIG.QTPCO  = 1 ;                           11392   
                       DEMAT_LIG.EAN13  = WTFAC.EANNU ;                 11393   
                       IF CODECH = ' '                                  11394   
                          THEN CODECH   = WTFAC.ECHEA ;                 11395   
                       NETTC            = WMONT ;                       11396   
                       DEMAT_LIG.ENSEQ  = DEMAT_LIG.ENSEQ + 1 ;         11397   
                       DEMAT_LIG.LIBTI  = SUBSTR(WTFAC.LIBTI,34,12);    11398   
                       TOP_DEMA_LIG     = 'O'   ;                       11399   
                       TOP_DEMA_LEC     = 'O'   ;                       11400   
                       CALL STEP_CHARGE ;                               11401   
                       END;                                             11402   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                11403   
  /*  ICI  */          NBCOM_ATM_D      = NBCOM_ATM_D + 1 ;             11404   
                       STO_D_LIG.TYPRO  = 'U' ;                         11405   
                       SVG_NUART        = WTFAC.NUART ;                 11406   
                       SVG_TYREF        = WTFAC.TYREF ;                 11407   
                       SVG_NUEDI        = WTFAC.NUEDI ;                 11408   
                       SVG_NUDIV        = WTFAC.NUDIV ;                 11409   
                       SVG_NUCOL        = WTFAC.NUCOL ;                 11410   
                       CALL DECODE_LIGNE_D ;                            11411   
                       STO_D_LIG.QTPCO  = 1 ;                           11412   
                       STO_D_LIG.EAN13  = WTFAC.EANNU ;                 11413   
                       IF CODECH = ' '                                  11414   
                          THEN CODECH   = WTFAC.ECHEA ;                 11415   
                       NETTC            = WMONT ;                       11416   
                       STO_D_LIG.LIBTI  = SUBSTR(WTFAC.LIBTI,34,12);    11417   
                       TOP_DEMA_LIG     = 'O'   ;                       11418   
                       TOP_DEMA_LEC     = 'O'   ;                       11419   
                       CALL STEP_CHARGE_D;                              11420   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                11421   
                    GO TO Z000F;                                        11422   
                    END;                /*   FIN COMPOSANT ATM SIMPLE */11423   
                 END;                   /*   FIN TEST NON COLIS       */11424   
0          IF COENR2 = '2' ! COENR2 = '3' ! COENR2 = '5' THEN DO;       11425   
                                        /*   COLIS                    */11426   
                                        /******************************/11427   
              IF COENR3 = '3' ! COENR3 = '4' THEN DO;                   11428   
                                        /*   TETE COLIS               */11429   
                    EDIT_EAN            = WTFAC.EANNU;                  11430   
                    RESAI.QUANT         = RESAI.QUANT + XQUANT;         11431   
                    CALL CUECHEA;       /*   CUMUL QUANT. PAR ECHEA   */11432   
                    CALL REPOIDS;       /*   CALCUL DU POIDS          */11433   
                    IF WTFAC.TRACO  = '4' & WTFAC.EDIPA = '1' THEN      11434   
                    CALL CUM_NOMPOI ;                                   11435   
                    LIGNE1.NUART        = NUARTNUM;                     11436   
                    REFLI_TETE_COLIS    = WTFAC.REFLI;                  11437   
                    LIGNE1.REFLI        = WTFAC.REFLI;                  11438   
                    CALL MEF_REFLI;     /*   EDITION NATRE RET EDITEUR*/11439   
                    /* BFA$ : DEBUT MODIF REMPLACER QUANT PAR NBTOM */  11440   
                    /*LIGNE1.QUANT        = WTFAC.QUANT;*/              11441   
                    LIGNE1.QUANT        = WTFAC.NBTOM;                  11442   
                    COLIS.QUANT         = WTFAC.NBTOM;                  11443   
                    /* BFA$ : FIN MODIF REMPLACER QUANT PAR NBTOM */    11444   
                    LIGNE1.PUNHT        = WTFAC.PUNHT;                  11445   
                    IF WTFAC.TRACO = '0' ! WTFAC.TRACO = '3' THEN DO;   11446   
                       CALL ECRLIGN;                                    11447   
                       LIGNE1.NETHT     = WTFAC.NETLI;                  11448   
                       END;             /*   FIN TEST TRACO 0,3       */11449   
                    IF WTFAC.IMPEC = '1' & WTFAC.EDIPA = '1' &          11450   
                       WTFAC.TRACO = '0' THEN DO;                       11451   
                       LIGNE1.ECHEA     = WTFAC.ECHEA;                  11452   
                       END;                                             11453   
                    IF TOP_DEMA_FAC     = 'O' THEN DO;                  11454   
                       NBCOM_COLIS      = 0    ;                        11455   
                       DEMAT_LIG.TYPRO  = 'C' ;                         11456   
                       SVG_NUART        = WTFAC.NUART ;                 11457   
                       SVG_TYREF        = WTFAC.TYREF ;                 11458   
                       SVG_NUEDI        = WTFAC.NUEDI ;                 11459   
                       SVG_NUDIV        = WTFAC.NUDIV ;                 11460   
                       SVG_NUCOL        = WTFAC.NUCOL ;                 11461   
                       CALL DECODE_LIGNE ;                              11462   
                       DEMAT_LIG.QTPCO  = 1 ;                           11463   
                       DEMAT_LIG.EAN13  = WTFAC.EANNU ;                 11464   
                       IF WTFAC.POFIS = '4' ! WTFAC.POFIS = '6' !       11465   
                          WTFAC.POFIS = '8' ! WTFAC.POFIS = '9'         11466   
                          THEN DO;                                      11467   
                          NETTC         = WTFAC.NETLI ;                 11468   
                          END;          ELSE DO;                        11469   
                          NETTC         = WTFAC.NETLI + WTFAC.TAXLI;    11470   
                          END;                                          11471   
                       DEMAT_LIG.ENSEQ  = DEMAT_LIG.ENSEQ + 1 ;         11472   
                       DEMAT_LIG.LIBTI  = WTFAC.LIBTI ;                 11473   
                       TOP_DEMA_LIG     = 'N'   ;                       11474   
                       TOP_DEMA_LEC     = 'O'   ;                       11475   
                       CALL STEP_CHARGE ;                               11476   
                       SVG_DEMAT_COLIS  = DEMAT_LIG , BY NAME ;         11477   
                       END;                                             11478   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                11479   
                       NBCOM_COLIS_D    = 0    ;                        11480   
                       STO_D_LIG.TYPRO  = 'C' ;                         11481   
                       SVG_NUART        = WTFAC.NUART ;                 11482   
                       SVG_TYREF        = WTFAC.TYREF ;                 11483   
                       SVG_NUEDI        = WTFAC.NUEDI ;                 11484   
                       SVG_NUDIV        = WTFAC.NUDIV ;                 11485   
                       SVG_NUCOL        = WTFAC.NUCOL ;                 11486   
                       CALL DECODE_LIGNE_D ;                            11487   
                       STO_D_LIG.QTPCO  = 1 ;                           11488   
                       STO_D_LIG.EAN13  = WTFAC.EANNU ;                 11489   
                       IF WTFAC.POFIS = '4' ! WTFAC.POFIS = '6' !       11490   
                          WTFAC.POFIS = '8' ! WTFAC.POFIS = '9'         11491   
                          THEN DO;                                      11492   
                          NETTC         = WTFAC.NETLI ;                 11493   
                          END;          ELSE DO;                        11494   
                          NETTC         = WTFAC.NETLI + WTFAC.TAXLI;    11495   
                          END;                                          11496   
                       STO_D_LIG.LIBTI  = WTFAC.LIBTI ;                 11497   
                       TOP_DEMA_LIG     = 'N'   ;                       11498   
                       TOP_DEMA_LEC     = 'O'   ;                       11499   
                       CALL STEP_CHARGE_D;                              11500   
                       SVG_STO_D_COLIS  = STO_D_LIG , BY NAME ;         11501   
                       CTR_ENSEQ_D      = CTR_ENSEQ_D + 1 ;             11502   
                       SVG_STO_D_COLIS.ID.ENSEQ = CTR_ENSEQ_D ;         11503   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                11504   
                    GO TO Z000G;                                        11505   
                    END;                /*   FIN COLIS TETE           */11506   
              IF COENR3 = '5' THEN DO;  /*   COLIS COMPOSANT ORDINAIRE*/11507   
                    EDIT_EAN            = WTFAC.EANNA;                  11508   
                    IF SVG_DEMAT_ATM.GS.NUFAC ^= '' THEN DO;            11509   
                       SVG_DEMAT_ATM.NBCOM = NBCOM_ATM ;                11510   
                       WRITE FILE (FICDEMA) FROM (SVG_DEMAT_ATM);       11511   
                       CTR_LIG_DEMA     = CTR_LIG_DEMA + 1 ;            11512   
                       SVG_DEMAT_ATM    = '' ;                          11513   
                       END;                                             11514   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                11515   
                    IF SVG_STO_D_ATM.GS.NUFAC ^= '' THEN DO;            11516   
                       SVG_STO_D_ATM.NBCOM = NBCOM_ATM_D ;              11517   
                    /* CTR_ENSEQ_D            = CTR_ENSEQ_D + 1         11518   
                       SVG_STO_D_ATM.ID.ENSEQ = CTR_ENSEQ_D */          11519   
                       WRITE FILE (FICSTOD) FROM (SVG_STO_D_ATM);       11520   
                       CTR_LIG_STOD     = CTR_LIG_STOD + 1 ;            11521   
                       SVG_STO_D_ATM    = '' ;                          11522   
                       END;                                             11523   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                11524   
                    LIGNE1.NUART        = NARSENUM;                     11525   
                    LIGNE1.PUNHT        = WTFAC.PUNHT;                  11526   
                    IF WTCLI1.TYFAC = '5' THEN DO;                      11527   
                       PUNHTCHAR        = ' ';                          11528   
                       END;                                             11529   
                    IF WTCLI1.TYFAC = '6' THEN DO;                      11530   
                       LIGNE1.PIPUB     = WTFAC.PUNHT;                  11531   
                       PUNHTCHAR        = ' ';                          11532   
                       END;             /*   FIN CLIENT ETRANGER      */11533   
                    XQUANT              = 0;                            11534   
                    CALL CALCUL;                                        11535   
                    IF WTFAC.EDIPA      = '2' THEN DO;                  11536   
                       LIGNE2_VENET     = ' ' ;     /*   SUPPRES 09.10*/11537   
                       END;                                             11538   
                    IF WTFAC.TRACO  = '2' ! WTFAC.TRACO = '4' THEN DO;  11539   
                       LIGNE1.NETHT     = WTFAC.NETLI;                  11540   
                       LIGNE1.REMIS     = WTFAC.REMBA;                  11541   
                       END;                                             11542   
                    IF NUCLI.COTAX= '1' THEN DO;                        11543   
                       LIGNE1.COTAX     = WTFAC.COTAX;                  11544   
                       END;                                             11545   
                    LIBEL4.QUANT        = WTFAC.QUANT;                  11546   
                    LIBEL4.FIL1         = ' ';                          11547   
                    LIBEL4.LIBTI        = WTFAC.LIBTI;                  11548   
                    WTFAC.LIBTI         = ZLIBEL;                       11549   
                    IF WTFAC.QUANT = 0  THEN DO;                        11550   
                       GO TO Z000F;                                     11551   
                       END;             ELSE DO;                        11552   
                       IF TOP_DEMA_FAC  = 'O' THEN DO;                  11553   
                          NBCOM_COLIS   = NBCOM_COLIS + 1 ;             11554   
                          IF COTAX_COLIS ^= WTFAC.COTAX THEN DO;        11555   
                             COTAX_COLIS  = WTFAC.COTAX ;               11556   
                             NBTAX_COLIS  = NBTAX_COLIS + 1;            11557   
                             END;                                       11558   
                          DEMAT_LIG.TYPRO = 'U'    ;                    11559   
                          SVG_NUART       = WTFAC.NUART ;               11560   
                          SVG_TYREF       = WTFAC.TYREF ;               11561   
                          SVG_NUEDI       = WTFAC.NUEDI ;               11562   
                          SVG_NUDIV       = WTFAC.NUDIV ;               11563   
                          SVG_NUCOL       = WTFAC.NUCOL ;               11564   
                          CALL DECODE_LIGNE ;                           11565   
                          DEMAT_LIG.QTPCO = DEMAT_LIG.QTFAC;            11566   
                          DEMAT_LIG.QTFAC = WTFAC.NBTOM ;               11567   
                          DEMAT_LIG.EAN13 = WTFAC.EANNA ;               11568   
                          IF CODECH = ' '                               11569   
                             THEN CODECH = WTFAC.ECHEA ;                11570   
                          /* DEB - IDIL-142 - 11/2021                   11571   
                          PDEMFA        = ENTET70.DAT10.AA !!           11572   
                                          ENTET70.DAT10.MM !!           11573   
                                          ENTET70.DAT10.JJ ;            11574   
                              FIN - IDIL-142  */                        11575   
                          NETTC         = WMONT    ;                    11576   
                          DEMAT_LIG.ENSEQ = DEMAT_LIG.ENSEQ + 1 ;       11577   
                          IF WTFAC.IMPEC = '1' & WTFAC.EDIPA = '1' &    11578   
                             WTFAC.TRACO = '0'                          11579   
                             THEN CODECH = WTFAC.ECHEA;                 11580   
                             ELSE CODECH = '00'      ;                  11581   
                          TOP_DEMA_LIG   = 'O'   ;                      11582   
                          TOP_DEMA_LEC   = 'N'   ;                      11583   
             /*           SVG_LIBEL       = LIGNE1_DEC.LIBEL            11584   
                          LIGNE1_DEC.LIBEL= WTFAC.LIBTI    */           11585   
                          DEMAT_LIG.LIBTI = LIBEL4.LIBTI;               11586   
                          CALL STEP_CHARGE ;                            11587   
             /*           LIGNE1_DEC.LIBEL= SVG_LIBEL      */           11588   
                          END;                                          11589   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                11590   
                          NBCOM_COLIS_D   = NBCOM_COLIS_D + 1 ;         11591   
                          IF COTAX_COLIS_D ^= WTFAC.COTAX THEN DO;      11592   
                             COTAX_COLIS_D  = WTFAC.COTAX ;             11593   
                             NBTAX_COLIS_D  = NBTAX_COLIS_D + 1;        11594   
                             END;                                       11595   
                          STO_D_LIG.TYPRO = 'U'    ;                    11596   
                          SVG_NUART       = WTFAC.NUART ;               11597   
                          SVG_TYREF       = WTFAC.TYREF ;               11598   
                          SVG_NUEDI       = WTFAC.NUEDI ;               11599   
                          SVG_NUDIV       = WTFAC.NUDIV ;               11600   
                          SVG_NUCOL       = WTFAC.NUCOL ;               11601   
                          CALL DECODE_LIGNE_D ;                         11602   
                          STO_D_LIG.QTPCO = STO_D_LIG.QTFAC;            11603   
                          STO_D_LIG.QTFAC = WTFAC.NBTOM ;               11604   
                          STO_D_LIG.EAN13 = WTFAC.EANNA ;               11605   
                          IF CODECH = ' '                               11606   
                             THEN CODECH = WTFAC.ECHEA ;                11607   
                          /* DEB - IDIL-142 - 11/2021                   11608   
                          PDEMFA        = ENTET70.DAT10.AA !!           11609   
                                          ENTET70.DAT10.MM !!           11610   
                                          ENTET70.DAT10.JJ ;            11611   
                             FIN - IDIL-142  */                         11612   
                          NETTC         = WMONT    ;                    11613   
                          IF WTFAC.IMPEC = '1' & WTFAC.EDIPA = '1' &    11614   
                             WTFAC.TRACO = '0'                          11615   
                             THEN CODECH = WTFAC.ECHEA;                 11616   
                             ELSE CODECH = '00'      ;                  11617   
                          TOP_DEMA_LIG   = 'O'   ;                      11618   
                          TOP_DEMA_LEC   = 'N'   ;                      11619   
                          STO_D_LIG.LIBTI = LIBEL4.LIBTI;               11620   
                          CALL STEP_CHARGE_D;                           11621   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                11622   
                       LIGNE1.REFLI     = REFLI_TETE_COLIS;             11623   
                       CALL MEF_REFLI;  /*   EDITION NATRE RET EDITEUR*/11624   
                       GO TO Z000G;                                     11625   
                       END;                                             11626   
                    END;                /*   FIN COLIS COMPOS. ORDIN. */11627   
              IF COENR3 = '6' THEN DO;  /*   COLIS ENTETE ATM         */11628   
                    EDIT_EAN            = WTFAC.EANNA;                  11629   
                    LIGNE1.NUART        = NARSENUM;                     11630   
                    LIBEL4.QUANT        = WTFAC.QUANT;                  11631   
                    LIBEL4.FIL1         = ' ';                          11632   
                    LIBEL4.LIBTI        = WTFAC.LIBTI;                  11633   
                    WTFAC.LIBTI         = ZLIBEL;                       11634   
                    IF WTFAC.TRACO  = '4' & WTFAC.EDIPA = '1'           11635   
                       THEN CALL CUM_NOMPOI ;                           11636   
                    IF SVG_DEMAT_ATM.GS.NUFAC ^= '' THEN DO;            11637   
                       SVG_DEMAT_ATM.NBCOM = NBCOM_ATM ;                11638   
                       WRITE FILE (FICDEMA) FROM (SVG_DEMAT_ATM);       11639   
                       CTR_LIG_DEMA     = CTR_LIG_DEMA + 1 ;            11640   
                       SVG_DEMAT_ATM    = '' ;                          11641   
                       END;                                             11642   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                11643   
                    IF SVG_STO_D_ATM.GS.NUFAC ^= '' THEN DO;            11644   
                       SVG_STO_D_ATM.NBCOM = NBCOM_ATM_D ;              11645   
                    /* CTR_ENSEQ_D            = CTR_ENSEQ_D + 1         11646   
                       SVG_STO_D_ATM.ID.ENSEQ = CTR_ENSEQ_D */          11647   
                       WRITE FILE (FICSTOD) FROM (SVG_STO_D_ATM);       11648   
                       CTR_LIG_STOD     = CTR_LIG_STOD + 1 ;            11649   
                       SVG_STO_D_ATM    = '' ;                          11650   
                       END;                                             11651   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                11652   
                    IF TOP_DEMA_FAC     = 'O' THEN DO;                  11653   
                       NBCOM_ATM        = 0      ;                      11654   
                       NBCOM_COLIS      = NBCOM_COLIS + 1 ;             11655   
                       DEMAT_LIG.TYPRO  = 'A'    ;                      11656   
                       SVG_NUART        = WTFAC.NUART ;                 11657   
                       SVG_TYREF        = WTFAC.TYREF ;                 11658   
                       SVG_NUEDI        = WTFAC.NUEDI ;                 11659   
                       SVG_NUDIV        = WTFAC.NUDIV ;                 11660   
                       SVG_NUCOL        = WTFAC.NUCOL ;                 11661   
                       CALL DECODE_LIGNE ;                              11662   
                       DEMAT_LIG.QTPCO  = DEMAT_LIG.QTFAC;              11663   
                       DEMAT_LIG.QTFAC  = WTFAC.NBTOM ;                 11664   
                       DEMAT_LIG.EAN13  = WTFAC.EANNA ;                 11665   
                       /* DEB - IDIL-142 - 11/2021                      11666   
                       PDEMFA           = ENTET70.DAT10.AA !!           11667   
                                          ENTET70.DAT10.MM !!           11668   
                                          ENTET70.DAT10.JJ ;            11669   
                          FIN - IDIL-142  */                            11670   
                       NETTC            = WMONT    ;                    11671   
                       DEMAT_LIG.DTECH  = '00000000';                   11672   
                       DEMAT_LIG.MTECH  = 0        ;                    11673   
                       DEMAT_LIG.SMTECH = '+'      ;                    11674   
                       DEMAT_LIG.ENSEQ  = DEMAT_LIG.ENSEQ + 1 ;         11675   
                       DEMAT_LIG.LIBTI  = WTFAC.LIBTI ;                 11676   
                       SVG_DEMAT_ATM    = DEMAT_LIG , BY NAME ;         11677   
                       END;                                             11678   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                11679   
                       STO_D_LIG.TYPRO  = 'A'    ;                      11680   
                       NBCOM_ATM_D      = 0      ;                      11681   
                       NBCOM_COLIS_D    = NBCOM_COLIS_D + 1 ;           11682   
                       SVG_NUART        = WTFAC.NUART ;                 11683   
                       SVG_TYREF        = WTFAC.TYREF ;                 11684   
                       SVG_NUEDI        = WTFAC.NUEDI ;                 11685   
                       SVG_NUDIV        = WTFAC.NUDIV ;                 11686   
                       SVG_NUCOL        = WTFAC.NUCOL ;                 11687   
                       CALL DECODE_LIGNE_D ;                            11688   
                       STO_D_LIG.QTPCO  = STO_D_LIG.QTFAC;              11689   
                       STO_D_LIG.QTFAC  = WTFAC.NBTOM ;                 11690   
                       STO_D_LIG.EAN13  = WTFAC.EANNA ;                 11691   
                       /* DEB - IDIL-142 - 11/2021                      11692   
                       PDEMFA           = ENTET70.DAT10.AA !!           11693   
                                          ENTET70.DAT10.MM !!           11694   
                                          ENTET70.DAT10.JJ ;            11695   
                          FIN - IDIL-142  */                            11696   
                       NETTC            = WMONT    ;                    11697   
                       STO_D_LIG.DTECH  = '00000000';                   11698   
                       STO_D_LIG.MTECH  = 0        ;                    11699   
                       STO_D_LIG.SMTECH = '+'      ;                    11700   
                       STO_D_LIG.LIBTI  = WTFAC.LIBTI ;                 11701   
                       CTR_ENSEQ_D      = CTR_ENSEQ_D + 1 ;             11702   
                       STO_D_LIG.ID.ENSEQ = CTR_ENSEQ_D ;               11703   
                       SVG_STO_D_ATM    = STO_D_LIG , BY NAME ;         11704   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                11705   
                    LIGNE1.REFLI        = REFLI_TETE_COLIS;             11706   
                    CALL MEF_REFLI;     /*   EDITION NATRE RET EDITEUR*/11707   
                    GO TO Z000G;                                        11708   
                    END;                /*   FIN COLIS ENTETE ATM     */11709   
              IF COENR3 = '7' THEN DO;  /*   COLIS COMPOSANT ATM      */11710   
                    LIGNE1.PUNHT        = WTFAC.PUNHT;                  11711   
                    IF WTCLI1.TYFAC = '5' THEN DO;                      11712   
                       PUNHTCHAR        = ' ';                          11713   
                       END;                                             11714   
                    IF WTCLI1.TYFAC = '6' THEN DO;                      11715   
                       LIGNE1.PIPUB     = WTFAC.PUNHT;                  11716   
                       PUNHTCHAR        = ' ';                          11717   
                       END;             /*   FIN CLIENT ETRANGER      */11718   
                    XQUANT              = 0;                            11719   
                    CALL CALCUL;                                        11720   
                    IF WTFAC.TRACO = '2' ! WTFAC.TRACO = '4' THEN DO;   11721   
                       LIGNE1.NETHT     = WTFAC.NETLI;                  11722   
                       LIGNE1.REMIS     = WTFAC.REMBA;                  11723   
                       END;                                             11724   
                    LIGNE1.LIBEL        = SUBSTR(WTFAC.LIBTI,34,12);    11725   
                    IF NUCLI.COTAX= '1' THEN DO;                        11726   
                       LIGNE1.COTAX     = WTFAC.COTAX;                  11727   
                       END;                                             11728   
                    IF WTFAC.EDIPA= '2' THEN DO;                        11729   
                       LIGNE2_VENET     = ' ' ;   /*   SUPPRES 09.10  */11730   
                       END;                                             11731   
                    IF WTFAC.EDIPA = '9' THEN GO TO Z000F;              11732   
                    IF FACT.LIGNE       > NLMAX_1 THEN CALL ENTCDL;     11733   
                    FACT.LIGNE          = FACT.LIGNE + 1;               11734   
                    STRING(ZSPOOLP_SVG) = LIGNE;                        11735   
                    IF ACCORD_OUI_NON = 'OUI' THEN CALL STOCKAGE_ACCORD;11736   
                    IF RECAP_BL       = 'OUI' THEN CALL STOCKAGE_BL    ;11737   
                    IF TOP_DEMA_FAC     = 'O' THEN DO;                  11738   
                       NBCOM_ATM        = NBCOM_ATM + 1 ;               11739   
                       DEMAT_LIG.TYPRO  = 'U'    ;                      11740   
                       IF COTAX_COLIS  ^= WTFAC.COTAX THEN DO;          11741   
                          COTAX_COLIS   = WTFAC.COTAX ;                 11742   
                          NBTAX_COLIS   = NBTAX_COLIS + 1;              11743   
                          END;                                          11744   
                       SVG_NUART        = WTFAC.NUART ;                 11745   
                       SVG_TYREF        = WTFAC.TYREF ;                 11746   
                       SVG_NUEDI        = WTFAC.NUEDI ;                 11747   
                       SVG_NUDIV        = WTFAC.NUDIV ;                 11748   
                       SVG_NUCOL        = WTFAC.NUCOL ;                 11749   
                       CALL DECODE_LIGNE ;                              11750   
                       DEMAT_LIG.QTPCO  = DEMAT_LIG.QTFAC;              11751   
                       DEMAT_LIG.QTFAC  = WTFAC.NBTOM ;                 11752   
                       DEMAT_LIG.EAN13  = WTFAC.EANNA ;                 11753   
                       IF CODECH = ' '                                  11754   
                          THEN CODECH = WTFAC.ECHEA ;                   11755   
                       NETTC            = WMONT    ;                    11756   
                       DEMAT_LIG.ENSEQ  = DEMAT_LIG.ENSEQ + 1 ;         11757   
                       IF WTFAC.IMPEC = '1' & WTFAC.EDIPA = '1' &       11758   
                          WTFAC.TRACO = '0'                             11759   
                          THEN CODECH   = WTFAC.ECHEA;                  11760   
                          ELSE CODECH   = '00'       ;                  11761   
                       TOP_DEMA_LIG     = 'O'   ;                       11762   
                       TOP_DEMA_LEC     = 'N'   ;                       11763   
                       CALL STEP_CHARGE ;                               11764   
                       END;                                             11765   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                11766   
                       NBCOM_ATM_D      = NBCOM_ATM_D + 1 ;             11767   
                       STO_D_LIG.TYPRO  = 'U'    ;                      11768   
                       IF COTAX_COLIS_D  ^= WTFAC.COTAX THEN DO;        11769   
                          COTAX_COLIS_D   = WTFAC.COTAX ;               11770   
                          NBTAX_COLIS_D   = NBTAX_COLIS_D + 1;          11771   
                          END;                                          11772   
                       SVG_NUART        = WTFAC.NUART ;                 11773   
                       SVG_TYREF        = WTFAC.TYREF ;                 11774   
                       SVG_NUEDI        = WTFAC.NUEDI ;                 11775   
                       SVG_NUDIV        = WTFAC.NUDIV ;                 11776   
                       SVG_NUCOL        = WTFAC.NUCOL ;                 11777   
                       CALL DECODE_LIGNE_D ;                            11778   
                       STO_D_LIG.QTPCO  = STO_D_LIG.QTFAC;              11779   
                       STO_D_LIG.QTFAC  = WTFAC.NBTOM ;                 11780   
                       STO_D_LIG.EAN13  = WTFAC.EANNA ;                 11781   
                       IF CODECH = ' '                                  11782   
                          THEN CODECH = WTFAC.ECHEA ;                   11783   
                       NETTC            = WMONT    ;                    11784   
                       IF WTFAC.IMPEC = '1' & WTFAC.EDIPA = '1' &       11785   
                          WTFAC.TRACO = '0'                             11786   
                          THEN CODECH   = WTFAC.ECHEA;                  11787   
                          ELSE CODECH   = '00'       ;                  11788   
                       TOP_DEMA_LIG     = 'O'   ;                       11789   
                       TOP_DEMA_LEC     = 'N'   ;                       11790   
                       CALL STEP_CHARGE_D;                              11791   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                11792   
                    LIGNE1.REFLI        = REFLI_TETE_COLIS;             11793   
                    CALL MEF_REFLI;     /*   EDITION NATRE RET EDITEUR*/11794   
                    CALL ECRITUR;                                       11795   
                    GO TO Z000F;                                        11796   
                    END;                /*   FIN COLIS COMPOSANT ATM  */11797   
              END;                      /*   FIN  TEST  COLIS         */11798   
0      Z000E:                           /*   COENR INCONNU ERREUR     */11799   
           WANOL.TBANO(1) = '2375';                                     11800   
           WANOE.TBANO(1) = '2375';                                     11801   
           WANOL.LIMPO    = '***** COENR INCONNU ' !! WTFAC.COENR !!    11802   
                            ' FORCE A 113  FACT '  !! WNUFAC;           11803   
           CALL ID470D;                 /*   ANOMALIE UTILISATEUR     */11804   
           WANOT.NUANO    = WANOT.NUANO + 1;                            11805   
           WANOT.NOFIC    = 'FAC3A';                                    11806   
           WANOT.LIANO    = '***** COENR INCONNU ' !! WTFAC.COENR !!    11807   
                            ' FORCE A 113  FACT '  !! WNUFAC;           11808   
           WANOT.ENREG    = ENRWFAC;    /*   ANOMALIE TECHNIQUE       */11809   
           WRITE FILE (FEDITI) FROM (WANOT);                            11810   
           WTFAC.COENR    = '113';      /*   COENR FORCE ARTICLE ORDIN*/11811   
           GO TO Z000D;                                                 11812   
0      Z000G:                                                           11813   
           IF WTFAC.EDIPA = '9' THEN GO TO Z000F;                       11814   
0      Z000H:                                                           11815   
           CALL EDLIBTI;                /*   EDITION LIBTI LIBAU      */11816   
0      Z000F:                                                           11817   
           END RECOENR;                                                 11818   
                                                                        11819   
1         /*********************************************************/   11820   
          /*  MODIF JNM LE 23/06/95                                */   11821   
          /*  CUMUL DU POIDS DANS LA TABLE PAR NOMENCLATURE        */   11822   
          /*********************************************************/   11823   
                                                                        11824   
 CUM_NOMPOI : PROC;                                                     11825   
   /*      PUT SKIP LIST('NUCLI ' !! WTFAC.NUCLI !! ' '                 11826   
                     !!  'NUART ' !! WTFAC.NUART !! ' '                 11827   
                !!  ' ' !! WTFAC.TRACO !! ' ' !! WTFAC.EDIPA            11828   
                !!  ' ' !! WTFAC.ECFAC !! ' ' !! WTFAC.QUANT            11829   
                !!  ' ' !! POIDFRED.POIDSF    !! NOM_POI(ECFAC9)) */    11830   
            IF COENR3 = '6' THEN DO;                                    11831   
               NOM_POI(ECFAC9) = NOM_POI(ECFAC9) +                      11832   
                             (WTFAC.QUANT * POIDFRED.POIDSF) ;          11833   
               END;                      ELSE DO;                       11834   
               NOM_POI(ECFAC9) = NOM_POI(ECFAC9) +                      11835   
                             (WTFAC.NBTOM * POIDFRED.POIDSF) ;          11836   
               END;                                                     11837   
            END  CUM_NOMPOI              ;                              11838   
                                                                        11839   
1         /*********************************************************/   11840   
          /*  MODIF FLC LE 13/05/93                                */   11841   
          /*  DEBUT DE SOUS PROG                                   */   11842   
          /*********************************************************/   11843   
          /*********************************************************/   11844   
          /*  CODE ECHEA EGALE ZERO                                */   11845   
          /*  MEME LOGIQUE QUE NATOP = 2X SAUF PARTIE LSH          */   11846   
          /*********************************************************/   11847   
                                                                        11848   
 STEP_CHARGE:  PROC;                                                    11849   
        /*-- ATTENTION AJOUT 05/01/2004 SMARTIN --*/                    11850   
        NETCAGR          = 0              ;                             11851   
        IF CODECH = '  ' THEN GOTO STPCHG ;                             11852   
        WS_FD_NBECH      = 0              ;                             11853   
        /*-- ------------------- ----*/                                 11854   
        T(*) = (0);                                                     11855   
0       CALL ECHEA_NBJOU;                 /*   NOUVELLE REGLE NB JOURS*/11856   
0       IF SVG_DAECH ^= ' ' THEN DO;      /*   NOUVELLE REGLE EXISTE  */11857   
           INJ             = 1             ;                            11858   
           INK             = 1             ;                            11859   
           DDTDUEB(1)      = SVG_DAECH     ;                            11860   
           CODECHE(1)      = CODECH        ;                            11861   
           CALL ENRICH                     ;                            11862   
           WS_FD_NBECH     = 1             ;                            11863   
           DEMAT_LIG.NBECH = 1             ;                            11864   
           SVG_AMTTC       = NETTC         ;                            11865   
           CALL ECRIT_DEMAT_LIG            ;                            11866   
           GO TO STPCHG                    ;                            11867   
           END;                                                         11868   
0                                         /*   LOGIQUE INCHANGEE      */11869   
        SELECT;                                                         11870   
          WHEN ( CODECH = 0 )                                           11871   
            DO ;                                                        11872   
              INJ = 1                      ;                            11873   
              INK = 1                      ;                            11874   
              DDTDUEB(1) = PDEMFA          ;                            11875   
              CODECHE(1) = CODECH          ;                            11876   
              CALL ENRICH                  ;                            11877   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   11878   
              SVG_DAECH       = PDEMFA     ;                            11879   
              WS_FD_NBECH     = 1          ;                            11880   
              DEMAT_LIG.NBECH = 1          ;                            11881   
              SVG_AMTTC       = NETTC      ;                            11882   
              CALL ECRIT_DEMAT_LIG         ;                            11883   
        /*-- --------------------------------- ----*/                   11884   
            END                          ;                              11885   
                                                                        11886   
1         /*********************************************************/   11887   
          /*  CODE ECHEANCE A CODE FIXE EXPORT      50 A 59        */   11888   
          /*  CODE ECHEANCE A CODE FIXE EXPORT 60 62 ET 70         */   11889   
          /*********************************************************/   11890   
                                                                        11891   
          WHEN ((CODECH < 60 & CODECH > 49)                             11892   
                 ! CODECH = 60 ! CODECH = 62  ! CODECH = 70 )           11893   
            DO  ;                                                       11894   
              CODECH_TRAV = CODECH - 50 ;                               11895   
              INJ = 1                              ;                    11896   
              INK = 1                              ;                    11897   
              MMDEMFA = (PDEMFA / 100) + CODECH_TRAV;                   11898   
              AADEMFA = (PDEMFA / 10000)           ;                    11899   
              IF MMDEMFA > 12                                           11900   
                THEN                                                    11901   
                   DO;                                                  11902   
                     IF MMDEMFA > 24                                    11903   
                       THEN                                             11904   
                          DO;                                           11905   
                            AADEMFA = AADEMFA + 2       ;               11906   
                            MMDEMFA = MMDEMFA - 24      ;               11907   
                          END;                                          11908   
                          ELSE                                          11909   
                             DO;                                        11910   
                               AADEMFA = AADEMFA + 1       ;            11911   
                               MMDEMFA = MMDEMFA - 12      ;            11912   
                             END            ;                           11913   
                   END;                                                 11914   
              ZDAT(2) = 28  ;                                           11915   
              IF MMDEMFA = 2                                            11916   
                THEN                                                    11917   
 /*  Y2K-OK-Y2K +++++++++++++++++++++++++++++++++++++++++++++*/         11918   
                    IF MOD (AADEMFA,4) = 0                              11919   
 /*                 IF MOD (AADEMFA,4) = 0 & (AADEMFA ^= 0)  */         11920   
 /*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/         11921   
                       THEN ZDAT(2) = 29  ;                             11922   
               DTDUEB = AADEMFA!!MMDEMFA!!ZDAT(MMDEMFA);                11923   
              /*       PUT SKIP LIST('DTDUEB AVANT= ' !! DTDUEB) */     11924   
                                                                        11925   
         /**************************************************/           11926   
         /* TENIR COMPTE DU NBJOU (NATCO)                  */           11927   
         /*   JNM LE 09.11 93                              */           11928   
         /**************************************************/           11929   
                      CALL MAJOR_NBJOU                        ;         11930   
                                                                        11931   
               DDTDUEB(1) = PDTDUEB                    ;                11932   
               CODECHE(1) = CODECH                     ;                11933   
               CALL ENRICH                          ;                   11934   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   11935   
               SVG_DAECH       = PDTDUEB    ;                           11936   
               WS_FD_NBECH     = 1          ;                           11937   
               DEMAT_LIG.NBECH = 1          ;                           11938   
               SVG_AMTTC       = NETTC      ;                           11939   
               CALL ECRIT_DEMAT_LIG         ;                           11940   
        /*-- --------------------------------- ----*/                   11941   
            END                   ;                                     11942   
                                                                        11943   
1         /*********************************************************/   11944   
          /*  CODE ECHEANCE A CODE FIXE DE 01   A 08               */   11945   
          /*********************************************************/   11946   
                                                                        11947   
          WHEN ( CODECH<9 & CODECH>0 )                                  11948   
            DO  ;                                                       11949   
               INJ = 1                              ;                   11950   
               INK = 1                              ;                   11951   
               MMDEMFA = (PDEMFA / 100) + CODECH    ;                   11952   
               AADEMFA = (PDEMFA / 10000)           ;                   11953   
               IF MMDEMFA > 12                                          11954   
                 THEN                                                   11955   
                   DO;                                                  11956   
                     AADEMFA = AADEMFA + 1       ;                      11957   
                     MMDEMFA = MMDEMFA - 12      ;                      11958   
                   END            ;                                     11959   
               ZDAT(2) = 28  ;                                          11960   
               IF MMDEMFA = 2                                           11961   
                  THEN                                                  11962   
 /*  Y2K-OK-Y2K +++++++++++++++++++++++++++++++++++++++++++++*/         11963   
                    IF MOD (AADEMFA,4) = 0                              11964   
 /*                 IF MOD (AADEMFA,4) = 0 & (AADEMFA ^= 0)  */         11965   
 /*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/         11966   
                        THEN ZDAT(2) = 29  ;                            11967   
               DTDUEB = AADEMFA!!MMDEMFA!!ZDAT(MMDEMFA);                11968   
              /*       PUT SKIP LIST('DTDUEB AVANT= ' !! DTDUEB) */     11969   
                                                                        11970   
         /**************************************************/           11971   
         /* TENIR COMPTE DU NBJOU (NATCO)                  */           11972   
         /*   JNM LE 09.11 93                              */           11973   
         /**************************************************/           11974   
                      CALL MAJOR_NBJOU                        ;         11975   
                                                                        11976   
               DDTDUEB(1) = PDTDUEB                    ;                11977   
               CODECHE(1) = CODECH                     ;                11978   
               CALL ENRICH                          ;                   11979   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   11980   
               SVG_DAECH       = PDTDUEB    ;                           11981   
               WS_FD_NBECH     = 1          ;                           11982   
               DEMAT_LIG.NBECH = 1          ;                           11983   
               SVG_AMTTC       = NETTC      ;                           11984   
               CALL ECRIT_DEMAT_LIG         ;                           11985   
        /*-- --------------------------------- ----*/                   11986   
            END                   ;                                     11987   
                                                                        11988   
1         /*********************************************************/   11989   
          /*  CODE ECHEANCE = 09 A FIXER                           */   11990   
          /*********************************************************/   11991   
                                                                        11992   
          WHEN (CODECH=09 ! CODECH=99)                                  11993   
            DO  ;                      /* A FIXER     */                11994   
               INJ = 1                              ;                   11995   
               INK = 1                              ;                   11996   
               DDTDUEB(1) = '999999'                ;                   11997   
               CODECHE(1) = CODECH                  ;                   11998   
               CALL ENRICH                          ;                   11999   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   12000   
               SVG_DAECH       = '999999'   ;                           12001   
               WS_FD_NBECH     = 1          ;                           12002   
               DEMAT_LIG.NBECH = 1          ;                           12003   
               SVG_AMTTC       = NETTC      ;                           12004   
               CALL ECRIT_DEMAT_LIG         ;                           12005   
        /*-- --------------------------------- ----*/                   12006   
               ZONCTL        = '** ECHEANCE A FIXER ' !!                12007   
                               CODECH !! ' FACT. NO.' !! WNUFAC !!      12008   
                               ' NUCLI. ' !! WTFAC.NUCLI;               12009   
               CALL MACMES3 (DESTI,'1',ZONCTL);                         12010   
             END                  ;                                     12011   
                                                                        12012   
          OTHERWISE                                                     12013   
            DO  ;                                                       12014   
                                                                        12015   
1      /*************************************************************/  12016   
       /*  CODE ECHEANCE DIFFERENT DE TOUS LES AUTRES DONC MULTIPLE */  12017   
       /*************************************************************/  12018   
                                                                        12019   
                                                                        12020   
        /* TEST D'EXISTANCE DU CODE ECHEANCE EN FCTION DE TABLE */      12021   
                                                                        12022   
 C :          DO INI = 1 TO (TBECHEB.INDCH)   ;                         12023   
                IF CODECH  = TECHEA(INI) THEN GOTO MULTIPLE ;           12024   
              END C                         ;                           12025   
                                                                        12026   
                /***************************************                12027   
                *  CODE ECHEA PIEDS NON TROUVE DS 1425 *                12028   
                ***************************************/                12029   
              INJ = 1                              ;                    12030   
              INK = 1                              ;                    12031   
              DDTDUEB(1) = '999999'                ;                    12032   
              CODECHE(1) = CODECH                  ;                    12033   
              CALL ENRICH                          ;                    12034   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   12035   
              SVG_DAECH       = '999999'   ;                            12036   
              WS_FD_NBECH     = 1          ;                            12037   
              DEMAT_LIG.NBECH = 1          ;                            12038   
              SVG_AMTTC       = NETTC      ;                            12039   
              CALL ECRIT_DEMAT_LIG         ;                            12040   
        /*-- --------------------------------- ----*/                   12041   
              ZONCTL        = '** CODE ECHEANCE INCONNU ' !!            12042   
                               CODECH !! ' FACT. NO.' !! WNUFAC !!      12043   
                               ' NUCLI. ' !! WTFAC.NUCLI;               12044   
              CALL MACMES3 (DESTI,'1',ZONCTL);                          12045   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   12046   
              GOTO STPCHG                  ;                            12047   
        /*-- --------------------------------- ----*/                   12048   
- MULTIPLE:   INK = 0                                              ;    12049   
              DO INJ = 1 TO 5 ;                                         12050   
                IF (TBECHEBC.NADE(INI,INJ) = '3' )                      12051   
                  THEN                                                  12052   
                    DO ;        /****************************           12053   
                                *  NATURE DE DELAI = 3 DANS *           12054   
                                *  UN CODE ECHEA MULTIPLE   *           12055   
                                *  CAS ANORMAL -> ANOMALIE  *           12056   
                                ****************************/           12057   
                       INJ = 1 ;                                        12058   
                       INK = 1 ;                                        12059   
                       DDTDUEB(1) = '999999';                           12060   
                       CODECHE(1) = CODECH                  ;           12061   
                       CALL ENRICH ;                                    12062   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   12063   
                       SVG_DAECH       = '999999'   ;                   12064   
                       WS_FD_NBECH     = 1          ;                   12065   
                       DEMAT_LIG.NBECH = 1          ;                   12066   
                       SVG_AMTTC       = NETTC      ;                   12067   
                       CALL ECRIT_DEMAT_LIG         ;                   12068   
        /*-- --------------------------------- ----*/                   12069   
                       ZONCTL        = '** ECHEA MULTIPLE ANOMALIE ' !! 12070   
                               CODECH !! ' FACT. NO.' !! WNUFAC !!      12071   
                               ' NUCLI. ' !! WTFAC.NUCLI;               12072   
                       CALL MACMES3 (DESTI,'1',ZONCTL);                 12073   
                    END;                                                12074   
              END                                                  ;    12075   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   12076   
        /*-- --------------------------------- ----*/                   12077   
                                                                        12078   
 D :        DO INJ = 1 TO 5 WHILE (TBECHEBC.NADE(INI,INJ) ^= ' ' );     12079   
                INK = INK + 1                                        ;  12080   
              END D                                                ;    12081   
 E :          DO INJ = 1 TO INK ;                                       12082   
                                                                        12083   
                               /********************************/       12084   
                               /*INK=NBRE ECHEANCES SI MULTIPLE*/       12085   
                               /*CODE DE LA TABLE = 1 =        */       12086   
                               /*DATE FIXE A IMPOSER POUR ECHEA*/       12087   
                               /********************************/       12088   
                                                                        12089   
                SELECT;                                                 12090   
                  WHEN ((TBECHEBC.NADE(INI,INJ)) = '1')                 12091   
                    DO;                                                 12092   
                      DTDUEB = SUBSTR(TPOSTEI.DLAI(INI,INJ),5,2) !!     12093   
                               SUBSTR(TPOSTEI.DLAI(INI,INJ),3,2) !!     12094   
                               SUBSTR(TPOSTEI.DLAI(INI,INJ),1,2) ;      12095   
                                                                        12096   
         /**************************************************/           12097   
         /* TENIR COMPTE DU NBJOU (NATCO)                  */           12098   
         /* SI JOUR ECHEANCE IMPOSEE EST FIN DE MOIS       */           12099   
         /*        ( FIN DE MOIS A PARTIR DU 28)           */           12100   
         /*   JNM LE 09.11 93                              */           12101   
         /**************************************************/           12102   
              IF SUBSTR(DTDUEB,5,2) > '27' THEN DO ;                    12103   
                 /*    PUT SKIP LIST('NADE=1' !! ' NUCLI= ' !!          12104   
                       WTCLI1.NUCLI !! ' NATCO= ' !! WTCLI1.NATCO) */   12105   
                 /*    PUT SKIP LIST('DTDUEB AVANT= ' !! DTDUEB) */     12106   
                      CALL MAJOR_NBJOU                        ;         12107   
                      END ;                                             12108   
                                                                        12109   
                      DDTDUEB(INJ) = PDTDUEB                  ;         12110   
                      CODECHE(INJ) = CODECH                   ;         12111   
                      CALL ENRICH                          ;            12112   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   12113   
                       SVG_DAECH       = PDTDUEB             ;          12114   
                       WS_FD_NBECH     = WS_FD_NBECH + 1     ;          12115   
                       IF INK > 1 THEN DO;                              12116   
                          DEMAT_LIG.NBECH = DEMAT_LIG.NBECH + 1 ;       12117   
                          DEMAT_LEC.GS.NULIG = DEMAT_LIG.GS.NULIG ;     12118   
                          DEMAT_LEC.ID.NULIG = DEMAT_LIG.GS.NULIG ;     12119   
                          CALL ECRIT_DEMAT_LEC               ;          12120   
                          END;          ELSE DO;                        12121   
                          CALL ECRIT_DEMAT_LIG               ;          12122   
                          END;                               ;          12123   
        /*-- --------------------------------- ----*/                   12124   
                    END                   ;                             12125   
                                                                        12126   
                                 /********************************/     12127   
                                 /*CODE DE LA TABLE = 2 =        */     12128   
                                 /*NBR DE JOUR POUR CALCUL ECHEA */     12129   
                                 /********************************/     12130   
                                                                        12131   
                  WHEN ((TBECHEBC.NADE(INI,INJ)) = '2')                 12132   
                    DO;                                                 12133   
                /*     PUT SKIP LIST('NADE=2' !! ' NUCLI= ' !!          12134   
                       WTCLI1.NUCLI !! ' NATCO= ' !! WTCLI1.NATCO) */   12135   
                       NBMOIS = ( DLAI(INI,INJ) / 1000 ) / 30 ;         12136   
                       MMDEMFA = (PDEMFA / 100) + NBMOIS    ;           12137   
                       AADEMFA = (PDEMFA / 10000)           ;           12138   
                       IF MMDEMFA > 12                                  12139   
                         THEN                                           12140   
                           DO;                                          12141   
                             AADEMFA = AADEMFA + 1       ;              12142   
                             MMDEMFA = MMDEMFA - 12      ;              12143   
                           END            ;                             12144   
                       ZDAT(2) = 28  ;                                  12145   
                       IF MMDEMFA = 2 THEN                              12146   
 /*  Y2K-OK-Y2K +++++++++++++++++++++++++++++++++++++++++++++*/         12147   
                    IF MOD (AADEMFA,4) = 0                              12148   
 /*                 IF MOD (AADEMFA,4) = 0 & (AADEMFA ^= 0)  */         12149   
 /*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/         12150   
                                                  THEN ZDAT(2) = 29  ;  12151   
                       DTDUEB = AADEMFA!!MMDEMFA!!ZDAT(MMDEMFA);        12152   
                                                                        12153   
         /**************************************************/           12154   
         /* TENIR COMPTE DU NBJOU (NATCO)                  */           12155   
         /*   JNM LE 09.11 93                              */           12156   
         /**************************************************/           12157   
                      CALL MAJOR_NBJOU                        ;         12158   
                                                                        12159   
                       DDTDUEB(INJ) = PDTDUEB                  ;        12160   
                       CODECHE(INJ) = CODECH                   ;        12161   
                       CALL ENRICH                          ;           12162   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   12163   
                       SVG_DAECH       = PDTDUEB             ;          12164   
                       WS_FD_NBECH     = WS_FD_NBECH + 1     ;          12165   
                       IF INK > 1 THEN DO;                              12166   
                          DEMAT_LIG.NBECH = DEMAT_LIG.NBECH + 1 ;       12167   
                          DEMAT_LEC.GS.NULIG = DEMAT_LIG.GS.NULIG ;     12168   
                          DEMAT_LEC.ID.NULIG = DEMAT_LIG.GS.NULIG ;     12169   
                          CALL ECRIT_DEMAT_LEC               ;          12170   
                          END;          ELSE DO;                        12171   
                          CALL ECRIT_DEMAT_LIG               ;          12172   
                          END;                               ;          12173   
        /*-- --------------------------------- ----*/                   12174   
                    END                   ;                             12175   
                  OTHERWISE                                             12176   
                    DO;                                                 12177   
               PUT SKIP LIST ('******************************');        12178   
               PUT SKIP LIST ('*** ATTENTION : ERREUR GRAVE  ');        12179   
               PUT SKIP LIST ('*** NADE DE TABLE ECHEANCE    ');        12180   
               PUT SKIP LIST ('*** INVALIDE ...              ');        12181   
               PUT SKIP LIST ('*** NADE : ' !! TBECHEBC.NADE(INI,INJ)); 12182   
               PUT SKIP LIST ('******************************');        12183   
                        SIGNAL ERROR ;                                  12184   
                    END;                                                12185   
                END;                      /*   FIN SELECT             */12186   
              END;                        /*   FIN BOUCLE DO INJ      */12187   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   12188   
              IF WS_FD_NBECH > 1 & DEMAT_LIG.TYPRO ^= 'C'               12189   
                THEN DO ;                                               12190   
                 SVG_DAECH = ''                  ;                      12191   
                 SVG_AMTTC = 0                   ;                      12192   
                 CALL ECRIT_DEMAT_LIG            ;                      12193   
              END                                ;                      12194   
        /*-- ----------------------------------- --*/                   12195   
            END;                                                        12196   
         END;                                                           12197   
  STPCHG:                                                               12198   
 END STEP_CHARGE;                                                       12199   
1   ECHEA_NBJOU:         PROCEDURE;                                     12200   
           /*                                                           12201   
                    **************************************              12202   
                    *                                    *              12203   
                    *    GESTION DU NBJOUR               *              12204   
                    *    ANNULE TOUS LES AUTRES MODES    *              12205   
                    *    DE CALCUL DE L ECHEANCE         *              12206   
                    *    EN ENTREE TBECHEA               *              12207   
                    *       SVG_DAECH A FIN DE MOIS      *              12208   
                    *                                    *              12209   
                    **************************************              12210   
           */                                                           12211   
0      ECHEA_NBJOU_D:                                                   12212   
           DO INI = 1 TO TBECHEB.INDCH;   /*   RECH CODE ECHEANCE     */12213   
              IF CODECH = TBECHEBC.TECHEA(INI)                          12214   
                 THEN GO TO ECHEA_NBJOU_S ;                             12215   
              END;                                                      12216   
           SVG_DAECH      = '' ;          /*   CODE ECHEANCE  INCONNU */12217   
           GO TO ECHEA_NBJOU_F ;                                        12218   
0      ECHEA_NBJOU_S:                                                   12219   
           IF TBECHEBC.NBJOU(INI) = ' '   /*   NBJOU NON NUMERIQUE    */12220   
            ! VERIFY(TBECHEBC.NBJOU(INI),'0123456789') ^= 0             12221   
              THEN DO;                                                  12222   
              SVG_DAECH   = '' ;                                        12223   
              GO TO ECHEA_NBJOU_F ;                                     12224   
              END;                                                      12225   
0                                         /*   POSITIONNEMENT FIN MOIS*/12226   
           MMDEMFA        = PDEMFA / 100   ;                            12227   
           AADEMFA        = PDEMFA / 10000 ;                            12228   
           IF MOD (AADEMFA,4) = 0                                       12229   
              THEN ZDAT(2) = 29  ;                                      12230   
           SVG_DAECH      = AADEMFA !! MMDEMFA !! ZDAT(MMDEMFA);        12231   
0                                         /*   NOUVELLE LOGIQUE NB JOU*/12232   
           NBJOU_CHAR     = TBECHEBC.NBJOU(INI);                        12233   
           NBMOIS_PIC     = NBJOU_PIC  / 30 ;                           12234   
           NBANNE_PIC     = NBMOIS_PIC / 12 ;                           12235   
           IF NBANNE_PIC ^= 0 THEN DO;                                  12236   
              AA_DAECH    = AA_DAECH   + NBANNE_PIC;                    12237   
              NBMOIS_PIC  = NBMOIS_PIC - (NBANNE_PIC * 12);             12238   
              END;                                                      12239   
           IF NBMOIS_PIC ^= 0 THEN DO;                                  12240   
              MM_DAECH    = MM_DAECH   + NBMOIS_PIC;                    12241   
              IF MM_DAECH > 12 THEN DO;                                 12242   
                 AA_DAECH = AA_DAECH   + 1;                             12243   
                 MM_DAECH = MM_DAECH   - 12;                            12244   
                 END;                                                   12245   
              END;                                                      12246   
                                          /*   NBRE JOUR RESTANT      */12247   
           NBJOU_PIC      = NBJOU_PIC  - (NBANNE_PIC * 12 * 30)         12248   
                            - (NBMOIS_PIC * 30);                        12249   
           IF NBJOU_PIC  ^= 0 THEN DO;                                  12250   
              MM_DAECH    = MM_DAECH + 1;                               12251   
              IF MM_DAECH > 12 THEN DO;                                 12252   
                 AA_DAECH = AA_DAECH + 1;                               12253   
                 MM_DAECH = MM_DAECH - 12;                              12254   
                 END;                                                   12255   
              JJ_DAECH    = NBJOU_PIC;                                  12256   
              END;                                                      12257   
  /*                                                                    12258   
   PUT SKIP LIST ('*** ECH AS=' !!                                      12259   
                           AADEMFA !! MMDEMFA !! ZDAT(MMDEMFA) !!       12260   
                  ' N=' !! TBECHEBC.NBJOU(INI) !!                       12261   
                  ' J=' !! NBJOU_PIC         !!                         12262   
                  ' M=' !! NBMOIS_PIC        !!                         12263   
                  ' A=' !! NBANNE_PIC        !!                         12264   
                  ' D=' !! SVG_DAECH         );                         12265   
  */                                                                    12266   
0      ECHEA_NBJOU_F:                                                   12267   
           END ECHEA_NBJOU;                                             12268   
                                                                        12269   
 STEP_INIT : PROC REORDER;                                              12270   
                                                                        12271   
              /*********************************/                       12272   
              /*�    AJOUT INIT 20/01/2016 YCH */                       12273   
              /*********************************/                       12274   
                                                                        12275   
               TABZ.WZ_DAECH(*) = '' ;                                  12276   
               TABZ.WZ_MTECH(*) = (0);                                  12277   
                                                                        12278   
                                                                        12279   
              /*********************************/                       12280   
              /*         TRAITEMENT TABLE 1425 */                       12281   
              /*********************************/                       12282   
                                                                        12283   
        TBECHEB = TABREF3, BY NAME ;                                    12284   
        TBECHEB.NUTAB = 1425 ;                                          12285   
        CALL CHTBOP3(TBECHEB) ;                                         12286   
        IF TBECHEB.CODER ^= 0                                           12287   
         THEN                                                           12288   
           DO ;                                                         12289   
             DISPLAY('ERREUR OUVERTURE TABLE 1425') ;                   12290   
             SIGNAL ERROR ;                                             12291   
           END ;                                                        12292   
        ALLOC TBECHEBC;                                                 12293   
        TBECHEB.LGMAX = 79*(TBECHEB.INDCH+1) ;                          12294   
        CALL CHTBGB3(TBECHEB,TBECHEBC) ;                                12295   
        IF TBECHEB.CODER ^= 0                                           12296   
          THEN                                                          12297   
            DO ;                                                        12298   
              ZONCTL        = '** ERREUR CHARGEMENT 1425 ';             12299   
              CALL MACMES3 (DESTI,'1',ZONCTL);                          12300   
              DISPLAY ('ERREUR CHARGEMENT TABLE 1425') ;                12301   
              SIGNAL ERROR ;                                            12302   
            END ;                                                       12303   
0                                                                       12304   
        TBNUEDIF           = TABREF3, BY NAME;                          12305   
        TBNUEDIF.NUTAB     = 1305;                                      12306   
        CALL CHTBOP3 (TBNUEDIF);                                        12307   
        IF TBNUEDIF.CODER ^= 0 THEN DO ;                                12308   
           ZONCTL          = 'ANOTB=TBNUEDI ';                          12309   
           CALL MACMES3 (DESTI,'1',ZONCTL);                             12310   
           SIGNAL ERROR;                                                12311   
           END;                                                         12312   
        ALLOC TBNUEDIC;                                                 12313   
        PDNUEDI            = ADDR (TBNUEDIC);                           12314   
        TBNUEDIF.LGMAX     = 18 * (TBNUEDIF.INDCH + 1);                 12315   
        CALL CHTBGB3 (TBNUEDIF,TBNUEDIT);                               12316   
        IF TBNUEDIF.CODER ^= 0 THEN DO;                                 12317   
           CALL MACMES3 (DESTI,'4','ANOTB=NUEDI',TBNUEDIF);             12318   
           SIGNAL ERROR;                                                12319   
           END;                                                         12320   
  END STEP_INIT                                     ;                   12321   
                                                                        12322   
1               /**************************                             12323   
                *  ROUTINE ENRICHISSEMENT *                             12324   
                **************************/                             12325   
                                                                        12326   
- ENRICH : PROC                                       ;                 12327   
           RECLIN0 = '0'                              ;                 12328   
           RECLIN1 = INJ                              ;                 12329   
           RECLIN2 = INK                              ;                 12330   
 S1 :      SELECT (DIVIDE(INJ+INK,2.0,2,1))           ;                 12331   
           WHEN (1) DO    ;      /* INJ = INK = 1 FIRST & SEUL ENRE.*/  12332   
                      AMTTC(1) = NETTC                ;                 12333   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   12334   
                      SVG_AMTTC = AMTTC(1)         ;                    12335   
        /*-- ----------------------------------- --*/                   12336   
                     END                              ;                 12337   
           WHEN (INK) DO  ;       /* INJ = INK DERNIER ENREGIST. */     12338   
                      AMTTC(INJ) = NETTC - NETCAGR    ;                 12339   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   12340   
                      SVG_AMTTC = AMTTC(INJ)       ;                    12341   
        /*-- ----------------------------------- --*/                   12342   
                     END                              ;                 12343   
           OTHERWISE  DO  ;             /* AUTRES ENREGST */            12344   
                        AMTTC(INJ) = (NETTC * FRAC(INI,INJ)) / 100    ; 12345   
                        NETCAGR = NETCAGR + AMTTC(INJ) ;                12346   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   12347   
                        SVG_AMTTC = AMTTC(INJ)       ;                  12348   
        /*-- ----------------------------------- --*/                   12349   
                     END                              ;                 12350   
    END S1                           ;                                  12351   
                                                                        12352   
  END ENRICH                                          ;                 12353   
                                                                        12354   
                                                                        12355   
 CHARGEMENT_TAB : PROC;                                                 12356   
              INI = 1;                                                  12357   
              INJ = 1;                                                  12358   
              INK = 0;                                                  12359   
              INH = 0;                                                  12360   
 DEB :        DO INJ = 1 TO 5 WHILE (T.DDTDUEB(INJ) ^= '000000' );      12361   
                INK = INK + 1                                        ;  12362   
              END DEB;                                             ;    12363   
                                                                        12364   
 DEB1 :       DO INI = 1 TO 100 WHILE (TABE.WS_DAECH(INI) ^= '' );      12365   
                INH = INH + 1                                        ;  12366   
              END DEB1;                                            ;    12367   
                                                                        12368   
 SUITE :      DO INI = 1 TO INK ;                                       12369   
                   TROUVE = '0'B;                                       12370   
                   DO INJ = 1 TO INH  WHILE (^TROUVE);                  12371   
                     IF ( DDTDUEB(INI) = TABE.WS_DAECH(INJ) &           12372   
                          CODECHE(INI) = TABE.WS_ECHEA(INJ) )           12373   
                          THEN TROUVE = '1'B;                           12374   
                   END;                                                 12375   
                   IF (^TROUVE)                                         12376   
                     THEN                                               12377   
                       CALL CREER_ENREG_TAB;                            12378   
                   ELSE                                                 12379   
                       CALL CUMULER_ENREG_TAB;                          12380   
              END;                                                      12381   
    END CHARGEMENT_TAB;                                                 12382   
                                                                        12383   
 CREER_ENREG_TAB : PROC;                                                12384   
                                                                        12385   
           INJ = INJ + 1;                                               12386   
           INH = INH + 1;                                               12387   
           IF INH = 1                                                   12388   
             THEN DO;                                                   12389   
               TABE.WS_DAECH(1) = DDTDUEB(INI);                         12390   
               TABE.WS_ECHEA(1) = CODECHE(INI);                         12391   
               TABE.WS_MTECH(1) = AMTTC(INI);                           12392   
             END;                                                       12393   
           ELSE                                                         12394   
             DO;                                                        12395   
               TABE.WS_DAECH(INJ-1) = DDTDUEB(INI);                     12396   
               TABE.WS_ECHEA(INJ-1) = CODECHE(INI);                     12397   
               TABE.WS_MTECH(INJ-1) = AMTTC(INI);                       12398   
             END;                                                       12399   
       END CREER_ENREG_TAB;                                             12400   
                                                                        12401   
 CUMULER_ENREG_TAB : PROC;                                              12402   
           TABE.WS_DAECH(INJ-1) = DDTDUEB(INI);                         12403   
           TABE.WS_ECHEA(INJ-1) = CODECHE(INI);                         12404   
           TABE.WS_MTECH(INJ-1) = TABE.WS_MTECH(INJ-1) + AMTTC(INI);    12405   
       END CUMULER_ENREG_TAB;                                           12406   
                                                                        12407   
 ECRITURE_TAB : PROC;                                                   12408   
                                                                        12409   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            12410   
                    TOP_DEMA_ECR = 'N' ;                                12411   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            12412   
           TOP_DEMA_FAC   = SVG_DEMA_FAC;                               12413   
           IF (FACT.LIGNE + 4) > NLMAX_3 THEN CALL ENTCDL;              12414   
           TOTAL14        = ' ';                                        12415   
         /*FINFAC3.FIL01  = ((175)'-')  YDV*/                           12416   
           IF WTFAC.EDIPA = '2'                                         12417   
              THEN FINFAC3.FIL01  = ((119)'-');                         12418   
              ELSE FINFAC3.FIL01  = ((119)'-');                         12419   
           STRING(ZSPOOLP_SVG) = TOTAL14; CALL ECRITUR;                 12420   
           FINFAC4.FIL01  = ((132)' ');                                 12421   
           STRING(ZSPOOLP_SVG) = TOTAL14; CALL ECRITUR;                 12422   
           FINFAC5.FIL01  = ((25)' ');                                  12423   
           FINFAC5.FIL02  =  ('****  DETAIL DES ECHEANCES  ****') ;     12424   
           STRING(ZSPOOLP_SVG) = TOTAL14; CALL ECRITUR;                 12425   
           FINFAC4.FIL01  = ((132)' ');                                 12426   
           STRING(ZSPOOLP_SVG) = TOTAL14; CALL ECRITUR;                 12427   
           FACT.LIGNE          = FACT.LIGNE + 4;                        12428   
           INJ = (0);                                                   12429   
           DO INI = 1 TO 100 WHILE (TABE.WS_DAECH(INI) ^= '' );         12430   
              INJ = INJ + 1;                                            12431   
           END;                                                         12432   
                                                                        12433   
           WS_CUMECH = '0';                                             12434   
        /* DO INI = 1 TO INJ UNTIL (INI > INJ)  */                      12435   
           DO INI = 1 TO INJ;                                           12436   
                   RECHERCHE = '0'B;                                    12437   
                   WS_CUMECH = (0);                                     12438   
                   DO INK = INI TO INJ  WHILE (^RECHERCHE);             12439   
                     IF TABE.WS_DAECH(INI) = TABE.WS_DAECH(INK)         12440   
                        THEN DO;                                        12441   
                          WS_CUMECH = WS_CUMECH + TABE.WS_MTECH(INK);   12442   
                        END;                                            12443   
                     ELSE                                               12444   
                          RECHERCHE = '1'B;                             12445   
                   END;                                                 12446   
                   INL = INI;                                           12447   
                   IF RECHERCHE                                         12448   
                      THEN DO;                                          12449   
                         IF INK > 2 THEN                                12450   
                            INI = (INK-2);                              12451   
                         ELSE                                           12452   
                           INI = INK;                                   12453   
                      END;                                              12454   
                   ELSE                                                 12455   
                      DO;                                               12456   
                        IF INK > 1 THEN                                 12457   
                           INI = (INK-1);                               12458   
                         ELSE                                           12459   
                           INI = INK;                                   12460   
                      END;                                              12461   
                   IF WS_CUMECH = TABE.WS_MTECH(INI)                    12462   
                    THEN DO;                                            12463   
                       CALL ECRITURE_DEBUT;                             12464   
                    END;                                                12465   
                   ELSE                                                 12466   
                     DO INH = INL TO INJ WHILE                          12467   
                       ( TABE.WS_DAECH(INH) = TABE.WS_DAECH(INI) );     12468   
                       IF TABE.WS_DAECH(INI) = '999999'                 12469   
                          THEN DO;                                      12470   
                            IF WS_CUMECH ^= 0                           12471   
                               THEN CALL ECRITURE_LIGNE;                12472   
                          END;                                          12473   
                       ELSE                                             12474   
                           CALL ECRITURE_LIGNE;                         12475   
                     END;                                               12476   
           END;                                                         12477   
                                                                        12478   
     /*-----------------------------------------------*/                12479   
     /*  CHARGEMENT TABLE PIED DE FACTURE             */                12480   
     /*  CHARGEMENT POUR EDITION 8 POSTES             */                12481   
     /*      MODIF JNM DU 09.11.93                    */                12482   
     /*-----------------------------------------------*/                12483   
           TABX.WX_DAECH(*) = '' ;                                      12484   
           TABX.WX_ECHEA(*) = '' ;                                      12485   
           TABX.WX_MTECH(*) = (0);                                      12486   
           WX_TAECH = WS_TAECH   ;                                      12487   
                                                                        12488   
           TABZ.WZ_DAECH(*) = '' ;                                      12489   
           TABZ.WZ_MTECH(*) = (0);                                      12490   
                                                                        12491   
           INH = (0);                                                   12492   
           DO INI = 1 TO 100 WHILE (TABE.WS_DAECH(INI) ^= '' );         12493   
              INH = INH + 1;                                            12494   
           END;                                                         12495   
           INZ    = 1  ;                                                12496   
           IZ     = 0  ;                                                12497   
    INCRE00 :                                                           12498   
           IZ    = IZ + 1 ;                                             12499   
           IF      IZ > 8 THEN GOTO INCRFIN ;                           12500   
           ZZ_DAT = TABX.WX_DAECH(INZ) ;                                12501   
           IF ZZ_DAT = '' THEN GOTO INCRFIN ;                           12502   
           TABZ.WZ_DAECH(IZ) = ZZ_DAT ;                                 12503   
           TABZ.WZ_MTECH(IZ) = TABX.WX_MTECH(INZ) ;                     12504   
    INCRE01 :                                                           12505   
           INZ    = INZ + 1 ;                                           12506   
           IF ZZ_DAT = TABX.WX_DAECH(INZ) THEN DO ;                     12507   
           TABZ.WZ_MTECH(IZ) =                                          12508   
           TABZ.WZ_MTECH(IZ) + TABX.WX_MTECH(INZ) ;                     12509   
           GO TO INCRE01 ;                                              12510   
           END ;                                                        12511   
           GO TO INCRE00 ;                                              12512   
    INCRFIN :                                                           12513   
                                                                        12514   
           TABE.WS_DAECH(*) = '' ;                                      12515   
           TABE.WS_ECHEA(*) = '' ;                                      12516   
           TABE.WS_MTECH(*) = (0);                                      12517   
       END ECRITURE_TAB;                                                12518   
                                                                        12519   
                                                                        12520   
 TRI_TAB : PROC;                                                        12521   
                                                                        12522   
           INH = (0);                                                   12523   
           DO INI = 1 TO 100 WHILE (TABE.WS_DAECH(INI) ^= '' );         12524   
              INH = INH + 1;                                            12525   
           END;                                                         12526   
                                                                        12527   
           DO INI = 1 TO (INH - 1);                                     12528   
              DO INJ = (INI + 1) TO INH;                                12529   
  /* Y2K-OK-Y2KOK  Y2KCOMP  ++++++++++++++++++++++++++++++++++++++*/    12530   
           Y2K_DECENNIE = '' ;                                          12531   
           Y2K_POSDE(1) = 1  ;                                          12532   
           Y2K_ARGUM1 = TABE.WS_DAECH(INI);                             12533   
           Y2K_ARGUM2 = TABE.WS_DAECH(INJ);                             12534   
           CALL Y2KCOMP1 ;      /*          Y2K_RESULT1           */    12535   
           IF Y2K_RESULT1>0 !                                           12536   
             (Y2K_RESULT1=0 & TABE.WS_ECHEA(INI) > TABE.WS_ECHEA(INJ))  12537   
  /*            IF ( TABE.WS_DAECH(INI) > TABE.WS_DAECH(INJ) ) !  */    12538   
  /*               ( TABE.WS_DAECH(INI) = TABE.WS_DAECH(INJ) &    */    12539   
  /*                 TABE.WS_ECHEA(INI) > TABE.WS_ECHEA(INJ) )    */    12540   
  /*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/    12541   
                   THEN DO;                                             12542   
                     WS_POSTE  =  TABE(INI);                            12543   
                     TABE(INI) =  TABE(INJ);                            12544   
                     TABE(INJ) =  WS_POSTE;                             12545   
                   END;                                                 12546   
              END;                                                      12547   
           END;                                                         12548   
       END TRI_TAB;                                                     12549   
                                                                        12550   
 ECRITURE_DEBUT : PROC;                                                 12551   
              TOTAL14        = ' ';                                     12552   
              FINFAC2.LIBEL1     = 'ECHEANCE ';                         12553   
              FINFAC2.MTECH1     = WS_CUMECH;                           12554   
              IF TABE.WS_DAECH(INI) ^= '999999'                         12555   
              THEN DO;                                                  12556   
                  FINFAC2.DAECH1.JJ  = SUBSTR(TABE.WS_DAECH(INI),5,2);  12557   
                  FINFAC2.DAECH1.MM  = SUBSTR(TABE.WS_DAECH(INI),3,2);  12558   
                  FINFAC2.DAECH1.AA  = SUBSTR(TABE.WS_DAECH(INI),1,2);  12559   
                  FINFAC2.FIL05      = '/';                             12560   
                  FINFAC2.FIL06      = '/';                             12561   
                  DO INM = 1 TO 100 WHILE ( TABE.WS_ECHEA(INI) ^=       12562   
                                           TBECHEBC.TECHEA(INM));       12563   
                  END;                                                  12564   
                  IF TABE.WS_ECHEA(INI) < '50'                          12565   
                   THEN DO;                                             12566   
                    FINFAC1.ECHEA1     = TABE.WS_ECHEA(INI);            12567   
                    FINFAC1.ECHEAL1    = '-';                           12568   
                  END;                                                  12569   
                  FINFAC2.ECHEAL2    =                                  12570   
                  TBECHEBC.TFILLE2(INM);                                12571   
              END;                                                      12572   
              IF FACT.LIGNE       > NLMAX_2 THEN CALL ENTCDL;           12573   
              FACT.LIGNE             = FACT.LIGNE + 1;                  12574   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            12575   
                    TOP_DEMA_ECR = 'N' ;                                12576   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            12577   
              STRING(ZSPOOLP_SVG) = TOTAL14; CALL ECRITUR;              12578   
                                                                        12579   
           END ECRITURE_DEBUT;                                          12580   
                                                                        12581   
 ECRITURE_LIGNE : PROC;                                                 12582   
                                                                        12583   
            TOTAL14        = ' ';                                       12584   
            IF WS_CUMECH ^= 0                                           12585   
              THEN DO;                                                  12586   
                FINFAC1.MTECH1     = WS_CUMECH;                         12587   
                WS_CUMECH          = (0);                               12588   
                FINFAC1.LIBEL1     = 'ECHEANCE ';                       12589   
                IF TABE.WS_DAECH(INH) ^= '999999'                       12590   
                 THEN DO;                                               12591   
                  FINFAC1.DAECH1.JJ  = SUBSTR(TABE.WS_DAECH(INH),5,2);  12592   
                  FINFAC1.DAECH1.MM  = SUBSTR(TABE.WS_DAECH(INH),3,2);  12593   
                  FINFAC1.DAECH1.AA  = SUBSTR(TABE.WS_DAECH(INH),1,2);  12594   
                  FINFAC1.FIL05      = '/';                             12595   
                  FINFAC1.FIL06      = '/';                             12596   
                 END;                                                   12597   
              END;                                                      12598   
                                                                        12599   
              IF TABE.WS_DAECH(INH) ^= '999999'                         12600   
              THEN DO;                                                  12601   
                 FINFAC1.MTECH2     = TABE.WS_MTECH(INH);               12602   
                 DO INM = 1 TO 100 WHILE ( TABE.WS_ECHEA(INH) ^=        12603   
                                         TBECHEBC.TECHEA(INM));         12604   
                 END;                                                   12605   
                 IF TABE.WS_ECHEA(INH) < '50'                           12606   
                   THEN DO;                                             12607   
                     FINFAC1.ECHEA1     = TABE.WS_ECHEA(INH);           12608   
                     FINFAC1.ECHEAL1    = '-';                          12609   
                   END;                                                 12610   
                 FINFAC1.ECHEAL2    = TBECHEBC.TFILLE2(INM);            12611   
              END;                                                      12612   
              IF FACT.LIGNE       > NLMAX_2 THEN CALL ENTCDL;           12613   
              FACT.LIGNE             = FACT.LIGNE + 1;                  12614   
                    /*-- FACT DEMAT SMARTIN 29/12/2004  --*/            12615   
                    TOP_DEMA_ECR = 'N' ;                                12616   
                    /*-- FACT DEMAT FIN     29/12/2004  --*/            12617   
              STRING(ZSPOOLP_SVG) = TOTAL14; CALL ECRITUR;              12618   
                                                                        12619   
           END ECRITURE_LIGNE;                                          12620   
                                                                        12621   
 MAJOR_NBJOU : PROC;                                                    12622   
            IF WTCLI1.NATCO > '00' THEN DO ;                            12623   
            XNBJOUR = WTCLI1.NATCO ;                                    12624   
            ZTDUEB  = DTDUEB      ;                                     12625   
            MO_WTDUEB = MO_WTDUEB + 1 ;                                 12626   
            IF MO_WTDUEB > 12 THEN DO ;                                 12627   
            MO_WTDUEB = 01     ;                                        12628   
            AN_WTDUEB = AN_WTDUEB + 1 ;                                 12629   
            END ;                                                       12630   
            JR_WTDUEB = WNBJOUR ;                                       12631   
            DTDUEB  = ZTDUEB      ;                                     12632   
            END ;                                                       12633   
           END MAJOR_NBJOU   ;                                          12634   
1      /**************************************************************/ 12635   
       /* RECHERCHE SI LA COLLECTION APPARTIENT A LA FOURCHETTE       */12636   
       /* EDITEUR/DIVISION/COLLECTION DE LA TABLE TBACCORD            */12637   
       /* SI OUI, CUMUL DANS UN TABLEAU SUR LE NUMERO ACCORD          */12638   
       /* SI NON, CUMUL DES PRODUITS AUTRES SUR DES VARIABLES SIMPLES */12639   
       /**************************************************************/ 12640   
 STOCKAGE_ACCORD : PROC;                                                12641   
            IF WTFAC.TYREF ^= '3' THEN DO;                              12642   
0           SIGNE  =  1 ;/* SIGNER LES MONTANTS POUR HISTORIQUE ACCORD*/12643   
            IF WTFAC.TRACO = '4' THEN DO;                               12644   
               IF SUBSTR(WTFAC.NATOP,1,1) = '5'                         12645   
                  THEN SIGNE  = - 1;                                    12646   
               END;                      ELSE DO;                       12647   
               IF SUBSTR(WTFAC.NATOP,1,1) = '3'                         12648   
                  THEN SIGNE  = - 1 ;                                   12649   
                  ELSE DO;                                              12650   
                  IF WTFAC.CATLI ^= ' '  &                              12651   
                     WTFAC.CATLI ^= '2'                                 12652   
                     THEN SIGNE   = 1  ;                                12653   
                  END;                                                  12654   
               END;                                                     12655   
            /* RECUPERATION VIA LES PICTURES D'EDITION */               12656   
              WS_ACC.QTE   = SIGNE * LIGNE1.QUANT;                      12657   
              IF PRIBBCHAR ='********' ! PRIBBCHAR = ' '                12658   
                 THEN WS_ACC.FORTC = SVG_PRIBB;                         12659   
                 ELSE WS_ACC.FORTC = LIGNE1.PRIBB;                      12660   
              WS_ACC.FORTC = WS_ACC.FORTC * WS_ACC.QTE;                 12661   
              WS_ACC.FORHT = LIGNE1.PIPUB;                              12662   
              WS_ACC.FORHT = WS_ACC.FORHT * WS_ACC.QTE;                 12663   
              IF LIGNE1.NETHT ^= 0 THEN DO; /* CALCUL DU NETTC */       12664   
                 IF COLIS.TETE = '1' THEN DO; /* COLIS SUM */           12665   
                    WS_ACC.NETTC = SIGNE * (LIGNE1.NETHT + COLIS.TAXLI);12666   
                    END;                 ELSE DO;                       12667   
                 IF SUM.NBMVT = 0 THEN DO; /* ARTICLE SIMPLE */         12668   
                    WS_ACC.NETTC = SIGNE * (LIGNE1.NETHT + WTFAC.TAXLI);12669   
                    END;              ELSE DO; /* NON COLIS SUM */      12670   
                     WS_ACC.NETTC = SIGNE * (LIGNE1.NETHT + SUM.TAXLI); 12671   
                                      END;                              12672   
                    END;                                                12673   
                 END;                    ELSE DO;                       12674   
                 WS_ACC.NETTC = 0 ; /* CAS ARTICLE S/2 LIGNES */        12675   
                 END;                                                   12676   
              WS_ACC.NETHT = SIGNE * LIGNE1.NETHT;                      12677   
                                                                        12678   
              IF PROD_AUTRE = 'OUI' THEN DO;                            12679   
                WS_ACC.AUT_FORTC = WS_ACC.AUT_FORTC + WS_ACC.FORTC;     12680   
                WS_ACC.AUT_FORHT = WS_ACC.AUT_FORHT + WS_ACC.FORHT;     12681   
                WS_ACC.AUT_NETTC = WS_ACC.AUT_NETTC + WS_ACC.NETTC;     12682   
                WS_ACC.AUT_NETHT = WS_ACC.AUT_NETHT + WS_ACC.NETHT;     12683   
                END;                                                    12684   
                                                                        12685   
              ELSE DO; /* RECHERCHER UN ACCORD SAUVE DS TABLEAU  */     12686   
                BCL1:                                                   12687   
                DO I = 1 TO MAX_ACCORD WHILE (ACC1.CODE(I) ^= '');      12688   
                   IF ACC1.CODE(I) = ACC_LIGNE                          12689   
                                       THEN LEAVE BCL1;                 12690   
                END BCL1;                                               12691   
                             /* GESTION TABLEAU PLEIN */                12692   
                IF I > MAX_ACCORD THEN CALL DEP_CAPAC;                  12693   
                    /* NOUVEAU CODE ACCORD */                           12694   
                IF ACC1.CODE(I) = '' THEN DO;                           12695   
                   ACC1.CODE(I) = ACC_LIGNE;                            12696   
                   NB_LIGNE_ACC = NB_LIGNE_ACC + 1;                     12697   
                   END;                                                 12698   
                ACC1.FORTC(I) = ACC1.FORTC(I) + WS_ACC.FORTC;           12699   
                ACC1.FORHT(I) = ACC1.FORHT(I) + WS_ACC.FORHT;           12700   
                ACC1.NETTC(I) = ACC1.NETTC(I) + WS_ACC.NETTC;           12701   
                ACC1.NETHT(I) = ACC1.NETHT(I) + WS_ACC.NETHT;           12702   
              END; /* FIN SI PRODUIT ACCORD AUTRE */                    12703   
            END; /* FIN SI LIGNE ^= FRAIS PORT */                       12704   
          END STOCKAGE_ACCORD;                                          12705   
       /**************************************************************/ 12706   
       /* COPIER LE TABLEAU ACCORD PLEIN DANS UN TABLEAU TAMPON,     */ 12707   
       /* ALLOUER UN NOUVEAU TABLEAU ACCORD 2 X PLUS GRAND,          */ 12708   
       /* COPIER LE TABLEAU TAMPON DANS LE TABLEAU ACCORD            */ 12709   
       /**************************************************************/ 12710   
 DEP_CAPAC : PROC;                                                      12711   
         ALLOCATE TBL_ACCORD2;                                          12712   
         PTACCORD2 = ADDR(TBL_ACCORD2(1));                              12713   
         TBL_ACCORD2(*) = TBL_ACCORD1(*);                               12714   
         FREE TBL_ACCORD1;                                              12715   
         MAX_ACCORD = MAX_ACCORD * 2;                                   12716   
         ALLOCATE TBL_ACCORD1;                                          12717   
         PTACCORD1 = ADDR(TBL_ACCORD1(1));                              12718   
         TBL_ACCORD1(*) = '';                                           12719   
         DO I = 1 TO (MAX_ACCORD / 2 );                                 12720   
           ACC1(I) = ACC2(I), BY NAME;                                  12721   
         END;                                                           12722   
         FREE TBL_ACCORD2;                                              12723   
       END DEP_CAPAC;                                                   12724   
                                                                        12725   
1      /**************************************************************/ 12726   
       /* INITIALISER LES LIGNES DU CADRE DES CUMULS S/ACCORD        */ 12727   
       /**************************************************************/ 12728   
 INIT_CDRE_ACCORD : PROC ;                                              12729   
                                                                        12730   
       CDRE_ACC1 =((115)'6');                                           12731   
       CDRE_ACC1.SAUT = '-';                                            12732   
       CDRE_ACC1.POLIC = '02'X;                                         12733   
       CDRE_ACC1.FIL1  = ' ';                                           12734   
       CDRE_ACC1.TRT1  = 'W';                                           12735   
       CDRE_ACC1.TRT2  = '1';                                           12736   
       CDRE_ACC1.TRT3  = '1';                                           12737   
       CDRE_ACC1.TRT4  = '1';                                           12738   
       CDRE_ACC1.TRT5  = '1'; /*YDV*/                                   12739   
       CDRE_ACC1.TRT7  = '1';                                           12740   
       CDRE_ACC1.TRT8  = 'X';                                           12741   
       CDRE_ACC1.FIL4  = ' ';                                           12742   
                                                                        12743   
       CDRE_ACC2.SAUT = ' ';                                            12744   
       CDRE_ACC2.POLIC  = '00'X;                                        12745   
       CDRE_ACC2.C_ACCORD  = '   N. FOURNISSEUR';                       12746   
       CDRE_ACC2.LIBEL  = ' EDITEUR';                                   12747   
       CDRE_ACC2.FORTC  = '   FORTC';                                   12748   
       CDRE_ACC2.FORHT  = '   FORHT';                                   12749   
       CDRE_ACC2.NETTC  = '   NETTC';                                   12750   
       CDRE_ACC2.NETHT  = '   NETHT';                                   12751   
                                                                        12752   
       CDRE_ACC3 = ((115)'6');                                          12753   
       CDRE_ACC3.SAUT = ' ';                                            12754   
       CDRE_ACC3.POLIC = '02'X;                                         12755   
       CDRE_ACC3.FIL1  = ' ';                                           12756   
       CDRE_ACC3.TRT1  = '3';                                           12757   
       CDRE_ACC3.TRT2  = '5';                                           12758   
       CDRE_ACC3.TRT3  = '5';                                           12759   
       CDRE_ACC3.TRT4  = '5';                                           12760   
       CDRE_ACC3.TRT5  = '4';                                           12761   
       CDRE_ACC3.TRT7  = '5';                                           12762   
       CDRE_ACC3.TRT8  = '4';                                           12763   
       CDRE_ACC3.FIL4  = ' ';                                           12764   
                                                                        12765   
       CDRE_ACC4.SAUT = '+';                                            12766   
       CDRE_ACC4.POLIC = '02'X;                                         12767   
       CDRE_ACC4.TRT1  = '7';                                           12768   
       CDRE_ACC4.TRT2  = '7';                                           12769   
       CDRE_ACC4.TRT3  = '7';                                           12770   
       CDRE_ACC4.TRT4  = '7';                                           12771   
       CDRE_ACC4.TRT5  = '7';                                           12772   
       CDRE_ACC4.TRT7  = '7';                                           12773   
       CDRE_ACC4.TRT8  = '7';                                           12774   
                                                                        12775   
       CDRE_ACC4B.SAUT = '+';                                           12776   
       CDRE_ACC4B.POLIC = '02'X;                                        12777   
       CDRE_ACC4B.TRT1  = '7';                                          12778   
       CDRE_ACC4B.TRT5  = '7';                                          12779   
       CDRE_ACC4B.TRT7  = '7';                                          12780   
       CDRE_ACC4B.TRT8  = '7';                                          12781   
                                                                        12782   
       CDRE_ACC5.SAUT = ' ';                                            12783   
       CDRE_ACC5.POLIC = '00'X;                                         12784   
       CDRE_ACC5.LIBEL = 'INFORMATIONS DONNEES A '!!                    12785   
                         'TITRE INDICATIF ET N''AYANT PAS VALEUR '!!    12786   
                         'COMPTABLE';                                   12787   
                                                                        12788   
       CDRE_ACC6 = ((115)'6');                                          12789   
       CDRE_ACC6.SAUT = ' ';                                            12790   
       CDRE_ACC6.POLIC = '02'X;                                         12791   
       CDRE_ACC6.FIL1  = ' ';                                           12792   
       CDRE_ACC6.TRT1 = 'Z';                                            12793   
       CDRE_ACC6.TRT2 = '2';                                            12794   
       CDRE_ACC6.TRT3 = '2';                                            12795   
       CDRE_ACC6.TRT4 = '2';                                            12796   
       CDRE_ACC6.TRT5 = '2';                                            12797   
       CDRE_ACC6.TRT7 = '2';                                            12798   
       CDRE_ACC6.TRT8 = 'Y';                                            12799   
       CDRE_ACC6.FIL4  = ' ';                                           12800   
 END INIT_CDRE_ACCORD ;                                                 12801   
1      /***************************************************************/12802   
       /* STOCKAGE DES COMPTEURS POUR LE RECAPITULATIF PAR            */12803   
       /* BORDEREAU DE LIVRAISON                                      */12804   
       /***************************************************************/12805   
 STOCKAGE_BL:      PROC;                                                12806   
        BL_TAB.NUBOR(WTFAC.GS.NUBOR) = WTFAC.GS.NUBOR ;                 12807   
        IF WTFAC.TYREF  = '3'            /*   FRAIS DE PORT           */12808   
           THEN I_BL_NUBOR   = 1000 ;                                   12809   
           ELSE I_BL_NUBOR   = WTFAC.GS.NUBOR;                          12810   
   /* ************************************* SUPPRIME 04-2004 YDU ****   12811   
        IF WTFAC.TYREF  = '3' THEN DO                                   12812   
           ZONCTL    = ' STOCK TYREF 3 NUART=' !! WTFAC.GS.NUART        12813   
           CALL MACMES3   (DESTI,'1',ZONCTL)                            12814   
        END                                                             12815   
   *************************************************************** */   12816   
        IF LIGNE1.NETHT ^= 0 THEN DO;    /*   CALCUL DU NETTC         */12817   
           IF COLIS.TETE = '1' THEN DO;                                 12818   
              BL_TAB.NETTC (I_BL_NUBOR)    = BL_TAB.NETTC (I_BL_NUBOR)  12819   
                                      + LIGNE1.NETHT + COLIS.TAXLI ;    12820   
              BL_TAB.TAXES (I_BL_NUBOR)    = BL_TAB.TAXES (I_BL_NUBOR)  12821   
                                             + COLIS.TAXLI ;            12822   
              END;                    ELSE DO;                          12823   
              IF SUM.NBMVT = 0 THEN DO;/*     ARTICLE SIMPLE          */12824   
                 BL_TAB.NETTC (I_BL_NUBOR) = BL_TAB.NETTC (I_BL_NUBOR)  12825   
                                      + LIGNE1.NETHT + WTFAC.TAXLI ;    12826   
                 BL_TAB.TAXES (I_BL_NUBOR) = BL_TAB.TAXES (I_BL_NUBOR)  12827   
                                             + WTFAC.TAXLI ;            12828   
                 END;                 ELSE DO; /*   NON COLIS SUM     */12829   
                 BL_TAB.NETTC (I_BL_NUBOR) = BL_TAB.NETTC (I_BL_NUBOR)  12830   
                                      + LIGNE1.NETHT + SUM.TAXLI ;      12831   
                 BL_TAB.TAXES (I_BL_NUBOR) = BL_TAB.TAXES (I_BL_NUBOR)  12832   
                                             + SUM.TAXLI ;              12833   
                 END;                                                   12834   
              END;                                                      12835   
           BL_TAB.NETHT (I_BL_NUBOR)       = BL_TAB.NETHT (I_BL_NUBOR)  12836   
                                             + LIGNE1.NETHT;            12837   
           END;                                                         12838   
        END STOCKAGE_BL;                                                12839   
1   MEF_REFLI:      PROCEDURE;                                          12840   
0          /*                                                           12841   
                    **************************************              12842   
                    *                                    *              12843   
                    *    EDITION DE LA NATURE DE RETOUR  *              12844   
                    *    EDITEUR DANS LA REFERENCE DE    *              12845   
                    *    LA LIGNE                        *              12846   
                    *                                    *              12847   
                    **************************************              12848   
           */                                                           12849   
0      MR00D:                                                           12850   
0          IF WTFAC.TRACO = '4'       &                                 12851   
              SUBSTR(WTFAC.NATOP,1,1) = '5'                             12852   
            /*THEN DO*/                                                 12853   
              THEN                                                      12854   
              SUBSTR(LIGNE1.REFLI,10,2) = WTFAC.NATRE ;                 12855   
            /*END*/                                                     12856   
                                                                        12857   
            /*-----------------------------------------------*/         12858   
           IF SUBSTR(ENTET70.NORUN,1,1) = '5' !                         12859   
              SUBSTR(ENTET70.NORUN,1,1) = '6'                           12860   
              THEN DO ;                                                 12861   
              TEMCOM = '' ;                                             12862   
              CALL RECHCOM ;                                            12863   
              IF TEMCOM ^= '' & TBRECOC.EDREF(IREC) = 'O'               12864   
              THEN DO ;                                                 12865   
              /*-- AJOUT SMARTIN DEBUT 22/11/2004  --*/                 12866   
              SPIPA.FONCT  = 'RP' ;                                     12867   
              SPIPA.COTAB  = 'CDLEXREF' ;                               12868   
              SPIPA.OPERA  = '=' ;                                      12869   
              SPIPA.REFPO  = SUBSTR(LIGNE1.REFLI,1,6) ;                 12870   
              CALL SPI2TBV (SPIPA,TCDLEXRF,SPIFI) ;                     12871   
              IF SPIPA.CORET ^= '00'                                    12872   
              THEN DO ;                                                 12873   
              /*-- AJOUT SMARTIN FIN   22/11/2004  --*/                 12874   
              IF W_RUP_REFLI ^= SUBSTR(LIGNE1.REFLI,1,10) &             12875   
                 SUBSTR(LIGNE1.REFLI,1,10) ^= ''                        12876   
                 THEN DO ;                                              12877   
                 W_RUP_REFLI  = SUBSTR(LIGNE1.REFLI,1,10);              12878   
                 TOP_REFLI = 'Y' ;                                      12879   
                 I_REFLI_MAX = 1000 ;                                   12880   
                 DO I_REFLI = 1 TO I_REFLI_MAX    ;                     12881   
                   IF REFLI_TAB.REFLI(I_REFLI) =                        12882   
                                SUBSTR(LIGNE1.REFLI,1,10)               12883   
                     THEN DO ;                                          12884   
                      I_REFLI_SAVE = I_REFLI  ;                         12885   
                      I_REFLI  = I_REFLI_MAX ;                          12886   
                   END ;                                                12887   
                   IF REFLI_TAB.REFLI(I_REFLI) = ''                     12888   
                     THEN DO ;                                          12889   
                      REFLI_TAB.REFLI(I_REFLI) =                        12890   
                                SUBSTR(LIGNE1.REFLI,1,10) ;             12891   
                      I_REFLI_SAVE = I_REFLI  ;                         12892   
                      I_REFLI      = I_REFLI_MAX ;                      12893   
                   END ;                                                12894   
                 END ;                                                  12895   
               END ;                                                    12896   
              END ;                                                     12897   
           END ;                                                        12898   
           END ;                                                        12899   
                                                                        12900   
              /*-  FIN AJOUT DU 22/09/2004 SMARTIN     -*/              12901   
0      MR00F:                                                           12902   
           END MEF_REFLI;                                               12903   
                                                                        12904   
              /*-      AJOUT DU 27/09/2004 SMARTIN     -*/              12905   
- RECHCOM : PROC ;                                                      12906   
         IRECFIN = TBRECOM.INDCH + 1;                                   12907   
 /********************************************************************/ 12908   
 /*       1) RECHERCHE AVEC ZONE NUCLI RENSEIGNEE                    */ 12909   
 /********************************************************************/ 12910   
         RECHCO = WTFIL4 !! WTCLI1.NUCLI ;                              12911   
         DO IREC = 1 TO IRECFIN ;                                       12912   
            IF RECHCO = TBRECOC.SYPRO(IREC) !! TBRECOC.AFFIL(IREC)      12913   
                                    !! TBRECOC.NUCLI(IREC) THEN DO ;    12914   
               TEMCOM = 'O' ;                                           12915   
               RETURN ;                                                 12916   
            END ;                                                       12917   
         END ;                                                          12918   
 /********************************************************************/ 12919   
 /*       2) RECHERCHE AVEC ZONE SYPRO ET AFFIL RENSEIGNE            */ 12920   
 /********************************************************************/ 12921   
         RECHCO = WTCLI1.SYPRO !! WTCLI1.AFFIL !! WTFIL6 ;              12922   
         DO IREC = 1 TO IRECFIN ;                                       12923   
            IF RECHCO = TBRECOC.SYPRO(IREC) !! TBRECOC.AFFIL(IREC)      12924   
                                 !! TBRECOC.NUCLI(IREC) THEN DO ;       12925   
               TEMCOM = 'O' ;                                           12926   
               RETURN ;                                                 12927   
            END ;                                                       12928   
         END ;                                                          12929   
 /********************************************************************/ 12930   
 /*       3) RECHERCHE AVEC ZONE AFFIL RENSEIGNE                     */ 12931   
 /********************************************************************/ 12932   
         RECHCO = WTFIL2 !! WTCLI1.AFFIL !! WTFIL6 ;                    12933   
         DO IREC = 1 TO IRECFIN ;                                       12934   
            IF RECHCO = TBRECOC.SYPRO(IREC) !! TBRECOC.AFFIL(IREC)      12935   
                                 !! TBRECOC.NUCLI(IREC) THEN DO ;       12936   
               TEMCOM = 'O' ;                                           12937   
               RETURN ;                                                 12938   
            END ;                                                       12939   
         END ;                                                          12940   
 /********************************************************************/ 12941   
 /*       4) RECHERCHE AVEC ZONE SYPRO RENSEIGNE                     */ 12942   
 /********************************************************************/ 12943   
         RECHCO = WTCLI1.SYPRO !! WTFIL8 ;                              12944   
         DO IREC = 1 TO IRECFIN ;                                       12945   
            IF RECHCO = TBRECOC.SYPRO(IREC) !! TBRECOC.AFFIL(IREC)      12946   
                                 !! TBRECOC.NUCLI(IREC) THEN DO ;       12947   
               TEMCOM = 'O' ;                                           12948   
               RETURN ;                                                 12949   
            END ;                                                       12950   
         END ;                                                          12951   
  FRECHCOM : END RECHCOM ;                                              12952   
-/*********************************************************************/12953   
              /*-  FIN AJOUT DU 27/09/2004 SMARTIN     -*/              12954   
1   MEF_LIDOC: PROCEDURE;                                               12955   
0          /*                                                           12956   
                    **************************************              12957   
                    *                                    *              12958   
                    *    MISE EN FORME LIDOC LGNAT ET    *              12959   
                    *    LECFA POUR LE TITRE DU DOCU-    *              12960   
                    *    MENT ET GESTION DE LA POLICE    *              12961   
                    *    LA STRUCTURE D ORIGINE EST      *              12962   
                    *    ENTET7_1 ET LA STRUCTURE POUR   *              12963   
                    *    ECRITURE EST ENTET7_1_EDI       *              12964   
                    *    X'04' ==> GB12                  *              12965   
                    *    X'05' ==> GB15                  *              12966   
                    *    X'00' ==> GT15                  *              12967   
                    *                                    *              12968   
                    **************************************              12969   
           */                                                           12970   
0      ML00D:                                                           12971   
0          LG_LIDOC  = 0 ;               /*   LONGUEUR LIDOC          */12972   
           PTR_LIBEL = ADDR(ENTET7_1.LIDOC);                            12973   
           DO I_LG = 20 TO 1 BY -1;                                     12974   
              IF CARAC(I_LG) ^= ' ' THEN DO;                            12975   
                 LG_LIDOC     = I_LG ;                                  12976   
                 I_LG         = 1 ;                                     12977   
                 END;                                                   12978   
              END;                                                      12979   
0          LG_LGNAT  = 0 ;               /*   LONGUEUR LGNAT          */12980   
           PTR_LIBEL = ADDR(ENTET7_1.LGNAT);                            12981   
           DO I_LG = 22 TO 1 BY -1;                                     12982   
              IF CARAC(I_LG) ^= ' ' THEN DO;                            12983   
                 LG_LGNAT     = I_LG ;                                  12984   
                 I_LG         = 1 ;                                     12985   
                 END;                                                   12986   
              END;                                                      12987   
0          LG_LECFA  = 0 ;               /*   LONGUEUR LECFA          */12988   
           PTR_LIBEL = ADDR(ENTET7_1.LECFA);                            12989   
           DO I_LG = 15 TO 1 BY -1;                                     12990   
              IF CARAC(I_LG) ^= ' ' THEN DO;                            12991   
                 LG_LECFA     = I_LG ;                                  12992   
                 I_LG         = 1 ;                                     12993   
                 END;                                                   12994   
              END;                                                      12995   
0                                        /*   CALCUL LG. TOTALE ET MEF*/12996   
           ENTET7_1_EDI       = ''  ;                                   12997   
           ENTET7_1_EDI.SAUT  = '+' ;                                   12998   
           IF UN_M = 20 ! UN_M = 70 !                                   12999   
              UN_M = 60 THEN DO;         /*   EXPORT GIH GHI AUTOMAT  */13000   
              LG_TOTAL = LG_LIDOC + 1 + LG_LGNAT + 1 + LG_LECFA ;       13001   
              IF LG_TOTAL <= 40 THEN DO;                                13002   
                 ENTET7_1_EDI.POLIC = '04'X;                            13003   
                 CHAR_60            = ' '    !!                         13004   
                                      SUBSTR(ENTET7_1.LIDOC,1,LG_LIDOC) 13005   
                                      !! ' ' !!                         13006   
                                      SUBSTR(ENTET7_1.LGNAT,1,LG_LGNAT) 13007   
                                      !! ' ' !!                         13008   
                                      SUBSTR(ENTET7_1.LECFA,1,LG_LECFA);13009   
                 ENTET7_1_60        = CHAR_60 ;                         13010   
                 END;                    ELSE DO;                       13011   
                 IF LG_TOTAL <= 50 THEN DO;                             13012   
                    ENTET7_1_EDI.POLIC = '05'X;                         13013   
                    CHAR_60         = ' '    !!                         13014   
                                      SUBSTR(ENTET7_1.LIDOC,1,LG_LIDOC) 13015   
                                      !! ' ' !!                         13016   
                                      SUBSTR(ENTET7_1.LGNAT,1,LG_LGNAT) 13017   
                                      !! ' ' !!                         13018   
                                      SUBSTR(ENTET7_1.LECFA,1,LG_LECFA);13019   
                    ENTET7_1_60     = CHAR_60 ;                         13020   
                    END;                 ELSE DO;                       13021   
                    ENTET7_1_EDI.POLIC = '00'X;                         13022   
                    ENTET7_1_EDI.FIL1  = ' '  ;                         13023   
                    ENTET7_1_EDI.LIDOC = ENTET7_1.LIDOC ;               13024   
                    ENTET7_1_EDI.LGNAT = ENTET7_1.LGNAT ;               13025   
                    ENTET7_1_EDI.LECFA = ENTET7_1.LECFA ;               13026   
                    END;                                                13027   
                 END;                                                   13028   
0             END;                       ELSE DO;                       13029   
                                         /* CAS FRANCE              */  13030   
              LG_TOTAL = LG_LIDOC + 1 + LG_LGNAT ;                      13031   
              IF LG_TOTAL <= 29 THEN DO;                                13032   
                 ENTET7_1_EDI.POLIC = '04'X;                            13033   
                 CHAR_60            = ' '    !!                         13034   
                                      SUBSTR(ENTET7_1.LIDOC,1,LG_LIDOC) 13035   
                                      !! ' ' !!                         13036   
                                      SUBSTR(ENTET7_1.LGNAT,1,LG_LGNAT);13037   
                 ENTET7_1_60        = CHAR_60 ;                         13038   
                 END;                    ELSE DO;                       13039   
                 IF LG_TOTAL <= 35 THEN DO;                             13040   
                    ENTET7_1_EDI.POLIC = '05'X;                         13041   
                    CHAR_60         = ' '    !!                         13042   
                                      SUBSTR(ENTET7_1.LIDOC,1,LG_LIDOC) 13043   
                                      !! ' ' !!                         13044   
                                      SUBSTR(ENTET7_1.LGNAT,1,LG_LGNAT);13045   
                    ENTET7_1_60     = CHAR_60 ;                         13046   
                    END;                 ELSE DO;                       13047   
                    ENTET7_1_EDI.POLIC = '00'X;                         13048   
                    ENTET7_1_EDI.FIL1  = ' '  ;                         13049   
                    ENTET7_1_EDI.LIDOC = ENTET7_1.LIDOC ;               13050   
                    ENTET7_1_EDI.LGNAT = ENTET7_1.LGNAT ;               13051   
                    ENTET7_1_EDI.LECFA = ENTET7_1.LECFA ;               13052   
                    END;                                                13053   
                 END;                                                   13054   
              END;                     /*   FIN TEST LONGUEUR         */13055   
0      ML00F:                                                           13056   
           END MEF_LIDOC;                                               13057   
 RECH_TBNUEDI: PROC;                                                    13058   
       SV_LIEDI  = '';                                                  13059   
       DO INDTAB = 1 TO TBNUEDIF.INDCH;                                 13060   
          IF SV_NUEDI = TBNUEDIT.NUEDI(INDTAB) THEN DO;                 13061   
             SV_LIEDI = TBNUEDIT.LIEDI(INDTAB) ;                        13062   
             GO TO SORTIE_RECH10 ;                                      13063   
             END;                                                       13064   
          END;                                                          13065   
 SORTIE_RECH10:                                                         13066   
 END RECH_TBNUEDI;                                                      13067   
 RECH_TBNUDIV: PROC;                                                    13068   
       SV_LIDIV  = '';                                                  13069   
       DO INDTAB = 1 TO TBNUDIV.INDCH;                                  13070   
          IF SV_NUDIV5 = ZTBNUDIV.NUEDI(INDTAB) !!                      13071   
                         ZTBNUDIV.NUDIV(INDTAB) THEN DO;                13072   
             SV_LIDIV  = ZTBNUDIV.LIDIV(INDTAB) ;                       13073   
             GO TO SORTIE_RECH11 ;                                      13074   
             END;                                                       13075   
          END;                                                          13076   
 SORTIE_RECH11:                                                         13077   
 END RECH_TBNUDIV;                                                      13078   
                                                                        13079   
1   RECH_CDLPAGGA:    PROCEDURE ;                                       13080   
0          /*                                                           13081   
                    **************************************              13082   
                    *                                    *              13083   
                    *    ACCES A LA TABLE CDLPAGGA       *              13084   
                    *    TABLE PAR EXCEPTION             *              13085   
                    *    CONTIENT LES FACTURES AVEC      *              13086   
                    *    PAGE DE GARDE A EDITER          *              13087   
                    *    - SYPRO + AFFIL + NUCLI         *              13088   
                    *      SI OK ==> PAS DE PAGE GARDE   *              13089   
                    *    - SYPRO + AFFIL                 *              13090   
                    *      SI OK ==> PAS DE PAGE GARDE   *              13091   
                    *    - SYPRO                         *              13092   
                    *      SI OK ==> PAS DE PAGE GARDE   *              13093   
                    *    - SINON EDITION PAGE DE GARDE   *              13094   
                    *                                    *              13095   
                    **************************************              13096   
           */                                                           13097   
0          EDIT_PAGGA     = 'N' ;                                       13098   
           SPIPA          = '';                                         13099   
           SPIPA.FONCT    = 'RP';                                       13100   
           SPIPA.COTAB    = 'CDLPAGGA';                                 13101   
           SPIPA.OPERA    = '=';                                        13102   
0                                        /*   1ER ACCES               */13103   
           SPIPA.REFPO    = WTFAC.SYPRO !! WTCLI1.AFFIL !! WTFAC.NUCLI; 13104   
           CALL SPI2TBV (SPIPA,TCDLPAGG,SPIFI);                         13105   
           IF SPIPA.CORET = '00' THEN DO;                               13106   
              EDIT_PAGGA  = 'O' ;                                       13107   
              RETURN ;                                                  13108   
              END;                                                      13109   
0                                        /*   2EME ACCES              */13110   
           SPIPA.REFPO    = WTFAC.SYPRO !! WTCLI1.AFFIL ;               13111   
           CALL SPI2TBV (SPIPA,TCDLPAGG,SPIFI);                         13112   
           IF SPIPA.CORET = '00' THEN DO;                               13113   
              EDIT_PAGGA  = 'O' ;                                       13114   
              RETURN ;                                                  13115   
              END;                                                      13116   
0                                        /*   3EME ACCES              */13117   
           SPIPA.REFPO    = WTFAC.SYPRO ;                               13118   
           CALL SPI2TBV (SPIPA,TCDLPAGG,SPIFI);                         13119   
           IF SPIPA.CORET = '00' THEN DO;                               13120   
              EDIT_PAGGA  = 'O' ;                                       13121   
              END;                                                      13122   
       END RECH_CDLPAGGA;                                               13123   
1   RECH_CDLCLLME:    PROCEDURE ;                                       13124   
0          /*                                                           13125   
                    **************************************              13126   
                    *                                    *              13127   
                    *    ACCES A LA TABLE CDLCLLME       *              13128   
                    *    TABLE PAR EXCEPTION             *              13129   
                    *    CONTIENT LE TEXTE DES LIGNES    *              13130   
                    *    LME A EDITER EN FIN DE FACTURE  *              13131   
                    *    - SYPRO + AFFIL + NUCLI         *              13132   
                    *      SI OK ==> PAS DE  LIGNES LME  *              13133   
                    *    - SYPRO + AFFIL                 *              13134   
                    *      SI OK ==> PAS DE  LIGNES LME  *              13135   
                    *    - SYPRO                         *              13136   
                    *      SI OK ==> PAS DE  LIGNES LME  *              13137   
                    *    - SINON EDITION DES LIGNES LME  *              13138   
                    *                                    *              13139   
                    **************************************              13140   
           */                                                           13141   
0          EDIT_CDLTELME  = 'N' ;                                       13142   
           SPIPA          = '';                                         13143   
           SPIPA.FONCT    = 'RP';                                       13144   
           SPIPA.COTAB    = 'CDLCLLME';                                 13145   
           SPIPA.OPERA    = '=';                                        13146   
0                                        /*   1ER ACCES               */13147   
           SPIPA.REFPO    = WTFAC.SYPRO !! WTCLI1.AFFIL !! WTFAC.NUCLI; 13148   
           CALL SPI2TBV (SPIPA,CDLCLLME,SPIFI);                         13149   
           IF SPIPA.CORET = '00' THEN DO;                               13150   
              EDIT_CDLTELME = 'O' ;                                     13151   
              RETURN ;                                                  13152   
              END;                                                      13153   
0                                        /*   2EME ACCES              */13154   
           SPIPA.REFPO    = WTFAC.SYPRO !! WTCLI1.AFFIL ;               13155   
           CALL SPI2TBV (SPIPA,CDLCLLME,SPIFI);                         13156   
           IF SPIPA.CORET = '00' THEN DO;                               13157   
              EDIT_CDLTELME = 'O' ;                                     13158   
              RETURN ;                                                  13159   
              END;                                                      13160   
0                                        /*   3EME ACCES              */13161   
           SPIPA.REFPO    = WTFAC.SYPRO ;                               13162   
           CALL SPI2TBV (SPIPA,CDLCLLME,SPIFI);                         13163   
           IF SPIPA.CORET = '00' THEN DO;                               13164   
              EDIT_CDLTELME = 'O' ;                                     13165   
              END;                                                      13166   
       END RECH_CDLCLLME;                                               13167   
1  /*-- ---------------------------------------------------- --*/       13168   
   /*-- AJOUT SMARTIN 22/12/2004 GESTION FACT DEMATERIALISEES -*/       13169   
   /*-- ---------------------------------------------------- --*/       13170   
 INIT_DEMA:    PROC;             /* INITIALISATION FACTURE DEMAT */     13171   
                                                                        13172   
       TOP_DEMA_FAC            = '' ;                                   13173   
       TOP_DEMA_ECR            = '' ;                                   13174   
       TOP_EDI                 = '' ;                                   13175   
       MOD_DEMA                = '' ;                                   13176   
       DF_TYPFA                = '' ;                                   13177   
       CTR_LIG_COM             = 0  ;                                   13178   
       SVG_DEMAT_COLIS         = '' ;                                   13179   
       SVG_DEMAT_ATM           = '' ;                                   13180   
       SVG_NULIG               = 0  ;                                   13181   
       DEMAT_GEN               = '' ;                                   13182   
       DEMAT_ENT               = '' ;                                   13183   
       DEMAT_ECH               = '' ;                                   13184   
       DEMAT_COM               = '' ;                                   13185   
       DEMAT_REF               = '' ;                                   13186   
       DEMAT_ADR               = '' ;                                   13187   
       DEMAT_AD2               = '' ;                                   13188   
       DEMAT_LIG               = '' ;                                   13189   
       DEMAT_LEC               = '' ;                                   13190   
       DEMAT_PIE               = '' ;                                   13191   
                                                                        13192   
  /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                13193   
       CTR_STO_COM             = 0  ;                                   13194   
       SVG_STO_D_COLIS         = '' ;                                   13195   
       SVG_STO_D_ATM           = '' ;                                   13196   
       STO_D_GEN               = '' ;                                   13197   
       STO_D_ENT               = '' ;                                   13198   
       STO_D_ECH               = '' ;                                   13199   
       STO_D_COM               = '' ;                                   13200   
       STO_D_REF               = '' ;                                   13201   
       STO_D_ADR               = '' ;                                   13202   
       STO_D_AD2               = '' ;                                   13203   
       STO_D_LIG               = '' ;                                   13204   
       STO_D_LEC               = '' ;                                   13205   
       STO_D_PIE               = '' ;                                   13206   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                13207   
                                                                        13208   
 END INIT_DEMA;                                                         13209   
                                                                        13210   
 INIT_ENREG_ENT: PROC;            /* INITIALISATION FACTURE DEMAT */    13211   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     13212   
       DEMAT_ENT.ID.NUCLI      = WTFAC.NUCLI                 ;          13213   
       DEMAT_ENT.ID.DAFAC      = STRING(DFDTF)               ;          13214   
       DEMAT_ENT.ID.GNATO      = WTFAC.GS.GNATO              ;          13215   
       DEMAT_ENT.ID.RUNFA      = WTDAT.NORUN                 ;          13216   
       DEMAT_ENT.ID.NUFAC      = WNUFAC                      ;          13217   
       DEMAT_ENT.ID.NULIG      = DEMAT_ENT.ID.NULIG + 1      ;          13218   
       DEMAT_ENT.ID.COENR      = 'A'                         ;          13219   
       DEMAT_ENT.ID.TYPDE      = MOD_DEMA                    ;          13220   
       DEMAT_ENT.ID.ENSEQ      = DEMAT_ENT.ID.ENSEQ + 1      ;          13221   
                                                                        13222   
                                 /* INIT. ENREG ENTETE           */     13223   
       DEMAT_ENT.GS.TYPEN      = 'ENT'                       ;          13224   
       DEMAT_ENT.GS.NULOT      = ''                          ;          13225   
       DEMAT_ENT.GS.EANFO      = WL_CLLIV.NUCLI              ;          13226   
       DEMAT_ENT.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5   ;          13227   
       DEMAT_ENT.GS.NUCLI      = WTFAC.NUCLI                 ;          13228   
       SELECT (MOD_DEMA) ;                                              13229   
          WHEN ('D') DO;                  /*   DEMAT SANS PAPIER CTLE+*/13230   
             DEMAT_ENT.GS.CDFON = '9 ';                                 13231   
             END;                                                       13232   
          WHEN ('E') DO;                  /*   DEMAT AVEC PAPIER CTLE-*/13233   
             DEMAT_ENT.GS.CDFON = '43';                                 13234   
             END;                                                       13235   
          WHEN ('T') DO;                  /*   DEMAT AVEC PAPIER CTLE+*/13236   
             DEMAT_ENT.GS.CDFON = '9 ';                                 13237   
             END;                                                       13238   
          OTHERWISE  DO;                                                13239   
             DEMAT_ENT.GS.CDFON = '  ';                                 13240   
             END;                                                       13241   
          END;                                                          13242   
 END INIT_ENREG_ENT;                                                    13243   
                                                                        13244   
 INIT_ENREG_COM: PROC;             /* INIT. ENREG COMMENTAIRES     */   13245   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     13246   
       DEMAT_COM.ID.NUCLI      = WTFAC.NUCLI                 ;          13247   
       DEMAT_COM.ID.DAFAC      = STRING(DFDTF)               ;          13248   
       DEMAT_COM.ID.GNATO      = WTFAC.GS.GNATO              ;          13249   
       DEMAT_COM.ID.RUNFA      = WTDAT.NORUN                 ;          13250   
       DEMAT_COM.ID.NUFAC      = WNUFAC                      ;          13251   
       DEMAT_COM.ID.COENR      = 'C'                         ;          13252   
       DEMAT_COM.ID.TYPDE      = MOD_DEMA                    ;          13253   
       DEMAT_COM.GS.TYPEN      = 'COM'                       ;          13254   
       DEMAT_COM.ID.NULIG      = DEMAT_COM.ID.NULIG + 1      ;          13255   
       DEMAT_COM.GS.NULOT      = ''                          ;          13256   
       DEMAT_COM.GS.EANFO      = WL_CLLIV.NUCLI              ;          13257   
       DEMAT_COM.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5   ;          13258   
 END INIT_ENREG_COM;                                                    13259   
                                                                        13260   
 INIT_ENREG_LOGCOM: PROC;          /* INIT. ENREG LOG COMMENTS     */   13261   
       LOG_COM.TYPEN    = 'LOG'             ;                           13262   
       LOG_COM.NORUN    = WTDAT.NORUN       ;                           13263   
       LOG_COM.DTRUN    = STRING(DFDTF)     ;                           13264   
       LOG_COM.NULOT    = ''                ;                           13265   
       LOG_COM.EANFO    = WL_CLLIV.NUCLI    ;                           13266   
       LOG_COM.NUFAC    = WNUFAC            ;                           13267   
       LOG_COM.TYPCOM   = 'SUR'             ;                           13268   
                                                                        13269   
 END INIT_ENREG_LOGCOM;                                                 13270   
                                                                        13271   
 INIT_ENREG_COMPMD: PROC;          /* INIT. ENREG COM TYPE PMD     */   13272   
                                                                        13273   
       DEMAT_COM.ID.ENSEQ      = DEMAT_COM.ID.ENSEQ + 1      ;          13274   
       DEMAT_COM.GS.ZOCOM      = '' ;                                   13275   
       DEMAT_COM.GS.TYPCO      = 'SUR' ;                                13276   
       DEMAT_COM.GS.ZOCOM      = 'NOS MARCHANDISES VOYAGENT AUX ' !!    13277   
                                 'RISQUES ET PERILS DES DESTINA'  !!    13278   
                                 'TAIRES (ART' ;                        13279   
       WRITE FILE(FICDEMA) FROM (DEMAT_COM)  ;                          13280   
       CTR_LIG_DEMA            = CTR_LIG_DEMA + 1 ;                     13281   
                                                                        13282   
       DEMAT_COM.ID.ENSEQ      = DEMAT_COM.ID.ENSEQ + 1      ;          13283   
       DEMAT_COM.GS.ZOCOM      = 'ICLE 100 CC)        ' ;               13284   
       WRITE FILE(FICDEMA) FROM (DEMAT_COM)  ;                          13285   
       CTR_LIG_DEMA            = CTR_LIG_DEMA + 1 ;                     13286   
                                                                        13287   
       DEMAT_COM.ID.ENSEQ      = DEMAT_COM.ID.ENSEQ + 1      ;          13288   
       DEMAT_COM.GS.ZOCOM      = '' ;                                   13289   
       DEMAT_COM.GS.TYPCO      = 'SUR' ;                                13290   
       DEMAT_COM.GS.ZOCOM      = 'LE TRANSFERT DE PROPRIETE DE T' !!    13291   
                                 'OUS NOS OUVRAGES ET PRODUITS '  !!    13292   
                                 'N''INTER' ;                           13293   
       WRITE FILE(FICDEMA) FROM (DEMAT_COM)  ;                          13294   
       CTR_LIG_DEMA            = CTR_LIG_DEMA + 1 ;                     13295   
                                                                        13296   
       DEMAT_COM.ID.ENSEQ      = DEMAT_COM.ID.ENSEQ + 1      ;          13297   
       DEMAT_COM.GS.ZOCOM      = 'VIENT QU''APRES PAIEMENT INTEG' !!    13298   
                                 'RAL DU PRIX ' ;                       13299   
       WRITE FILE(FICDEMA) FROM (DEMAT_COM)  ;                          13300   
       CTR_LIG_DEMA            = CTR_LIG_DEMA + 1 ;                     13301   
                                                                        13302   
       IF W_RECOO ^= ' '                                                13303   
       THEN DO;                                                         13304   
          DEMAT_COM.ID.ENSEQ      = DEMAT_COM.ID.ENSEQ + 1      ;       13305   
          DEMAT_COM.GS.ZOCOM      = '' ;                                13306   
          DEMAT_COM.GS.TYPCO      = 'SUR' ;                             13307   
          DEMAT_COM.GS.ZOCOM      = 'REF COMMANDE ORIGINE ' !! W_RECOO; 13308   
          WRITE FILE(FICDEMA) FROM (DEMAT_COM)  ;                       13309   
          CTR_LIG_DEMA            = CTR_LIG_DEMA + 1 ;                  13310   
       END;                                                             13311   
                                                                        13312   
       DEMAT_COM.GS.TYPCO      = 'AAB' ;                                13313   
       DEMAT_COM.ID.ENSEQ      = DEMAT_COM.ID.ENSEQ + 1      ;          13314   
       DEMAT_COM.GS.ZOCOM      = 'LA SOCI'           !!                 13315   
                                 'ETE N''ACCORDE PAS D''ESCOMPTE.';     13316   
       WRITE FILE(FICDEMA) FROM (DEMAT_COM)  ;                          13317   
       CTR_LIG_COM             = CTR_LIG_COM  + 3 ;                     13318   
       CTR_LIG_DEMA            = CTR_LIG_DEMA + 1 ;                     13319   
                                                                        13320   
       DEMAT_COM.GS.TYPCO      = 'PMD' ;                                13321   
       DEMAT_COM.ID.ENSEQ      = DEMAT_COM.ID.ENSEQ + 1      ;          13322   
       DEMAT_COM.GS.ZOCOM      = 'PENALITES DE RETARD : INTERET ' !!    13323   
                                 'AU TAUX DE REFINANCEMENT DE LA' !!    13324   
                                 ' BCE '         ;                      13325   
       WRITE FILE(FICDEMA) FROM (DEMAT_COM)  ;                          13326   
       CTR_LIG_DEMA            = CTR_LIG_DEMA + 1 ;                     13327   
0      DEMAT_COM.ID.ENSEQ      = DEMAT_COM.ID.ENSEQ + 1      ;          13328   
       DEMAT_COM.GS.ZOCOM      = 'MAJORE DE 8 POINTS DE POURCENT' !!    13329   
                                 'AGE AVEC UN MINIMUM LEGAL FIXE' !!    13330   
                                 ' A 3 '         ;                      13331   
       WRITE FILE(FICDEMA) FROM (DEMAT_COM)  ;                          13332   
       CTR_LIG_DEMA            = CTR_LIG_DEMA + 1 ;                     13333   
0      DEMAT_COM.ID.ENSEQ      = DEMAT_COM.ID.ENSEQ + 1      ;          13334   
       DEMAT_COM.GS.ZOCOM      = 'FOIS LE TAUX D''INTERET LEGAL.';      13335   
       WRITE FILE(FICDEMA) FROM (DEMAT_COM)  ;                          13336   
       /* PJA 201309 : ACTION EDI 92 */                                 13337   
       CTR_LIG_DEMA            = CTR_LIG_DEMA + 1 ;                     13338   
       CTR_LIG_COM             = CTR_LIG_COM + 3  ;                     13339   
                                                                        13340   
       DEMAT_COM.GS.TYPCO      = 'PMT' ;                                13341   
0      DEMAT_COM.ID.ENSEQ      = DEMAT_COM.ID.ENSEQ + 1      ;          13342   
       DEMAT_COM.GS.ZOCOM      = 'CE MONTANT EST COMPLETE D''UN ' !!    13343   
                                 'FORFAIT DE 40 EUROS POUR FRAIS' ;     13344   
       WRITE FILE(FICDEMA) FROM (DEMAT_COM)  ;                          13345   
       CTR_LIG_DEMA            = CTR_LIG_DEMA + 1 ;                     13346   
0      DEMAT_COM.ID.ENSEQ      = DEMAT_COM.ID.ENSEQ + 1      ;          13347   
       DEMAT_COM.GS.ZOCOM      = 'DE RECOUVREMENT.' ;                   13348   
       WRITE FILE(FICDEMA) FROM (DEMAT_COM)  ;                          13349   
       CTR_LIG_DEMA            = CTR_LIG_DEMA + 1 ;                     13350   
       CTR_LIG_COM             = CTR_LIG_COM + 2  ;                     13351   
                                                                        13352   
       DEMAT_COM.GS.TYPCO      = 'SUR' ;                                13353   
       DEMAT_COM.ID.ENSEQ      = DEMAT_COM.ID.ENSEQ + 1      ;          13354   
       DEMAT_COM.GS.ZOCOM      = 'SERVICE CLIENT : ' !!                 13355   
                                 SUBSTR(WADCRD,34,2) !!                 13356   
                                 SUBSTR(WADCRD,37,2) !!                 13357   
                                 SUBSTR(WADCRD,40,2) !!                 13358   
                                 SUBSTR(WADCRD,43,2) !!                 13359   
                                 SUBSTR(WADCRD,46,2) !!                 13360   
                                 ' RECOUVREMENT : '  !!                 13361   
                                 SUBSTR(WVICRD,34,2) !!                 13362   
                                 SUBSTR(WVICRD,37,2) !!                 13363   
                                 SUBSTR(WVICRD,40,2) !!                 13364   
                                 SUBSTR(WVICRD,43,2) !!                 13365   
                                 SUBSTR(WVICRD,46,2)  ;                 13366   
       WRITE FILE(FICDEMA) FROM (DEMAT_COM)  ;                          13367   
       CTR_LIG_DEMA            = CTR_LIG_DEMA + 1 ;                     13368   
       CTR_LIG_COM             = CTR_LIG_COM  + 1 ;                     13369   
0                                        /*   TEXTE LME 05.09         */13370   
       IF EDIT_CDLTELME = 'O' THEN DO;                                  13371   
          DEMAT_COM.GS.TYPCO    = 'SUR' ;                               13372   
          DO I = 1 TO NB_CDLTELME;                                      13373   
             Z115_CDLTELME      = TBL_CDLTELME.LIBE1(I) !!              13374   
                                  TBL_CDLTELME.LIBE2(I) !!              13375   
                                  TBL_CDLTELME.LIBE3(I) ;               13376   
                                         /*   DECOUPAGE EN 2 LIGNES   */13377   
             IF SUBSTR(Z115_CDLTELME,DEB_CDLTELME,70) ^= ' ' THEN DO;   13378   
                DEMAT_COM.GS.ZOCOM =                                    13379   
                               SUBSTR(Z115_CDLTELME,DEB_CDLTELME,70);   13380   
                DEMAT_COM.ID.ENSEQ = DEMAT_COM.ID.ENSEQ + 1;            13381   
                WRITE FILE(FICDEMA) FROM (DEMAT_COM) ;                  13382   
                CTR_LIG_DEMA       = CTR_LIG_DEMA + 1 ;                 13383   
                END;                                                    13384   
             IF SUBSTR(Z115_CDLTELME,DEB_CDLTELME + 70) ^= ' ' THEN DO; 13385   
                DEMAT_COM.GS.ZOCOM =                                    13386   
                               SUBSTR(Z115_CDLTELME,DEB_CDLTELME + 70); 13387   
                DEMAT_COM.ID.ENSEQ = DEMAT_COM.ID.ENSEQ + 1;            13388   
                WRITE FILE(FICDEMA) FROM (DEMAT_COM) ;                  13389   
                CTR_LIG_DEMA       = CTR_LIG_DEMA + 1 ;                 13390   
                END;                                                    13391   
             END;                                                       13392   
          END;                                                          13393   
 END INIT_ENREG_COMPMD;                                                 13394   
                                                                        13395   
 INIT_ENREG_ECH: PROC;            /* INITIALISATION FACTURE DEMAT */    13396   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     13397   
       DEMAT_ECH.ID.NUCLI      = WTFAC.NUCLI                 ;          13398   
       DEMAT_ECH.ID.DAFAC      = STRING(DFDTF)               ;          13399   
       DEMAT_ECH.ID.GNATO      = WTFAC.GS.GNATO              ;          13400   
       DEMAT_ECH.ID.RUNFA      = WTDAT.NORUN                 ;          13401   
       DEMAT_ECH.ID.NUFAC      = WNUFAC                      ;          13402   
       DEMAT_ECH.ID.NULIG      = DEMAT_ECH.ID.NULIG + 1      ;          13403   
       DEMAT_ECH.ID.COENR      = 'B'                         ;          13404   
       DEMAT_ECH.ID.TYPDE      = MOD_DEMA                    ;          13405   
       DEMAT_ECH.ID.ENSEQ      = DEMAT_ECH.ID.ENSEQ + 1      ;          13406   
                                                                        13407   
                                 /* INIT. ENREG ECHEANCE         */     13408   
       DEMAT_ECH.GS.TYPEN      = 'ECH'                       ;          13409   
       DEMAT_ECH.GS.NULOT      = ''                          ;          13410   
       DEMAT_ECH.GS.EANFO      = WL_CLLIV.NUCLI              ;          13411   
       DEMAT_ECH.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5   ;          13412   
 END INIT_ENREG_ECH;                                                    13413   
                                                                        13414   
 INIT_ENREG_REF: PROC;            /* INITIALISATION FACTURE DEMAT */    13415   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     13416   
       DEMAT_REF.ID.NUCLI      = WTFAC.NUCLI                 ;          13417   
       DEMAT_REF.ID.DAFAC      = STRING(DFDTF)               ;          13418   
       DEMAT_REF.ID.GNATO      = WTFAC.GS.GNATO              ;          13419   
       DEMAT_REF.ID.RUNFA      = WTDAT.NORUN                 ;          13420   
       DEMAT_REF.ID.NUFAC      = WNUFAC                      ;          13421   
       DEMAT_REF.ID.NULIG      = DEMAT_REF.ID.NULIG + 1      ;          13422   
       DEMAT_REF.ID.COENR      = 'D'                         ;          13423   
       DEMAT_REF.ID.TYPDE      = MOD_DEMA                    ;          13424   
       DEMAT_REF.ID.ENSEQ      = DEMAT_REF.ID.ENSEQ + 1      ;          13425   
                                                                        13426   
                                 /* INIT. ENREG REFERENCE FACT   */     13427   
       DEMAT_REF.GS.TYPEN      = 'REF'                       ;          13428   
       DEMAT_REF.GS.NULOT      = ''                          ;          13429   
       DEMAT_REF.GS.EANFO      = WL_CLLIV.NUCLI              ;          13430   
       DEMAT_REF.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5   ;          13431   
 END INIT_ENREG_REF;                                                    13432   
                                                                        13433   
 INIT_ENREG_ADR: PROC;            /* INITIALISATION FACTURE DEMAT */    13434   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     13435   
       DEMAT_ADR.ID.NUCLI      = WTFAC.NUCLI                 ;          13436   
       DEMAT_ADR.ID.DAFAC      = STRING(DFDTF)               ;          13437   
       DEMAT_ADR.ID.GNATO      = WTFAC.GS.GNATO              ;          13438   
       DEMAT_ADR.ID.RUNFA      = WTDAT.NORUN                 ;          13439   
       DEMAT_ADR.ID.NUFAC      = WNUFAC                      ;          13440   
       DEMAT_ADR.ID.NULIG      = DEMAT_ADR.ID.NULIG + 1      ;          13441   
       DEMAT_ADR.ID.COENR      = 'E'                         ;          13442   
       DEMAT_ADR.ID.TYPDE      = MOD_DEMA                    ;          13443   
       DEMAT_ADR.ID.ENSEQ      = DEMAT_ADR.ID.ENSEQ + 1      ;          13444   
                                                                        13445   
                                 /* INIT. ENREG ADRESSE   FACT   */     13446   
       DEMAT_ADR.GS.TYPEN      = 'ADR'                       ;          13447   
       DEMAT_ADR.GS.NULOT      = ''                          ;          13448   
       DEMAT_ADR.GS.EANFO      = WL_CLLIV.NUCLI              ;          13449   
       DEMAT_ADR.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5   ;          13450   
                                                                        13451   
                                 /* RUBRIQUES SIEGE SOCIALE  */         13452   
                                                                        13453   
       SPIPA       = '';                                                13454   
       SPIPA.FONCT = 'RP';                                              13455   
       SPIPA.COTAB = 'CDLSIEGE';                                        13456   
       SPIPA.OPERA = '>';                                               13457   
       SPIPA.REFPO = LOW(13);                                           13458   
       CALL SPI2TBV (SPIPA,TSIEGE,SPIFI);                               13459   
       IF SPIPA.CORET = '00'                                            13460   
         THEN DO ;                                                      13461   
           /* AJOUT 10/06 YFB NAD+CO DOIT ETRE DIFF NAD+SE */           13462   
           IF TCDLFDEM.CNUSS ^= TCDLFDEM.CNUDF                          13463   
             THEN DO ;                                                  13464   
               DEMAT_ADR.SIEGE.EAN    = TCDLFDEM.CNUSS       ;          13465   
               DEMAT_ADR.SIEGE.NOCLI  = TSIEGE.NOSIE         ;          13466   
               DEMAT_ADR.SIEGE.RASOC  = TSIEGE.RASIE         ;          13467   
               DEMAT_ADR.SIEGE.ADCLI  = TSIEGE.ADSIE         ;          13468   
               DEMAT_ADR.SIEGE.LORES  = TSIEGE.LOSIE         ;          13469   
               DEMAT_ADR.SIEGE.LOBDI  = TSIEGE.LBSIE         ;          13470   
               DEMAT_ADR.SIEGE.CPCLI  = TSIEGE.CPSIE         ;          13471   
               DEMAT_ADR.SIEGE.CPAYS  = TSIEGE.PASIE         ;          13472   
             END ;                                                      13473   
             ELSE DO ;                                                  13474   
               DEMAT_ADR.SIEGE.EAN    = ' '                  ;          13475   
               DEMAT_ADR.SIEGE.NOCLI  = ' '                  ;          13476   
               DEMAT_ADR.SIEGE.RASOC  = ' '                  ;          13477   
               DEMAT_ADR.SIEGE.ADCLI  = ' '                  ;          13478   
               DEMAT_ADR.SIEGE.LORES  = ' '                  ;          13479   
               DEMAT_ADR.SIEGE.LOBDI  = ' '                  ;          13480   
               DEMAT_ADR.SIEGE.CPCLI  = ' '                  ;          13481   
               DEMAT_ADR.SIEGE.CPAYS  = ' '                  ;          13482   
             END ;                                                      13483   
           DEMAT_ADR.SIEGE.FJURI  = TSIEGE.FJSIE         ;              13484   
           DEMAT_ADR.SIEGE.CAPIT  = TSIEGE.CASIE         ;              13485   
           DEMAT_ADR.SIEGE.CMONA  = 'EUR'                ;              13486   
           DEMAT_ADR.SIEGE.RCOMM  = TSIEGE.RCSIE         ;              13487   
           DEMAT_ADR.SIEGE.NUCEE  = TSIEGE.TVSIE         ;              13488   
           /* PJA 201311 : PB NUMERO DE TVA INTRACOMMUNAUTAIRE */       13489   
        /* DEMAT_ADR.SIEGE.MAGTV  = WL_CLLIV.MAGTV       ;  */          13490   
           DEMAT_ADR.SIEGE.MAGTV  = WF_CLFAC.MAGTV       ;              13491   
       END ;                                                            13492   
       DEMAT_ADR.CLLIV            = WL_CLLIV, BY NAME    ;              13493   
0      DEMAT_ADR.CLFAC            = WF_CLFAC, BY NAME    ;              13494   
       DEMAT_ADR.CLFAC.CLIFA      = WF_CLFAC.NUCLI       ;              13495   
       /*   CNUD MULTIMED OU HACHETT*/                                  13496   
    /* IF NUCLI_HMD = 'O'                                               13497   
          THEN DEMAT_ADR.MACOM    = '3010955650103' ;                   13498   
          ELSE DEMAT_ADR.MACOM    = '3010955600100' ; */                13499   
       /* MODIF YFB 10/2006 ON PREND L'EAN DANS CDLFDEMX */             13500   
       /*                          ET L'ADRESSE CDLADRES */             13501   
       DEMAT_ADR.MACOM            = TCDLFDEM.CNUDF ;                    13502   
0      SPIPA                      = '';  /*   TABLE DES ADRESSES CNUDF*/13503   
       SPIPA.FONCT                = 'RP';                               13504   
       SPIPA.COTAB                = 'CDLADRES';                         13505   
       SPIPA.OPERA                = '=';                                13506   
       SPIPA.REFPO                = TCDLFDEM.CNUDF;                     13507   
       CALL SPI2TBV (SPIPA,TCDLADRE,SPIFI);                             13508   
       IF SPIPA.CORET ^= '00' THEN DO;                                  13509   
          TCDLADRE                = '' ;                                13510   
          END;                                                          13511   
       DEMAT_ADR.EMETT.NOCLI      = TCDLADRE.RASOC;                     13512   
       DEMAT_ADR.EMETT.RASOC      = TCDLADRE.NOCLI;                     13513   
       DEMAT_ADR.EMETT.ADCLI      = TCDLADRE.ADCLI;                     13514   
       DEMAT_ADR.EMETT.LORES      = TCDLADRE.LORES;                     13515   
       DEMAT_ADR.EMETT.LOBDI      = TCDLADRE.LOBDI;                     13516   
       DEMAT_ADR.EMETT.CPCLI      = TCDLADRE.CPCLI;                     13517   
       DEMAT_ADR.EMETT.CPAYS      = TCDLADRE.CPAYS;                     13518   
       DEMAT_ADR.REGIF            = TCDLADRE.REGIC;                     13519   
       DEMAT_ADR.EMETT.NUTEL      = SUBSTR(M001_NOCRD,31,2) !!          13520   
                                    SUBSTR(M001_NOCRD,34,2) !!          13521   
                                    SUBSTR(M001_NOCRD,37,2) !!          13522   
                                    SUBSTR(M001_NOCRD,40,2) !!          13523   
                                    SUBSTR(M001_NOCRD,43,2)  ;          13524   
       DEMAT_ADR.EMETT.NUFAX      = ''                   ;              13525   
       DEMAT_ADR.EMETT.SIREM      = TCDLADRE.SIREN;                     13526   
       DEMAT_ADR.EMETT.RECOU      = SUBSTR(M001_VICRD,34,2) !!          13527   
                                    SUBSTR(M001_VICRD,37,2) !!          13528   
                                    SUBSTR(M001_VICRD,40,2) !!          13529   
                                    SUBSTR(M001_VICRD,43,2) !!          13530   
                                    SUBSTR(M001_VICRD,46,2)  ;          13531   
       WRITE FILE(FICDEMA) FROM (DEMAT_ADR)      ;                      13532   
       CTR_LIG_DEMA               = CTR_LIG_DEMA + 1 ;                  13533   
                                                                        13534   
                                      /* INIT. ZONE ADRESSE COMP. AD2 */13535   
       DEMAT_AD2.ID.NUCLI         = DEMAT_ADR.ID.NUCLI          ;       13536   
       DEMAT_AD2.ID.DAFAC         = DEMAT_ADR.ID.DAFAC          ;       13537   
       DEMAT_AD2.ID.GNATO         = DEMAT_ADR.ID.GNATO          ;       13538   
       DEMAT_AD2.ID.RUNFA         = DEMAT_ADR.ID.RUNFA          ;       13539   
       DEMAT_AD2.ID.NUFAC         = DEMAT_ADR.ID.NUFAC          ;       13540   
       DEMAT_AD2.ID.NULIG         = DEMAT_AD2.ID.NULIG + 1      ;       13541   
       DEMAT_AD2.ID.COENR         = 'E'                         ;       13542   
       DEMAT_AD2.ID.TYPDE         = DEMAT_ADR.ID.TYPDE          ;       13543   
       DEMAT_AD2.ID.ENSEQ         = DEMAT_AD2.ID.ENSEQ + 1      ;       13544   
       DEMAT_AD2.GS.TYPEN         = 'AD2'                       ;       13545   
       DEMAT_AD2.GS.NULOT         = ''                          ;       13546   
       DEMAT_AD2.GS.EANFO         = WL_CLLIV.NUCLI              ;       13547   
       DEMAT_AD2.GS.NUFAC         = ENTET70.NORUN !! WNUFAC_5   ;       13548   
0      SPIPA                      = '';  /*   TABLE DES ADRESSES CNUD2*/13549   
       SPIPA.FONCT                = 'RP';                               13550   
       SPIPA.COTAB                = 'CDLADRES';                         13551   
       SPIPA.OPERA                = '=';                                13552   
       SPIPA.REFPO                = TCDLFDEM.CNUD2;                     13553   
       CALL SPI2TBV (SPIPA,TCDLADRE,SPIFI);                             13554   
       IF SPIPA.CORET ^= '00' THEN DO;                                  13555   
          TCDLADRE                = '' ;                                13556   
          TCDLADRE.CNUDC          = TCDLFDEM.CNUD2;                     13557   
          END;                                                          13558   
       DEMAT_AD2.GS.LIVREA.CNUD2  = TCDLADRE.CNUDC;                     13559   
       DEMAT_AD2.GS.LIVREA.RASOC  = TCDLADRE.RASOC;                     13560   
       DEMAT_AD2.GS.LIVREA.NOCLI  = TCDLADRE.NOCLI;                     13561   
       DEMAT_AD2.GS.LIVREA.ADCLI  = TCDLADRE.ADCLI;                     13562   
       DEMAT_AD2.GS.LIVREA.LORES  = TCDLADRE.LORES;                     13563   
       DEMAT_AD2.GS.LIVREA.LOBDI  = TCDLADRE.LOBDI;                     13564   
       DEMAT_AD2.GS.LIVREA.CPCLI  = TCDLADRE.CPCLI;                     13565   
       DEMAT_AD2.GS.LIVREA.CPAYS  = TCDLADRE.CPAYS;                     13566   
       DEMAT_AD2.GS.LIVREA.SIREN  = TCDLADRE.SIREN;                     13567   
0      SPIPA                      = '';  /*   TABLE DES ADRESSES CNUD7*/13568   
       SPIPA.FONCT                = 'RP';                               13569   
       SPIPA.COTAB                = 'CDLADRES';                         13570   
       SPIPA.OPERA                = '=';                                13571   
       SPIPA.REFPO                = TCDLFDEM.CNUD7;                     13572   
       CALL SPI2TBV (SPIPA,TCDLADRE,SPIFI);                             13573   
       IF SPIPA.CORET ^= '00' THEN DO;                                  13574   
       /* SPIPA.CORET ^= '00' & TCDLFDEM.CNUD7 ^= ' ' THEN DO */        13575   
          TCDLADRE                = '' ;                                13576   
          TCDLADRE.CNUDC          = TCDLFDEM.CNUD7;                     13577   
          END;                                                          13578   
       DEMAT_AD2.GS.LIVPAR.CNUD7  = TCDLADRE.CNUDC;                     13579   
       DEMAT_AD2.GS.LIVPAR.RASOC  = TCDLADRE.RASOC;                     13580   
       DEMAT_AD2.GS.LIVPAR.NOCLI  = TCDLADRE.NOCLI;                     13581   
       DEMAT_AD2.GS.LIVPAR.ADCLI  = TCDLADRE.ADCLI;                     13582   
       DEMAT_AD2.GS.LIVPAR.LORES  = TCDLADRE.LORES;                     13583   
       DEMAT_AD2.GS.LIVPAR.LOBDI  = TCDLADRE.LOBDI;                     13584   
       DEMAT_AD2.GS.LIVPAR.CPCLI  = TCDLADRE.CPCLI;                     13585   
       DEMAT_AD2.GS.LIVPAR.CPAYS  = TCDLADRE.CPAYS;                     13586   
       DEMAT_AD2.GS.LIVPAR.SIREN  = TCDLADRE.SIREN;                     13587   
0      SPIPA                      = '';  /*   TABLE DES ADRESSES CNUD6*/13588   
       SPIPA.FONCT                = 'RP';                               13589   
       SPIPA.COTAB                = 'CDLADRES';                         13590   
       SPIPA.OPERA                = '=';                                13591   
       SPIPA.REFPO                = TCDLFDEM.CNUD6;                     13592   
       CALL SPI2TBV (SPIPA,TCDLADRE,SPIFI);                             13593   
       IF SPIPA.CORET ^= '00' THEN DO;                                  13594   
          TCDLADRE                = '' ;                                13595   
          TCDLADRE.CNUDC          = TCDLFDEM.CNUD6;                     13596   
          END;                                                          13597   
       DEMAT_AD2.GS.REGLEA.CNUD6  = TCDLADRE.CNUDC;                     13598   
       DEMAT_AD2.GS.REGLEA.RASOC  = TCDLADRE.RASOC;                     13599   
       DEMAT_AD2.GS.REGLEA.NOCLI  = TCDLADRE.NOCLI;                     13600   
       DEMAT_AD2.GS.REGLEA.ADCLI  = TCDLADRE.ADCLI;                     13601   
       DEMAT_AD2.GS.REGLEA.LORES  = TCDLADRE.LORES;                     13602   
       DEMAT_AD2.GS.REGLEA.LOBDI  = TCDLADRE.LOBDI;                     13603   
       DEMAT_AD2.GS.REGLEA.CPCLI  = TCDLADRE.CPCLI;                     13604   
       DEMAT_AD2.GS.REGLEA.CPAYS  = TCDLADRE.CPAYS;                     13605   
       DEMAT_AD2.GS.REGLEA.SIREN  = TCDLADRE.SIREN;                     13606   
0      SPIPA                      = '';  /*   TABLE DES ADRESSES CNUD9*/13607   
       SPIPA.FONCT                = 'RP';                               13608   
       SPIPA.COTAB                = 'CDLADRES';                         13609   
       SPIPA.OPERA                = '=';                                13610   
       SPIPA.REFPO                = TCDLFDEM.CNUD9;                     13611   
       CALL SPI2TBV (SPIPA,TCDLADRE,SPIFI);                             13612   
       IF SPIPA.CORET ^= '00' THEN DO;                                  13613   
       /* SPIPA.CORET ^= '00' & TCDLFDEM.CNUD9 ^= ' ' THEN DO */        13614   
          TCDLADRE                = '' ;                                13615   
          TCDLADRE.CNUDC          = TCDLFDEM.CNUD9;                     13616   
          END;                                                          13617   
       DEMAT_AD2.GS.DCLTVA.CNUD9  = TCDLADRE.CNUDC;                     13618   
       DEMAT_AD2.GS.DCLTVA.RASOC  = TCDLADRE.RASOC;                     13619   
       DEMAT_AD2.GS.DCLTVA.NOCLI  = TCDLADRE.NOCLI;                     13620   
       DEMAT_AD2.GS.DCLTVA.ADCLI  = TCDLADRE.ADCLI;                     13621   
       DEMAT_AD2.GS.DCLTVA.LORES  = TCDLADRE.LORES;                     13622   
       DEMAT_AD2.GS.DCLTVA.LOBDI  = TCDLADRE.LOBDI;                     13623   
       DEMAT_AD2.GS.DCLTVA.CPCLI  = TCDLADRE.CPCLI;                     13624   
       DEMAT_AD2.GS.DCLTVA.CPAYS  = TCDLADRE.CPAYS;                     13625   
       DEMAT_AD2.GS.DCLTVA.SIREN  = TCDLADRE.SIREN;                     13626   
0      WRITE FILE(FICDEMA) FROM (DEMAT_AD2);                            13627   
       CTR_LIG_DEMA               = CTR_LIG_DEMA + 1 ;                  13628   
                                                                        13629   
 END INIT_ENREG_ADR;                                                    13630   
                                                                        13631   
 /* INIT_ENREG_NBL: PROC       INITIALISATION FACTURE DEMAT */          13632   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     13633   
   /*  DEMAT_NBL.ID.NUCLI      = WTFAC.NUCLI                            13634   
       DEMAT_NBL.ID.DAFAC      = STRING(DFDTF)                          13635   
       DEMAT_NBL.ID.GNATO      = WTFAC.GS.GNATO                         13636   
       DEMAT_NBL.ID.RUNFA      = WTFAC.NORUN                            13637   
       DEMAT_NBL.ID.NUFAC      = WNUFAC                                 13638   
       DEMAT_NBL.ID.NULIG      = DEMAT_NBL.ID.NULIG + 1                 13639   
       DEMAT_NBL.ID.COENR      = 'F'                                    13640   
       DEMAT_NBL.ID.ENSEQ      = DEMAT_NBL.ID.ENSEQ + 1       */        13641   
                                                                        13642   
                                 /* INIT. ENREG NUMERO DE BL     */     13643   
    /* DEMAT_NBL.GS.TYPEN      = 'ADR'                                  13644   
       DEMAT_NBL.GS.NULOT      = ''                                     13645   
       DEMAT_NBL.GS.EANFO      = WL_CLLIV.NUCLI                         13646   
       DEMAT_NBL.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5        */    13647   
 /* END INIT_ENREG_NBL */                                               13648   
                                                                        13649   
 INIT_ENREG_LIG: PROC;            /* INITIALISATION FACTURE DEMAT */    13650   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     13651   
       DEMAT_LIG               = '' ;                                   13652   
       DEMAT_LIG.TYPEN         = 'LIG';                                 13653   
       DEMAT_LIG.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5 ;            13654   
       DEMAT_LIG.NUCLI         = WTFAC.NUCLI   ;                        13655   
       DEMAT_LIG.GNATO         = WTFAC.GNATO   ;                        13656   
       DEMAT_LIG.RUNFA         = WRESL.RUNFA   ;                        13657   
       DEMAT_LIG.ID.NUFAC      = WRESL.NUFAC   ;                        13658   
       DEMAT_LIG.COENR         = 'G'           ;                        13659   
       DEMAT_LIG.TYPDE         = MOD_DEMA      ;                        13660   
       DEMAT_LIG.DAFAC         = '20' !! ENTET70.DAT10.AA !!            13661   
                                 ENTET70.DAT10.MM !!                    13662   
                                 ENTET70.DAT10.JJ ;                     13663   
       DEMAT_LIG.GS.EANFO      = WL_CLLIV.NUCLI;                        13664   
 END INIT_ENREG_LIG;                                                    13665   
                                                                        13666   
 INIT_ENREG_LEC: PROC;            /* INITIALISATION FACTURE DEMAT */    13667   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     13668   
    /* PUT SKIP LIST ('ETIQ INIT_ENREG_LEC   ******')        */         13669   
       DEMAT_LEC.ID.NUCLI      = WTFAC.NUCLI                 ;          13670   
       DEMAT_LEC.ID.DAFAC      = STRING(DFDTF)               ;          13671   
       DEMAT_LEC.ID.GNATO      = WTFAC.GS.GNATO              ;          13672   
       DEMAT_LEC.ID.RUNFA      = WTDAT.NORUN                 ;          13673   
       DEMAT_LEC.ID.NUFAC      = WNUFAC                      ;          13674   
       DEMAT_LEC.ID.NULIG      = DEMAT_LEC.ID.NULIG + 1      ;          13675   
       DEMAT_LEC.ID.COENR      = 'H'                         ;          13676   
       DEMAT_LEC.ID.TYPDE      = MOD_DEMA                    ;          13677   
       DEMAT_LEC.ID.ENSEQ      = DEMAT_LEC.ID.ENSEQ + 1      ;          13678   
                                                                        13679   
                                 /* INIT. ENREG LIGNE ECHEANCE   */     13680   
       DEMAT_LEC.GS.TYPEN      = 'LEC'                       ;          13681   
       DEMAT_LEC.GS.NULOT      = ''                          ;          13682   
       DEMAT_LEC.GS.EANFO      = WL_CLLIV.NUCLI              ;          13683   
       DEMAT_LEC.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5   ;          13684   
 END INIT_ENREG_LEC;                                                    13685   
                                                                        13686   
 INIT_ENREG_PIE: PROC;            /* INITIALISATION FACTURE DEMAT */    13687   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     13688   
       DEMAT_PIE.ID.NUCLI      = WTFAC.NUCLI                 ;          13689   
       DEMAT_PIE.ID.DAFAC      = STRING(DFDTF)               ;          13690   
       DEMAT_PIE.ID.GNATO      = WTFAC.GS.GNATO              ;          13691   
       DEMAT_PIE.ID.RUNFA      = WTDAT.NORUN                 ;          13692   
       DEMAT_PIE.ID.NUFAC      = WNUFAC                      ;          13693   
   /*  DEMAT_PIE.ID.NULIG      = DEMAT_PIE.ID.NULIG + 1      */         13694   
       DEMAT_PIE.ID.COENR      = 'I'                         ;          13695   
       DEMAT_PIE.ID.TYPDE      = MOD_DEMA                    ;          13696   
   /*  DEMAT_PIE.ID.ENSEQ      = DEMAT_PIE.ID.ENSEQ + 1      */         13697   
                                                                        13698   
                                 /* INIT. ENREG PIED FACTURE     */     13699   
       DEMAT_PIE.GS.TYPEN      = 'PIE'                       ;          13700   
       DEMAT_PIE.GS.NULOT      = ''                          ;          13701   
       DEMAT_PIE.GS.EANFO      = WL_CLLIV.NUCLI              ;          13702   
       DEMAT_PIE.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5   ;          13703   
 END INIT_ENREG_PIE;                                                    13704   
                                                                        13705   
 TRAIT_ENREG_ENT: PROC;            /* TRAIT. ENT     FACTURE DEMAT */   13706   
       SELECT ( WTFAC.GS.NATOP );  /* YDU 03.07                    */   13707   
          WHEN ('12','15','16','22','31','33') DO;                      13708   
             DEMAT_ENT.GS.TYPFA  = '381' ;                              13709   
             END;                                                       13710   
          OTHERWISE    DO;                                              13711   
             DEMAT_ENT.GS.TYPFA  = '380' ;                              13712   
             END;                                                       13713   
          END;                                                          13714   
       IF FACT.NETHT < 0   THEN DEMAT_ENT.GS.SMONHT = '-'   ;           13715   
                           ELSE DEMAT_ENT.GS.SMONHT = '+'   ;           13716   
       DEMAT_ENT.GS.MONHT  = FACT.NETHT                     ;           13717   
       IF FACT.DEBIT < 0   THEN DEMAT_ENT.GS.SMTTTC = '-'   ;           13718   
                           ELSE DEMAT_ENT.GS.SMTTTC = '+'   ;           13719   
       DEMAT_ENT.GS.MTTTC  = FACT.DEBIT                     ;           13720   
       IF FACT.TAXES < 0   THEN DEMAT_ENT.GS.SMTTVA = '-'   ;           13721   
                           ELSE DEMAT_ENT.GS.SMTTVA = '+'   ;           13722   
       IF WTFAC.POFIS = '0' ! WTFAC.POFIS = '2' !                       13723   
          WTFAC.POFIS = '3' ! WTFAC.POFIS = '5' !                       13724   
          WTFAC.POFIS = '7' THEN DO;                                    13725   
          DEMAT_ENT.GS.MTTVA = FACT.TAXES                   ;           13726   
          END;             ELSE DO;                                     13727   
          DEMAT_ENT.GS.MTTVA = 0                            ;           13728   
          END;                                              ;           13729   
       F15D2               = FRAIS - SVG_MTEMB_TTC          ;           13730   
       IF F15D2 < 0        THEN DEMAT_ENT.GS.SMTFRA = '-'   ;           13731   
                           ELSE DEMAT_ENT.GS.SMTFRA = '+'   ;           13732   
       DEMAT_ENT.GS.MTFRA  = F15D2                          ;           13733   
       DEMAT_ENT.GS.DEVIS  = 'EUR'                          ;           13734   
       DEMAT_ENT.GS.DAFAC  = STRING(DFDTF)                  ;           13735   
       F15D2               = FRAIS_HT - SVG_MTEMB_HT        ;           13736   
       IF F15D2 < 0        THEN DEMAT_ENT.GS.SMTTRA = '-'   ;           13737   
                           ELSE DEMAT_ENT.GS.SMTTRA = '+'   ;           13738   
       DEMAT_ENT.GS.MTTRA  = F15D2                          ;           13739   
       DEMAT_ENT.GS.DAINS  = ''                             ;           13740   
       DEMAT_ENT.GS.HEINS  = ''                             ;           13741   
       DEMAT_ENT.MTEMB     = SVG_MTEMB_HT                   ;           13742   
       IF SVG_MTEMB_HT  < 0 THEN DEMAT_ENT.SMTEMB    = '-'  ;           13743   
                            ELSE DEMAT_ENT.SMTEMB    = '+'  ;           13744   
       DEMAT_ENT.SMTAFR    = '+'                            ;           13745   
       IF WRDAT.COENR = 'OF' THEN DEMAT_ENT.GS.CDORR = 'O'  ;           13746   
                             ELSE DEMAT_ENT.GS.CDORR = 'R'  ;           13747   
0                                        /*   GESTION ECHEANCES DEMAT */13748   
       DF_NB_ECH             = 0 ;                                      13749   
       DO I = 1 TO 8 ;                                                  13750   
          IF TABZ.WZ_DAECH(I) ^= ''                                     13751   
             THEN DF_NB_ECH    = DF_NB_ECH + 1 ;                        13752   
          END;                                                          13753   
       DEMAT_ENT.GS.NBECH    = DF_NB_ECH      ;                         13754   
       IF DF_NB_ECH = 1 THEN DO ;                                       13755   
          DEMAT_ENT.GS.DAECH = '20' !! TABZ.WZ_DAECH(1);                13756   
          END;                           ELSE DO;                       13757   
          DEMAT_ENT.GS.DAECH  = '' ;                                    13758   
          CALL TRAIT_ENREG_ECH;                                         13759   
          END;                                                          13760   
       IF WTFAC.EDIPA = '1' THEN DO;                                    13761   
          DEMAT_ENT.MTFHT          = FACT.FORTHT;                       13762   
          IF FACT.FORTHT > 0                                            13763   
             THEN DEMAT_ENT.SMTFHT = '+' ;                              13764   
             ELSE DEMAT_ENT.SMTFHT = '-' ;                              13765   
          END;                           ELSE DO;                       13766   
          DEMAT_ENT.MTFHT          = 0   ;                              13767   
          DEMAT_ENT.SMTFHT         = '+' ;                              13768   
          END;                                                          13769   
       CLE2                = WTGCO.MOREG ;                              13770   
       CALL ID470B(TBMOREG.NUTAB);                                      13771   
       DEMAT_ENT.GS.COPAE  = WCOPAE;                                    13772   
                                                                        13773   
                                         /*   RESTITUTION SVG 12-09   */13774   
        SELECT ( W_NUFAOC );                                            13775   
           WHEN (' ') DO;                                               13776   
              IF SVG_W_NUFAOC ^= ' '                                    13777   
                 THEN W_NUFAOC = SVG_W_NUFAOC;                          13778   
              END;                                                      13779   
           WHEN ('999999999') DO;                                       13780   
              IF SVG_W_NUFAOC ^= ' '                                    13781   
               & SVG_W_NUFAOC ^= '999999999'                            13782   
                 THEN W_NUFAOC = SVG_W_NUFAOC;                          13783   
              END;                                                      13784   
           OTHERWISE  DO ;                                              13785   
              END;                                                      13786   
           END;                                                         13787   
        SELECT ( W_NUBLOC );                                            13788   
           WHEN (' ') DO;                                               13789   
              IF SVG_W_NUBLOC ^= ' '                                    13790   
                 THEN W_NUBLOC = SVG_W_NUBLOC;                          13791   
              END;                                                      13792   
           WHEN ('999999999') DO;                                       13793   
              IF SVG_W_NUBLOC ^= ' '                                    13794   
               & SVG_W_NUBLOC ^= '999999999'                            13795   
                 THEN W_NUBLOC = SVG_W_NUBLOC;                          13796   
              END;                                                      13797   
           OTHERWISE  DO ;                                              13798   
              END;                                                      13799   
           END;                                                         13800   
                                                                        13801   
       DEMAT_ENT.GS.NUFAO  = W_NUFAO_RUN !! W_NUFAO_NUFAC ;             13802   
       DEMAT_ENT.GS.NUBLO  = W_NUBLO_RUN !! W_NUBLO_LOREC ;             13803   
       IF DEMAT_REF_EXIST_DQ = ' '       /*   YDU 04.07.08 SI  NUBLO= */13804   
        & DEMAT_ENT.GS.NUBLO = '99999999'                               13805   
          THEN DO;                       /*   99-99 DS ENT ==> GENERAT*/13806   
                                         /*   ION REF DQ AVEC DATE    */13807   
          DEMAT_REF_EXIST_DQ   = 'O' ;                                  13808   
          DEMAT_REF.QUALI      = 'DQ';                                  13809   
          SVG_LOREC_P          = WTFAC.LOREC ;                          13810   
          DEMAT_REF.RFDIS      = WTFAC.NORUN !!                         13811   
                                 SVG_LOREC_P !!                         13812   
                                 SVG_OPERA   ;                          13813   
          IF WTFAC.DAMMM = '00' ! WTFAC.DAMMM = '  ' THEN DO;           13814   
             DEMAT_REF.DAOPE   = '20' !! ENTET70.DAT10.AA !!            13815   
                                 ENTET70.DAT10.MM !!                    13816   
                                 ENTET70.DAT10.JJ ;                     13817   
             END;                        ELSE DO;                       13818   
             DEMAT_REF.DAOPE   = '20' !! WTFAC.DAMAA !!                 13819   
                                 WTFAC.DAMMM !! WTFAC.DAMJJ;            13820   
             END;                                                       13821   
          CALL ECRIT_DEMAT_REF;                                         13822   
          END;                                                          13823   
                                                                        13824   
       CTR_LIG_DEMA        = CTR_LIG_DEMA + 1 ;                         13825   
       DEMAT_ENT.GS.NBLFA  = CTR_LIG_DEMA     ;                         13826   
       WRITE FILE(FICDEMA) FROM (DEMAT_ENT)   ;                         13827   
                                                                        13828   
 END TRAIT_ENREG_ENT;                                                   13829   
                                                                        13830   
1TRAIT_ENREG_ECH: PROCEDURE;                                            13831   
           /*                                                           13832   
                    **************************************              13833   
                    *                                    *              13834   
                    *    ECRITURE DES LIGNES DEMAT       *              13835   
                    *    ECH SI ECHEANCES MULTIPLES      *              13836   
                    *                                    *              13837   
                    **************************************              13838   
           */                                                           13839   
       DO I = 1 TO 8 ;                                                  13840   
          IF TABZ.WZ_DAECH(I) ^= '' THEN DO;                            13841   
             DEMAT_ECH.DTECH   = '20' !! TABZ.WZ_DAECH(I);              13842   
             DEMAT_ECH.MTECH   = TABZ.WZ_MTECH(I);                      13843   
             IF TABZ.WZ_MTECH(I) > 0                                    13844   
                THEN DEMAT_ECH.SMTECH = '+' ;                           13845   
                ELSE DEMAT_ECH.SMTECH = '-' ;                           13846   
             DEMAT_ECH.ENSEQ   = DEMAT_ECH.ENSEQ + 1;                   13847   
             WRITE FILE (FICDEMA) FROM (DEMAT_ECH);                     13848   
             CTR_LIG_DEMA      = CTR_LIG_DEMA + 1 ;                     13849   
             END;                                                       13850   
          END;                                                          13851   
                                                                        13852   
 END TRAIT_ENREG_ECH;                                                   13853   
1   DECODE_LIGNE:   PROCEDURE;                                          13854   
           /*                                                           13855   
                    **************************************              13856   
                    *                                    *              13857   
                    *    SOUS PROGRAMME DE DECODAGE DE   *              13858   
                    *    LA LIGNE A PARTIR DE LIGNE1     *              13859   
                    *    POUR ALIMENTER FICHIER DEMAT    *              13860   
                    *                                    *              13861   
                    **************************************              13862   
           */                                                           13863   
0      AA00D:                                                           13864   
0                                       /*   VARIABLES GENERALES      */13865   
                                        /******************************/13866   
0          DEMAT_LIG.CT         = ''  ;                                 13867   
           DEMAT_LIG.QUARF      = 'ON';                                 13868   
0          IF ENTET70.DAT10.AA ^= ' ' &                                 13869   
              ENTET70.DAT10.MM ^= ' ' &                                 13870   
              ENTET70.DAT10.JJ ^= ' ' THEN DO;                          13871   
              PDEMFA            = ENTET70.DAT10.AA !!                   13872   
                                  ENTET70.DAT10.MM !!                   13873   
                                  ENTET70.DAT10.JJ ;                    13874   
              END;                      ELSE DO;                        13875   
              PDEMFA            = '000000' ;                            13876   
              END;                                                      13877   
0          DEMAT_LIG.LIBTI      = WTFAC.LIBTI ;                         13878   
           DEMAT_LIG.NOAUT      = WTFAC.LIBAU ;                         13879   
           IF LIGNE1_DEC.NUART  = ' '                                   13880   
              THEN DEMAT_LIG.NUART    = WTFAC.NUART ;                   13881   
              ELSE DEMAT_LIG.NUART    = LIGNE1_DEC.NUART;               13882   
           IF LIGNE1_DEC.REFLI  = ' '                                   13883   
              THEN WS_REFLI           = WTFAC.REFLI ;                   13884   
              ELSE WS_REFLI           = SUBSTR(LIGNE1_DEC.REFLI,1,10) ; 13885   
           IF SUBSTR(WS_REFLI,10,1)  ^= ' ' THEN DO;                    13886   
              I_DEB                   = 3 ;                             13887   
              END;                    ELSE DO;                          13888   
              IF SUBSTR(WS_REFLI,9,1) ^= ' ' THEN DO;                   13889   
                 I_DEB                = 2 ;                             13890   
                 END;                 ELSE DO;                          13891   
                 I_DEB                = 1 ;                             13892   
                 END;                                                   13893   
              END;                      /*   FIN PRISE 8 DERNIERS CAR.*/13894   
           DEMAT_LIG.REFLI      = SUBSTR(WS_REFLI,I_DEB,8);             13895   
           DEMAT_LIG.LIEDI      = LIGNE_NUEDI.LIEDI !!                  13896   
                                  LIGNE_NUEDI.FIL02 !!                  13897   
                                  LIGNE_NUEDI.LIDIV ;                   13898   
           CODECH               = SUBSTR(LIGNE1_DEC.ECHEA,1,2) ;        13899   
           IF CODECH = ' '                                              13900   
              THEN   CODECH     = WTFAC.ECHEA ;                         13901   
0                                       /*   SURREMISE                */13902   
                                        /******************************/13903   
           IF LIGNE1_DEC.ASTER  = ' *'                                  13904   
              THEN DEMAT_LIG.SURRE      = 'O' ;                         13905   
              ELSE DEMAT_LIG.SURRE      = 'N' ;                         13906   
0                                       /*   MONTANT REMISE           */13907   
                                        /******************************/13908   
           DEMAT_LIG.MTREM      = WTFAC.FORLI - WTFAC.NETLI ;           13909   
           IF (WTFAC.FORLI - WTFAC.NETLI) > 0                           13910   
              THEN DEMAT_LIG.SMTREM     = '+' ;                         13911   
              ELSE DEMAT_LIG.SMTREM     = '-' ;                         13912   
0                                       /*   QUANTITE                 */13913   
                                        /******************************/13914   
           IF LIGNE1_DEC.QUANT  = ' ' THEN DO;                          13915   
              IF DEMAT_LIG.TYPRO   = 'C' THEN DO;/*   COLIS TETE      */13916   
                 QUANT_DEC                = '000'           !!          13917   
                                            SUBSTR(ZLIBEL,1,3) ;        13918   
                 END;                   ELSE DO;                        13919   
                                        /*   TETE COLIS ET ATM        */13920   
                 QUANT_NS                 = WTFAC.QUANT ;               13921   
                 END;                                                   13922   
              END;                     ELSE DO;                         13923   
              QUANT_DEC         = SUBSTR(LIGNE1_DEC.QUANT,1,3) !!       13924   
                                  SUBSTR(LIGNE1_DEC.QUANT,5,3) ;        13925   
              END;                                                      13926   
           QUANT_DEC            = TRANSLATE(QUANT_DEC,'0',' ');         13927   
           IF VERIFY(QUANT_DEC,'0123456789') = 0 THEN DO;               13928   
              DEMAT_LIG.QTFAC   = QUANT_NS ;                            13929   
              END;                                                      13930   
0                                       /*   NET HT                   */13931   
                                        /******************************/13932   
           IF LIGNE1_DEC.NETHT  = ' ' THEN DO;                          13933   
                                        /*   TETE COLIS ET ATM        */13934   
              NET_NS            = WTFAC.NETLI ;                         13935   
              IF WTFAC.NETLI > 0                                        13936   
                 THEN DEMAT_LIG.SNETHT = '+' ;                          13937   
                 ELSE DEMAT_LIG.SNETHT = '-' ;                          13938   
              END;                      ELSE DO;                        13939   
              NET_DEC           = SUBSTR(LIGNE1_DEC.NETHT,1,5) !!       13940   
                                  SUBSTR(LIGNE1_DEC.NETHT,7,3) !!       13941   
                                  SUBSTR(LIGNE1_DEC.NETHT,11,2) ;       13942   
              IF SUBSTR(LIGNE1_DEC.NETHT,13,1) = '-'                    13943   
                 THEN DEMAT_LIG.SNETHT  = '-' ;                         13944   
                 ELSE DEMAT_LIG.SNETHT  = '+' ;                         13945   
              END;                                                      13946   
           NET_DEC              = TRANSLATE(NET_DEC,'0',' ');           13947   
           IF VERIFY(NET_DEC,'0123456789') = 0 THEN DO;                 13948   
              DEMAT_LIG.NETHT   = NET_NS ;                              13949   
              END;                                                      13950   
0                                       /*   TAUX REMISE              */13951   
                                        /******************************/13952   
           IF LIGNE1_DEC.REMIS  = ' ' THEN DO;                          13953   
                                        /*   TETE COLIS ET ATM        */13954   
              REMIS_NS          = WTFAC.RAPLI ;                         13955   
              END;                      ELSE DO;                        13956   
              REMIS_DEC         = SUBSTR(LIGNE1_DEC.REMIS,1,3) !!       13957   
                                  SUBSTR(LIGNE1_DEC.REMIS,5,2) ;        13958   
              END;                                                      13959   
           REMIS_DEC            = TRANSLATE(REMIS_DEC,'0',' ');         13960   
           IF VERIFY(REMIS_DEC,'0123456789') = 0 THEN DO;               13961   
              DEMAT_LIG.TXREM   = REMIS_NS ;                            13962   
              END;                                                      13963   
0                                       /*   PIPUB HT                 */13964   
                                        /******************************/13965   
           PRIX_DEC             = SUBSTR(LIGNE1_DEC.PIPUB,1,5) !!       13966   
                                  SUBSTR(LIGNE1_DEC.PIPUB,7,2) ;        13967   
           PRIX_DEC             = TRANSLATE(PRIX_DEC,'0',' ');          13968   
           IF VERIFY(PRIX_DEC,'0123456789') = 0 THEN DO;                13969   
              DEMAT_LIG.PPUHT   = PRIX_NS  ;                            13970   
              END;                                                      13971   
0                                       /*   PUNHT HT                 */13972   
                                        /******************************/13973   
           IF LIGNE1_DEC.PUNHT = ' ' THEN DO;                           13974   
                                        /*   TETE COLIS ET ATM        */13975   
              PRIX_NS           = WTFAC.PUNHT ;                         13976   
              END;                      ELSE DO;                        13977   
              PRIX_DEC          = SUBSTR(LIGNE1_DEC.PUNHT,1,5) !!       13978   
                                     SUBSTR(LIGNE1_DEC.PUNHT,7,2) ;     13979   
              PRIX_DEC          = TRANSLATE(PRIX_DEC,'0',' ');          13980   
              END;                                                      13981   
           IF VERIFY(PRIX_DEC,'0123456789') = 0 THEN DO;                13982   
              DEMAT_LIG.PUNHT   = PRIX_NS  ;                            13983   
              END;                                                      13984   
0                                       /*   PRIBB TC                 */13985   
                                        /******************************/13986   
           PRIX_DEC             = SUBSTR(LIGNE1_DEC.PRIBB,1,5) !!       13987   
                                  SUBSTR(LIGNE1_DEC.PRIBB,7,2) ;        13988   
           PRIX_DEC             = TRANSLATE(PRIX_DEC,'0',' ');          13989   
           IF VERIFY(PRIX_DEC,'0123456789') = 0 THEN DO;                13990   
              DEMAT_LIG.PPUTC   = PRIX_NS  ;                            13991   
              END;                                                      13992   
0                                       /*   TAUX TAXE                */13993   
                                        /******************************/13994   
           IF LIGNE1_DEC.COTAX ^= SVG_DEMAT_COTAX                       13995   
            & LIGNE1_DEC.COTAX ^= ' ' THEN DO;                          13996   
              SVG_DEMAT_COTAX   = LIGNE1_DEC.COTAX ;                    13997   
              CLE1              = SVG_DEMAT_COTAX  ;                    13998   
              WPOFIS            = WTFAC.POFIS;                          13999   
              CALL ID470B(TBCOTAX.NUTAB);                               14000   
              REMIS_DEC         = SUBSTR(WTOLEG,1,3) !!                 14001   
                                  SUBSTR(WTOLEG,5,2) ;                  14002   
              REMIS_DEC         = TRANSLATE(REMIS_DEC,'0',' ');         14003   
              IF VERIFY(REMIS_DEC,'0123456789') = 0 THEN DO;            14004   
                 SVG_DEMAT_TXTAX   = REMIS_NS ;                         14005   
                 END;           ELSE DO;                                14006   
                 SVG_DEMAT_TXTAX   = 0        ;                         14007   
                 END;                                                   14008   
              END;                                                      14009   
           IF LIGNE1_DEC.COTAX   = ' ' THEN DO;                         14010   
                                         /*   09.2007 GRATUIT MT=0    */14011   
              IF DEMAT_LIG.TYPRO = 'U' THEN DO;                         14012   
                 SVG_DEMAT_COTAX    = WTFAC.COTAX;                      14013   
                 CLE1               = SVG_DEMAT_COTAX;                  14014   
                 WPOFIS             = WTFAC.POFIS;   /*EDI-351 09/2024*/14015   
                 CALL ID470B(TBCOTAX.NUTAB);                            14016   
                 REMIS_DEC          = SUBSTR(WTOLEG,1,3) !!             14017   
                                      SUBSTR(WTOLEG,5,2) ;              14018   
                 REMIS_DEC          = TRANSLATE(REMIS_DEC,'0',' ');     14019   
                 IF VERIFY(REMIS_DEC,'0123456789') = 0 THEN DO;         14020   
                    SVG_DEMAT_TXTAX = REMIS_NS ;                        14021   
                    END;         ELSE DO;                               14022   
                    SVG_DEMAT_TXTAX = 0       ;                         14023   
                    END;                                                14024   
                 DEMAT_LIG.TXTAX    = SVG_DEMAT_TXTAX ;                 14025   
                 END;                                                   14026   
              IF DEMAT_LIG.TYPRO = 'A' THEN DO;                         14027   
                 DEMAT_LIG.TXTAX    = 0               ;                 14028   
                 END;                                                   14029   
              END;                      ELSE DO;                        14030   
              DEMAT_LIG.TXTAX       = SVG_DEMAT_TXTAX ;                 14031   
              END;                                                      14032   
0                                       /*   CAS COLIS HOMOGENE       */14033   
                                        /******************************/14034   
           IF DEMAT_LIG.TYPRO = 'C' THEN DO;                            14035   
              SVG_DEMAT_COTAX   = WTFAC.COTAX;                          14036   
              CLE1              = SVG_DEMAT_COTAX  ;                    14037   
              WPOFIS            = WTFAC.POFIS;    /*EDI-351 09/2024*/   14038   
              CALL ID470B(TBCOTAX.NUTAB);                               14039   
              REMIS_DEC         = SUBSTR(WTOLEG,1,3) !!                 14040   
                                  SUBSTR(WTOLEG,5,2) ;                  14041   
              REMIS_DEC         = TRANSLATE(REMIS_DEC,'0',' ');         14042   
              IF VERIFY(REMIS_DEC,'0123456789') = 0                     14043   
                 THEN SVG_DEMAT_TXTAX = REMIS_NS ;                      14044   
                 ELSE SVG_DEMAT_TXTAX = 0        ;                      14045   
              DEMAT_LIG.TXTAX   = SVG_DEMAT_TXTAX;                      14046   
              END;                                                      14047   
 /* PCA 20150630 MISE A ZERO TAUX TVA EXPORT                        */  14048   
           IF  WTFAC.DEPCO = '17' THEN DEMAT_LIG.TXTAX = 0;             14049   
                                                                        14050   
0      AA00F:                                                           14051   
           END DECODE_LIGNE;                                            14052   
1   ECRIT_DEMAT_LIG:     PROCEDURE;                                     14053   
           /*                                                           14054   
                    **************************************              14055   
                    *                                    *              14056   
                    *    SOUS PROGRAMME D ECRITURE DE    *              14057   
                    *    LA LIGNE DETAIL DEMAT           *              14058   
                    *                                    *              14059   
                    **************************************              14060   
           */                                                           14061   
0      AB00D:                                                           14062   
0                                       /*   DOCUM ECHEANCE           */14063   
                                        /******************************/14064   
0          IF SVG_TYREF = '3' THEN DO;  /* 20-07-07 PAS DEMAT FR.PORT */14065   
              GO TO AB00F;                                              14066   
              END;                                                      14067   
0          DEMAT_LIG.MTECH              = SVG_AMTTC ;                   14068   
           IF SVG_AMTTC > 0                                             14069   
              THEN DEMAT_LIG.SMTECH     = '+' ;                         14070   
              ELSE DEMAT_LIG.SMTECH     = '-' ;                         14071   
           DEMAT_LIG.DTECH              = '20' !! SVG_DAECH ;           14072   
0          IF TOP_DEMA_LIG = 'O' &                                      14073   
              TOP_DEMA_FAC = 'O' THEN DO;                               14074   
              /* MISE EN COMMENTAIRE, MAINTENANT ON ENVOIE LES */       14075   
              /* COMPOSANTS GRATUITS : BFA 04/12/2006 A LA     */       14076   
              /* DEMANDE DE JDU ET CVE                         */       14077   
              /* 05/12/2006 : ON LAISSE PASSER LES GRATUITS    */       14078   
              /* MAIS PAS LES LIBELLES (TYREF 5 ET EDI/DIV/COL */       14079   
              /* 998/98/98)                                    */       14080   
              IF SVG_TYREF = '5' &                                      14081   
                 SVG_NUEDI = '998' &                                    14082   
                 SVG_NUDIV = '98' &                                     14083   
                 SVG_NUCOL = '98' THEN DO;                              14084   
                 CTR_LIG_COM            = CTR_LIG_COM + 1 ;             14085   
                 IF CTR_LIG_COM < 51 THEN DO;                           14086   
                    DEMAT_COM.TYPCO     = 'SUR' ;                       14087   
                    DEMAT_COM.ZOCOM     = LIGNE1_DEC.QUANT !!           14088   
                                          LIGNE1_DEC.LIBEL !!           14089   
                                          LIGNE1_DEC.NETHT ;            14090   
                    DEMAT_COM.ENSEQ     = DEMAT_COM.ENSEQ + 1;          14091   
                    WRITE FILE (FICDEMA) FROM (DEMAT_COM) ;             14092   
                    CTR_LIG_DEMA        = CTR_LIG_DEMA + 1 ;            14093   
                    END;                 ELSE DO;                       14094   
                    LOG_COM.ZOCOM       = ''            ;               14095   
                    LOG_COM.ZOCOM       = LIGNE1_DEC.QUANT !!           14096   
                                          LIGNE1_DEC.LIBEL !!           14097   
                                          LIGNE1_DEC.NETHT ;            14098   
                    WRITE FILE(FICLCOM) FROM(LOG_COM)   ;               14099   
                    NB_FICLCOM          = NB_FICLCOM + 1;               14100   
                    END;                                                14101   
                 END;                    ELSE DO;                       14102   
                 WRITE FILE (FICDEMA) FROM (DEMAT_LIG) ;                14103   
                 CTR_LIG_DEMA           = CTR_LIG_DEMA + 1 ;            14104   
                 END;                                                   14105   
              END;                                                      14106   
0      AB00F:                                                           14107   
           END ECRIT_DEMAT_LIG;                                         14108   
1   ECRIT_DEMAT_LEC:     PROCEDURE;                                     14109   
           /*                                                           14110   
                    **************************************              14111   
                    *                                    *              14112   
                    *    SOUS PROGRAMME D ECRITURE DE    *              14113   
                    *    LA LIGNE DETAIL POUR LA         *              14114   
                    *    PARTIE LEC SI ECHEANCE MULTI.   *              14115   
                    *                                    *              14116   
                    **************************************              14117   
           */                                                           14118   
0      AC00D:                                                           14119   
0                                       /*   DOCUM ECHEANCE MULTIPLE  */14120   
                                        /******************************/14121   
0          DEMAT_LEC.MTECH              = SVG_AMTTC ;                   14122   
           IF SVG_AMTTC > 0                                             14123   
              THEN DEMAT_LEC.SMTECH     = '+' ;                         14124   
              ELSE DEMAT_LEC.SMTECH     = '-' ;                         14125   
           DEMAT_LEC.DTECH              = '20' !! SVG_DAECH ;           14126   
           DEMAT_LEC.ENSEQ              = DEMAT_LEC.ENSEQ + 1;          14127   
0          IF TOP_DEMA_LEC = 'O' &                                      14128   
              TOP_DEMA_FAC = 'O' &                                      14129   
              SVG_AMTTC   ^=  0  THEN DO;                               14130   
              WRITE FILE (FICDEMA) FROM (DEMAT_LEC) ;                   14131   
              CTR_LIG_DEMA              = CTR_LIG_DEMA + 1 ;            14132   
              CTR_LEC_DEMA              = CTR_LEC_DEMA + 1 ;            14133   
              END;                                                      14134   
0      AC00F:                                                           14135   
           END ECRIT_DEMAT_LEC;                                         14136   
1   GEST_REFERENCE:      PROCEDURE;                                     14137   
           /*                                                           14138   
                    **************************************              14139   
                    *                                    *              14140   
                    *    GESTION DES REFERENCES          *              14141   
                    *    DISTRIBUTEUR ET CLIENT          *              14142   
                    *    PARTIE LEC SI ECHEANCE MULTI.   *              14143   
                    *                                    *              14144   
                    **************************************              14145   
           */                                                           14146   
0      AD00D:                                                           14147   
        SELECT (SUBSTR(WTFAC.GNATO,1,1));                               14148   
           WHEN ('0','1') DO;            /*   FACTURE ET RECTIF       */14149   
              IF SVG_RESAI ^= WTFAC.RESAI.ANNEE !!                      14150   
                              WTFAC.RESAI.RUN   !!                      14151   
                              WTFAC.RESAI.ORIGI THEN DO;                14152   
                 SVG_RESAI  = WTFAC.RESAI.ANNEE !!                      14153   
                              WTFAC.RESAI.RUN   !!                      14154   
                              WTFAC.RESAI.ORIGI ;                       14155   
                 IF SVG_RESAI ^= ' ' THEN DO;                           14156   
                    DEMAT_REF_EXIST_SS   = 'O' ;                        14157   
                    DEMAT_REF.QUALI      = 'SS';                        14158   
                    DEMAT_REF.RFDIS      = WTFAC.RESAI.ANNEE !!         14159   
                                           WTFAC.RESAI.RUN   !! '.' !!  14160   
                                           WTFAC.RESAI.ORIGI ;          14161   
                    CALL ECRIT_DEMAT_REF;                               14162   
                    END;                                                14163   
                 END;                                                   14164   
              IF SVG_RECO1 ^= WTFAC.RECO1 THEN DO;                      14165   
                 SVG_RECO1  = WTFAC.RECO1 ;                             14166   
                 IF SVG_RECO1 ^= ' '  THEN DO;                          14167   
                    DEMAT_REF_EXIST_ON   = 'O' ;                        14168   
                    DEMAT_REF.QUALI      = 'ON';                        14169   
                    DEMAT_REF.RFDIS      = SUBSTR(WTFAC.RECO1,1,17);    14170   
                    IF DEMAT_REF.RFDIS  ^= SVG_RFDIS THEN DO;           14171   
                       CALL ECRIT_DEMAT_REF;                            14172   
                       END;              /*   09-10 YDU               */14173   
                    SVG_RFDIS            = DEMAT_REF.RFDIS;             14174   
                    END;                                                14175   
                 END;                                                   14176   
              IF SVG_NORUN ^= WTFAC.NORUN !                             14177   
                 SVG_LOREC ^= WTFAC.LOREC THEN DO;                      14178   
                 SVG_NORUN  = WTFAC.NORUN ;                             14179   
                 SVG_LOREC  = WTFAC.LOREC ;                             14180   
                 IF SVG_NORUN ^= ' '  & SVG_LOREC ^= 0 THEN DO;         14181   
                    DEMAT_REF_EXIST_DQ   = 'O' ;                        14182   
                    DEMAT_REF.QUALI      = 'DQ';                        14183   
                    SVG_LOREC_P          = WTFAC.LOREC ;                14184   
                    DEMAT_REF.RFDIS      = WTFAC.NORUN !!               14185   
                                           SVG_LOREC_P !!               14186   
                                           SVG_OPERA   ;                14187   
                    CALL ECRIT_DEMAT_REF;                               14188   
                    SVG_OPERA            = '' ;                         14189   
                    END;                                                14190   
                 END;                                                   14191   
              END;                                                      14192   
           WHEN ('3')        DO;         /*   RETOUR                  */14193   
              IF WTFAC.NATOP = '31' THEN DO;                            14194   
                 IF DEMAT_REF_EXIST_04G ^= 'O' THEN DO;                 14195   
                    DEMAT_REF_EXIST_04G  = 'O' ;                        14196   
                    DEMAT_REF.QUALI      = '04G';                       14197   
                    IF WTFAC.RECO1 ^= ' '                               14198   
                    /* PJA 20141107 - PB REFERENCE PRISME */            14199   
                    /* THEN DEMAT_REF.RFDIS = SUBSTR(WTFAC.RECO1,1,8);*/14200   
                       THEN DEMAT_REF.RFDIS = SUBSTR(WTFAC.RECO1,1,17); 14201   
                       ELSE DEMAT_REF.RFDIS = SVG_REPIE ;               14202   
                    CALL ECRIT_DEMAT_REF;                               14203   
                    END;                                                14204   
                 END;                                                   14205   
              IF SVG_REPIE ^= WTFAC.REPIE THEN DO;                      14206   
                 SVG_REPIE  = WTFAC.REPIE ;                             14207   
                 IF SVG_REPIE ^= ' ' & SVG_REPIE ^= '0000' THEN DO;     14208   
                    DEMAT_REF_EXIST_VN   = 'O' ;                        14209   
                    DEMAT_REF.QUALI      = 'VN';                        14210   
                    DEMAT_REF.RFDIS      = WTFAC.REPIE ;                14211   
                    CALL ECRIT_DEMAT_REF;                               14212   
                    END;                                                14213   
                 END;                                                   14214   
              IF SVG_RECO1 ^= WTFAC.RECO1 THEN DO;                      14215   
                 SVG_RECO1  = WTFAC.RECO1 ;                             14216   
                 IF SVG_RECO1 ^= ' ' THEN DO;                           14217   
                    DEMAT_REF_EXIST_ON   = 'O' ;                        14218   
                    DEMAT_REF.QUALI      = 'ON';                        14219   
                    DEMAT_REF.RFDIS      = SUBSTR(SVG_RECO1,1,8);       14220   
                    IF DEMAT_REF.RFDIS  ^= SVG_RFDIS THEN DO;           14221   
                       CALL ECRIT_DEMAT_REF;                            14222   
                       END;              /*   09-10 YDU               */14223   
                    SVG_RFDIS            = DEMAT_REF.RFDIS;             14224   
                    END;                                                14225   
                 END;                                                   14226   
              END;                                                      14227   
           OTHERWISE         DO;         /*   RETOUR                  */14228   
              END;                                                      14229   
           END;                                                         14230   
0      AD00F:                                                           14231   
           END GEST_REFERENCE;                                          14232   
1   ECRIT_DEMAT_REF:     PROCEDURE;                                     14233   
           /*                                                           14234   
                    **************************************              14235   
                    *                                    *              14236   
                    *    AJOUT D UNE DATE DE REFERENCE   *              14237   
                    *    DANS LA DEMAT SI IL N Y EN A    *              14238   
                    *    PAS - DEMANDE AUCHAN -          *              14239   
                    *                                    *              14240   
                    **************************************              14241   
           */                                                           14242   
0      AE00D:                                                           14243   
           IF SUBSTR(DEMAT_REF.DAOPE,3,6) = ' '      !                  14244   
              SUBSTR(DEMAT_REF.DAOPE,3,6) = '000000' THEN DO;           14245   
              IF ^(WTFAC.DAMMM = ' ' ! WTFAC.DAMMM = '00') THEN DO;     14246   
                 DEMAT_REF.DAOPE         = '20' !! WTFAC.DAMAA !!       14247   
                                           WTFAC.DAMMM !! WTFAC.DAMJJ;  14248   
                 END;                    ELSE DO;                       14249   
                 IF ^(WTFAC.DCOMM = ' ' ! WTFAC.DCOMM = '00') THEN DO;  14250   
                    DEMAT_REF.DAOPE      = '20' !! WTFAC.DCOAA !!       14251   
                                           WTFAC.DCOMM !! WTFAC.DCOJJ;  14252   
                    END;                 ELSE DO;                       14253   
                    DEMAT_REF.DAOPE      = '20' !! ENTET70.DAT10.AA !!  14254   
                                           ENTET70.DAT10.MM !!          14255   
                                           ENTET70.DAT10.JJ ;           14256   
                    END;                                                14257   
                 END;                                                   14258   
              END;                                                      14259   
           DEMAT_REF.ENSEQ    = DEMAT_REF.ENSEQ + 1;                    14260   
           WRITE FILE (FICDEMA) FROM (DEMAT_REF) ;                      14261   
           CTR_LIG_DEMA       = CTR_LIG_DEMA    + 1;                    14262   
0      AE00F:                                                           14263   
           END ECRIT_DEMAT_REF;                                         14264   
1   EXPORT_INFOC:        PROCEDURE;                                     14265   
           /*                                                           14266   
                    **************************************              14267   
                    *                                    *              14268   
                    *    GESTION DU FICHIER EXPORT       *              14269   
                    *    POUR L INFOCENTRE HARRY         *              14270   
                    *                                    *              14271   
                    **************************************              14272   
           */                                                           14273   
0      AF00D:                                                           14274   
           NB_LIGTRA            = 0 ;                                   14275   
           TB_LIGTRA(*)         = '';                                   14276   
           WEXPO                = '';                                   14277   
           WEXPO.NUFAC          = WNUFAC;                               14278   
           WEXPO.NORUN          = ENTET70.NORUN ;                       14279   
           WEXPO.DAFAC          = '20' !! ENTET70.DAT10.AA !!           14280   
                                  ENTET70.DAT10.MM !!                   14281   
                                  ENTET70.DAT10.JJ ;                    14282   
           WEXPO.INCLI.NUCLI    = WTFAC.GS.NUCLI;                       14283   
           WEXPO.INCLI.RASOC    = WTCLI1.RASOC  ;                       14284   
           WEXPO.INCLI.NOCLI    = WTCLI1.NOCLI  ;                       14285   
           WEXPO.INCLI.ADCLI    = WTCLI1.ADCLI  ;                       14286   
           WEXPO.INCLI.LORES    = WTCLI1.LORES  ;                       14287   
           WEXPO.INCLI.CPCLI    = WTCLI1.CPCLI  ;                       14288   
           WEXPO.INCLI.LOBDI    = WTCLI1.LOBDI  ;                       14289   
           WEXPO.INCLI.DEPAY    = WTCLI1.DEPAY  ;                       14290   
           WEXPO.INCLI.PAYCL    = WTCLI1.PAYCL  ;                       14291   
           WEXPO.RECOM          = WTFAC.GS.RECOM;                       14292   
           WEXPO.MOTRA          = WTFAC.GS.MOTRA;                       14293   
           WEXPO.SPENV          = WTFAC.GS.SPENV;                       14294   
           WEXPO.SYPRO          = WTCLI1.SYPRO  ;                       14295   
           IF WTCLI1.CLIFA = ' ' ! WTCLI1.CLIFA = '000000' THEN DO;     14296   
                                         /*   PAS DE CLIFA            */14297   
              END;                       ELSE DO;                       14298   
              WEXPO.INCFA.CLIFA = WTCLI1.CLIFA ;                        14299   
              WEXPO.INCFA.RASOC = WTCLI2.RASOC ;                        14300   
              WEXPO.INCFA.NOCLI = WTCLI2.NOCLI ;                        14301   
              WEXPO.INCFA.ADCLI = WTCLI2.ADCLI ;                        14302   
              WEXPO.INCFA.LORES = WTCLI2.LORES ;                        14303   
              WEXPO.INCFA.CPCLI = WTCLI2.CPCLI ;                        14304   
              WEXPO.INCFA.LOBDI = WTCLI2.LOBDI ;                        14305   
              WEXPO.INCFA.DEPAY = WTCLI2.DEPAY ;                        14306   
              WEXPO.INCFA.PAYCL = WTCLI2.PAYCL ;                        14307   
              END;                                                      14308   
                                         /*   DECODAGE LIGNES TRIFA=4 */14309   
           DO ITRIFA = 1 TO TRIFA.LIGNE;                                14310   
              LIGNE             = TRIFA.IMP(ITRIFA);                    14311   
              SELECT ( TRIFA.NUART(ITRIFA) );                           14312   
                 WHEN ('9290800','9292806','9293804') DO;               14313   
                    IF SUBSTR(LIGNE1.LIBEL,1,08) = 'COLIS NO' THEN DO;  14314   
                       COLIS_CHAR  = SUBSTR(LIGNE1.LIBEL,17,03);        14315   
                       COLIS_CHAR  = TRANSLATE(COLIS_CHAR,' ','0');     14316   
                       WEXPO.NBCOL = WEXPO.NBCOL + COLIS_CHAR_NUM;      14317   
                       END;                                             14318   
                    END;                 /*   FIN LIGNE COLIS         */14319   
                 WHEN ('9290818','9292814','9293812') DO;               14320   
                    IF SUBSTR(LIGNE1.LIBEL,1,08) = 'PALETTES' THEN DO;  14321   
                       COLIS_CHAR  = SUBSTR(LIGNE1.LIBEL,17,03);        14322   
                       COLIS_CHAR  = TRANSLATE(COLIS_CHAR,' ','0');     14323   
                       WEXPO.NBPAL = WEXPO.NBPAL + COLIS_CHAR_NUM;      14324   
                       END;                                             14325   
                    END;                 /*   FIN LIGNE PALETTES      */14326   
                 WHEN ('9290826','9292822','9293820') DO;               14327   
                    IF SUBSTR(LIGNE1.LIBEL,1,09) = 'TRANSPORT' THEN DO; 14328   
                       NB_LIGTRA   = NB_LIGTRA + 1  ;                   14329   
                       IF NB_LIGTRA > 10 THEN NB_LIGTRA = 10 ;          14330   
                       TB_LIGTRA(NB_LIGTRA) =SUBSTR(LIGNE1.LIBEL,17,25);14331   
                       END;                                             14332   
                    END;                 /*   FIN LIGNE TRANSPORT     */14333   
                 WHEN ('9290842','9292848','9293846') DO;               14334   
                    IF SUBSTR(LIGNE1.LIBEL,1,10) = 'POIDS BRUT'         14335   
                       THEN DO;                                         14336   
                       POIDS_CHAR  = SUBSTR(LIGNE1.LIBEL,17,11);        14337   
                       POIDS_CHAR  = TRANSLATE(POIDS_CHAR,' ','0');     14338   
                       WEXPO.POIDF = POIDS_CHAR_NUM ;                   14339   
                       END;                                             14340   
                    END;                 /*   FIN LIGNE POIDS BRUT    */14341   
                 WHEN ('9291113','9291139','9291105','9291121',         14342   
                       '9291154','9291147') DO;                         14343   
                    IF SUBSTR(LIGNE1.LIBEL,1,12) = 'AUTRES FRAIS'       14344   
                       THEN DO;                                         14345   
                       WEXPO.MTFRN = WEXPO.MTFRN +                      14346   
                                     TRIFA.EXPHA.MONTT(ITRIFA);         14347   
                       END;                                             14348   
                    END;                 /*   FIN LIGNE FRAIS TRANSPOR*/14349   
                 OTHERWISE DO;                                          14350   
                    IF TRIFA.TYREF(ITRIFA) = '3'                        14351   
                     & TRIFA.FRPOR(ITRIFA) = '8' THEN DO;               14352   
                                         /*   FRAIS DE TRANSPORT      */14353   
                       WEXPO.MTFRT = WEXPO.MTFRT +                      14354   
                                     TRIFA.EXPHA.MONTT(ITRIFA);         14355   
                       END;                                             14356   
                    END;                                                14357   
                 END;                    /*   FIN SELECT              */14358   
              END;                       /*   FIN BOUCLE ITRIFA       */14359   
           SELECT (NB_LIGTRA) ;                                         14360   
              WHEN ( 1 ) DO;                                            14361   
                 WEXPO.TRALO    = TB_LIGTRA(1) ;                        14362   
                 END;                                                   14363   
              WHEN ( 2 ) DO;                                            14364   
                 WEXPO.MODTR    = TB_LIGTRA(1) ;                        14365   
                 WEXPO.TRALO    = TB_LIGTRA(2) ;                        14366   
                 END;                                                   14367   
              WHEN ( 3 ) DO;                                            14368   
                 WEXPO.MODTR    = TB_LIGTRA(1) ;                        14369   
                 WEXPO.SPECL    = TB_LIGTRA(2) ;                        14370   
                 WEXPO.TRALO    = TB_LIGTRA(3) ;                        14371   
                 END;                                                   14372   
              OTHERWISE    DO;                                          14373   
                 WEXPO.MODTR    = TB_LIGTRA(1) ;                        14374   
                 WEXPO.SPECL    = TB_LIGTRA(2) ;                        14375   
                 WEXPO.TRALO    = TB_LIGTRA(3) ;                        14376   
                 END;                                                   14377   
              END;                                                      14378   
           WEXPO.MTMAR          = FACT.DEBIT - WEXPO.MTFRN              14379   
                                  - WEXPO.MTFRT;                        14380   
           IF WEXPO.NBCOL = 0 & WEXPO.POIDF = 0                         14381   
            & WEXPO.MTFRT = 0 & WEXPO.MTFRN = 0 THEN DO;                14382   
              END;                       ELSE DO;                       14383   
              WRITE FILE (EXPOHARR) FROM (WEXPO) ;                      14384   
              NB_EXPOHA         = NB_EXPOHA + 1;                        14385   
              END;                                                      14386   
0      AF00F:                                                           14387   
           END EXPORT_INFOC;                                            14388   
1   GESTION_FIR:         PROCEDURE;                                     14389   
           /*                                                           14390   
                    **************************************              14391   
                    *                                    *              14392   
                    *    GESTION ACCES AU FICHIER FIR    *              14393   
                    *    POUR LA DOCUMENTATION DES       *              14394   
                    *    INFOS ORIGINE FACTURE ET BL     *              14395   
                    *                                    *              14396   
                    **************************************              14397   
           */                                                           14398   
0      AG00D:                                                           14399   
           IF W_NATOP = '12' ! W_NATOP = '14' !                         14400   
              W_NATOP = '15' ! W_NATOP = '32' !                         14401   
              W_NATOP = '33' ! W_NATOP = '52' !                         14402   
              W_NATOP = '53' ! W_NATOP = '54' !                         14403   
              /* PJA 201410 - NATOP '62' SE TRANSFORME EN '16' */       14404   
              /* W_NATOP = '62' !  /* PJA 201311 : ACTION EDI 100 */    14405   
              W_NATOP = '16' !                                          14406   
              W_NATOP = '31' THEN DO;                                   14407   
  /*             IF W_ETOIL = '*' THEN DO 17.04.08 QUELQUE SOIT ETOIL */14408   
              IF VERIFY(W_NUPAC,NUMERIC) = 0                            14409   
                 THEN W_NUPACP      = W_NUPAC;                          14410   
                 ELSE W_NUPACP      = 0   ;                             14411   
              WK_RECHE_FIRENT       = 'O' ;                             14412   
              /* PUT SKIP LIST('W_NUPACC = ' !! W_NUPACC); */           14413   
              READ FILE(FIRENT) INTO(WZON_ENT) KEY(W_NUPACC) ;          14414   
              IF WK_RECHE_FIRENT = 'O'                                  14415   
               & WTFAC.NUCLI = E_NUCLI THEN DO;                         14416   
                 W_NATOP_FIR        = E_NATOP;                          14417   
                 WS_FIR_RECOM       = E_RECOM;                          14418   
                 IF E_RUNFA ^= ' ' THEN DO;                             14419   
                    W_NUFAO_RUN     = E_RUNFA;                          14420   
                    W_NUFAO_SEP     = ' ';                              14421   
                    W_NUFAO_NUFAC   = E_NUFAC;                          14422   
                    LIGNE_FIR.NUFAO = W_NUFAOC;                         14423   
                    END;                 ELSE DO;                       14424   
                    W_NUFAOC        = '999999999';                      14425   
                    LIGNE_FIR.NUFAO = ' ';                              14426   
                    END;                                                14427   
                 IF W_NATOP_FIR = '31' ! W_NATOP_FIR = '22' !           14428   
                    W_NATOP_FIR = '16' ! W_NATOP_FIR = '74' !           14429   
                    W_NATOP_FIR = '12' ! W_NATOP_FIR = '14' !           14430   
                    W_NATOP_FIR = '15' ! W_NATOP_FIR = '32' !           14431   
                    W_NATOP_FIR = '33' ! W_NATOP_FIR = '52' !           14432   
              /* PJA 201410 - NATOP '62' SE TRANSFORME EN '16' */       14433   
                    /* PJA 201311 : ACTION EDI 100 */                   14434   
                    /* W_NATOP_FIR = '62' !        */                   14435   
                    W_NATOP_FIR = '53' ! W_NATOP_FIR = '54'             14436   
                    THEN DO;                                            14437   
                    W_NUBLOC        = '999999999';                      14438   
                    LIGNE_FIR.NUBLO = ' ';                              14439   
                    END;                 ELSE DO;                       14440   
                    W_NUBLO_RUN     = E_NORUN;                          14441   
                    W_NUBLO_SEP     = ' ';                              14442   
                    W_NUBLO_LOREC   = E_LOREC;                          14443   
                    LIGNE_FIR.NUBLO = W_NUBLOC;                         14444   
                    END;                                                14445   
                 IF W_NATOP = '31' THEN DO;                             14446   
                    W_RECOO31       = E_RECOM;                          14447   
                                         /*   YDU 09.09 PAS TEST SOUFF*/14448   
                    W_RECOO         = E_RECOM;                          14449   
                    LIGNE_FIR.RECOO = W_RECOO;                          14450   
                    END;                 ELSE DO;                       14451   
                    W_RECOO         = E_RECOM;                          14452   
                    LIGNE_FIR.RECOO = W_RECOO;                          14453   
                    END;                                                14454   
                 END;                    ELSE DO;                       14455   
                 W_NUFAOC           = '999999999';                      14456   
                 LIGNE_FIR.NUFAO    = ' ';                              14457   
                 W_NUBLOC           = '999999999';                      14458   
                 LIGNE_FIR.NUBLO    = ' ';                              14459   
                 W_RECOO            = '99999999';                       14460   
                 LIGNE_FIR.RECOO    = ' ';                              14461   
                 END;                                                   14462   
              END;                       ELSE DO;                       14463   
              W_NUFAOC              = ' ';                              14464   
              LIGNE_FIR.NUFAO       = ' ';                              14465   
              W_NUBLOC              = ' ';                              14466   
              LIGNE_FIR.NUBLO       = ' ';                              14467   
              W_RECOO               = ' ';                              14468   
              LIGNE_FIR.RECOO       = ' ';                              14469   
              END;                                                      14470   
     /* MISE EN COMMENTAIRE MODIF FACTURE PAPIER YFB */                 14471   
           /* PJA 201410 - NATOP '62' SE TRANSFORME EN '16' */          14472   
           /* IF W_NUFAOC ^= ' '                            */          14473   
           /*  ! W_NUBLOC ^= ' '                            */          14474   
           /*  ! W_RECOO  ^= ' ' THEN DO;                   */          14475   
           IF LIGNE_FIR.NUFAO ^= ' '                                    14476   
            ! LIGNE_FIR.NUBLO ^= ' '                                    14477   
            ! LIGNE_FIR.RECOO ^= ' ' THEN DO;                           14478   
              LIGNE_FIR.POLIC      = '00'X;                             14479   
              LIGNE_FIR.SEPA1      = ' / ';                             14480   
              LIGNE_FIR.SEPA2      = ' / ';                             14481   
              LIGNE_FIR.FIL2       = 'BL ORIGINE : ';                   14482   
              IF W_NATOP_FIR = '  ' ! W_NATOP_FIR = '01' !              14483   
                 W_NATOP_FIR = '21' ! W_NATOP_FIR = '61' !              14484   
                 W_NATOP_FIR = '70' THEN DO;                            14485   
                 LIGNE_FIR.FIL1    = 'FACTURE ORIGINE : ';              14486   
                 LIGNE_FIR.FIL3    = 'REF COMMANDE ORIGINE : ';         14487   
                 END;                    ELSE DO;                       14488   
                 LIGNE_FIR.FIL1    = 'AVOIR ORIGINE   : ';              14489   
                 LIGNE_FIR.FIL3    = 'REF RETOUR           : ';         14490   
                 END;                                                   14491   
              EDIT_LIG_FIR         = 'O';                               14492   
              END;                                                      14493   
     /* FIN MISE EN COMMENTAIRE MODIF FACTURE PAPIER YFB */             14494   
0      AG00F:                                                           14495   
           SELECT ( W_NUFAOC );          /*   SVG W_NUFAOC   12-09    */14496   
              WHEN (' ') DO;                                            14497   
                 END;                                                   14498   
              WHEN ('999999999') DO;                                    14499   
                 IF SVG_W_NUFAOC = ' '                                  14500   
                    THEN  SVG_W_NUFAOC = W_NUFAOC;                      14501   
                 END;                                                   14502   
              OTHERWISE  DO ;                                           14503   
                 IF SVG_W_NUFAOC = ' ' !                                14504   
                    SVG_W_NUFAOC = '999999999'                          14505   
                    THEN  SVG_W_NUFAOC = W_NUFAOC;                      14506   
                 END;                                                   14507   
              END;                                                      14508   
           SELECT ( W_NUBLOC );          /*   SVG W_NUBLOC   12-09    */14509   
              WHEN (' ') DO;                                            14510   
                 END;                                                   14511   
              WHEN ('999999999') DO;                                    14512   
                 IF SVG_W_NUBLOC = ' '                                  14513   
                    THEN  SVG_W_NUBLOC = W_NUBLOC;                      14514   
                 END;                                                   14515   
              OTHERWISE  DO ;                                           14516   
                 IF SVG_W_NUBLOC = ' ' !                                14517   
                    SVG_W_NUBLOC = '999999999'                          14518   
                    THEN  SVG_W_NUBLOC = W_NUBLOC;                      14519   
                 END;                                                   14520   
              END;                                                      14521   
           END GESTION_FIR;                                             14522   
1   LIGNE_EAN:           PROCEDURE;                                     14523   
           /*                                                           14524   
                    **************************************              14525   
                    *                                    *              14526   
                    *    GESTION CODE EAN SUR            *              14527   
                    *    LA 2I�ME LIGNE DETAIL           *              14528   
                    *                                    *              14529   
                    **************************************              14530   
           */                                                           14531   
0      BA00D:                                                           14532   
           LIGNE                  = ' ';                                14533   
           LIGNE1.POLIC           = '00'X;                              14534   
           LIGNE2_EANNU           = EDIT_EAN;                           14535   
           STRING(ZSPOOLP_SVG)    = LIGNE;                              14536   
           FACT.LIGNE             = FACT.LIGNE + 1;                     14537   
           SVG_DEMA_ECR           = TOP_DEMA_ECR;                       14538   
           TOP_DEMA_ECR           = 'N' ;                               14539   
           CALL ECRITUR;                                                14540   
           TOP_DEMA_ECR           = SVG_DEMA_ECR;                       14541   
0      BA00F:                                                           14542   
           END LIGNE_EAN;                                               14543   
1 /*-- DEBUT GLT ---------- JUIN 2010 ------------- --*/                14544   
          /*********************************************************/   14545   
          /*  MODIF FLC LE 13/05/93                                */   14546   
          /*  DEBUT DE SOUS PROG                                   */   14547   
          /*********************************************************/   14548   
          /*********************************************************/   14549   
          /*  CODE ECHEA EGALE ZERO                                */   14550   
          /*  MEME LOGIQUE QUE NATOP = 2X SAUF PARTIE LSH          */   14551   
          /*********************************************************/   14552   
                                                                        14553   
 STEP_CHARGE_D:  PROC;                                                  14554   
        /*-- ATTENTION AJOUT 05/01/2004 SMARTIN --*/                    14555   
        NETCAGR          = 0              ;                             14556   
        IF CODECH = '  ' THEN GOTO STPCHG_STO_D  ;                      14557   
        WS_FD_NBECH      = 0              ;                             14558   
        /*-- ------------------- ----*/                                 14559   
        T(*) = (0);                                                     14560   
0       CALL ECHEA_NBJOU;                 /*   NOUVELLE REGLE NB JOURS*/14561   
0       IF SVG_DAECH ^= ' ' THEN DO;      /*   NOUVELLE REGLE EXISTE  */14562   
           INJ             = 1             ;                            14563   
           INK             = 1             ;                            14564   
           DDTDUEB(1)      = SVG_DAECH     ;                            14565   
           CODECHE(1)      = CODECH        ;                            14566   
           CALL ENRICH                     ;                            14567   
           WS_FD_NBECH     = 1             ;                            14568   
           STO_D_LIG.NBECH = 1             ;                            14569   
           SVG_AMTTC       = NETTC         ;                            14570   
           CALL ECRIT_STO_D_LIG            ;                            14571   
           GO TO STPCHG_STO_D              ;                            14572   
           END;                                                         14573   
0                                         /*   LOGIQUE INCHANGEE      */14574   
        SELECT;                                                         14575   
          WHEN ( CODECH = 0 )                                           14576   
            DO ;                                                        14577   
              INJ = 1                      ;                            14578   
              INK = 1                      ;                            14579   
              DDTDUEB(1) = PDEMFA          ;                            14580   
              CODECHE(1) = CODECH          ;                            14581   
              CALL ENRICH                  ;                            14582   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   14583   
              SVG_DAECH       = PDEMFA     ;                            14584   
              WS_FD_NBECH     = 1          ;                            14585   
              STO_D_LIG.NBECH = 1          ;                            14586   
              SVG_AMTTC       = NETTC      ;                            14587   
              CALL ECRIT_STO_D_LIG         ;                            14588   
        /*-- --------------------------------- ----*/                   14589   
            END                          ;                              14590   
                                                                        14591   
1         /*********************************************************/   14592   
          /*  CODE ECHEANCE A CODE FIXE EXPORT      50 A 59        */   14593   
          /*  CODE ECHEANCE A CODE FIXE EXPORT 60 62 ET 70         */   14594   
          /*********************************************************/   14595   
                                                                        14596   
          WHEN ((CODECH < 60 & CODECH > 49)                             14597   
                 ! CODECH = 60 ! CODECH = 62  ! CODECH = 70 )           14598   
            DO  ;                                                       14599   
              CODECH_TRAV = CODECH - 50 ;                               14600   
              INJ = 1                              ;                    14601   
              INK = 1                              ;                    14602   
              MMDEMFA = (PDEMFA / 100) + CODECH_TRAV;                   14603   
              AADEMFA = (PDEMFA / 10000)           ;                    14604   
              IF MMDEMFA > 12                                           14605   
                THEN                                                    14606   
                   DO;                                                  14607   
                     IF MMDEMFA > 24                                    14608   
                       THEN                                             14609   
                          DO;                                           14610   
                            AADEMFA = AADEMFA + 2       ;               14611   
                            MMDEMFA = MMDEMFA - 24      ;               14612   
                          END;                                          14613   
                          ELSE                                          14614   
                             DO;                                        14615   
                               AADEMFA = AADEMFA + 1       ;            14616   
                               MMDEMFA = MMDEMFA - 12      ;            14617   
                             END            ;                           14618   
                   END;                                                 14619   
              ZDAT(2) = 28  ;                                           14620   
              IF MMDEMFA = 2                                            14621   
                THEN                                                    14622   
 /*  Y2K-OK-Y2K +++++++++++++++++++++++++++++++++++++++++++++*/         14623   
                    IF MOD (AADEMFA,4) = 0                              14624   
 /*                 IF MOD (AADEMFA,4) = 0 & (AADEMFA ^= 0)  */         14625   
 /*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/         14626   
                       THEN ZDAT(2) = 29  ;                             14627   
               DTDUEB = AADEMFA!!MMDEMFA!!ZDAT(MMDEMFA);                14628   
              /*       PUT SKIP LIST('DTDUEB AVANT= ' !! DTDUEB) */     14629   
                                                                        14630   
         /**************************************************/           14631   
         /* TENIR COMPTE DU NBJOU (NATCO)                  */           14632   
         /*   JNM LE 09.11 93                              */           14633   
         /**************************************************/           14634   
                      CALL MAJOR_NBJOU                        ;         14635   
                                                                        14636   
               DDTDUEB(1) = PDTDUEB                    ;                14637   
               CODECHE(1) = CODECH                     ;                14638   
               CALL ENRICH                          ;                   14639   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   14640   
               SVG_DAECH       = PDTDUEB    ;                           14641   
               WS_FD_NBECH     = 1          ;                           14642   
               STO_D_LIG.NBECH = 1          ;                           14643   
               SVG_AMTTC       = NETTC      ;                           14644   
               CALL ECRIT_STO_D_LIG         ;                           14645   
        /*-- --------------------------------- ----*/                   14646   
            END                   ;                                     14647   
                                                                        14648   
1         /*********************************************************/   14649   
          /*  CODE ECHEANCE A CODE FIXE DE 01   A 08               */   14650   
          /*********************************************************/   14651   
                                                                        14652   
          WHEN ( CODECH<9 & CODECH>0 )                                  14653   
            DO  ;                                                       14654   
               INJ = 1                              ;                   14655   
               INK = 1                              ;                   14656   
               MMDEMFA = (PDEMFA / 100) + CODECH    ;                   14657   
               AADEMFA = (PDEMFA / 10000)           ;                   14658   
               IF MMDEMFA > 12                                          14659   
                 THEN                                                   14660   
                   DO;                                                  14661   
                     AADEMFA = AADEMFA + 1       ;                      14662   
                     MMDEMFA = MMDEMFA - 12      ;                      14663   
                   END            ;                                     14664   
               ZDAT(2) = 28  ;                                          14665   
               IF MMDEMFA = 2                                           14666   
                  THEN                                                  14667   
 /*  Y2K-OK-Y2K +++++++++++++++++++++++++++++++++++++++++++++*/         14668   
                    IF MOD (AADEMFA,4) = 0                              14669   
 /*                 IF MOD (AADEMFA,4) = 0 & (AADEMFA ^= 0)  */         14670   
 /*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/         14671   
                        THEN ZDAT(2) = 29  ;                            14672   
               DTDUEB = AADEMFA!!MMDEMFA!!ZDAT(MMDEMFA);                14673   
              /*       PUT SKIP LIST('DTDUEB AVANT= ' !! DTDUEB) */     14674   
                                                                        14675   
         /**************************************************/           14676   
         /* TENIR COMPTE DU NBJOU (NATCO)                  */           14677   
         /*   JNM LE 09.11 93                              */           14678   
         /**************************************************/           14679   
                      CALL MAJOR_NBJOU                        ;         14680   
                                                                        14681   
               DDTDUEB(1) = PDTDUEB                    ;                14682   
               CODECHE(1) = CODECH                     ;                14683   
               CALL ENRICH                          ;                   14684   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   14685   
               SVG_DAECH       = PDTDUEB    ;                           14686   
               WS_FD_NBECH     = 1          ;                           14687   
               STO_D_LIG.NBECH = 1          ;                           14688   
               SVG_AMTTC       = NETTC      ;                           14689   
               CALL ECRIT_STO_D_LIG         ;                           14690   
        /*-- --------------------------------- ----*/                   14691   
            END                   ;                                     14692   
                                                                        14693   
1         /*********************************************************/   14694   
          /*  CODE ECHEANCE = 09 A FIXER                           */   14695   
          /*********************************************************/   14696   
                                                                        14697   
          WHEN (CODECH=09 ! CODECH=99)                                  14698   
            DO  ;                      /* A FIXER     */                14699   
               INJ = 1                              ;                   14700   
               INK = 1                              ;                   14701   
               DDTDUEB(1) = '999999'                ;                   14702   
               CODECHE(1) = CODECH                  ;                   14703   
               CALL ENRICH                          ;                   14704   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   14705   
               SVG_DAECH       = '999999'   ;                           14706   
               WS_FD_NBECH     = 1          ;                           14707   
               STO_D_LIG.NBECH = 1          ;                           14708   
               SVG_AMTTC       = NETTC      ;                           14709   
               CALL ECRIT_STO_D_LIG         ;                           14710   
        /*-- --------------------------------- ----*/                   14711   
               ZONCTL        = '** ECHEANCE A FIXER ' !!                14712   
                               CODECH !! ' FACT. NO.' !! WNUFAC !!      14713   
                               ' NUCLI. ' !! WTFAC.NUCLI;               14714   
               CALL MACMES3 (DESTI,'1',ZONCTL);                         14715   
             END                  ;                                     14716   
                                                                        14717   
          OTHERWISE                                                     14718   
            DO  ;                                                       14719   
                                                                        14720   
1      /*************************************************************/  14721   
       /*  CODE ECHEANCE DIFFERENT DE TOUS LES AUTRES DONC MULTIPLE */  14722   
       /*************************************************************/  14723   
                                                                        14724   
                                                                        14725   
        /* TEST D'EXISTANCE DU CODE ECHEANCE EN FCTION DE TABLE */      14726   
                                                                        14727   
 CSTO_D:      DO INI = 1 TO (TBECHEB.INDCH)   ;                         14728   
                IF CODECH  = TECHEA(INI) THEN GOTO MULTIPLESTO_D;       14729   
              END CSTO_D                    ;                           14730   
                                                                        14731   
                /***************************************                14732   
                *  CODE ECHEA PIEDS NON TROUVE DS 1425 *                14733   
                ***************************************/                14734   
              INJ = 1                              ;                    14735   
              INK = 1                              ;                    14736   
              DDTDUEB(1) = '999999'                ;                    14737   
              CODECHE(1) = CODECH                  ;                    14738   
              CALL ENRICH                          ;                    14739   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   14740   
              SVG_DAECH       = '999999'   ;                            14741   
              WS_FD_NBECH     = 1          ;                            14742   
              STO_D_LIG.NBECH = 1          ;                            14743   
              SVG_AMTTC       = NETTC      ;                            14744   
              CALL ECRIT_STO_D_LIG         ;                            14745   
        /*-- --------------------------------- ----*/                   14746   
              ZONCTL        = '** CODE ECHEANCE INCONNU ' !!            14747   
                               CODECH !! ' FACT. NO.' !! WNUFAC !!      14748   
                               ' NUCLI. ' !! WTFAC.NUCLI;               14749   
              CALL MACMES3 (DESTI,'1',ZONCTL);                          14750   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   14751   
              GOTO STPCHG_STO_D            ;                            14752   
        /*-- --------------------------------- ----*/                   14753   
- MULTIPLESTO_D :  INK = 0                                       ;      14754   
              DO INJ = 1 TO 5 ;                                         14755   
                IF (TBECHEBC.NADE(INI,INJ) = '3' )                      14756   
                  THEN                                                  14757   
                    DO ;        /****************************           14758   
                                *  NATURE DE DELAI = 3 DANS *           14759   
                                *  UN CODE ECHEA MULTIPLE   *           14760   
                                *  CAS ANORMAL -> ANOMALIE  *           14761   
                                ****************************/           14762   
                       INJ = 1 ;                                        14763   
                       INK = 1 ;                                        14764   
                       DDTDUEB(1) = '999999';                           14765   
                       CODECHE(1) = CODECH                  ;           14766   
                       CALL ENRICH ;                                    14767   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   14768   
                       SVG_DAECH       = '999999'   ;                   14769   
                       WS_FD_NBECH     = 1          ;                   14770   
                       STO_D_LIG.NBECH = 1          ;                   14771   
                       SVG_AMTTC       = NETTC      ;                   14772   
                       CALL ECRIT_STO_D_LIG         ;                   14773   
        /*-- --------------------------------- ----*/                   14774   
                       ZONCTL        = '** ECHEA MULTIPLE ANOMALIE ' !! 14775   
                               CODECH !! ' FACT. NO.' !! WNUFAC !!      14776   
                               ' NUCLI. ' !! WTFAC.NUCLI;               14777   
                       CALL MACMES3 (DESTI,'1',ZONCTL);                 14778   
                    END;                                                14779   
              END                                                  ;    14780   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   14781   
        /*-- --------------------------------- ----*/                   14782   
                                                                        14783   
 DSTO_D :   DO INJ = 1 TO 5 WHILE (TBECHEBC.NADE(INI,INJ) ^= ' ' );     14784   
                INK = INK + 1                                        ;  14785   
              END DSTO_D                                           ;    14786   
 ESTO_D :     DO INJ = 1 TO INK ;                                       14787   
                                                                        14788   
                               /********************************/       14789   
                               /*INK=NBRE ECHEANCES SI MULTIPLE*/       14790   
                               /*CODE DE LA TABLE = 1 =        */       14791   
                               /*DATE FIXE A IMPOSER POUR ECHEA*/       14792   
                               /********************************/       14793   
                                                                        14794   
                SELECT;                                                 14795   
                  WHEN ((TBECHEBC.NADE(INI,INJ)) = '1')                 14796   
                    DO;                                                 14797   
                      DTDUEB = SUBSTR(TPOSTEI.DLAI(INI,INJ),5,2) !!     14798   
                               SUBSTR(TPOSTEI.DLAI(INI,INJ),3,2) !!     14799   
                               SUBSTR(TPOSTEI.DLAI(INI,INJ),1,2) ;      14800   
                                                                        14801   
         /**************************************************/           14802   
         /* TENIR COMPTE DU NBJOU (NATCO)                  */           14803   
         /* SI JOUR ECHEANCE IMPOSEE EST FIN DE MOIS       */           14804   
         /*        ( FIN DE MOIS A PARTIR DU 28)           */           14805   
         /*   JNM LE 09.11 93                              */           14806   
         /**************************************************/           14807   
              IF SUBSTR(DTDUEB,5,2) > '27' THEN DO ;                    14808   
                 /*    PUT SKIP LIST('NADE=1' !! ' NUCLI= ' !!          14809   
                       WTCLI1.NUCLI !! ' NATCO= ' !! WTCLI1.NATCO) */   14810   
                 /*    PUT SKIP LIST('DTDUEB AVANT= ' !! DTDUEB) */     14811   
                      CALL MAJOR_NBJOU                        ;         14812   
                      END ;                                             14813   
                                                                        14814   
                      DDTDUEB(INJ) = PDTDUEB                  ;         14815   
                      CODECHE(INJ) = CODECH                   ;         14816   
                      CALL ENRICH                          ;            14817   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   14818   
                       SVG_DAECH       = PDTDUEB             ;          14819   
                       WS_FD_NBECH     = WS_FD_NBECH + 1     ;          14820   
                       IF INK > 1 THEN DO;                              14821   
                          STO_D_LIG.NBECH = STO_D_LIG.NBECH + 1 ;       14822   
                          STO_D_LEC.GS.NULIG = STO_D_LIG.GS.NULIG ;     14823   
                          CALL ECRIT_STO_D_LEC               ;          14824   
                          END;          ELSE DO;                        14825   
                          CALL ECRIT_STO_D_LIG               ;          14826   
                          END;                               ;          14827   
        /*-- --------------------------------- ----*/                   14828   
                    END                   ;                             14829   
                                                                        14830   
                                 /********************************/     14831   
                                 /*CODE DE LA TABLE = 2 =        */     14832   
                                 /*NBR DE JOUR POUR CALCUL ECHEA */     14833   
                                 /********************************/     14834   
                                                                        14835   
                  WHEN ((TBECHEBC.NADE(INI,INJ)) = '2')                 14836   
                    DO;                                                 14837   
                /*     PUT SKIP LIST('NADE=2' !! ' NUCLI= ' !!          14838   
                       WTCLI1.NUCLI !! ' NATCO= ' !! WTCLI1.NATCO) */   14839   
                       NBMOIS = ( DLAI(INI,INJ) / 1000 ) / 30 ;         14840   
                       MMDEMFA = (PDEMFA / 100) + NBMOIS    ;           14841   
                       AADEMFA = (PDEMFA / 10000)           ;           14842   
                       IF MMDEMFA > 12                                  14843   
                         THEN                                           14844   
                           DO;                                          14845   
                             AADEMFA = AADEMFA + 1       ;              14846   
                             MMDEMFA = MMDEMFA - 12      ;              14847   
                           END            ;                             14848   
                       ZDAT(2) = 28  ;                                  14849   
                       IF MMDEMFA = 2 THEN                              14850   
 /*  Y2K-OK-Y2K +++++++++++++++++++++++++++++++++++++++++++++*/         14851   
                    IF MOD (AADEMFA,4) = 0                              14852   
 /*                 IF MOD (AADEMFA,4) = 0 & (AADEMFA ^= 0)  */         14853   
 /*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/         14854   
                                                  THEN ZDAT(2) = 29  ;  14855   
                       DTDUEB = AADEMFA!!MMDEMFA!!ZDAT(MMDEMFA);        14856   
                                                                        14857   
         /**************************************************/           14858   
         /* TENIR COMPTE DU NBJOU (NATCO)                  */           14859   
         /*   JNM LE 09.11 93                              */           14860   
         /**************************************************/           14861   
                      CALL MAJOR_NBJOU                        ;         14862   
                                                                        14863   
                       DDTDUEB(INJ) = PDTDUEB                  ;        14864   
                       CODECHE(INJ) = CODECH                   ;        14865   
                       CALL ENRICH                          ;           14866   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   14867   
                       SVG_DAECH       = PDTDUEB             ;          14868   
                       WS_FD_NBECH     = WS_FD_NBECH + 1     ;          14869   
                       IF INK > 1 THEN DO;                              14870   
                          STO_D_LIG.NBECH = STO_D_LIG.NBECH + 1 ;       14871   
                          STO_D_LEC.GS.NULIG = STO_D_LIG.GS.NULIG ;     14872   
                          CALL ECRIT_STO_D_LEC               ;          14873   
                          END;          ELSE DO;                        14874   
                          CALL ECRIT_STO_D_LIG               ;          14875   
                          END;                               ;          14876   
        /*-- --------------------------------- ----*/                   14877   
                    END                   ;                             14878   
                  OTHERWISE                                             14879   
                    DO;                                                 14880   
               PUT SKIP LIST ('******************************');        14881   
               PUT SKIP LIST ('*** ATTENTION : ERREUR GRAVE  ');        14882   
               PUT SKIP LIST ('*** NADE DE TABLE ECHEANCE    ');        14883   
               PUT SKIP LIST ('*** INVALIDE ...              ');        14884   
               PUT SKIP LIST ('*** NADE : ' !! TBECHEBC.NADE(INI,INJ)); 14885   
               PUT SKIP LIST ('******************************');        14886   
                        SIGNAL ERROR ;                                  14887   
                    END;                                                14888   
                END;                      /*   FIN SELECT             */14889   
              END;                        /*   FIN BOUCLE DO INJ      */14890   
        /*-- FACT DEMAT AJOUT 06/01/2005 SMARTIN --*/                   14891   
              IF WS_FD_NBECH > 1 & STO_D_LIG.TYPRO ^= 'C'               14892   
                THEN DO ;                                               14893   
                 SVG_DAECH = ''                  ;                      14894   
                 SVG_AMTTC = 0                   ;                      14895   
                 CALL ECRIT_STO_D_LIG            ;                      14896   
              END                                ;                      14897   
        /*-- ----------------------------------- --*/                   14898   
            END;                                                        14899   
         END;                                                           14900   
  STPCHG_STO_D:                                                         14901   
 END STEP_CHARGE_D;                                                     14902   
                                                                        14903   
1INIT_STO_D_ENT: PROC;            /* INITIALISATION FACTURE DEMAT */    14904   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     14905   
       STO_D_ENT.ID.SYPRO      = WTFAC.SYPRO                 ;          14906   
       STO_D_ENT.ID.AFFIL      = WTCLI1.AFFIL                ;          14907   
       STO_D_ENT.ID.NUCLI      = WTFAC.NUCLI                 ;          14908   
       STO_D_ENT.ID.RUNFA      = WTDAT.NORUN                 ;          14909   
       STO_D_ENT.ID.NUFAC      = WNUFAC                      ;          14910   
       STO_D_ENT.ID.DAFAC      = '20' !! ENTET70.DAT10.AA !!            14911   
                                 ENTET70.DAT10.MM !!                    14912   
                                 ENTET70.DAT10.JJ ;                     14913   
       CTR_ENSEQ_D             = CTR_ENSEQ_D + 1             ;          14914   
       STO_D_ENT.ID.ENSEQ      = CTR_ENSEQ_D                 ;          14915   
                                                                        14916   
                                 /* INIT. ENREG ENTETE           */     14917   
       STO_D_ENT.GS.TYPEN      = 'ENT'                       ;          14918   
       STO_D_ENT.ID.COENR      = 'A'                         ;          14919   
       STO_D_ENT.GS.NULOT      = ''                          ;          14920   
       STO_D_ENT.GS.EANFO      = WL_CLLIV.NUCLI              ;          14921   
       STO_D_ENT.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5   ;          14922   
       STO_D_ENT.GS.NUCLI      = WTFAC.NUCLI                 ;          14923   
       SELECT (MOD_DEMA) ;                                              14924   
          WHEN ('D') DO;                  /*   DEMAT SANS PAPIER CTLE+*/14925   
             STO_D_ENT.GS.CDFON = '9 ';                                 14926   
             END;                                                       14927   
          WHEN ('E') DO;                  /*   DEMAT AVEC PAPIER CTLE-*/14928   
             STO_D_ENT.GS.CDFON = '43';                                 14929   
             END;                                                       14930   
          WHEN ('T') DO;                  /*   DEMAT AVEC PAPIER CTLE+*/14931   
             STO_D_ENT.GS.CDFON = '9 ';                                 14932   
             END;                                                       14933   
          OTHERWISE  DO;                                                14934   
             STO_D_ENT.GS.CDFON = '  ';                                 14935   
             END;                                                       14936   
          END;                                                          14937   
 END INIT_STO_D_ENT;                                                    14938   
                                                                        14939   
 INIT_STO_D_COM: PROC;             /* INIT. ENREG COMMENTAIRES     */   14940   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     14941   
       STO_D_COM.ID            = STO_D_ENT.ID                ;          14942   
                                                                        14943   
       STO_D_COM.GS.TYPEN      = 'COM'                       ;          14944   
       STO_D_COM.ID.COENR      = 'C'                         ;          14945   
       STO_D_COM.GS.NULOT      = ''                          ;          14946   
       STO_D_COM.GS.EANFO      = WL_CLLIV.NUCLI              ;          14947   
       STO_D_COM.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5   ;          14948   
 END INIT_STO_D_COM;                                                    14949   
                                                                        14950   
 INIT_STO_D_COMPMD: PROC;          /* INIT. ENREG COM TYPE PMD     */   14951   
                                                                        14952   
       STO_D_COM.GS.ZOCOM      = '' ;                                   14953   
       STO_D_COM.GS.TYPCO      = 'SUR' ;                                14954   
       STO_D_COM.GS.ZOCOM      = 'NOS MARCHANDISES VOYAGENT AUX ' !!    14955   
                                 'RISQUES ET PERILS DES DESTINA'  !!    14956   
                                 'TAIRES (ART' ;                        14957   
       CTR_ENSEQ_D             = CTR_ENSEQ_D + 1             ;          14958   
       STO_D_COM.ID.ENSEQ      = CTR_ENSEQ_D                 ;          14959   
       WRITE FILE(FICSTOD) FROM (STO_D_COM)  ;                          14960   
       CTR_LIG_STOD            = CTR_LIG_STOD + 1 ;                     14961   
                                                                        14962   
       STO_D_COM.GS.ZOCOM      = 'ICLE 100 CC)        ' ;               14963   
       CTR_ENSEQ_D             = CTR_ENSEQ_D + 1             ;          14964   
       STO_D_COM.ID.ENSEQ      = CTR_ENSEQ_D                 ;          14965   
       WRITE FILE(FICSTOD) FROM (STO_D_COM)  ;                          14966   
       CTR_LIG_STOD            = CTR_LIG_STOD + 1 ;                     14967   
                                                                        14968   
       STO_D_COM.GS.ZOCOM      = '' ;                                   14969   
       STO_D_COM.GS.TYPCO      = 'SUR' ;                                14970   
       STO_D_COM.GS.ZOCOM      = 'LE TRANSFERT DE PROPRIETE DE T' !!    14971   
                                 'OUS NOS OUVRAGES ET PRODUITS '  !!    14972   
                                 'N''INTER' ;                           14973   
       CTR_ENSEQ_D             = CTR_ENSEQ_D + 1             ;          14974   
       STO_D_COM.ID.ENSEQ      = CTR_ENSEQ_D                 ;          14975   
       WRITE FILE(FICSTOD) FROM (STO_D_COM)  ;                          14976   
       CTR_LIG_STOD            = CTR_LIG_STOD + 1 ;                     14977   
                                                                        14978   
       STO_D_COM.GS.ZOCOM      = 'VIENT QU''APRES PAIEMENT INTEG' !!    14979   
                                 'RAL DU PRIX ' ;                       14980   
       CTR_ENSEQ_D             = CTR_ENSEQ_D + 1             ;          14981   
       STO_D_COM.ID.ENSEQ      = CTR_ENSEQ_D                 ;          14982   
       WRITE FILE(FICSTOD) FROM (STO_D_COM)  ;                          14983   
       CTR_LIG_STOD            = CTR_LIG_STOD + 1 ;                     14984   
                                                                        14985   
       IF W_RECOO ^= ' '                                                14986   
       THEN DO;                                                         14987   
          STO_D_COM.GS.ZOCOM      = '' ;                                14988   
          STO_D_COM.GS.TYPCO      = 'SUR' ;                             14989   
          STO_D_COM.GS.ZOCOM      = 'REF COMMANDE ORIGINE ' !! W_RECOO; 14990   
          CTR_ENSEQ_D             = CTR_ENSEQ_D + 1             ;       14991   
          STO_D_COM.ID.ENSEQ      = CTR_ENSEQ_D                 ;       14992   
          WRITE FILE(FICSTOD) FROM (STO_D_COM)  ;                       14993   
          CTR_LIG_STOD            = CTR_LIG_STOD + 1 ;                  14994   
       END;                                                             14995   
                                                                        14996   
       STO_D_COM.GS.TYPCO      = 'AAB' ;                                14997   
       STO_D_COM.GS.ZOCOM      = 'LA SOCI'           !!                 14998   
                                 'ETE N''ACCORDE PAS D''ESCOMPTE.';     14999   
       CTR_ENSEQ_D             = CTR_ENSEQ_D + 1             ;          15000   
       STO_D_COM.ID.ENSEQ      = CTR_ENSEQ_D                 ;          15001   
       WRITE FILE(FICSTOD) FROM (STO_D_COM)  ;                          15002   
       CTR_LIG_STOD            = CTR_LIG_STOD + 1 ;                     15003   
       CTR_STO_COM             = CTR_STO_COM  + 3 ;                     15004   
                                                                        15005   
       STO_D_COM.GS.TYPCO      = 'PMD' ;                                15006   
       STO_D_COM.GS.ZOCOM      = 'PENALITES DE RETARD : INTERET ' !!    15007   
                                 'AU TAUX DE REFINANCEMENT DE LA' !!    15008   
                                 ' BCE '         ;                      15009   
       CTR_ENSEQ_D             = CTR_ENSEQ_D + 1             ;          15010   
       STO_D_COM.ID.ENSEQ      = CTR_ENSEQ_D                 ;          15011   
       WRITE FILE(FICSTOD) FROM (STO_D_COM)  ;                          15012   
       CTR_LIG_STOD            = CTR_LIG_STOD + 1 ;                     15013   
                                                                        15014   
       STO_D_COM.GS.ZOCOM      = 'MAJORE DE 8 POINTS DE POURCENT' !!    15015   
                                 'AGE AVEC UN MINIMUM LEGAL FIXE' !!    15016   
                                 ' A 3 '         ;                      15017   
       CTR_ENSEQ_D             = CTR_ENSEQ_D + 1             ;          15018   
       STO_D_COM.ID.ENSEQ      = CTR_ENSEQ_D                 ;          15019   
       WRITE FILE(FICSTOD) FROM (STO_D_COM)  ;                          15020   
       CTR_LIG_STOD            = CTR_LIG_STOD + 1 ;                     15021   
                                                                        15022   
       STO_D_COM.GS.ZOCOM      = 'FOIS LE TAUX D''INTERET LEGAL.';      15023   
       CTR_ENSEQ_D             = CTR_ENSEQ_D + 1             ;          15024   
       STO_D_COM.ID.ENSEQ      = CTR_ENSEQ_D                 ;          15025   
       WRITE FILE(FICSTOD) FROM (STO_D_COM)  ;                          15026   
       CTR_LIG_STOD            = CTR_LIG_STOD + 1 ;                     15027   
       /* PJA 201309 : ACTION EDI 92 */                                 15028   
       CTR_STO_COM             = CTR_STO_COM + 3  ;                     15029   
                                                                        15030   
       STO_D_COM.GS.TYPCO      = 'PMT' ;                                15031   
       STO_D_COM.GS.ZOCOM      = 'CE MONTANT EST COMPLETE D''UN ' !!    15032   
                                 'FORFAIT DE 40 EUROS POUR FRAIS' ;     15033   
       CTR_ENSEQ_D             = CTR_ENSEQ_D + 1             ;          15034   
       STO_D_COM.ID.ENSEQ      = CTR_ENSEQ_D                 ;          15035   
       WRITE FILE(FICSTOD) FROM (STO_D_COM)  ;                          15036   
       CTR_LIG_STOD            = CTR_LIG_STOD + 1 ;                     15037   
       STO_D_COM.GS.ZOCOM      = 'DE RECOUVREMENT.' ;                   15038   
       CTR_ENSEQ_D             = CTR_ENSEQ_D + 1             ;          15039   
       STO_D_COM.ID.ENSEQ      = CTR_ENSEQ_D                 ;          15040   
       WRITE FILE(FICSTOD) FROM (STO_D_COM)  ;                          15041   
       CTR_LIG_STOD            = CTR_LIG_STOD + 1 ;                     15042   
       CTR_STO_COM             = CTR_STO_COM + 2  ;                     15043   
                                                                        15044   
       STO_D_COM.GS.TYPCO      = 'SUR' ;                                15045   
       STO_D_COM.GS.ZOCOM      = 'SERVICE CLIENT : ' !!                 15046   
                                 SUBSTR(WADCRD,34,2) !!                 15047   
                                 SUBSTR(WADCRD,37,2) !!                 15048   
                                 SUBSTR(WADCRD,40,2) !!                 15049   
                                 SUBSTR(WADCRD,43,2) !!                 15050   
                                 SUBSTR(WADCRD,46,2) !!                 15051   
                                 ' RECOUVREMENT : '  !!                 15052   
                                 SUBSTR(WVICRD,34,2) !!                 15053   
                                 SUBSTR(WVICRD,37,2) !!                 15054   
                                 SUBSTR(WVICRD,40,2) !!                 15055   
                                 SUBSTR(WVICRD,43,2) !!                 15056   
                                 SUBSTR(WVICRD,46,2)  ;                 15057   
       CTR_ENSEQ_D             = CTR_ENSEQ_D + 1             ;          15058   
       STO_D_COM.ID.ENSEQ      = CTR_ENSEQ_D                 ;          15059   
       WRITE FILE(FICSTOD) FROM (STO_D_COM)  ;                          15060   
       CTR_LIG_STOD            = CTR_LIG_STOD + 1 ;                     15061   
       CTR_STO_COM             = CTR_STO_COM  + 1 ;                     15062   
0                                        /*   TEXTE LME 05.09         */15063   
       IF EDIT_CDLTELME = 'O' THEN DO;                                  15064   
          STO_D_COM.GS.TYPCO    = 'SUR' ;                               15065   
          DO I = 1 TO NB_CDLTELME;                                      15066   
             Z115_CDLTELME      = TBL_CDLTELME.LIBE1(I) !!              15067   
                                  TBL_CDLTELME.LIBE2(I) !!              15068   
                                  TBL_CDLTELME.LIBE3(I) ;               15069   
                                         /*   DECOUPAGE EN 2 LIGNES   */15070   
             IF SUBSTR(Z115_CDLTELME,DEB_CDLTELME,70) ^= ' ' THEN DO;   15071   
                STO_D_COM.GS.ZOCOM =                                    15072   
                               SUBSTR(Z115_CDLTELME,DEB_CDLTELME,70);   15073   
                CTR_ENSEQ_D        = CTR_ENSEQ_D + 1  ;                 15074   
                STO_D_COM.ID.ENSEQ = CTR_ENSEQ_D      ;                 15075   
                WRITE FILE(FICSTOD) FROM (STO_D_COM)  ;                 15076   
                CTR_LIG_STOD       = CTR_LIG_STOD + 1 ;                 15077   
                END;                                                    15078   
             IF SUBSTR(Z115_CDLTELME,DEB_CDLTELME + 70) ^= ' ' THEN DO; 15079   
                STO_D_COM.GS.ZOCOM =                                    15080   
                               SUBSTR(Z115_CDLTELME,DEB_CDLTELME + 70); 15081   
                CTR_ENSEQ_D        = CTR_ENSEQ_D + 1  ;                 15082   
                STO_D_COM.ID.ENSEQ = CTR_ENSEQ_D      ;                 15083   
                WRITE FILE(FICSTOD) FROM (STO_D_COM)  ;                 15084   
                CTR_LIG_STOD       = CTR_LIG_STOD + 1 ;                 15085   
                END;                                                    15086   
             END;                                                       15087   
          END;                                                          15088   
 END INIT_STO_D_COMPMD;                                                 15089   
                                                                        15090   
 INIT_STO_D_ECH: PROC;            /* INITIALISATION FACTURE DEMAT */    15091   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     15092   
       STO_D_ECH.ID            = STO_D_ENT.ID                ;          15093   
                                                                        15094   
                                 /* INIT. ENREG ECHEANCE         */     15095   
       STO_D_ECH.GS.TYPEN      = 'ECH'                       ;          15096   
       STO_D_ECH.ID.COENR      = 'B'                         ;          15097   
       STO_D_ECH.GS.NULOT      = ''                          ;          15098   
       STO_D_ECH.GS.EANFO      = WL_CLLIV.NUCLI              ;          15099   
       STO_D_ECH.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5   ;          15100   
 END INIT_STO_D_ECH;                                                    15101   
                                                                        15102   
 INIT_STO_D_REF: PROC;            /* INITIALISATION FACTURE DEMAT */    15103   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     15104   
       STO_D_REF.ID            = STO_D_ENT.ID                ;          15105   
                                                                        15106   
                                 /* INIT. ENREG REFERENCE FACT   */     15107   
       STO_D_REF.GS.TYPEN      = 'REF'                       ;          15108   
       STO_D_REF.ID.COENR      = 'D'                         ;          15109   
       STO_D_REF.GS.NULOT      = ''                          ;          15110   
       STO_D_REF.GS.EANFO      = WL_CLLIV.NUCLI              ;          15111   
       STO_D_REF.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5   ;          15112   
 END INIT_STO_D_REF;                                                    15113   
                                                                        15114   
 INIT_STO_D_ADR: PROC;            /* INITIALISATION FACTURE DEMAT */    15115   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     15116   
       STO_D_ADR.ID            = STO_D_ENT.ID                ;          15117   
                                                                        15118   
                                 /* INIT. ENREG ADRESSE   FACT   */     15119   
       STO_D_ADR.GS.TYPEN      = 'ADR'                       ;          15120   
       STO_D_ADR.ID.COENR      = 'E'                         ;          15121   
       STO_D_ADR.GS.NULOT      = ''                          ;          15122   
       STO_D_ADR.GS.EANFO      = WL_CLLIV.NUCLI              ;          15123   
       STO_D_ADR.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5   ;          15124   
                                                                        15125   
                                 /* RUBRIQUES SIEGE SOCIALE  */         15126   
                                                                        15127   
       SPIPA       = '';                                                15128   
       SPIPA.FONCT = 'RP';                                              15129   
       SPIPA.COTAB = 'CDLSIEGE';                                        15130   
       SPIPA.OPERA = '>';                                               15131   
       SPIPA.REFPO = LOW(13);                                           15132   
       CALL SPI2TBV (SPIPA,TSIEGE,SPIFI);                               15133   
       IF SPIPA.CORET = '00'                                            15134   
         THEN DO ;                                                      15135   
           /* AJOUT 10/06 YFB NAD+CO DOIT ETRE DIFF NAD+SE */           15136   
           IF TCDLFDEM.CNUSS ^= TCDLFDEM.CNUDF                          15137   
             THEN DO ;                                                  15138   
               STO_D_ADR.SIEGE.EAN    = TCDLFDEM.CNUSS       ;          15139   
               STO_D_ADR.SIEGE.NOCLI  = TSIEGE.NOSIE         ;          15140   
               STO_D_ADR.SIEGE.RASOC  = TSIEGE.RASIE         ;          15141   
               STO_D_ADR.SIEGE.ADCLI  = TSIEGE.ADSIE         ;          15142   
               STO_D_ADR.SIEGE.LORES  = TSIEGE.LOSIE         ;          15143   
               STO_D_ADR.SIEGE.LOBDI  = TSIEGE.LBSIE         ;          15144   
               STO_D_ADR.SIEGE.CPCLI  = TSIEGE.CPSIE         ;          15145   
               STO_D_ADR.SIEGE.CPAYS  = TSIEGE.PASIE         ;          15146   
             END ;                                                      15147   
             ELSE DO ;                                                  15148   
               STO_D_ADR.SIEGE.EAN    = ' '                  ;          15149   
               STO_D_ADR.SIEGE.NOCLI  = ' '                  ;          15150   
               STO_D_ADR.SIEGE.RASOC  = ' '                  ;          15151   
               STO_D_ADR.SIEGE.ADCLI  = ' '                  ;          15152   
               STO_D_ADR.SIEGE.LORES  = ' '                  ;          15153   
               STO_D_ADR.SIEGE.LOBDI  = ' '                  ;          15154   
               STO_D_ADR.SIEGE.CPCLI  = ' '                  ;          15155   
               STO_D_ADR.SIEGE.CPAYS  = ' '                  ;          15156   
             END ;                                                      15157   
           STO_D_ADR.SIEGE.FJURI  = TSIEGE.FJSIE         ;              15158   
           STO_D_ADR.SIEGE.CAPIT  = TSIEGE.CASIE         ;              15159   
           STO_D_ADR.SIEGE.CMONA  = 'EUR'                ;              15160   
           STO_D_ADR.SIEGE.RCOMM  = TSIEGE.RCSIE         ;              15161   
           STO_D_ADR.SIEGE.NUCEE  = TSIEGE.TVSIE         ;              15162   
       /* PJA 201311 : PB NUMERO DE TVA INTRACOMMUNAUTAIRE */           15163   
       /*  STO_D_ADR.SIEGE.MAGTV  = WL_CLLIV.MAGTV       ; */           15164   
           STO_D_ADR.SIEGE.MAGTV  = WF_CLFAC.MAGTV       ;              15165   
       END ;                                                            15166   
       STO_D_ADR.CLLIV            = WL_CLLIV, BY NAME    ;              15167   
0      STO_D_ADR.CLFAC            = WF_CLFAC, BY NAME    ;              15168   
       STO_D_ADR.CLFAC.CLIFA      = WF_CLFAC.NUCLI       ;              15169   
       STO_D_ADR.MACOM            = TCDLFDEM.CNUDF ;                    15170   
0      SPIPA                      = '';  /*   TABLE DES ADRESSES CNUDF*/15171   
       SPIPA.FONCT                = 'RP';                               15172   
       SPIPA.COTAB                = 'CDLADRES';                         15173   
       SPIPA.OPERA                = '=';                                15174   
       SPIPA.REFPO                = TCDLFDEM.CNUDF;                     15175   
       CALL SPI2TBV (SPIPA,TCDLADRE,SPIFI);                             15176   
       IF SPIPA.CORET ^= '00' THEN DO;                                  15177   
          TCDLADRE                = '' ;                                15178   
          END;                                                          15179   
       STO_D_ADR.EMETT.NOCLI      = TCDLADRE.RASOC;                     15180   
       STO_D_ADR.EMETT.RASOC      = TCDLADRE.NOCLI;                     15181   
       STO_D_ADR.EMETT.ADCLI      = TCDLADRE.ADCLI;                     15182   
       STO_D_ADR.EMETT.LORES      = TCDLADRE.LORES;                     15183   
       STO_D_ADR.EMETT.LOBDI      = TCDLADRE.LOBDI;                     15184   
       STO_D_ADR.EMETT.CPCLI      = TCDLADRE.CPCLI;                     15185   
       STO_D_ADR.EMETT.CPAYS      = TCDLADRE.CPAYS;                     15186   
       STO_D_ADR.REGIF            = TCDLADRE.REGIC;                     15187   
       STO_D_ADR.EMETT.NUTEL      = SUBSTR(M001_NOCRD,31,2) !!          15188   
                                    SUBSTR(M001_NOCRD,34,2) !!          15189   
                                    SUBSTR(M001_NOCRD,37,2) !!          15190   
                                    SUBSTR(M001_NOCRD,40,2) !!          15191   
                                    SUBSTR(M001_NOCRD,43,2)  ;          15192   
       STO_D_ADR.EMETT.NUFAX      = ''                   ;              15193   
       STO_D_ADR.EMETT.SIREM      = TCDLADRE.SIREN;                     15194   
       STO_D_ADR.EMETT.RECOU      = SUBSTR(M001_VICRD,34,2) !!          15195   
                                    SUBSTR(M001_VICRD,37,2) !!          15196   
                                    SUBSTR(M001_VICRD,40,2) !!          15197   
                                    SUBSTR(M001_VICRD,43,2) !!          15198   
                                    SUBSTR(M001_VICRD,46,2)  ;          15199   
       CTR_ENSEQ_D             = CTR_ENSEQ_D + 1             ;          15200   
       STO_D_ADR.ID.ENSEQ      = CTR_ENSEQ_D                 ;          15201   
       WRITE FILE(FICSTOD) FROM (STO_D_ADR)      ;                      15202   
       CTR_LIG_STOD               = CTR_LIG_STOD + 1 ;                  15203   
                                                                        15204   
                                      /* INIT. ZONE ADRESSE COMP. AD2 */15205   
       STO_D_AD2.ID               = STO_D_ADR.ID                ;       15206   
       STO_D_AD2.GS.TYPEN         = 'AD2'                       ;       15207   
       STO_D_AD2.ID.COENR         = 'E'                         ;       15208   
       STO_D_AD2.GS.NULOT         = ''                          ;       15209   
       STO_D_AD2.GS.EANFO         = WL_CLLIV.NUCLI              ;       15210   
       STO_D_AD2.GS.NUFAC         = ENTET70.NORUN !! WNUFAC_5   ;       15211   
0      SPIPA                      = '';  /*   TABLE DES ADRESSES CNUD2*/15212   
       SPIPA.FONCT                = 'RP';                               15213   
       SPIPA.COTAB                = 'CDLADRES';                         15214   
       SPIPA.OPERA                = '=';                                15215   
       SPIPA.REFPO                = TCDLFDEM.CNUD2;                     15216   
       CALL SPI2TBV (SPIPA,TCDLADRE,SPIFI);                             15217   
       IF SPIPA.CORET ^= '00' THEN DO;                                  15218   
          TCDLADRE                = '' ;                                15219   
          TCDLADRE.CNUDC          = TCDLFDEM.CNUD2;                     15220   
          END;                                                          15221   
       STO_D_AD2.GS.LIVREA.CNUD2  = TCDLADRE.CNUDC;                     15222   
       STO_D_AD2.GS.LIVREA.RASOC  = TCDLADRE.RASOC;                     15223   
       STO_D_AD2.GS.LIVREA.NOCLI  = TCDLADRE.NOCLI;                     15224   
       STO_D_AD2.GS.LIVREA.ADCLI  = TCDLADRE.ADCLI;                     15225   
       STO_D_AD2.GS.LIVREA.LORES  = TCDLADRE.LORES;                     15226   
       STO_D_AD2.GS.LIVREA.LOBDI  = TCDLADRE.LOBDI;                     15227   
       STO_D_AD2.GS.LIVREA.CPCLI  = TCDLADRE.CPCLI;                     15228   
       STO_D_AD2.GS.LIVREA.CPAYS  = TCDLADRE.CPAYS;                     15229   
       STO_D_AD2.GS.LIVREA.SIREN  = TCDLADRE.SIREN;                     15230   
0      SPIPA                      = '';  /*   TABLE DES ADRESSES CNUD7*/15231   
       SPIPA.FONCT                = 'RP';                               15232   
       SPIPA.COTAB                = 'CDLADRES';                         15233   
       SPIPA.OPERA                = '=';                                15234   
       SPIPA.REFPO                = TCDLFDEM.CNUD7;                     15235   
       CALL SPI2TBV (SPIPA,TCDLADRE,SPIFI);                             15236   
       IF SPIPA.CORET ^= '00' THEN DO;                                  15237   
       /* SPIPA.CORET ^= '00' & TCDLFDEM.CNUD7 ^= ' ' THEN DO */        15238   
          TCDLADRE                = '' ;                                15239   
          TCDLADRE.CNUDC          = TCDLFDEM.CNUD7;                     15240   
          END;                                                          15241   
       STO_D_AD2.GS.LIVPAR.CNUD7  = TCDLADRE.CNUDC;                     15242   
       STO_D_AD2.GS.LIVPAR.RASOC  = TCDLADRE.RASOC;                     15243   
       STO_D_AD2.GS.LIVPAR.NOCLI  = TCDLADRE.NOCLI;                     15244   
       STO_D_AD2.GS.LIVPAR.ADCLI  = TCDLADRE.ADCLI;                     15245   
       STO_D_AD2.GS.LIVPAR.LORES  = TCDLADRE.LORES;                     15246   
       STO_D_AD2.GS.LIVPAR.LOBDI  = TCDLADRE.LOBDI;                     15247   
       STO_D_AD2.GS.LIVPAR.CPCLI  = TCDLADRE.CPCLI;                     15248   
       STO_D_AD2.GS.LIVPAR.CPAYS  = TCDLADRE.CPAYS;                     15249   
       STO_D_AD2.GS.LIVPAR.SIREN  = TCDLADRE.SIREN;                     15250   
0      SPIPA                      = '';  /*   TABLE DES ADRESSES CNUD6*/15251   
       SPIPA.FONCT                = 'RP';                               15252   
       SPIPA.COTAB                = 'CDLADRES';                         15253   
       SPIPA.OPERA                = '=';                                15254   
       SPIPA.REFPO                = TCDLFDEM.CNUD6;                     15255   
       CALL SPI2TBV (SPIPA,TCDLADRE,SPIFI);                             15256   
       IF SPIPA.CORET ^= '00' THEN DO;                                  15257   
          TCDLADRE                = '' ;                                15258   
          TCDLADRE.CNUDC          = TCDLFDEM.CNUD6;                     15259   
          END;                                                          15260   
       STO_D_AD2.GS.REGLEA.CNUD6  = TCDLADRE.CNUDC;                     15261   
       STO_D_AD2.GS.REGLEA.RASOC  = TCDLADRE.RASOC;                     15262   
       STO_D_AD2.GS.REGLEA.NOCLI  = TCDLADRE.NOCLI;                     15263   
       STO_D_AD2.GS.REGLEA.ADCLI  = TCDLADRE.ADCLI;                     15264   
       STO_D_AD2.GS.REGLEA.LORES  = TCDLADRE.LORES;                     15265   
       STO_D_AD2.GS.REGLEA.LOBDI  = TCDLADRE.LOBDI;                     15266   
       STO_D_AD2.GS.REGLEA.CPCLI  = TCDLADRE.CPCLI;                     15267   
       STO_D_AD2.GS.REGLEA.CPAYS  = TCDLADRE.CPAYS;                     15268   
       STO_D_AD2.GS.REGLEA.SIREN  = TCDLADRE.SIREN;                     15269   
0      SPIPA                      = '';  /*   TABLE DES ADRESSES CNUD9*/15270   
       SPIPA.FONCT                = 'RP';                               15271   
       SPIPA.COTAB                = 'CDLADRES';                         15272   
       SPIPA.OPERA                = '=';                                15273   
       SPIPA.REFPO                = TCDLFDEM.CNUD9;                     15274   
       CALL SPI2TBV (SPIPA,TCDLADRE,SPIFI);                             15275   
       IF SPIPA.CORET ^= '00' THEN DO;                                  15276   
       /* SPIPA.CORET ^= '00' & TCDLFDEM.CNUD9 ^= ' ' THEN DO */        15277   
          TCDLADRE                = '' ;                                15278   
          TCDLADRE.CNUDC          = TCDLFDEM.CNUD9;                     15279   
          END;                                                          15280   
       STO_D_AD2.GS.DCLTVA.CNUD9  = TCDLADRE.CNUDC;                     15281   
       STO_D_AD2.GS.DCLTVA.RASOC  = TCDLADRE.RASOC;                     15282   
       STO_D_AD2.GS.DCLTVA.NOCLI  = TCDLADRE.NOCLI;                     15283   
       STO_D_AD2.GS.DCLTVA.ADCLI  = TCDLADRE.ADCLI;                     15284   
       STO_D_AD2.GS.DCLTVA.LORES  = TCDLADRE.LORES;                     15285   
       STO_D_AD2.GS.DCLTVA.LOBDI  = TCDLADRE.LOBDI;                     15286   
       STO_D_AD2.GS.DCLTVA.CPCLI  = TCDLADRE.CPCLI;                     15287   
       STO_D_AD2.GS.DCLTVA.CPAYS  = TCDLADRE.CPAYS;                     15288   
       STO_D_AD2.GS.DCLTVA.SIREN  = TCDLADRE.SIREN;                     15289   
       CTR_ENSEQ_D             = CTR_ENSEQ_D + 1             ;          15290   
       STO_D_AD2.ID.ENSEQ      = CTR_ENSEQ_D                 ;          15291   
0      WRITE FILE(FICSTOD) FROM (STO_D_AD2);                            15292   
       CTR_LIG_STOD               = CTR_LIG_STOD + 1 ;                  15293   
                                                                        15294   
 END INIT_STO_D_ADR;                                                    15295   
                                                                        15296   
 INIT_STO_D_LIG: PROC;            /* INITIALISATION FACTURE DEMAT */    15297   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     15298   
       STO_D_LIG               = '' ;                                   15299   
       STO_D_LIG.ID            = STO_D_ENT.ID                ;          15300   
                                                                        15301   
       STO_D_LIG.ID.COENR      = 'G'  ;                                 15302   
       STO_D_LIG.GS.TYPEN      = 'LIG';                                 15303   
       STO_D_LIG.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5 ;            15304   
       STO_D_LIG.GS.EANFO      = WL_CLLIV.NUCLI;                        15305   
 END INIT_STO_D_LIG;                                                    15306   
                                                                        15307   
 INIT_STO_D_LEC: PROC;            /* INITIALISATION FACTURE DEMAT */    15308   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     15309   
    /* PUT SKIP LIST ('ETIQ INIT_ENREG_LEC   ******')        */         15310   
       STO_D_LEC.ID            = STO_D_ENT.ID                ;          15311   
                                                                        15312   
                                 /* INIT. ENREG LIGNE ECHEANCE   */     15313   
       STO_D_LEC.GS.TYPEN      = 'LEC'                       ;          15314   
       STO_D_LEC.ID.COENR      = 'H'                         ;          15315   
       STO_D_LEC.GS.NULOT      = ''                          ;          15316   
       STO_D_LEC.GS.EANFO      = WL_CLLIV.NUCLI              ;          15317   
       STO_D_LEC.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5   ;          15318   
 END INIT_STO_D_LEC;                                                    15319   
                                                                        15320   
 INIT_STO_D_PIE: PROC;            /* INITIALISATION FACTURE DEMAT */    15321   
                                 /* INIT. ZONE ARGUMENT DE TRI   */     15322   
       STO_D_PIE.ID            = STO_D_ENT.ID                ;          15323   
                                                                        15324   
                                 /* INIT. ENREG PIED FACTURE     */     15325   
       STO_D_PIE.GS.TYPEN      = 'PIE'                       ;          15326   
       STO_D_PIE.ID.COENR      = 'I'                         ;          15327   
       STO_D_PIE.GS.NULOT      = ''                          ;          15328   
       STO_D_PIE.GS.EANFO      = WL_CLLIV.NUCLI              ;          15329   
       STO_D_PIE.GS.NUFAC      = ENTET70.NORUN !! WNUFAC_5   ;          15330   
 END INIT_STO_D_PIE;                                                    15331   
                                                                        15332   
1TRAIT_STO_D_ENT: PROC;            /* TRAIT. ENT     FACTURE DEMAT */   15333   
       SELECT ( WTFAC.GS.NATOP );  /* YDU 03.07                    */   15334   
          WHEN ('12','15','16','22','31','33') DO;                      15335   
             STO_D_ENT.GS.TYPFA  = '381' ;                              15336   
             END;                                                       15337   
          OTHERWISE    DO;                                              15338   
             STO_D_ENT.GS.TYPFA  = '380' ;                              15339   
             END;                                                       15340   
          END;                                                          15341   
       IF FACT.NETHT < 0   THEN STO_D_ENT.GS.SMONHT = '-'   ;           15342   
                           ELSE STO_D_ENT.GS.SMONHT = '+'   ;           15343   
       STO_D_ENT.GS.MONHT  = FACT.NETHT                     ;           15344   
       IF FACT.DEBIT < 0   THEN STO_D_ENT.GS.SMTTTC = '-'   ;           15345   
                           ELSE STO_D_ENT.GS.SMTTTC = '+'   ;           15346   
       STO_D_ENT.GS.MTTTC  = FACT.DEBIT                     ;           15347   
       IF FACT.TAXES < 0   THEN STO_D_ENT.GS.SMTTVA = '-'   ;           15348   
                           ELSE STO_D_ENT.GS.SMTTVA = '+'   ;           15349   
       IF WTFAC.POFIS = '0' ! WTFAC.POFIS = '2' !                       15350   
          WTFAC.POFIS = '3' ! WTFAC.POFIS = '5' !                       15351   
          WTFAC.POFIS = '7' THEN DO;                                    15352   
          STO_D_ENT.GS.MTTVA = FACT.TAXES                   ;           15353   
          END;             ELSE DO;                                     15354   
          STO_D_ENT.GS.MTTVA = 0                            ;           15355   
          END;                                              ;           15356   
       F15D2               = FRAIS - SVG_MTEMB_TTC          ;           15357   
       IF F15D2 < 0        THEN STO_D_ENT.GS.SMTFRA = '-'   ;           15358   
                           ELSE STO_D_ENT.GS.SMTFRA = '+'   ;           15359   
       STO_D_ENT.GS.MTFRA  = F15D2                          ;           15360   
       STO_D_ENT.GS.DEVIS  = 'EUR'                          ;           15361   
       STO_D_ENT.GS.DAFAC  = STRING(DFDTF)                  ;           15362   
       F15D2               = FRAIS_HT - SVG_MTEMB_HT        ;           15363   
       IF F15D2 < 0        THEN STO_D_ENT.GS.SMTTRA = '-'   ;           15364   
                           ELSE STO_D_ENT.GS.SMTTRA = '+'   ;           15365   
       STO_D_ENT.GS.MTTRA  = F15D2                          ;           15366   
       STO_D_ENT.GS.DAINS  = ''                             ;           15367   
       STO_D_ENT.GS.HEINS  = ''                             ;           15368   
       STO_D_ENT.MTEMB     = SVG_MTEMB_TTC                  ;           15369   
       IF SVG_MTEMB_TTC < 0 THEN STO_D_ENT.SMTEMB    = '-'  ;           15370   
                            ELSE STO_D_ENT.SMTEMB    = '+'  ;           15371   
       STO_D_ENT.SMTAFR    = '+'                            ;           15372   
       IF WRDAT.COENR = 'OF' THEN STO_D_ENT.GS.CDORR = 'O'  ;           15373   
                             ELSE STO_D_ENT.GS.CDORR = 'R'  ;           15374   
0                                        /*   GESTION ECHEANCES DEMAT */15375   
       DF_NB_ECH             = 0 ;                                      15376   
       DO I = 1 TO 8 ;                                                  15377   
          IF TABZ.WZ_DAECH(I) ^= ''                                     15378   
             THEN DF_NB_ECH    = DF_NB_ECH + 1 ;                        15379   
          END;                                                          15380   
       STO_D_ENT.GS.NBECH    = DF_NB_ECH      ;                         15381   
       IF DF_NB_ECH = 1 THEN DO ;                                       15382   
          STO_D_ENT.GS.DAECH = '20' !! TABZ.WZ_DAECH(1);                15383   
          END;                           ELSE DO;                       15384   
          STO_D_ENT.GS.DAECH  = '' ;                                    15385   
          CALL TRAIT_STO_D_ECH;                                         15386   
          END;                                                          15387   
       IF WTFAC.EDIPA = '1' THEN DO;                                    15388   
          STO_D_ENT.MTFHT          = FACT.FORTHT;                       15389   
          IF FACT.FORTHT > 0                                            15390   
             THEN STO_D_ENT.SMTFHT = '+' ;                              15391   
             ELSE STO_D_ENT.SMTFHT = '-' ;                              15392   
          END;                           ELSE DO;                       15393   
          STO_D_ENT.MTFHT          = 0   ;                              15394   
          STO_D_ENT.SMTFHT         = '+' ;                              15395   
          END;                                                          15396   
       IF WTGCO.MOREG = ' ' THEN DO;                                    15397   
          WCOPAE           = '' ;                                       15398   
          END;                           ELSE DO;                       15399   
          CLE2             = WTGCO.MOREG ;                              15400   
          CALL ID470B(TBMOREG.NUTAB);                                   15401   
       END;                                                             15402   
       STO_D_ENT.GS.COPAE  = WCOPAE;                                    15403   
                                                                        15404   
                                         /*   RESTITUTION SVG 12-09   */15405   
        SELECT ( W_NUFAOC );                                            15406   
           WHEN (' ') DO;                                               15407   
              IF SVG_W_NUFAOC ^= ' '                                    15408   
                 THEN W_NUFAOC = SVG_W_NUFAOC;                          15409   
              END;                                                      15410   
           WHEN ('999999999') DO;                                       15411   
              IF SVG_W_NUFAOC ^= ' '                                    15412   
               & SVG_W_NUFAOC ^= '999999999'                            15413   
                 THEN W_NUFAOC = SVG_W_NUFAOC;                          15414   
              END;                                                      15415   
           OTHERWISE  DO ;                                              15416   
              END;                                                      15417   
           END;                                                         15418   
        SELECT ( W_NUBLOC );                                            15419   
           WHEN (' ') DO;                                               15420   
              IF SVG_W_NUBLOC ^= ' '                                    15421   
                 THEN W_NUBLOC = SVG_W_NUBLOC;                          15422   
              END;                                                      15423   
           WHEN ('999999999') DO;                                       15424   
              IF SVG_W_NUBLOC ^= ' '                                    15425   
               & SVG_W_NUBLOC ^= '999999999'                            15426   
                 THEN W_NUBLOC = SVG_W_NUBLOC;                          15427   
              END;                                                      15428   
           OTHERWISE  DO ;                                              15429   
              END;                                                      15430   
           END;                                                         15431   
                                                                        15432   
       STO_D_ENT.GS.NUFAO  = W_NUFAO_RUN !! W_NUFAO_NUFAC ;             15433   
       STO_D_ENT.GS.NUBLO  = W_NUBLO_RUN !! W_NUBLO_LOREC ;             15434   
       IF STO_D_REF_EXIST_DQ = ' '       /*   YDU 04.07.08 SI  NUBLO= */15435   
        & STO_D_ENT.GS.NUBLO = '99999999'                               15436   
          THEN DO;                       /*   99-99 DS ENT ==> GENERAT*/15437   
                                         /*   ION REF DQ AVEC DATE    */15438   
          STO_D_REF_EXIST_DQ   = 'O' ;                                  15439   
          STO_D_REF.QUALI      = 'DQ';                                  15440   
          SVG_LOREC_PD         = WTFAC.LOREC ;                          15441   
          STO_D_REF.RFDIS      = WTFAC.NORUN  !!                        15442   
                                 SVG_LOREC_PD !!                        15443   
                                 SVG_OPERA_D ;                          15444   
          IF WTFAC.DAMMM = '00' ! WTFAC.DAMMM = '  ' THEN DO;           15445   
             STO_D_REF.DAOPE   = '20' !! ENTET70.DAT10.AA !!            15446   
                                 ENTET70.DAT10.MM !!                    15447   
                                 ENTET70.DAT10.JJ ;                     15448   
             END;                        ELSE DO;                       15449   
             STO_D_REF.DAOPE   = '20' !! WTFAC.DAMAA !!                 15450   
                                 WTFAC.DAMMM !! WTFAC.DAMJJ;            15451   
             END;                                                       15452   
          CALL ECRIT_STO_D_REF;                                         15453   
          END;                                                          15454   
                                                                        15455   
       CTR_LIG_STOD        = CTR_LIG_STOD + 1 ;                         15456   
       STO_D_ENT.GS.NBLFA  = CTR_LIG_STOD     ;                         15457   
       WRITE FILE(FICSTOD) FROM (STO_D_ENT)   ;                         15458   
                                                                        15459   
 END TRAIT_STO_D_ENT;                                                   15460   
                                                                        15461   
1TRAIT_STO_D_ECH: PROCEDURE;                                            15462   
           /*                                                           15463   
                    **************************************              15464   
                    *                                    *              15465   
                    *    ECRITURE DES LIGNES DEMAT       *              15466   
                    *    ECH SI ECHEANCES MULTIPLES      *              15467   
                    *                                    *              15468   
                    **************************************              15469   
           */                                                           15470   
       DO I = 1 TO 8 ;                                                  15471   
          IF TABZ.WZ_DAECH(I) ^= '' THEN DO;                            15472   
             STO_D_ECH.DTECH   = '20' !! TABZ.WZ_DAECH(I);              15473   
             STO_D_ECH.MTECH   = TABZ.WZ_MTECH(I);                      15474   
             IF TABZ.WZ_MTECH(I) > 0                                    15475   
                THEN STO_D_ECH.SMTECH = '+' ;                           15476   
                ELSE STO_D_ECH.SMTECH = '-' ;                           15477   
             STO_D_ECH.ENSEQ   = STO_D_ECH.ENSEQ + 1;                   15478   
             CTR_ENSEQ_D         = CTR_ENSEQ_D + 1 ;                    15479   
             STO_D_ECH.ENSEQ     = CTR_ENSEQ_D     ;                    15480   
             WRITE FILE (FICSTOD) FROM (STO_D_ECH);                     15481   
             CTR_LIG_STOD      = CTR_LIG_STOD + 1 ;                     15482   
             END;                                                       15483   
          END;                                                          15484   
                                                                        15485   
 END TRAIT_STO_D_ECH;                                                   15486   
                                                                        15487   
1   DECODE_LIGNE_D:   PROCEDURE;                                        15488   
           /*                                                           15489   
                    **************************************              15490   
                    *                                    *              15491   
                    *    SOUS PROGRAMME DE DECODAGE DE   *              15492   
                    *    LA LIGNE A PARTIR DE LIGNE1     *              15493   
                    *    POUR ALIMENTER FICHIER DEMAT    *              15494   
                    *                                    *              15495   
                    **************************************              15496   
           */                                                           15497   
0      AA00D:                                                           15498   
0                                       /*   VARIABLES GENERALES      */15499   
                                        /******************************/15500   
0          STO_D_LIG.CT         = ''  ;                                 15501   
           STO_D_LIG.QUARF      = 'ON';                                 15502   
0          IF ENTET70.DAT10.AA ^= ' ' &                                 15503   
              ENTET70.DAT10.MM ^= ' ' &                                 15504   
              ENTET70.DAT10.JJ ^= ' ' THEN DO;                          15505   
              PDEMFA            = ENTET70.DAT10.AA !!                   15506   
                                  ENTET70.DAT10.MM !!                   15507   
                                  ENTET70.DAT10.JJ ;                    15508   
              END;                      ELSE DO;                        15509   
              PDEMFA            = '000000' ;                            15510   
              END;                                                      15511   
0          STO_D_LIG.LIBTI      = WTFAC.LIBTI ;                         15512   
           STO_D_LIG.NOAUT      = WTFAC.LIBAU ;                         15513   
           IF LIGNE1_DEC.NUART  = ' '                                   15514   
              THEN STO_D_LIG.NUART    = WTFAC.NUART ;                   15515   
              ELSE STO_D_LIG.NUART    = LIGNE1_DEC.NUART;               15516   
           IF LIGNE1_DEC.REFLI  = ' '                                   15517   
              THEN WS_REFLI           = WTFAC.REFLI ;                   15518   
              ELSE WS_REFLI           = SUBSTR(LIGNE1_DEC.REFLI,1,10) ; 15519   
           IF SUBSTR(WS_REFLI,10,1)  ^= ' ' THEN DO;                    15520   
              I_DEB                   = 3 ;                             15521   
              END;                    ELSE DO;                          15522   
              IF SUBSTR(WS_REFLI,9,1) ^= ' ' THEN DO;                   15523   
                 I_DEB                = 2 ;                             15524   
                 END;                 ELSE DO;                          15525   
                 I_DEB                = 1 ;                             15526   
                 END;                                                   15527   
              END;                      /*   FIN PRISE 8 DERNIERS CAR.*/15528   
           STO_D_LIG.REFLI      = SUBSTR(WS_REFLI,I_DEB,8);             15529   
           STO_D_LIG.LIEDI      = LIGNE_NUEDI.LIEDI !!                  15530   
                                  LIGNE_NUEDI.FIL02 !!                  15531   
                                  LIGNE_NUEDI.LIDIV ;                   15532   
           CODECH               = SUBSTR(LIGNE1_DEC.ECHEA,1,2) ;        15533   
           IF CODECH = ' '                                              15534   
              THEN   CODECH     = WTFAC.ECHEA ;                         15535   
0                                       /*   SURREMISE                */15536   
                                        /******************************/15537   
           IF LIGNE1_DEC.ASTER  = ' *'                                  15538   
              THEN STO_D_LIG.SURRE      = 'O' ;                         15539   
              ELSE STO_D_LIG.SURRE      = 'N' ;                         15540   
0                                       /*   MONTANT REMISE           */15541   
                                        /******************************/15542   
           STO_D_LIG.MTREM      = WTFAC.FORLI - WTFAC.NETLI ;           15543   
           IF (WTFAC.FORLI - WTFAC.NETLI) > 0                           15544   
              THEN STO_D_LIG.SMTREM     = '+' ;                         15545   
              ELSE STO_D_LIG.SMTREM     = '-' ;                         15546   
0                                       /*   QUANTITE                 */15547   
                                        /******************************/15548   
           IF LIGNE1_DEC.QUANT  = ' ' THEN DO;                          15549   
              IF STO_D_LIG.TYPRO   = 'C' THEN DO;/*   COLIS TETE      */15550   
                 QUANT_DEC                = '000'           !!          15551   
                                            SUBSTR(ZLIBEL,1,3) ;        15552   
                 END;                   ELSE DO;                        15553   
                                        /*   TETE COLIS ET ATM        */15554   
                 /* BFA$ : DEBUT MODIF REMPLACER QUANT PAR NBTOM */     15555   
                 /*QUANT_NS                 = WTFAC.QUANT ;*/           15556   
                 QUANT_NS                 = WTFAC.NBTOM ;               15557   
                 /* BFA$ : FIN MODIF REMPLACER QUANT PAR NBTOM */       15558   
                 END;                                                   15559   
              END;                     ELSE DO;                         15560   
              QUANT_DEC         = SUBSTR(LIGNE1_DEC.QUANT,1,3) !!       15561   
                                  SUBSTR(LIGNE1_DEC.QUANT,5,3) ;        15562   
              END;                                                      15563   
           QUANT_DEC            = TRANSLATE(QUANT_DEC,'0',' ');         15564   
           IF VERIFY(QUANT_DEC,'0123456789') = 0 THEN DO;               15565   
              STO_D_LIG.QTFAC   = QUANT_NS ;                            15566   
              END;                                                      15567   
0                                       /*   NET HT                   */15568   
                                        /******************************/15569   
           IF LIGNE1_DEC.NETHT  = ' ' THEN DO;                          15570   
                                        /*   TETE COLIS ET ATM        */15571   
              NET_NS            = WTFAC.NETLI ;                         15572   
              IF WTFAC.NETLI > 0                                        15573   
                 THEN STO_D_LIG.SNETHT = '+' ;                          15574   
                 ELSE STO_D_LIG.SNETHT = '-' ;                          15575   
              END;                      ELSE DO;                        15576   
              NET_DEC           = SUBSTR(LIGNE1_DEC.NETHT,1,5) !!       15577   
                                  SUBSTR(LIGNE1_DEC.NETHT,7,3) !!       15578   
                                  SUBSTR(LIGNE1_DEC.NETHT,11,2) ;       15579   
              IF SUBSTR(LIGNE1_DEC.NETHT,13,1) = '-'                    15580   
                 THEN STO_D_LIG.SNETHT  = '-' ;                         15581   
                 ELSE STO_D_LIG.SNETHT  = '+' ;                         15582   
              END;                                                      15583   
           NET_DEC              = TRANSLATE(NET_DEC,'0',' ');           15584   
           IF VERIFY(NET_DEC,'0123456789') = 0 THEN DO;                 15585   
              STO_D_LIG.NETHT   = NET_NS ;                              15586   
              END;                                                      15587   
0                                       /*   TAUX REMISE              */15588   
                                        /******************************/15589   
           IF LIGNE1_DEC.REMIS  = ' ' THEN DO;                          15590   
                                        /*   TETE COLIS ET ATM        */15591   
              REMIS_NS          = WTFAC.RAPLI ;                         15592   
              END;                      ELSE DO;                        15593   
              REMIS_DEC         = SUBSTR(LIGNE1_DEC.REMIS,1,3) !!       15594   
                                  SUBSTR(LIGNE1_DEC.REMIS,5,2) ;        15595   
              END;                                                      15596   
           REMIS_DEC            = TRANSLATE(REMIS_DEC,'0',' ');         15597   
           IF VERIFY(REMIS_DEC,'0123456789') = 0 THEN DO;               15598   
              STO_D_LIG.TXREM   = REMIS_NS ;                            15599   
              END;                                                      15600   
0                                       /*   PIPUB HT                 */15601   
                                        /******************************/15602   
           PRIX_DEC             = SUBSTR(LIGNE1_DEC.PIPUB,1,5) !!       15603   
                                  SUBSTR(LIGNE1_DEC.PIPUB,7,2) ;        15604   
           PRIX_DEC             = TRANSLATE(PRIX_DEC,'0',' ');          15605   
           IF VERIFY(PRIX_DEC,'0123456789') = 0 THEN DO;                15606   
              STO_D_LIG.PPUHT   = PRIX_NS  ;                            15607   
              END;                                                      15608   
0                                       /*   PUNHT HT                 */15609   
                                        /******************************/15610   
           IF LIGNE1_DEC.PUNHT = ' ' THEN DO;                           15611   
                                        /*   TETE COLIS ET ATM        */15612   
              PRIX_NS           = WTFAC.PUNHT ;                         15613   
              END;                      ELSE DO;                        15614   
              PRIX_DEC          = SUBSTR(LIGNE1_DEC.PUNHT,1,5) !!       15615   
                                     SUBSTR(LIGNE1_DEC.PUNHT,7,2) ;     15616   
              PRIX_DEC          = TRANSLATE(PRIX_DEC,'0',' ');          15617   
              END;                                                      15618   
           IF VERIFY(PRIX_DEC,'0123456789') = 0 THEN DO;                15619   
              STO_D_LIG.PUNHT   = PRIX_NS  ;                            15620   
              END;                                                      15621   
0                                       /*   PRIBB TC                 */15622   
                                        /******************************/15623   
           PRIX_DEC             = SUBSTR(LIGNE1_DEC.PRIBB,1,5) !!       15624   
                                  SUBSTR(LIGNE1_DEC.PRIBB,7,2) ;        15625   
           PRIX_DEC             = TRANSLATE(PRIX_DEC,'0',' ');          15626   
           IF VERIFY(PRIX_DEC,'0123456789') = 0 THEN DO;                15627   
              STO_D_LIG.PPUTC   = PRIX_NS  ;                            15628   
              END;                                                      15629   
0                                       /*   TAUX TAXE                */15630   
                                        /******************************/15631   
           IF LIGNE1_DEC.COTAX ^= SVG_STO_D_COTAX                       15632   
            & LIGNE1_DEC.COTAX ^= ' ' THEN DO;                          15633   
              SVG_STO_D_COTAX   = LIGNE1_DEC.COTAX ;                    15634   
              CLE1              = SVG_STO_D_COTAX  ;                    15635   
              WPOFIS            = WTFAC.POFIS;                          15636   
              CALL ID470B(TBCOTAX.NUTAB);                               15637   
              REMIS_DEC         = SUBSTR(WTOLEG,1,3) !!                 15638   
                                  SUBSTR(WTOLEG,5,2) ;                  15639   
              REMIS_DEC         = TRANSLATE(REMIS_DEC,'0',' ');         15640   
              IF VERIFY(REMIS_DEC,'0123456789') = 0 THEN DO;            15641   
                 SVG_STO_D_TXTAX   = REMIS_NS ;                         15642   
                 END;           ELSE DO;                                15643   
                 SVG_STO_D_TXTAX   = 0        ;                         15644   
                 END;                                                   15645   
              END;                                                      15646   
           IF LIGNE1_DEC.COTAX   = ' ' THEN DO;                         15647   
                                         /*   09.2007 GRATUIT MT=0    */15648   
              IF STO_D_LIG.TYPRO = 'U' THEN DO;                         15649   
                 SVG_STO_D_COTAX    = WTFAC.COTAX;                      15650   
                 CLE1               = SVG_STO_D_COTAX;                  15651   
                 WPOFIS             = WTFAC.POFIS;  /*EDI-351 09/2024*/ 15652   
                 CALL ID470B(TBCOTAX.NUTAB);                            15653   
                 REMIS_DEC          = SUBSTR(WTOLEG,1,3) !!             15654   
                                      SUBSTR(WTOLEG,5,2) ;              15655   
                 REMIS_DEC          = TRANSLATE(REMIS_DEC,'0',' ');     15656   
                 IF VERIFY(REMIS_DEC,'0123456789') = 0 THEN DO;         15657   
                    SVG_STO_D_TXTAX = REMIS_NS ;                        15658   
                    END;         ELSE DO;                               15659   
                    SVG_STO_D_TXTAX = 0       ;                         15660   
                    END;                                                15661   
                 STO_D_LIG.TXTAX    = SVG_STO_D_TXTAX ;                 15662   
                 END;                                                   15663   
              IF STO_D_LIG.TYPRO = 'A' THEN DO;                         15664   
                 STO_D_LIG.TXTAX    = 0               ;                 15665   
                 END;                                                   15666   
              END;                      ELSE DO;                        15667   
              STO_D_LIG.TXTAX       = SVG_STO_D_TXTAX ;                 15668   
              END;                                                      15669   
0                                       /*   CAS COLIS HOMOGENE       */15670   
                                        /******************************/15671   
           IF STO_D_LIG.TYPRO = 'C' THEN DO;                            15672   
              SVG_STO_D_COTAX   = WTFAC.COTAX;                          15673   
              CLE1              = SVG_STO_D_COTAX  ;                    15674   
              WPOFIS            = WTFAC.POFIS;    /*EDI-351 09/2024*/   15675   
              CALL ID470B(TBCOTAX.NUTAB);                               15676   
              REMIS_DEC         = SUBSTR(WTOLEG,1,3) !!                 15677   
                                  SUBSTR(WTOLEG,5,2) ;                  15678   
              REMIS_DEC         = TRANSLATE(REMIS_DEC,'0',' ');         15679   
              IF VERIFY(REMIS_DEC,'0123456789') = 0                     15680   
                 THEN SVG_STO_D_TXTAX = REMIS_NS ;                      15681   
                 ELSE SVG_STO_D_TXTAX = 0        ;                      15682   
              STO_D_LIG.TXTAX   = SVG_STO_D_TXTAX;                      15683   
              END;                                                      15684   
                                                                        15685   
 /* EDI-154 20210204 MISE A ZERO TAUX TVA EXPORT: FICHIER FICSTOD  */   15686   
 /*        IF  WTFAC.DEPCO = '17' THEN STO_D_LIG.TXTAX = 0; */          15687   
                                                                        15688   
0      AA00F:                                                           15689   
           END DECODE_LIGNE_D;                                          15690   
                                                                        15691   
1   ECRIT_STO_D_LIG:     PROCEDURE;                                     15692   
           /*                                                           15693   
                    **************************************              15694   
                    *                                    *              15695   
                    *    SOUS PROGRAMME D ECRITURE DE    *              15696   
                    *    LA LIGNE DETAIL DEMAT           *              15697   
                    *                                    *              15698   
                    **************************************              15699   
           */                                                           15700   
0      AB00D_D:                                                         15701   
0                                       /*   DOCUM ECHEANCE           */15702   
                                        /******************************/15703   
0          IF SVG_TYREF = '3' THEN DO;  /* 20-07-07 PAS DEMAT FR.PORT */15704   
              GO TO AB00F_D;                                            15705   
              END;                                                      15706   
0          STO_D_LIG.MTECH              = SVG_AMTTC ;                   15707   
           IF SVG_AMTTC > 0                                             15708   
              THEN STO_D_LIG.SMTECH     = '+' ;                         15709   
              ELSE STO_D_LIG.SMTECH     = '-' ;                         15710   
           STO_D_LIG.DTECH              = '20' !! SVG_DAECH ;           15711   
0          IF TOP_DEMA_LIG = 'O'                                        15712   
                                 THEN DO;                               15713   
              /* MISE EN COMMENTAIRE, MAINTENANT ON ENVOIE LES */       15714   
              /* COMPOSANTS GRATUITS : BFA 04/12/2006 A LA     */       15715   
              /* DEMANDE DE JDU ET CVE                         */       15716   
              /* 05/12/2006 : ON LAISSE PASSER LES GRATUITS    */       15717   
              /* MAIS PAS LES LIBELLES (TYREF 5 ET EDI/DIV/COL */       15718   
              /* 998/98/98)                                    */       15719   
              IF SVG_TYREF = '5' &                                      15720   
                 SVG_NUEDI = '998' &                                    15721   
                 SVG_NUDIV = '98' &                                     15722   
                 SVG_NUCOL = '98' THEN DO;                              15723   
                 CTR_STO_COM            = CTR_STO_COM + 1 ;             15724   
                 IF CTR_STO_COM < 51 THEN DO;                           15725   
                    STO_D_COM.TYPCO     = 'SUR' ;                       15726   
                    STO_D_COM.ZOCOM     = LIGNE1_DEC.QUANT !!           15727   
                                          LIGNE1_DEC.LIBEL !!           15728   
                                          LIGNE1_DEC.NETHT ;            15729   
                    CTR_ENSEQ_D         = CTR_ENSEQ_D + 1 ;             15730   
                    STO_D_COM.ENSEQ     = CTR_ENSEQ_D     ;             15731   
                    WRITE FILE (FICSTOD) FROM (STO_D_COM) ;             15732   
                    CTR_LIG_STOD        = CTR_LIG_STOD + 1 ;            15733   
                    END;                                                15734   
                 END;                    ELSE DO;                       15735   
                 CTR_ENSEQ_D         = CTR_ENSEQ_D + 1 ;                15736   
                 STO_D_LIG.ENSEQ     = CTR_ENSEQ_D     ;                15737   
                 WRITE FILE (FICSTOD) FROM (STO_D_LIG) ;                15738   
                 CTR_LIG_STOD           = CTR_LIG_STOD + 1 ;            15739   
                 END;                                                   15740   
              END;                                                      15741   
0      AB00F_D:                                                         15742   
           END ECRIT_STO_D_LIG;                                         15743   
                                                                        15744   
1   ECRIT_STO_D_LEC:     PROCEDURE;                                     15745   
           /*                                                           15746   
                    **************************************              15747   
                    *                                    *              15748   
                    *    SOUS PROGRAMME D ECRITURE DE    *              15749   
                    *    LA LIGNE DETAIL POUR LA         *              15750   
                    *    PARTIE LEC SI ECHEANCE MULTI.   *              15751   
                    *                                    *              15752   
                    **************************************              15753   
           */                                                           15754   
0      AC00D:                                                           15755   
0                                       /*   DOCUM ECHEANCE MULTIPLE  */15756   
                                        /******************************/15757   
0          STO_D_LEC.MTECH              = SVG_AMTTC ;                   15758   
           IF SVG_AMTTC > 0                                             15759   
              THEN STO_D_LEC.SMTECH     = '+' ;                         15760   
              ELSE STO_D_LEC.SMTECH     = '-' ;                         15761   
           STO_D_LEC.DTECH              = '20' !! SVG_DAECH ;           15762   
0          IF TOP_DEMA_LEC = 'O' &                                      15763   
              SVG_AMTTC   ^=  0  THEN DO;                               15764   
              CTR_ENSEQ_D         = CTR_ENSEQ_D + 1 ;                   15765   
              STO_D_LEC.ENSEQ     = CTR_ENSEQ_D     ;                   15766   
              WRITE FILE (FICSTOD) FROM (STO_D_LEC) ;                   15767   
              CTR_LIG_STOD              = CTR_LIG_STOD + 1 ;            15768   
              END;                                                      15769   
0      AC00F:                                                           15770   
           END ECRIT_STO_D_LEC;                                         15771   
                                                                        15772   
1   GEST_REFERENCE_D:      PROCEDURE;                                   15773   
           /*                                                           15774   
                    **************************************              15775   
                    *                                    *              15776   
                    *    GESTION DES REFERENCES          *              15777   
                    *    DISTRIBUTEUR ET CLIENT          *              15778   
                    *    PARTIE LEC SI ECHEANCE MULTI.   *              15779   
                    *                                    *              15780   
                    **************************************              15781   
           */                                                           15782   
0      AD00D_D:                                                         15783   
        SELECT (SUBSTR(WTFAC.GNATO,1,1));                               15784   
           WHEN ('0','1') DO;            /*   FACTURE ET RECTIF       */15785   
              IF SVG_RESAI_D ^= WTFAC.RESAI.ANNEE !!                    15786   
                                WTFAC.RESAI.RUN   !!                    15787   
                                WTFAC.RESAI.ORIGI THEN DO;              15788   
                 SVG_RESAI_D  = WTFAC.RESAI.ANNEE !!                    15789   
                                WTFAC.RESAI.RUN   !!                    15790   
                                WTFAC.RESAI.ORIGI ;                     15791   
                 IF SVG_RESAI_D ^= ' ' THEN DO;                         15792   
                    STO_D_REF_EXIST_SS   = 'O' ;                        15793   
                    STO_D_REF.QUALI      = 'SS';                        15794   
                    STO_D_REF.RFDIS      = WTFAC.RESAI.ANNEE !!         15795   
                                           WTFAC.RESAI.RUN   !! '.' !!  15796   
                                           WTFAC.RESAI.ORIGI ;          15797   
                    CALL ECRIT_STO_D_REF;                               15798   
                    END;                                                15799   
                 END;                                                   15800   
              IF SVG_RECO1_D ^= WTFAC.RECO1 THEN DO;                    15801   
                 SVG_RECO1_D  = WTFAC.RECO1 ;                           15802   
                 IF SVG_RECO1_D ^= ' '  THEN DO;                        15803   
                    STO_D_REF_EXIST_ON   = 'O' ;                        15804   
                    STO_D_REF.QUALI      = 'ON';                        15805   
                    STO_D_REF.RFDIS      = SUBSTR(WTFAC.RECO1,1,17);    15806   
                    CALL ECRIT_STO_D_REF;                               15807   
                    END;                                                15808   
                 END;                                                   15809   
              IF SVG_NORUN_D ^= WTFAC.NORUN !                           15810   
                 SVG_LOREC_D ^= WTFAC.LOREC THEN DO;                    15811   
                 SVG_NORUN_D  = WTFAC.NORUN ;                           15812   
                 SVG_LOREC_D  = WTFAC.LOREC ;                           15813   
                 IF SVG_NORUN_D ^= ' '  & SVG_LOREC_D ^= 0 THEN DO;     15814   
                    STO_D_REF_EXIST_DQ   = 'O' ;                        15815   
                    STO_D_REF.QUALI      = 'DQ';                        15816   
                    SVG_LOREC_PD         = WTFAC.LOREC ;                15817   
                    STO_D_REF.RFDIS      = WTFAC.NORUN  !!              15818   
                                           SVG_LOREC_PD !!              15819   
                                           SVG_OPERA_D ;                15820   
                    CALL ECRIT_STO_D_REF;                               15821   
                    SVG_OPERA_D          = '' ;                         15822   
                    END;                                                15823   
                 END;                                                   15824   
              END;                                                      15825   
           WHEN ('3')        DO;         /*   RETOUR                  */15826   
              IF WTFAC.NATOP = '31' THEN DO;                            15827   
                 IF STO_D_REF_EXIST_04G ^= 'O' THEN DO;                 15828   
                    STO_D_REF_EXIST_04G  = 'O' ;                        15829   
                    STO_D_REF.QUALI      = '04G';                       15830   
                    IF WTFAC.RECO1 ^= ' '                               15831   
                    /* PJA 20141107 - PB REFERENCE PRISME */            15832   
                    /* THEN STO_D_REF.RFDIS = SUBSTR(WTFAC.RECO1,1,8);*/15833   
                       THEN STO_D_REF.RFDIS = SUBSTR(WTFAC.RECO1,1,17); 15834   
                       ELSE STO_D_REF.RFDIS = SVG_REPIE_D ;             15835   
                    CALL ECRIT_STO_D_REF;                               15836   
                    END;                                                15837   
                 END;                                                   15838   
              IF SVG_REPIE_D ^= WTFAC.REPIE THEN DO;                    15839   
                 SVG_REPIE_D  = WTFAC.REPIE ;                           15840   
                 IF SVG_REPIE_D ^= ' ' & SVG_REPIE_D ^= '0000' THEN DO; 15841   
                    STO_D_REF_EXIST_VN   = 'O' ;                        15842   
                    STO_D_REF.QUALI      = 'VN';                        15843   
                    STO_D_REF.RFDIS      = WTFAC.REPIE ;                15844   
                    CALL ECRIT_STO_D_REF;                               15845   
                    END;                                                15846   
                 END;                                                   15847   
              IF SVG_RECO1_D ^= WTFAC.RECO1 THEN DO;                    15848   
                 SVG_RECO1_D  = WTFAC.RECO1 ;                           15849   
                 IF SVG_RECO1_D ^= ' ' THEN DO;                         15850   
                    STO_D_REF_EXIST_ON   = 'O' ;                        15851   
                    STO_D_REF.QUALI      = 'ON';                        15852   
                    STO_D_REF.RFDIS      = SUBSTR(SVG_RECO1_D,1,8);     15853   
                    CALL ECRIT_STO_D_REF;                               15854   
                    END;                                                15855   
                 END;                                                   15856   
              END;                                                      15857   
           OTHERWISE         DO;         /*   RETOUR                  */15858   
              END;                                                      15859   
           END;                                                         15860   
0      AD00F_D:                                                         15861   
           END GEST_REFERENCE_D;                                        15862   
                                                                        15863   
1   ECRIT_STO_D_REF:     PROCEDURE;                                     15864   
           /*                                                           15865   
                    **************************************              15866   
                    *                                    *              15867   
                    *    AJOUT D UNE DATE DE REFERENCE   *              15868   
                    *    DANS LA DEMAT SI IL N Y EN A    *              15869   
                    *    PAS - DEMANDE AUCHAN -          *              15870   
                    *                                    *              15871   
                    **************************************              15872   
           */                                                           15873   
0      AE00D_D:                                                         15874   
           IF SUBSTR(STO_D_REF.DAOPE,3,6) = ' '      !                  15875   
              SUBSTR(STO_D_REF.DAOPE,3,6) = '000000' THEN DO;           15876   
              IF ^(WTFAC.DAMMM = ' ' ! WTFAC.DAMMM = '00') THEN DO;     15877   
                 STO_D_REF.DAOPE         = '20' !! WTFAC.DAMAA !!       15878   
                                           WTFAC.DAMMM !! WTFAC.DAMJJ;  15879   
                 END;                    ELSE DO;                       15880   
                 IF ^(WTFAC.DCOMM = ' ' ! WTFAC.DCOMM = '00') THEN DO;  15881   
                    STO_D_REF.DAOPE      = '20' !! WTFAC.DCOAA !!       15882   
                                           WTFAC.DCOMM !! WTFAC.DCOJJ;  15883   
                    END;                 ELSE DO;                       15884   
                    STO_D_REF.DAOPE      = '20' !! ENTET70.DAT10.AA !!  15885   
                                           ENTET70.DAT10.MM !!          15886   
                                           ENTET70.DAT10.JJ ;           15887   
                    END;                                                15888   
                 END;                                                   15889   
              END;                                                      15890   
           CTR_ENSEQ_D        = CTR_ENSEQ_D + 1;                        15891   
           STO_D_REF.ID.ENSEQ = CTR_ENSEQ_D;                            15892   
           WRITE FILE (FICSTOD) FROM (STO_D_REF) ;                      15893   
           CTR_LIG_STOD       = CTR_LIG_STOD    + 1;                    15894   
0      AE00F:                                                           15895   
           END ECRIT_STO_D_REF;                                         15896   
  /*-- FIN   GLT ---------- JUIN 2010 ------------- --*/                15897   
1   MEF_FICSTOP:         PROCEDURE;                                     15898   
           /*                                                           15899   
                    **************************************              15900   
                    *                                    *              15901   
                    *    POUR FICHIER FICSTOP GESTION    *              15902   
                    *     - SAUT DE PAGE                 *              15903   
                    *     - CODE SAUT                    *              15904   
                    *     - CODE POLICE                  *              15905   
                    *     - CHAMPS 5A                    *              15906   
                    *                                    *              15907   
                    **************************************              15908   
           */                                                           15909   
0      AF00D:                                                           15910   
                                         /*   CHANGEMENT FOND PAGE    */15911   
           IF STO_P_WOR.COFPAGSC ^= STO_P_WOR_AS.COFPAGSC THEN DO;      15912   
              CALL GEST_FICSTOP_5A;                                     15913   
              END;                                                      15914   
           IF STO_P_WOR.IIPAGEFD ^= STO_P_WOR_AS.IIPAGEFD THEN DO;      15915   
              IF FICSTOP_PREV_GEN.SAUT ^= '5A'X THEN DO;                15916   
                 CALL GEST_FICSTOP_5A;                                  15917   
                 END;                                                   15918   
              STO_P_GEN.SAUT             = '1';                         15919   
              END;                       ELSE DO;                       15920   
              STO_P_GEN.SAUT             = ' ';                         15921   
              END;                                                      15922   
           IF STO_P_WOR.IIORLIFD ^= 0                                   15923   
              THEN STO_P_GEN.SAUT        = '+';                         15924   
           SELECT (STO_P_WOR.IDPOCASC);                                 15925   
              WHEN (000) STO_P_GEN.POLIC = '00'X;                       15926   
              WHEN (001) STO_P_GEN.POLIC = '01'X;                       15927   
              WHEN (002) STO_P_GEN.POLIC = '02'X;                       15928   
              WHEN (004) STO_P_GEN.POLIC = '04'X;                       15929   
              WHEN (005) STO_P_GEN.POLIC = '05'X;                       15930   
              WHEN (006) STO_P_GEN.POLIC = '60'X;                       15931   
              OTHERWISE  STO_P_GEN.POLIC = '00'X;                       15932   
              END;                                                      15933   
0          STO_P_WOR_AS             = STO_P_WOR , BY NAME;              15934   
           STO_P_GEN_AS             = STO_P_GEN , BY NAME;              15935   
0      AF00F:                                                           15936   
           END MEF_FICSTOP;                                             15937   
1   GEST_FICSTOP_5A:     PROCEDURE;                                     15938   
           /*                                                           15939   
                    **************************************              15940   
                    *                                    *              15941   
                    *    POUR FICHIER FICSTOP GESTION    *              15942   
                    *     - SAUT DE PAGE                 *              15943   
                    *     - CODE SAUT                    *              15944   
                    *     - CODE POLICE                  *              15945   
                    *     - CHAMPS 5A                    *              15946   
                    *                                    *              15947   
                    **************************************              15948   
           */                                                           15949   
0      BF00D:                                                           15950   
                                         /*   CHANGEMENT FOND PAGE    */15951   
           STO_P_GEN.GS.INFO        = '' ;                              15952   
           STO_P_GEN_CH5A1          = PAG1_POR  , BY NAME;              15953   
           STO_P_GEN_CH5A1.V_NOM    = STO_P_WOR.COFPAGSC;               15954   
           STO_P_GEN.ID.ENSEQ       = STO_P_GEN.ID.ENSEQ + 1 ;          15955   
           FICSTOP_PREV_GEN         = STO_P_GEN ;                       15956   
           WRITE FILE (FICSTOP) FROM (STO_P_GEN) ;                      15957   
           STO_P_GEN_CH5A2          = PAG2_POR  , BY NAME;              15958   
           SELECT (STO_P_WOR.COFPAGSC);                                 15959   
              WHEN ('FCTF61') STO_P_GEN_CH5A2.V_NOM = 'O1A4FR61';       15960   
              WHEN ('FCTF62') STO_P_GEN_CH5A2.V_NOM = 'O1A4FR62';       15961   
              WHEN ('FCTF63') STO_P_GEN_CH5A2.V_NOM = 'O1A4FR63';       15962   
              WHEN ('FCTH91') STO_P_GEN_CH5A2.V_NOM = 'O1A4FH91';       15963   
              WHEN ('FCTH92') STO_P_GEN_CH5A2.V_NOM = 'O1A4FH92';       15964   
              WHEN ('FCTH93') STO_P_GEN_CH5A2.V_NOM = 'O1A4FH93';       15965   
              WHEN ('FCTM31') STO_P_GEN_CH5A2.V_NOM = 'O1A4FR61';       15966   
              WHEN ('FCTM32') STO_P_GEN_CH5A2.V_NOM = 'O1A4FR62';       15967   
              WHEN ('FCTM33') STO_P_GEN_CH5A2.V_NOM = 'O1A4FR63';       15968   
              OTHERWISE       STO_P_GEN_CH5A2.V_NOM = 'O1A4FR63';       15969   
              END;                                                      15970   
           STO_P_GEN.ID.ENSEQ       = STO_P_GEN.ID.ENSEQ + 1 ;          15971   
           FICSTOP_PREV_GEN         = STO_P_GEN ;                       15972   
           WRITE FILE (FICSTOP) FROM (STO_P_GEN) ;                      15973   
           NB_FICSTOP               = NB_FICSTOP + 2;                   15974   
0      BF00F:                                                           15975   
           END GEST_FICSTOP_5A;                                         15976   
1                                                                       15977   
 /*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/15978   
 /*    INCLUDE++ Y2KPLIP                                              */15979   
        /* DATA SET Y2KPLIP    AT LEVEL 039 AS OF 16/10/97    */                
 /*===================================================================*/00001   
 /*  COMPARAISON DE DATES (ETENDU SEULEMENT)                          */00002   
 /*_------------------------------------------------------------------*/00003   
 /*  APPEL : CALL Y2KCOMP? ? VARIANT DE 1 A 5 MAXIMUM                 */00004   
 /*  PARAMETRES : VARIABLES STATIQUES                                 */00005   
 /*               Y2K_ARGUM1 , 2 : ZONES EN CHAR A COMPARER (MAX 999) */00006   
 /*               Y2K_DECENNIE  : STRUCTURE A INITIALISER A CHAQUE    */00007   
 /*                               APPEL                               */00008   
 /*               Y2K_POSDE(I)(I DE 1 A 4):POSITIONS DE LA DECENNIE   */00009   
 /*                            DANS LES ZONES A COMPARER              */00010   
 /*  RESULTAT   : Y2K_RESULT?  < 0 SI Y2K_ARGUM1 < Y2K_ARGUM2         */00011   
 /*               Y2K_RESULT?  = 0 SI Y2K_ARGUM1 = Y2K_ARGUM2         */00012   
 /*               Y2K_RESULT?  > 0 SI Y2K_ARGUM1 > Y2K_ARGUM2         */00013   
 /*-------------------------------------------------------------------*/00014   
 /*  REGLES DE COMPARAISON :                                          */00015   
 /*  -----------------------                                          */00016   
 /*    L'ORDRE IMPOSE EST   LE SUIVANT :                              */00017   
 /*    LOW<SPACE<'0000..'<'5...'<'9...'<'0...'<'4...'<'9999..'<HIGH   */00018   
 /*                                                                   */00019   
 /*    POUR LE CAS AA (DECENNIE SEULE) IL FAUT SIGNER EN <0 LA        */00020   
 /*    POSITION DE LA DECENNIE POUR INDIQUER AU MODULE DE NE PAS      */00021   
 /*    TRAITER SPECIFIQUEMENT AAMM = '0000' OU '9999'                 */00022   
 /*-------------------------------------------------------------------*/00023   
 /*  EXEMPLE : IF (( ZONE1 > ZONE2 & PRIX > 100 ) ! ZONE3 < ZONE4 )   */00024   
 /*      AVEC DES DECENNIES EN 12 POUR ZONE1 5,8 POUR ZONE 3 DEVIENT  */00025   
 /*      Y2K_DECENNIE = ''                                            */00026   
 /*      Y2K_POSDE(1) = 12                                            */00027   
 /*      Y2K_ARGUM1= ZONE1                                            */00028   
 /*      Y2K_ARGUM2= ZONE2                                            */00029   
 /*      CALL Y2KCOMP1                                                */00030   
 /*                                                                   */00031   
 /*      Y2K_DECENNIE = ''                                            */00032   
 /*      Y2K_POSDE(1) = 5                                             */00033   
 /*      Y2K_POSDE(2) = 8                                             */00034   
 /*      Y2K_ARGUM1= ZONE3                                            */00035   
 /*      Y2K_ARGUM2= ZONE4                                            */00036   
 /*      CALL Y2KCOMP2                                                */00037   
 /*  TEST REMPLACE                                                    */00038   
 /*    IF ((Y2K_RESULT1 > 0 & PRIX > 100) ! Y2K_RESULT2 < 0 )         */00039   
 /*===================================================================*/00040   
 /*================================================================     00041   
  *   CALCULS SUR ANNEES / DETERMINATION DU SIECLE                      00042   
  *      ENTREES : DATE EN ETENDU OU PACKE AA , AAMM , AAMMJJ           00043   
  *                DELTA EN NOMBRES D'ANNEES SIGNE (S99)                00044   
  *      RESULTAT: DATE SUR 8 OBTENU EN EFFECTUANT AA + DELTA PUIS      00045   
  *                APPLICATION DE LA FENETRE AU RESULTAT XX             00046   
  *     SI ORIGINE+DELTA < 50 ALORS SIECLE = 20 => 20AA....             00047   
  *     SI ORIGINE+DELTA > 49 ALORS SIECLE = 19 => 19AA....             00048   
  *     SI DELTA = 0 , DETERMINATION SIMPLE DU SIECLE                   00049   
  *     SI ANNEE NON NUMERIQUE ALORS                                    00050   
  *                     SIECLE = AA(ORIGINE)                            00051   
  *                   EXEMPLE (SPACES, LOW_VALUE, ....)                 00052   
  *-----------------------------------------------------------------    00053   
  *   POUR UNE DATE EN ETENDU                                           00054   
  *   APPEL : CALL Y2KSIECLE                                            00055   
  *   PARAMETRES:VARIABLES EN WORKING                                   00056   
  *              Y2K_DELTA   DELTA A APPLIQUER (INITIALISE A 0)         00057   
  *              Y2K_ORIGINE REPRESENTANT LA DATE D'ORIGINE             00058   
  *              Y2K_RESULTA, Y2K_SSAA, Y2K_SS, Y2K_AA RESULTATS        00059   
  *                                                                     00060   
  *   ENTREES:   Y2K_ORIGINE DOIT CONTENIR LA DATE D'ORIGINE            00061   
  *              Y2K_DELTA   DOIT CONTENIR LE DELTA A APPLIQUER         00062   
  *                                                                     00063   
  *   RESULTATS :Y2K_RESULTA CHAR(8) DATE COMPLETE                      00064   
  *              Y2K_SIECLE CHAR(2) SIECLE EN CHAR                      00065   
  *              Y2K_RESULTNUM DATE COMPLETE EN PIC 9                   00066   
  *              Y2K_SSNUM PIC 99  SIECLE EN PIC 9                      00067   
  *              Y2K_AANUM PIC 99  ANNEE EN PIC 9                       00068   
  *              Y2K_MMNUM PIC 99  MOIS  EN PIC 9                       00069   
  *              Y2K_JJNUM PIC 99  JOUR  EN PIC 9                       00070   
  *              Y2K_SSAAMMNUM PIC 999999 SSAAMM    EN PIC 9            00071   
  *              Y2K_SSAANUMPIC 9999 ANNEE COMPLETE EN PIC 9            00072   
  *                                                                     00073   
  *   POUR UNE DATE EN PACKE                                            00074   
  *   APPEL : CALL Y2KSIECLEP2 SI ORIGINE = AA                          00075   
  *           CALL Y2KSIECLEP4 SI ORIGINE = AAMM                        00076   
  *           CALL Y2KSIECLEP6 SI ORIGINE = AAMMJJ                      00077   
  *   PARAMETRES:VARIABLES EN WORKING                                   00078   
  *              Y2K_DELTA   DELTA A APPLIQUER (INITIALISE A 0)         00079   
  *              Y2K_ORIGINPACK          DATE D'ORIGINE                 00080   
  *              Y2K_RESULTPACK          DATE RESULTAT                  00081   
  *   ENTREES :                                                         00082   
  *              Y2K_ORIGINPACK DOIT CONTENIR LA DATE D'ORIGINE         00083   
  *              Y2K_DELTA   DOIT CONTENIR LE DELTA A APPLIQUER         00084   
  *   RESULTATS :                                                       00085   
  *              Y2K_RESULTPACK CONTIENDRA LA DATE RESULTAT             00086   
  *                 COMPLETE AU FORMAT DEC FIXED(9,0)                   00087   
  *-----------------------------------------------------------------    00088   
  *   EXEMPLES :                                                        00089   
  *          W_AA CONTIENT LA DATE D'ORIGINE AA                         00090   
  *          W_AAAA DOIT RECEVOIR LE RESULTAT SSAA                      00091   
  *          W_DELT CONTIENT LE DELTA A APPLIQUER A AA                  00092   
  *       Y2K_ORIGINPACK = W_AA                                         00093   
  *       Y2K_DELTA      = W_DELT                                       00094   
  *       CALL Y2KSIECLEP2                                              00095   
  *        W_AAAA         = Y2K_RESULTPACK                              00096   
  *                                                                     00097   
  *          W_AAMM CONTIENT LA DATE D'ORIGINE AAMM                     00098   
  *          W_AAAAMM DOIT RECEVOIR LE RESULTAT SSAAMM                  00099   
  *       Y2K_ORIGINPACK = W_AAMM                                       00100   
  *       CALL Y2KSIECLEP4                                              00101   
  *       W_AAAAMM       = Y2K_RESULTPACK                               00102   
  *                                                                     00103   
  *          W_AAMMJJ CONTIENT LA DATE D'ORIGINE AAMMJJ                 00104   
  *          W_AAAAMMJJ DOIT RECEVOIR LE RESULTAT SSAAMMJJ              00105   
  *       Y2K_ORIGINPACK = W_AAMMJJ                                     00106   
  *       CALL Y2KSIECLEP6                                              00107   
  *       W_AAAAMMJJ     = Y2K_RESULTPACK                               00108   
  *                                                                     00109   
  ===============================================================*/     00110   
         /**********************************************************/   00111   
         /* ZONES DE TRAVAIL POUR MODULES AN 2000                  */   00112   
         /**********************************************************/   00113   
         /* ZONES ALLOUEES = STRUCTURE UNIQUE Y2K_W                */   00114   
         /**********************************************************/   00115   
                                                                        00116   
 DCL 01 Y2K_PLIW,                          /* ZONE GENERALE          */ 00117   
   02  Y2K_PO       PIC'99'   INIT('0') ,  /* POSITION DANS VALEUR   */ 00118   
   02  IY2K_POD  BIN FIXED(15,0) INIT (0) ,/* POSITION DECENNIE      */ 00119   
   02  IY2K_POSI BIN FIXED(15,0) INIT (0) ,/* POSITION BUFFER IN     */ 00120   
   02  IY2K_RES  BIN FIXED(15,0) INIT (0) ,/* INDICE DE RESULTAT     */ 00121   
   02  Y2K_RESA,                           /*  5 ZONES RESULTATS     */ 00122   
       03 Y2K_RESULT(5) FIXED DEC(1,0) ,   /*                        */ 00123   
   02  Y2K_VALEUR CHAR(5) INIT('�����') ,  /* TABLEAU DE VALEURS     */ 00124   
   02  Y2K_DECENNIE ,                      /* POSITIONS DECENNIES    */ 00125   
          03 Y2K_POSDE(4)  PIC'S999' ,     /*   4 POSSIBILITES       */ 00126   
          03 Y2K_FIL01     PIC'S999' ,     /*   >0 OU <0             */ 00127   
   02  Y2K_POSDE_FLAG      CHAR(1) ,       /* ='O' SI POSDE < 0      */ 00128   
   02  Y2K_ARGUM1       CHAR(999) ,        /*  ARGUMENT1             */ 00129   
   02  Y2K_ARGUM2       CHAR(999) ,        /*  ARGUMENT2             */ 00130   
         02 Y2K_DELTA   PIC'S99' INIT(0),  /*  SS EN SORTIE          */ 00131   
         02 Y2K_SIECLE     CHAR(02),       /*  SS EN SORTIE          */ 00132   
         02 Y2K_ORIGINE    CHAR(06);       /*  AAMMJJ EN ENTREE      */ 00133   
         /**********************************************************/   00134   
         /* REDEFINITIONS SUR LES ZONES DE Y2K_W                   */   00135   
         /**********************************************************/   00136   
   DCL    Y2K_RESULTA CHAR(8)              /*  RESULTA SSAAMMJJ      */ 00137   
       BASED(ADDR(Y2K_SIECLE));                                         00138   
   DCL    Y2K_SSAANUM PIC'9999'            /*  RESULTA SSAA EN PIC9  */ 00139   
       BASED(ADDR(Y2K_SIECLE));                                         00140   
   DCL    Y2K_SSAAMMNUM PIC'999999'        /*  RESULTA SSAAMM  PIC9  */ 00141   
       BASED(ADDR(Y2K_SIECLE));                                         00142   
   DCL    Y2K_RESULTNUM PIC'99999999'      /*  RESULTA TOTAL   PIC9  */ 00143   
       BASED(ADDR(Y2K_SIECLE));                                         00144   
   DCL 1  Y2K_AZERTYU                                                   00145   
       BASED(ADDR(Y2K_SIECLE)),                                         00146   
         2 Y2K_SSNUM PIC'99',              /*  RESULTA SS   EN PIC9  */ 00147   
         2 Y2K_AANUM PIC'99',              /*  RESULTA AA   EN PIC9  */ 00148   
         2 Y2K_MMNUM PIC'99',              /*  RESULTA MM   EN PIC9  */ 00149   
         2 Y2K_JJNUM PIC'99';              /*  RESULTA JJ   EN PIC9  */ 00150   
   DCL    Y2K_ZYBHKW  CHAR(2)              /*   ZONE AA EN ENTREE    */ 00151   
       BASED(ADDR(Y2K_ORIGINE));                                        00152   
   DCL    Y2K_ORIGINPACK DEC FIXED(9,0)    /*                        */ 00153   
       BASED(ADDR(Y2K_SIECLE));            /*                        */ 00154   
   DCL    Y2K_RESULTPACK DEC FIXED(9,0)    /*                        */ 00155   
       BASED(ADDR(Y2K_SIECLE));            /*                        */ 00156   
   DCL 01 Y2K_RESB      BASED(ADDR(Y2K_RESA)),                          00157   
       03 Y2K_RESULT1   FIXED DEC(1,0) ,   /* POUR SIMULER LE 88     */ 00158   
       03 Y2K_RESULT2   FIXED DEC(1,0) ,   /* COBOL : -1 , 0 , +1    */ 00159   
       03 Y2K_RESULT3   FIXED DEC(1,0) ,   /*  POUR   <    =    >    */ 00160   
       03 Y2K_RESULT4   FIXED DEC(1,0) ,   /*                        */ 00161   
       03 Y2K_RESULT5   FIXED DEC(1,0) ;   /*                        */ 00162   
   DCL 01 Y2K_TABVAL BASED(ADDR(Y2K_VALEUR)) ,                          00163   
          02 Y2K_ANX(5) CHAR(1) ;          /*                        */ 00164   
   DCL 01 Y2K_ARG1   BASED(ADDR(Y2K_ARGUM1)) ,                          00165   
          02 Y2K_ARG1X(999) ,              /*   ARGUMENT1 EN TABLEAU */ 00166   
            03 Y2K_ARGN1  PIC'9' ;         /*   DE CHIFFRES          */ 00167   
   DCL 01 Y2K_ARG11  BASED(ADDR(Y2K_ARGUM1)) ,                          00168   
          02 Y2K_AR11X(999) ,              /*   ARGUMENT1 EN TABLEAU */ 00169   
            03 Y2K_ARGX1  CHAR(1);         /*   DE CARACTERES        */ 00170   
   DCL 01 Y2K_ARG2   BASED(ADDR(Y2K_ARGUM2)) ,                          00171   
          02 Y2K_ARG2X(999) ,              /*   ARGUMENT2 EN TABLEAU */ 00172   
            03 Y2K_ARGN2  PIC'9' ;         /*   DE CHIFFRES          */ 00173   
   DCL 01 Y2K_ARG22  BASED(ADDR(Y2K_ARGUM2)) ,                          00174   
          02 Y2K_AR22X(999) ,              /*   ARGUMENT2 EN TABLEAU */ 00175   
            03 Y2K_ARGX2  CHAR(1);         /*   DE CHIFFRES          */ 00176   
       /********************************************/                   00177   
       /*  MODULE DE COMPARAISON DE DATE  AN 2000  */                   00178   
       /********************************************/                   00179   
       Y2KCOMP1: PROC ;                                                 00180   
           IY2K_RES = 1 ;                                               00181   
           CALL Y2KCOMP ;                                               00182   
       END Y2KCOMP1 ;                                                   00183   
       /********************************************/                   00184   
       Y2KCOMP2:  PROC ;                                                00185   
           IY2K_RES = 2 ;                                               00186   
           CALL Y2KCOMP ;                                               00187   
       END Y2KCOMP2 ;                                                   00188   
       /********************************************/                   00189   
       Y2KCOMP3:  PROC ;                                                00190   
           IY2K_RES = 3 ;                                               00191   
           CALL Y2KCOMP ;                                               00192   
       END Y2KCOMP3 ;                                                   00193   
       /********************************************/                   00194   
       Y2KCOMP4: PROC ;                                                 00195   
           IY2K_RES = 4 ;                                               00196   
           CALL Y2KCOMP ;                                               00197   
       END Y2KCOMP4 ;                                                   00198   
       /********************************************/                   00199   
       Y2KCOMP5: PROC ;                                                 00200   
           IY2K_RES = 5 ;                                               00201   
           CALL Y2KCOMP ;                                               00202   
       END Y2KCOMP5 ;                                                   00203   
       /********************************************/                   00204   
       Y2KCOMP  : PROCEDURE ;                                           00205   
           IY2K_POD = 1 ;                                               00206   
       Y2KCOMP2 :                                                       00207   
           IF Y2K_POSDE(IY2K_POD) = 0 THEN GO TO Y2KCOMP5 ;             00208   
           IF Y2K_POSDE(IY2K_POD) < 0 THEN                              00209   
           DO ;                                                         00210   
              Y2K_POSDE_FLAG = 'N' ;                                    00211   
              IY2K_POSI = - Y2K_POSDE(IY2K_POD) ;                       00212   
           END ;                                                        00213   
           ELSE                                                         00214   
           DO ;                                                         00215   
              Y2K_POSDE_FLAG = 'O' ;                                    00216   
              IY2K_POSI = Y2K_POSDE(IY2K_POD) ;                         00217   
           END ;                                                        00218   
           IF Y2K_ARGX1(IY2K_POSI) < '0' !                              00219   
              Y2K_ARGX1(IY2K_POSI) > '4'                                00220   
                                   THEN GO TO Y2KCOMP3 ;                00221   
           IF Y2K_POSDE_FLAG = 'O' &                                    00222   
              Y2K_ARGX1(IY2K_POSI)     = '0' &                          00223   
              Y2K_ARGX1(IY2K_POSI + 1) = '0' &                          00224   
              Y2K_ARGX1(IY2K_POSI + 2) = '0' &                          00225   
              Y2K_ARGX1(IY2K_POSI + 3) = '0'                            00226   
                                    THEN GO TO Y2KCOMP3 ;               00227   
           Y2K_PO = Y2K_ARGN1(IY2K_POSI) + 1 ;                          00228   
           Y2K_ARGX1(IY2K_POSI) = Y2K_ANX(Y2K_PO) ;                     00229   
       Y2KCOMP3 :                                                       00230   
           IF Y2K_POSDE_FLAG = 'O' &                                    00231   
              Y2K_ARGX1(IY2K_POSI)     = '9' &                          00232   
              Y2K_ARGX1(IY2K_POSI + 1) = '9' &                          00233   
              Y2K_ARGX1(IY2K_POSI + 2) = '9' &                          00234   
              Y2K_ARGX1(IY2K_POSI + 3) = '9'                            00235   
           THEN  Y2K_ARGX1(IY2K_POSI)  = Y2K_ANX(5) ;                   00236   
           IF Y2K_ARGX2(IY2K_POSI) < '0' !                              00237   
              Y2K_ARGX2(IY2K_POSI) > '4'                                00238   
                                   THEN GO TO Y2KCOMP4 ;                00239   
           IF Y2K_POSDE_FLAG = 'O' &                                    00240   
              Y2K_ARGX2(IY2K_POSI)     = '0' &                          00241   
              Y2K_ARGX2(IY2K_POSI + 1) = '0' &                          00242   
              Y2K_ARGX2(IY2K_POSI + 2) = '0' &                          00243   
              Y2K_ARGX2(IY2K_POSI + 3) = '0'                            00244   
                                    THEN GO TO Y2KCOMP4 ;               00245   
           Y2K_PO = Y2K_ARGN2(IY2K_POSI) + 1 ;                          00246   
           Y2K_ARGX2(IY2K_POSI) = Y2K_ANX(Y2K_PO) ;                     00247   
       Y2KCOMP4 :                                                       00248   
           IF Y2K_POSDE_FLAG = 'O' &                                    00249   
              Y2K_ARGX2(IY2K_POSI)     = '9' &                          00250   
              Y2K_ARGX2(IY2K_POSI + 1) = '9' &                          00251   
              Y2K_ARGX2(IY2K_POSI + 2) = '9' &                          00252   
              Y2K_ARGX2(IY2K_POSI + 3) = '9'                            00253   
           THEN  Y2K_ARGX2(IY2K_POSI)  = Y2K_ANX(5) ;                   00254   
           IY2K_POD = IY2K_POD + 1 ;                                    00255   
           GO TO Y2KCOMP2 ;                                             00256   
       Y2KCOMP5 :                                                       00257   
           IF Y2K_ARGUM1 > Y2K_ARGUM2 THEN                              00258   
           DO ;                                                         00259   
              Y2K_RESULT(IY2K_RES) = 1    ;                             00260   
              GO TO F_Y2KCOMP ;                                         00261   
           END ;                                                        00262   
           IF Y2K_ARGUM1 < Y2K_ARGUM2 THEN                              00263   
           DO ;                                                         00264   
              Y2K_RESULT(IY2K_RES) = -1   ;                             00265   
              GO TO F_Y2KCOMP ;                                         00266   
           END ;                                                        00267   
              Y2K_RESULT(IY2K_RES) = 0    ;                             00268   
                                                                        00269   
       F_Y2KCOMP : /* IY2K_RES = IY2K_RES + 1 ; */                      00270   
       END Y2KCOMP ;                                                    00271   
                                                                        00272   
 /*-------------------------------------------------------*/            00273   
 /* MODULE DE DETERMINATION DU SIECLE : FENETRE = 50      */            00274   
 /*-------------------------------------------------------*/            00275   
 /* DATE ORIGINE ETENDU 2 (AA) 4 (AAMM) OU 6 (AAMMJJ)     */            00276   
 /* DATE RESULTAT ETENDU 4 (SSAA) 6 (SSAAMM) 8 (SSAAMMJJ) */            00277   
 /*-------------------------------------------------------*/            00278   
 Y2KSIECLE: PROC ;                                                      00279   
     IF (Y2K_ZYBHKW >= '00' & Y2K_ZYBHKW <= '99' ) THEN                 00280   
     DO ;                                                               00281   
        IF Y2K_ZYBHKW < '50' THEN                                       00282   
           Y2K_SIECLE = '20' ;                                          00283   
        ELSE                                                            00284   
           Y2K_SIECLE = '19' ;                                          00285   
        Y2K_SSAANUM = Y2K_SSAANUM + Y2K_DELTA ;                         00286   
        IF Y2K_SSAANUM < 1950 THEN                                      00287   
           Y2K_SSAANUM =     Y2K_SSAANUM +     100 ;                    00288   
        IF Y2K_SSAANUM > 2049 THEN                                      00289   
           Y2K_SSAANUM =     Y2K_SSAANUM -     100 ;                    00290   
     END ;                                                              00291   
     ELSE                                                               00292   
        Y2K_SIECLE =  Y2K_ZYBHKW ;                                      00293   
 END Y2KSIECLE ;                                                        00294   
 /*-------------------------------------------------------*/            00295   
 /* DATE ORIGINE PACKE AA                                 */            00296   
 /* DATE RESULTAT PACKE SSAA                              */            00297   
 /*-------------------------------------------------------*/            00298   
 Y2KSIECLEP2: PROC ;                                                    00299   
     IF Y2K_ORIGINPACK < 50 THEN                                        00300   
        Y2K_ORIGINPACK =  Y2K_ORIGINPACK + 2000 ;                       00301   
     ELSE                                                               00302   
        Y2K_ORIGINPACK =  Y2K_ORIGINPACK + 1900 ;                       00303   
     Y2K_ORIGINPACK = Y2K_ORIGINPACK + Y2K_DELTA ;                      00304   
     IF Y2K_ORIGINPACK < 1950 THEN                                      00305   
        Y2K_ORIGINPACK =  Y2K_ORIGINPACK +  100 ;                       00306   
     IF Y2K_ORIGINPACK > 2049 THEN                                      00307   
        Y2K_ORIGINPACK =  Y2K_ORIGINPACK -  100 ;                       00308   
 END Y2KSIECLEP2 ;                                                      00309   
 /*-------------------------------------------------------*/            00310   
 /* DATE ORIGINE PACKE AAMM                               */            00311   
 /* DATE RESULTAT PACKE SSAAMM                            */            00312   
 /*-------------------------------------------------------*/            00313   
 Y2KSIECLEP4: PROC ;                                                    00314   
     IF Y2K_ORIGINPACK < 5000 THEN                                      00315   
        Y2K_ORIGINPACK =  Y2K_ORIGINPACK + 200000 ;                     00316   
     ELSE                                                               00317   
        Y2K_ORIGINPACK =  Y2K_ORIGINPACK + 190000 ;                     00318   
     Y2K_ORIGINPACK = Y2K_ORIGINPACK + 100*Y2K_DELTA ;                  00319   
     IF Y2K_ORIGINPACK < 195000 THEN                                    00320   
        Y2K_ORIGINPACK =  Y2K_ORIGINPACK +  10000 ;                     00321   
     IF Y2K_ORIGINPACK >= 205000 THEN                                   00322   
        Y2K_ORIGINPACK =  Y2K_ORIGINPACK -  10000 ;                     00323   
 END Y2KSIECLEP4 ;                                                      00324   
 /*-------------------------------------------------------*/            00325   
 /* DATE ORIGINE PACKE AAMMJJ                             */            00326   
 /* DATE RESULTAT PACKE SSAAMMJJ                          */            00327   
 /*-------------------------------------------------------*/            00328   
 Y2KSIECLEP6: PROC ;                                                    00329   
     IF Y2K_ORIGINPACK < 500000 THEN                                    00330   
        Y2K_ORIGINPACK =  Y2K_ORIGINPACK + 20000000 ;                   00331   
     ELSE                                                               00332   
        Y2K_ORIGINPACK =  Y2K_ORIGINPACK + 19000000 ;                   00333   
     Y2K_ORIGINPACK = Y2K_ORIGINPACK + 10000*Y2K_DELTA ;                00334   
     IF Y2K_ORIGINPACK < 19500000 THEN                                  00335   
        Y2K_ORIGINPACK =  Y2K_ORIGINPACK +  1000000 ;                   00336   
     IF Y2K_ORIGINPACK >= 20500000 THEN                                 00337   
        Y2K_ORIGINPACK =  Y2K_ORIGINPACK -  1000000 ;                   00338   
 END Y2KSIECLEP6 ;                                                      00339   
 /*    END INCLUDE++                                                  */        
 /*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/15980   
0          END ID470RA;                                                 15981   
